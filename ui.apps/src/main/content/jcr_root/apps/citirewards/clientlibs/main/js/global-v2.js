window.citiConfig = (function() {
    'use strict';

    var endPointHost = "../../../../js/mock-endpoints/";
    var categoryEndPointPath = "mock-category-brands/alphabetical/";
    var productListingEndPointPath = "mock-product-listing/";
    var searchResultsEndPointPath = "mock-search/";
    var mfaEndPointPath = "mock-mfa/";
    var pointsTransferDetailEndPointPath = "mock-points-transfer-detail/";
    var handlebarTemplatesDir = '../../../../templates.hbs/';

    return {
        categoryEndPointPath: categoryEndPointPath,
        endPointHost: endPointHost,
        handlebarTemplatesDir: handlebarTemplatesDir,
        productListingEndPointPath: productListingEndPointPath,
        searchResultsEndPointPath: searchResultsEndPointPath,
        mfaEndPointPath: mfaEndPointPath,
        pointsTransferDetailEndPointPath: pointsTransferDetailEndPointPath
    };
})();

/* global L */
/**
 * JSHint:
 * To allow bracket notation,
 * For example, test["placeholder"] vs test.placeholder
 */

/*jshint sub:true*/

/**
 * Object shared across different countries
 */
var citiShare = (function () {
  "use strict";


  var pubsub = null;

  var Keyboard = {
    ENTER: 13,
    TAB: 9,
    ESCAPE: 27,
    SPACE: 32,
    LEFT: 37,
    RIGHT: 39,
    UP: 38,
    DOWN: 40
  };

  var Header = {
    mobileMenuInstantiated: false,
    desktopMenuInstantiated: false,
    windowWidth: window.innerWidth || $(window).width(),
    searchOpen: false,
    isResizing: false,
    openedSubNav: null,
    resizingTimeout: null,
    searchIcon: $('#desktop-header-search .control i, #mobile-header-search .control i')
  };

  //ini

  /**
   * Header and Menu Initializations
   */
  function _initializeMenu() {
    $(window).bind('resize', function () {
      Header.isResizing = true;
      Header.windowWidth = window.innerWidth || $(window).width();

      if (Header.windowWidth < 960 && !Header.mobileMenuInstantiated) {
        initMobile();
      }
      if (Header.windowWidth >= 960 && !Header.mobileMenuInstantiated) {
        initDesktop();
      }

      if ($("#header-desktop").css("display") === "block" && $(".oc-container").hasClass("oc-push")) {
        $('#menu-button').click();
      }

      if (Header.resizingTimeout) {
        clearTimeout(Header.resizingTimeout);
      }
      Header.resizingTimeout = setTimeout(function () {
        Header.isResizing = false;
      }, 2000);

    }).trigger('resize');

    setupMenus();
    setupMobileTabletSearch();
    setupAccountNameOverflow();
    setupNavigationa11y();
    setupPlaceholder();
  }

  function setupPlaceholder() {
    $('input').on('keyup focus', function () {
      $(this).prev('label').addClass('visible');
    });

    $('input').on('blur', function () {
      if ($(this).val().length <= 0) {
        $(this).prev('label').removeClass('visible');
      }
    });
  }

  /**
   * Function to determine on page load the width of the window and whether or not
   * to use the initMobile() or the initDesktop()
   *
   * @param sParam (windoWidth)
   */
  function setupMenus(sParam) {
    if (sParam < 960) {
      initMobile();
    } else {
      initDesktop();
    }
  }

  /**
   * Initializes the mobile version of the header
   */
  function initMobile() {
    setupMobileMenu();
    mobileFilterList();
    $('body').removeClass('init');
    Header.mobileMenuInstantiated = true;
  }

  /**
   * Initializes the desktop version of the header
   */
  function initDesktop() {
    $('body').addClass('init');
    setupDesktopMenu();
    Header.desktopMenuInstantiated = true;
  }

  /**
   * Setups skip naviation
   */
  function setupNavigationa11y() {
    $('.skipnav').on('click', function () {

      setTimeout(function () {
        if ($('h1').length > 0) {
          $('h1').attr('tabindex', '0').focus();
        } else {
          $('h2').attr('tabindex', '0').focus();
        }
      }, 500);
    });
  }

  /**
   * Starts the accessibleMegaMenu javascript for the header implementation
   */
  function setupDesktopMenu() {
    $('.megamenu').accessibleMegaMenu();
    // hack so that the megamenu doesn't show flash of css animation after the page loads.
    $('body').removeClass('init');
  }


  /**
   * Gets URL parameters
   *
   * @param sParam
   * @returns {string}
   */
  function _getUrlParameter(sParam) {

    if (sParam) {
      var sPageURL = window.location.search.substring(1);
      var sURLVariables = sPageURL.split('&');

      for (var i = 0; i < sURLVariables.length; i++) {

        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] === sParam) {
          return sParameterName[1];
        }
      }
    }

  }

  function mobileFilterList() {
    $(".filter-subnav-control").bind('click.citishare', function (e) {
      var $this = $(this);
      var $subnav = $('.' + $this.attr('aria-controls'));

      openSubNav($subnav, $this);

      $subnav.find('.sub-nav-back').bind('click touchend', function (e) {
        closeSubNav($subnav, $this);
        $(this).unbind('click');
        setTimeout(function () {
          $('#mobile-menu a:visible:first').focus();
        }, 25);
        e.preventDefault();
        return false;
      });

      e.preventDefault();
      return false;
    });
  }

  /**
   * Sets up the mobile menu
   */
  function setupMobileMenu() {

    $('.mobile-subnav-control').bind('click.citishare', function (e) {
      var $this = $(this);
      var $subnav = $('#' + $this.attr('aria-controls'));

      openSubNav($subnav, $this);

      $subnav.find('.sub-nav-back').bind('click touchend', function (e) {
        closeSubNav($subnav, $this);
        $(this).unbind('click');
        setTimeout(function () {
          $('#mobile-menu a:visible:first').focus();
        }, 25);
        e.preventDefault();
        return false;
      });

      e.preventDefault();
      return false;
    });

    /**
     * Triggers close search and removes padding top when
     * browser is resized to larger than tablet 960px
     *
     * Conditions: If the browser width is larger than tablet,
     * and search bar is opened (true state set in openSearch())
     */
    $(window).bind('resize', function () {
      if (Header.windowWidth > 960 && Header.searchOpen) {
        closeSearch();
      }
    });

    initMenu();
  }

  /**
   * Tablet Search Implementation
   */
  function setupMobileTabletSearch() {

    var searchForm = $('#desktop-search-form, #mobile-search-form');

    $("#desktop-header-search a, #mobile-header-search a, #desktop-header-search-form a").on('click', function (e) {
      if ($(e.currentTarget).attr('aria-controls') === "search") {
        if ($("#search").val() === "") {
          return false;
        }
      } else {
        if($("#responsive-page").val() !== "none-responsive"){
          if (Header.windowWidth < 1260) {
            searchBoxAction();
          } else {
            closeSearch();
          }
        } else {
          searchBoxAction();
        }
      }
    });
    $(window).bind('resize', function () {

      if (Header.windowWidth >= 1260) {
        $('#desktop-search-form').attr('aria-hidden', false);

        /**
         * If the search form is opened from mobile view,
         * and the browser is resized to desktop view,
         * close the opened search form.
         */
        if (searchForm.hasClass("opened")) {
          return searchForm.removeClass("opened");
        }
      } else {
        $('#desktop-search-form').attr('aria-hidden', true);
      }
    }).trigger('resize');
  }

  function searchBoxAction(){
    if (Header.searchIcon.hasClass('hide-search')) {
      openSearch();
    } else {
      closeSearch();
    }
  }
  /**
   * Opens the sub nav in mobile view
   */
  function openSubNav(subnav, subnavTitle) {
    subnav.attr('aria-expanded', true).attr('aria-hidden', false).addClass('opened');
    subnavTitle.attr('aria-expanded', true);
    subnavTitle.addClass('sub-menu-opened').attr('aria-hidden', true);
    Header.openedSubNav = subnavTitle;

    setTimeout(function () {
      $('#mobile-menu > ol > li > a').not('.sub-menu-opened').parent().each(function (i, elem) {
        $(elem).attr('aria-hidden', true);
      });
      $('#oc-trigger').attr('aria-hidden', true);
      $('.sub-nav-back:visible:first').focus();
    }, 25);
  }

  /**
   * Closes the sub nav in mobile view
   */
  function closeSubNav(subnav, subnavTitle) {
    subnav.removeClass('opened').attr('aria-expanded', false).attr('aria-hidden', true);
    subnavTitle.attr('aria-expanded', true).blur();
    $('#mobile-menu > ol > li > a').not('.sub-menu-opened').parent().each(function (i, elem) {
      $(elem).removeAttr('aria-hidden');
    });
    $('#oc-trigger').removeAttr('aria-hidden');

    subnavTitle.removeClass('sub-menu-opened');
    subnavTitle.removeAttr('aria-hidden');
    setTimeout(function () {
      Header.openedSubNav.focus();
    }, 50);
  }

  /**
   * Open search in the header when still not in mobile view
   */
  function openSearch() {
    Header.searchIcon.removeClass('hide-search');
    Header.searchOpen = true;
    Header.searchIcon.removeClass('icon_search').addClass('icon_x close-search');

    if (Header.windowWidth < 960) {
      $('main.oc-content').css({
        'padding-top': '42px'
      });
    }

    $('#mobile-header-account-info').addClass('search-open');
    $('#mobile-account-menu-logged-out').addClass('search-open');
    $('#desktop-header-search a, #desktop-header-search, #mobile-header-search a, #mobile-header-search').addClass('opened');
    $('#desktop-search-form, #mobile-search-form').addClass('opened');
    $('#desktop-search-form, #mobile-search-form').attr('aria-hidden', 'false');
    $('#desktop-search-form input, #mobile-header-search input').focus();
    setTimeout(function () {
      $('#desktop-search-form input, #mobile-header-search input').focus();
    }, 50);

    $("#mobile-header-search input").css({'padding': '0 5px', 'margin-left': '0'});
    $('.modal-points-transfer').css('top', '170px');
  }

  /**
   * Close search in the header
   */
  function closeSearch() {

    Header.searchOpen = false;
    $("#mobile-header-search input").css({'padding': '13px 16px 12px 10px', 'margin-left': '0'});
    Header.searchIcon.addClass('hide-search');
    Header.searchIcon.removeClass('icon_x').addClass('icon_search');
    $('#desktop-header-search a, #mobile-header-search a').removeClass('opened');
    $('#mobile-header-account-info').removeClass('search-open');
    $('#mobile-account-menu-logged-out').removeClass('search-open');
    $('main.oc-content').css({
      'padding-top': 0
    });
    $('#desktop-search-form, #mobile-search-form').removeClass('opened');
    $('#desktop-header-search input, #mobile-header-search input').blur();
    $('#desktop-header-search a, #mobile-header-search a').blur();
    $('#desktop-search-form, #mobile-search-form').attr('aria-hidden', 'true');
    $('#desktop-search-form input, #mobile-header-search input').unbind('blur');
    $("#mobile-header-search input").css({'padding': '0'});
    $(window).unbind('keyup');
    $('.modal-points-transfer').css('top', '138px');
  }


  /**
   * Account Name overflow function
   */
  function setupAccountNameOverflow() {

    // Desktop name
    var height = '30px';
    var $name = $('#account-menu-logged-in .greeting');
    var $points = $('#account-menu-logged-in .points');
    var $parent = $('#account-menu-logged-in > a');
    if ($name.length <= 0) {
      return false;
    }

    $name.bind('change', function () {
      console.log($name.text().length);
    });

    var len = $name.text().length;

    var elem = $name.get(0);
    //if text is overflowing container
    if (len < 36) {
      $name.css({
        'font-size': '13px'
      });
      $points.css({
        'font-size': '13px'
      });
    }
    if (elem.offsetWidth < elem.scrollWidth) {


      if (len >= 37 && len < 86) {
        $name.css({
          'height': 'auto',
          'padding-right': '7px',
          'white-space': 'normal',
          'word-break': 'break-word'
        });
        $parent.css({
          'padding': '6px 10px 3px 10px'
        });
        $points.css({
          'font-size': '11px'
        });

      }
      //two lines needs dotdotdot
      if (len >= 86) {

        $parent.css({
          'padding': '5px 10px'
        });
        $name.css({
          'height': '25px',
          'font-size': '9px',
          'padding-right': '7px'
        });

        $name.dotdotdot();
        $('#account-menu-logged-in').hover(
          function () {
            $name.css({
              'height': 'auto',
              'margin-bottom': '10px',
              'font-size': '11px'
            });
            $name.trigger("originalContent", function (content) {
              $name.empty().append(content);
            });
          },
          function () {
            $name.css({
              'height': height
            });
            $name.dotdotdot();
          }
        );
      }

    }

    // Mobile name
    var $mobileGreeting = $('#mobile-header-account-info .greeting');
    if ($mobileGreeting.length > 0 && $mobileGreeting.text().length > 64) {
      $mobileGreeting.css({
        height: '40px',
        'word-wrap': 'break-word'
      });
      $mobileGreeting.dotdotdot({
        watch: true
      });
    }

  }

  /**
   * Initializes and resets the menu for mobile only
   */
  function initMenu() {

    var $menu = $('#mobile-menu');
    var $menuTrigger = $('#oc-trigger');
    var $trigger = $('#menu-button');
    var isOpen = false;

    $trigger.attr('aria-expanded', 'false');
    $trigger.attr('aria-label', 'Menu');
    $trigger.attr('aria-controls', 'mobile-menu');

    $menu.attr('aria-hidden', 'true');
    $menu.attr('aria-labelledby', 'menu-button');

    var $container = $('#oc-container');


    function resetMenu() {
      $menuTrigger.find('> a, > div').not('#menu-button').removeAttr('aria-hidden');
      $trigger.attr('aria-expanded', 'false');
      $menu.attr('aria-hidden', 'true');
      $container.removeClass('oc-menu-open');
      $container.removeClass('oc-push');
      isOpen = false;
      $trigger.removeClass('opened');
      $trigger.attr('aria-expanded', 'false');
      $menu.attr('aria-hidden', 'true');
      $menu.attr('aria-expanded', 'false');
      $('#menu-button').blur();
      $('.oc-content').removeAttr('aria-hidden');
      $('#footer').removeAttr('aria-hidden');
      $('.back-to-top').removeAttr('aria-hidden');
      $trigger.attr('aria-label', 'Menu');
    }

    function bodyClickFn() {
      if (isOpen) {
        resetMenu();
      }
    }


    $('#mobile-menu a:last').bind('blur', function () {
      $trigger.focus();
    });
    $trigger.bind('blur', function () {
      if ($('.oc-menu-open').length > 0) {
        $('#mobile-menu a:first').focus();
      }
    });

    $('#menu-button').bind('click touchstart', function (ev) {
      if (isOpen) {
        resetMenu();
        return false;
      }
      isOpen = true;
      $menuTrigger.find('> a, > div').not('#menu-button').attr('aria-hidden', true);
      ev.stopPropagation();
      ev.preventDefault();

      $trigger.attr('aria-label', 'Close Menu');
      $trigger.addClass('opened');
      $trigger.attr('aria-expanded', 'true');
      $menu.removeAttr('aria-hidden');
      $menu.attr('aria-expanded', 'true');
      $('.oc-content').attr('aria-hidden', true);
      $('#footer').attr('aria-hidden', true);
      $('.back-to-top').attr('aria-hidden', true);
      setTimeout(function () {
        $('#mobile-menu a:visible:first').focus();
      }, 25);

      $container.addClass('oc-container'); // clear
      $container.addClass('oc-push');
      $container.addClass('oc-menu-open');

      $('.oc-content').bind('click touchstart', bodyClickFn);
    });


    // Handle 'esc' event
    // Keyboard Tweaks via Scott Vinkle
    var escapeMenu = function (ev) {
      if (ev.which === Keyboard.ESCAPE) {
        ev.stopPropagation();
        ev.preventDefault();
        resetMenu();
        $trigger.focus();
      }
    };

    $trigger.bind('keydown', function (ev) {
      escapeMenu(ev);
    });

    $menu.bind('keydown', function (ev) {
      escapeMenu(ev);
    });
  }

  /**
   * Gets parameter by name
   *
   * @param name
   * @returns {string}
   */
  function _getParameterByName(name) {

    var formattedName = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]"),
      regex = new RegExp("[\\?&]" + formattedName + "=([^&#]*)"),
      results = regex.exec(location.search);

    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
  }

  /**
   * Sets up section sub-navs (i.e. travel section cars/hotels/points)
   */
  function _setupSectionSubNavs() {

    var defaultTab = 0;
    // look for default tab class
    if ($('#travel-tabs .default-tab').length > 0) {
      defaultTab = $('#travel-tabs .default-tab').index();
    }

    if ($('#travel-tabs .ui-state-active').length > 0) {
      defaultTab = $('#travel-tabs .ui-state-active').index();
    }

    $('#travel-tabs li').not('.activated').remove();

    $("#travel-tabs").tabs({
      active: defaultTab
    });
  }

  /**
   * Sets up travel validation
   */
  function _setupTravelValidation() {

    $('.sub-section').each(function (i, elem) {
      var $section = $(elem);
      var $inputs = $section.find('input[type="text"]');
      var $errorMessage = $section.find('.error-message').attr('tabindex', 0);


      function validateSection(e) {

        $('.has-error').removeClass('has-error');
        $section.removeClass('has-error');
        var errors = false;
        var errorElements = [];

        //test inputs
        $inputs.each(function (i, elem) {
          if ($(elem).val() === '') {
            errors = true;
            errorElements.push(elem);
          }
        });

        if (errors) {
          $section.addClass('has-error');
          $.each(errorElements, function (i, elem) {
            $(elem).bind('change keyup selectmenuchange', validateSection).addClass('has-error');
          });

          if (e.type === "click") {
            $errorMessage.focus().bind('blur', function () {
              $inputs.first().focus();
            });
          }
          e.preventDefault();
          return false;
        }

      }//end a.btn click event

      $section.find('a.btn').bind('click', validateSection);

    });
  }

  /**
   * Enables functionality for showing/hiding sub sections based upon sub section navs
   */
  function _showHideSubSections() {

    $("li[role='tab']").click(function () {

      $("li[role='tab']:not(this)").attr("aria-selected", "false");
      $(this).attr("aria-selected", "true");

      var tabpanid = $(this).attr("aria-controls");
      var tabpan = $("#" + tabpanid);

      $("div[role='tabpanel']:not(tabpan)").attr("aria-hidden", "true");
      $("div[role='tabpanel']:not(tabpan)").addClass("hidden");

      tabpan.removeClass("hidden");
      tabpan.attr("aria-hidden", "false");
    });
  }

  /**
   * Sets up jquery-ui select menu for select elements (points transfer dropdowns)
   */
  function _selectMenuForElement() {

    $('.dropdown:not(.desktop-filter)').find('select').each(function (i, elem) {
      var $elem = $(elem);
      var settings = {
        width: '100%',
        icons: {
          button: 'icon icon_caret-down'
        }
      };

      if ($elem.attr('data-placeholder')) {
        settings['placeholder'] = $elem.attr('data-placeholder');
      }
      $elem.selectmenu(settings);

      $(window).bind('resize', function () {
        $elem.selectmenu('close');
      });
    });

  }


  /**
   * Adds style for activated menu item
   */
  function _addStyleActivatedMenuItem() {

    $('.main-menu .menu-list > ul').each(function (i, elem) {

      if ($(elem).find('li.activated').length === 1) {
        $(elem).find('li.activated, li.activated > a').css({'border-bottom': '0px solid transparent'});
      }
    });
  }

  /**
   * Adds keyboard accessibility by adding the enter key to the basic click event.
   */
  function _addKeyboardEnterKey() {

    $("li[role='tab']").keydown(function (ev) {

      if (ev.which === Keyboard.ENTER) {
        $(this).click();
      }
    });
  }

  /**
   * _addKeyboardArrowNavigation Implements arrow key access of a jQuery list element.
   * Assumes SlickJS carousel markup if 'slick-slide' is present.
   * @param {Object} $listElement [description]
   * @param {String} itemSelector [description]
   * @param {String} linkSelector [description]
   */
  function _addKeyboardArrowNavigation($listElement, itemSelector, linkSelector) {
    function _helperGetNext($element) {
      return $element.next();
    }

    function _helperGetPrev($element) {
      return $element.prev();
    }

    function _helperGetFirst($element) {
      return $element.parentsUntil('slick-sider').find('.slick-active').first();
    }

    function _helperGetLast($element) {
      return $element.parentsUntil('slick-slider').find('.slick-active').last();
    }

    $listElement.keydown(function (event) {
      var $currentSelection = $(this).find('.active').not('.slick-cloned');
      var $newSelectionContainer = $currentSelection.closest(itemSelector);
      var $activeSlideContainer = $newSelectionContainer.closest('.slick-active') || null;
      var $gotoSlideContainer;
      var $newSelection;

      switch (event.which) {
        case Keyboard.RIGHT:
        case Keyboard.UP:
          // SlideJS carousel detected
          if ($activeSlideContainer.length) {
            $gotoSlideContainer = _helperGetNext($activeSlideContainer);

            // Only select the next active visible slide in the carousel, otherwise move to the first one.
            if (!$gotoSlideContainer.hasClass('slick-active')) {
              $gotoSlideContainer = _helperGetFirst($newSelectionContainer);
            }
            $newSelection = $gotoSlideContainer.find(linkSelector);
          }

          // No SlideJS
          else {
            $newSelection = $currentSelection.closest(itemSelector).next().find(linkSelector);
          }
          break;

        case Keyboard.LEFT:
        case Keyboard.DOWN:
          // SlideJS carousel detected
          if ($activeSlideContainer.length) {
            $gotoSlideContainer = _helperGetPrev($activeSlideContainer);

            // Only select the previous active visible slide in the carousel, otherwise move to the last one.
            if (!$gotoSlideContainer.hasClass('slick-active')) {
              $gotoSlideContainer = _helperGetLast($newSelectionContainer);
            }
            $newSelection = $gotoSlideContainer.find(linkSelector);
          }

          // No SlideJS
          else {
            $newSelection = $currentSelection.closest(itemSelector).prev().find(linkSelector);
          }
          break;

        case Keyboard.ENTER:
          $currentSelection.click();
          event.stopPropagation();
          break;
      }

      // We are at the end of the list.
      if (($newSelection && $newSelection.length === 0) || ($newSelection === undefined)) {
        $newSelection = $currentSelection;
      }

      // Toggle active classes.
      $currentSelection.removeClass('active');
      $newSelection.addClass('active');
    });
  }

  /**
   * Adds keyboard function that pressing an arrow left or arrow right from the tabs toggel the tabs.
   */
  function _addKeyboardLeftRightToggle() {

    $("li[role='tab']").keydown(function (ev) {
      var goto;

      if (ev.which === Keyboard.LEFT) {
        goto = $(this).prev();

        if (goto.length === 0) {
          goto = $('.section-sub-nav ul > li[role="tab"]:last');
        }
      }

      if (ev.which === Keyboard.RIGHT) {
        goto = $(this).next();
        if (goto.length === 0) {
          goto = $('.section-sub-nav ul > li[role="tab"]:first');
        }
      }

      if (goto !== undefined && goto.length > 0) {
        goto.attr("aria-selected", "true").focus();
        $(this).attr("aria-selected", "false");

        var tabpanid = $("li[aria-selected='true']").attr("aria-controls");
        var tabpan = $("#" + tabpanid);
        $("div[role='tabpanel']:not(tabpan)").attr("aria-hidden", "true");
        $("div[role='tabpanel']:not(tabpan)").addClass("hidden");

        tabpan.attr("aria-hidden", "false");
        tabpan.removeClass("hidden");
      }

    });
  }

  /**
   * Legacy accessible modal
   */
  function _getAccessibleModalById() {
    var element;
    var modalObj = [];
    var modalId = [];
    var elements = $('[data-modal-id]');
    if (elements.length) {
      elements.each(function (i, el) {
        element = $(el);
        modalId[i] = element.data('modal-id');
        element.bind('click', function (e) {
          e.preventDefault();
          if ($(this).attr('disabled')) {
            return false;
          }
          if (!modalObj[i]) {
            modalObj[i] = new citiShare.AccessibleModal({
              modal: $('#' + modalId[i]),
              previousElement: e.target
            });
          } else {
            modalObj[i].show();
          }

          return false;
        });
      });
    }
  }

  /**
   * _populateProductList - Populate product listing from an ajax endpoint
   * @param  {Object} $targetContainer [description]
   * @param  {string} templateSelector        [DOM selector for template]
   * @param  {string} productFile             [file name at endpoint]
   */
  function _populateProductList($targetContainer, templateSelector, productFile) {
    var productEndPoint = window.citiConfig.endPointHost + window.citiConfig.productListingEndPointPath + productFile;
    var source = $(templateSelector).html();
    var template = window.Handlebars.compile(source);

    var request = $.ajax({
      url: productEndPoint,
      method: 'GET',
      dataType: 'json'
    });

    request.done(function (data) {
      var output;

      data.products.forEach(function (el) {
        el.pageState = window.citiConfig.state;
        el.country = window.citiConfig.country;
      });
      output = template(data);
      $targetContainer.append(output);

      // add .horizontal-image class to images as needed
      window.setTimeout(function () {
        $('.product-list-image').each(function (i, elem) {
          if ($(elem).width() > $(elem).height()) {
            $(elem).addClass('horizontal-image');
          }
        });
      }, 500);

    });

    request.success(function () {
      // Activate pagination after product list request is successful
      citiShare.pagination.initPagination($(".product-list-item"), ".pagination", 48);
    });

    request.error(function (data) {
      console.log('ajax error:', data);
    });
  }

  /**
   * Generate a quick view section on a PLP
   * @param  {Object} $targetContainer The DOM elem that the template is going to be injected into
   * @param  {String} templateId       The selector
   * @param  {String} productFile      [description]
   * @param  {Number} productId        [description]
   * @param  {function} callback        Func to run after everything is done
   */
  function _getProductDetailItem($targetContainer, templateId, productFile, productId, callback) {
    var productEndPoint = window.citiConfig.endPointHost + window.citiConfig.productListingEndPointPath + productFile;
    var source = $(templateId).html();
    var template = window.Handlebars.compile(source);

    $.ajax({
      url: productEndPoint,
      method: 'GET',
      dataType: 'json'
    })
      .done(function (data) {

        $.each(data.products, function (key, value) {
          var output;
          //Return only the requested product by ID
          if (value.productId === productId) {
            value.productDetail.product.pageState = window.citiConfig.state;
            value.productDetail.product.country = window.citiConfig.country;
            output = template(value.productDetail);
            $targetContainer.append(output);

            if (typeof callback === "function") {
              callback();
            }

            return;
          }
        });


      })
      .fail(function (data) {
        console.log('ajax error:', data);
      });

  }

  /**
   * _populateCategoryList - Populate category list from an ajax endpoint.
   * Loads an alphabetical list of companies for the Category Landing page and navigates to a selected alphabetical list.
   *
   * @param {Object} $element      container element to be populated.
   * @param {String} selectedIndex populate a specific alphabetical list.
   *
   * the selectedEndPoint variable should resove to a string similar to  "mock-endpoints/mock-category-brands/alphabetical/b.json"
   */
  function _populateCategoryList($element, selectedIndex) {
    // Default to the beginning of the alphabetized list if no selection is passed
    var selectedEndPoint = window.citiConfig.endPointHost + window.citiConfig.categoryEndPointPath + selectedIndex + '.json';
    $.getJSON(selectedEndPoint, function (data) {
      var selectedBrandsArray = data.brands;
      _createCategoryList(selectedBrandsArray, $element);
    });
  }

  /**
   * _createCategoryList - Helper function for _populateCategoryList
   * Renders array of brands in the Category Landing page.
   *
   * @param  {Object} brandsArray [description]
   * @param  {Object} $element     jQuery object $element
   */
  function _createCategoryList(brandsArray, $element) {
    var listTemplate = '<ul class="category-list">';

    // Iterate through array of brands.
    for (var i = 0; i < brandsArray.length; i++) {
      listTemplate += '<li class="category-item">';
      listTemplate += '<a href=" ' + brandsArray[i].url + ' " class="copy text-extra-light omniture-category-list-item">' + brandsArray[i].label + '</a>';
      listTemplate += '</li>';
    }

    listTemplate += '</ul>';
    $element.html(listTemplate);
  }


  /**
   * Number stepper
   * @type {{numericStepper}}
   */
  function _numericStepperSetup() {

    var $parentEl = $(".stepper-buttons");
    var $inputStepperEl = $(".numeric-stepper > input");
    var maxQuantity = parseInt($inputStepperEl.attr("max"));
    var minQuantity = parseInt($inputStepperEl.attr("min"));
    var $decreaseButton = $("[data-stepper=decrease]");
    var $increaseButton = $("[data-stepper=increase]");
    var accessibleLiveRegion = $('.buttonset-a11y');

    var changeValue = function changeValue(e) {

      e.preventDefault();
      var getCurrentValue = parseInt($inputStepperEl.val());
      var valueAdjustment = parseInt($(this).attr("data-quantity-adjustment")) || 0; // 0 when its called from pressing enter
      var setValue = getCurrentValue + valueAdjustment;

      if (setValue <= minQuantity) {
        $decreaseButton.prop('disabled', true);
        $inputStepperEl.val(parseInt(minQuantity));
        accessibleLiveRegion.append('Quantity ' + setValue);
        return $increaseButton.prop('disabled', false);
      } else if ((setValue > minQuantity) && (setValue < maxQuantity)) {
        $decreaseButton.prop('disabled', false);
        $inputStepperEl.val(setValue);
        accessibleLiveRegion.append('Quantity ' + setValue);
        return $increaseButton.prop('disabled', false);
      } else {
        $decreaseButton.prop('disabled', false);
        $inputStepperEl.val(parseInt(maxQuantity));
        accessibleLiveRegion.append('Quantity ' + setValue);
        return $increaseButton.prop('disabled', true);
      }

    };

    // Allow numbers only (no decimal)
    $inputStepperEl.numeric({
      decimal: false,
      decimalPlaces: -1
    });

    $inputStepperEl.on('focusout keypress', function (e) {
      // on focusout or enter
      if (e.keyCode === 13 || e.type === "focusout") {
        changeValue(e);
      }
    });

    $parentEl.on("click", changeValue);
  }

  /**
   * Activate product zoom for product details page (PDP)
   * elevateZoom plugin
   * @param {Number} width window resize width
   */
  function _createZoom(width) {

    if ($('#photo').length > 0) {

      var windowWidth = window.innerWidth || $(window).width();

      var map = L.map('photo', {
        zoomControl: false,
        minZoom: 0,
        maxZoom: 4,
        scrollWheelZoom: false,
        center: [0, 0],
        zoom: windowWidth <= 767 ? 0 : 1,
        crs: L.CRS.Simple
      });

      map.touchZoom.disable();
      map.doubleClickZoom.disable();

      var image = $('#photo').data('image');
      var alt = $('#photo').data('alt');

      // dimensions of the image
      var w = $('.product-zoom.show-on-mobile-only')[0].naturalWidth * 2.25,
        h = $('.product-zoom.show-on-mobile-only')[0].naturalHeight * 2.75,
        url = image;

      if (width <= 767) {
        w = 800;
        h = 800;
      }

      // calculate the edges of the image, in coordinate space
      var southWest = map.unproject([0, h], map.getMaxZoom() - 1);
      var northEast = map.unproject([w, 0], map.getMaxZoom() - 1);
      var bounds = new L.LatLngBounds(southWest, northEast);

      // add the image overlay,
      // so that it covers the entire map
      L.imageOverlay(url, bounds).addTo(map);

      // tell leaflet that the map is exactly as big as the image
      map.setMaxBounds(bounds);

      map.on('zoomend', function () {
        if (map.getZoom() === 4) {
          $('.zoom-in').attr('disabled', 'disabled');
          $('.zoom-out').removeAttr('disabled');
          $('.zoom-out').focus();
        } else if (map.getZoom() === 0) {
          $('.zoom-out').attr('disabled', 'disabled');
          $('.zoom-in').removeAttr('disabled');
          $('.zoom-in').focus();
        }
      });

      $('.leaflet-image-layer').attr('alt', alt);

      //bind click events to the zoom in
      $('.zoom-in').bind("click keypress", function (event) {

        if (event.which === 13 || event.type === "click") {
          map.zoomIn();
          $('.zoom-out').removeAttr('disabled');
        }

      });

      //bind click events to the zoom out function
      $('.zoom-out').bind("click keypress", function () {
        if (event.which === 13 || event.type === "click") {
          map.zoomOut();
          $('.zoom-in').removeAttr('disabled');
        }
      });

      setTimeout(function () {
        $(window).on('orientationchange pageshow resize', function () {
          //$("#map").height($(window).height());
          var windowWidth = window.innerWidth || $(window).width();

          if (windowWidth <= 767) {
            map.setZoom(0);
          } else {
            map.setZoom(1);
          }

        });
      }, 1000);
    }
  }


  function _createTabs() {
    /**
     * Activate tabs on product details page (PDP)
     * Jquery UI
     */
    $(".product-detail-tabs").tabs();

    /**
     * Activate tabs on pages which have one
     * Jquery UI
     */
    $(".tabs-module").tabs();

    /**
     * Activate second tab
     */
    $(".product-detail-second-tabs").tabs({
      active: 1
    });
  }


  function _createTooltips() {

  }

  /**
   * Activate button sets
   */
  function _createButtonSets() {
    var _radioDenominationGroup = null;
    var _radioDeliveryGroup = null;

    //verify that the element exists on page.
    if ($('#buttonset-denomination').length > 0) {
      _radioDeliveryGroup = new $A.RadioGroup('buttonset-denomination', 'a.accRadio', 0, '',
        function (selectedRadioNode, radiosArray) {
          $.each(radiosArray, function (i, elem) {
            $(elem).removeClass('active');
            $(elem).removeAttr('aria-describedby');
          });
          $(selectedRadioNode).addClass('active');
          $(selectedRadioNode).attr('aria-describedby', 'denomination-errors');
          _createButtonRules();
        });

      _radioDenominationGroup = new $A.RadioGroup('buttonset-delivery', 'a.accRadio', -1, '',
        function (selectedRadioNode, radiosArray) {
          $.each(radiosArray, function (i, elem) {
            $(elem).removeClass('active');
          });
          $(selectedRadioNode).addClass('active');
          _createButtonRules();
        });

      if ($('#buttonset-delivery > a').length < 2) {
        $('#buttonset-delivery > a').first().trigger('click');
      } else {
        if ($('#buttonset-delivery > a').length > 0) {
          $('.add-to-cart').addClass('notActive');
        }
      }

      if ($('#buttonset-denomination > a').length > 4) {
        $('.buttonset-view-more').show();
        $('#buttonset-denomination > a:gt(3)').hide();
      }


    }
  }

  function _updateProductDataPDP() {
    $('#buttonset-denomination > a').on('click', function () {
      $('.price').html($(this).find('span').html());
    });
  }

  /**
   * update product and quickview name and pricing data
   */
  function _updateProductData() {
    $('body').on('click', '.js-update-product-data', function () {
      var formattedValue;
      var dataCurrencyValue = $(this).attr('data-currency-value');
      var pointsFormat = $('.js-product-price').last().text().replace(/[0-9,]/g, '').trim();

      if (dataCurrencyValue) {
        if ($('.js-product-price').last().text() !== "" && $(this).data('currency-value') !== "") {
          formattedValue = citiShare.formValidation.formatNumericValues($(this).data('currency-value'));
          $('.js-product-price').last().text(formattedValue + ' ' + pointsFormat);
        }
      }

      // AZ:: the above is overcomplicated shrugh. just replace the text within .price span
      $('.js-product-title').find('.price').html($(this).text());

      var isAnonymousText = $(this).data('anonymous');
      $('.js-product-price').last().text($(this).data('anonymous'));

      if (isAnonymousText) {
        formattedValue = citiShare.formValidation.formatNumericValues($(this).data('currency-value'));
      }

      $('.js-product-price').first().text(formattedValue + ' ' + pointsFormat).show();
      $('.text-strikeout').hide();
      $('.placeholder-copy').hide();
      $('.sale-icon').hide();
      $('.sale-ends').hide();


      var dataDefaultPrice = $(this).attr('data-default-price');
      if (dataDefaultPrice) {

        $('.js-product-price').last().text(formattedValue + ' ' + pointsFormat);
        $('.js-product-price').first().hide();
        $('.text-strikeout').show();
        $('.sale-icon').show();
        $('.placeholder-copy').show();
        $('.sale-ends').show();

      }

      // Target GR loggedin state only
      if (window.citiConfig.site === "GR") {
        $('.js-product-price').last().text($(this).data('loggedin'));
        $('.js-product-price').first().text(formattedValue + ' ' + pointsFormat).show();
        $('.js-orginal-price').hide(); // GR logged in state only logic
        $('.text-strikeout').hide();
        $('.placeholder-copy').hide();
        $('.sale-icon').hide();
        $('.sale-ends').hide();
      }
    });
  }

  /**
   * Update the quantity in the modal when add to cart in PDP
   */
  function _updateModalQty() {
    $(".add-to-cart").on("click", function () {
      var qtyValue = $(".numeric-stepper > input").val();
      $(".js-product-qty").text(qtyValue);
    });
  }

  /**
   * Sets Button Rules (PDP)
   * Jquery UI
   */
  function _createButtonRules() {
    //both subsets or groups of denomination and delivery must be selected in order to activate
    //add to cart

    //TODO MODIFY
    if ($('.buttonset').find('a.active').length === 2) {
      $('.product-form > a.btn').removeClass('notActive').removeAttr('tabindex');
    } else if ($('.buttonset').find('a.active').length === 1 && $("#buttonset-delivery").find('a.active').length === 1) {
      $('.product-form > a.btn').removeClass('notActive').removeAttr('tabindex');
    } else {
      if ($("#buttonset-delivery").length > 0) {
        $('.product-form > a.btn').addClass('notActive').attr('tabindex', '-1');
      }
    }

  }

  /**
   * Modal events related to GC and Merchandise
   */
  function _timedOverlayModals() {
    /**
     * Display overlays in anonymous state to encourage sign on
     */
    setTimeout(function () {
      $('[data-modal-id="modal-sign-on"]').trigger("click");
      $('[data-modal-id="modal-important-notice"]').trigger("click");
    }, 1000); // milliseconds

    sessionTimeOut();

    // Close modal on click button
    $(".btn-close-modal").on("click", function () {
      $('.modal-close-button').trigger("click");
    });
  }

  /**
   * Display overlays in cart for session timeout and session ended
   * After 6 minutes
   */
  function sessionTimeOut() {
    var setSessionTimeout = 2000;
    var btnsBoolean = $(".js-btn-boolean");

    // Sets timeout when inactive for 6 minutes
    setTimeout(function () {
      $('[data-modal-id="modal-session-timeout"]').trigger("click");

      $(".btn-boolean-group").on("click", function () {
        btnsBoolean.data('state', 'clicked');
        $('.modal-close-button').trigger("click");
      });

      sessionEnded();
    }, setSessionTimeout);
  }

  /**
   * Display overlays in cart for session timeout and session ended
   * After 6 minutes
   */
  function sessionEnded() {
    // Open the session ended modal
    setTimeout(function () {
      $('.modal-close-button').trigger("click");
      $('[data-modal-id="modal-session-ended"]').trigger("click");
    }, 2000);
  }

  function _initPubSub() {
    pubsub = $({});

    $.each(['on', 'off', 'trigger'], function (i, method) {
      $[method] = $.proxy(pubsub[method], pubsub);
    });
  }

  function _initPrintCta() {
    $('.print-btn').bind('click', function (event) {
      event.preventDefault();
      window.print();
    });
  }

  function _on(eventName, fn) {
    pubsub.on(eventName, fn);
  }

  function _off(eventName, fn) {
    pubsub.off(eventName, fn);
  }

  function _trigger(eventName, args) {
    pubsub.trigger(eventName, args);
  }

  /**
   * Calculate proper width for jquery ui select dropdown
   * under 360 window width.
   * There was a problem with jquery
   * ui, it didn't calculate the proper width and css couldn't
   * do the trick
   */
  function _initCalculateSelectOptionsWidth() {

    $('.ui-selectmenu-button').click(function () {

      if ($(window).width() < 359) {

        var $dropdownOptions = $('.ui-selectmenu-open').find('.ui-menu');
        var $selectWidth = $(this).width();

        $dropdownOptions.width($selectWidth);

      }

    });

  }

  /*
   * Add proper role to dropdown elements
   */
  function _adjustDropdown() {
    // Wait to make sure the dropdown are initilazed by jquery-ui
    window.setTimeout(function() {
      $('.dropdown').find('.ui-selectmenu-text').attr('role', 'textbox');
    }, 500);
  }

  function _init() {
    _initPubSub();
    _initPrintCta();
    _getAccessibleModalById();
    _initializeMenu(); //  Header and Menu Initializations
    _selectMenuForElement();
    _numericStepperSetup();
    _createTabs();
    _createZoom();
    _createTooltips();
    _createButtonSets();
    //_timedOverlayModals(); // enable when going live
    _updateProductData();
    _updateProductDataPDP();
    _updateModalQty();
    _initCalculateSelectOptionsWidth();
    _adjustDropdown();
  }

  _init();

  return {
    addKeyboardArrowNavigation: _addKeyboardArrowNavigation,
    addKeyboardEnterKey: _addKeyboardEnterKey,
    addKeyboardLeftRightToggle: _addKeyboardLeftRightToggle,
    addStyleActivatedMenuItem: _addStyleActivatedMenuItem,
    createTabs: _createTabs,
    createTooltips: _createTooltips,
    closeSearch: closeSearch,
    createButtonSets: _createButtonSets,
    createZoom: _createZoom,
    getParameterByName: _getParameterByName,
    getProductDetailItem: _getProductDetailItem,
    getUrlParameter: _getUrlParameter,
    initializeMenu: _initializeMenu,
    numericStepperSetup: _numericStepperSetup,
    populateCategoryList: _populateCategoryList,
    populateProductList: _populateProductList,
    selectMenuForElement: _selectMenuForElement,
    setupSectionSubNavs: _setupSectionSubNavs,
    setupTravelValidation: _setupTravelValidation,
    showHideSubSections: _showHideSubSections,
    timedOverlayModals: _timedOverlayModals,
    updateModalQty: _updateModalQty,
    on: _on,
    off: _off,
    trigger: _trigger
  };
})();

// Based in part on the code from: https://github.com/gdkraus/accessible-modal-dialog

/*

 ============================================
 License for Application
 ============================================

 This license is governed by United States copyright law, and with respect to matters
 of tort, contract, and other causes of action it is governed by North Carolina law,
 without regard to North Carolina choice of law provisions.  The forum for any dispute
 resolution shall be in Wake County, North Carolina.

 Redistribution and use in source and binary forms, with or without modification, are
 permitted provided that the following conditions are met:

 1. Redistributions of source code must retain the above copyright notice, this list
 of conditions and the following disclaimer.

 2. Redistributions in binary form must reproduce the above copyright notice, this
 list of conditions and the following disclaimer in the documentation and/or other
 materials provided with the distribution.

 3. The name of the author may not be used to endorse or promote products derived from
 this software without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE AUTHOR "AS IS" AND ANY EXPRESS OR IMPLIED
 WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
 AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR BE
 LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
 ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

 */

citiShare.util = (function() {
    'use strict';


    /**
     * trap tab key into passed element
     * @param  {object} obj The element that focus should be trapped within
     * @param  {Event} evt The event
     */
    function trapTabKey(obj, evt) {
        var focusableElementsString = "a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]";

        // if tab or shift-tab pressed
        if (evt.which === 9) {

            // get list of all children elements in given object
            var o = obj.find('*');

            // get list of focusable items
            var focusableItems;
            focusableItems = o.filter(focusableElementsString).filter(':visible');

            // get currently focused item
            var focusedItem;
            focusedItem = jQuery(':focus');

            // get the number of focusable items
            var numberOfFocusableItems;
            numberOfFocusableItems = focusableItems.length;

            // get the index of the currently focused item
            var focusedItemIndex;
            focusedItemIndex = focusableItems.index(focusedItem);

            if (evt.shiftKey) {
                //back tab
                // if focused on first item and user preses back-tab, go to the last focusable item
                if (focusedItemIndex === 0) {
                    focusableItems.get(numberOfFocusableItems - 1).focus();
                    evt.preventDefault();
                }

            } else {
                //forward tab
                // if focused on the last item and user preses tab, go to the first focusable item
                if (focusedItemIndex === numberOfFocusableItems - 1) {
                    focusableItems.get(0).focus();
                    evt.preventDefault();
                }
            }
        }
    }


    function trapEscapeKey(obj, evt) {
        // if escape pressed
        if (evt.which === 27) {
            evt.preventDefault();
            $('.js-product-detail-module .modal-close-button').click();
        }

    }

    /**
     * grab and register a handlebars template
     * @param  {string} template the name of the template to grab, without the file extension (getHandlebarPartials("something") will grab and register the "something.html" template)
     * @return {null}
     */
    function getHandlebarPartials(template){
        $.ajax({
            url: window.citiConfig.handlebarTemplatesDir + template + '.html',
            type: 'GET',
            async: false,
            dataType: 'text'
        })
        .done(function(data) {
            window.Handlebars.registerPartial(template, data);
        });
    }
    function throttle(fn, delay) {
        delay = delay ? delay : 100;
        var last = (function () {
            return +new Date();
        })(),
            timeoutId = null;

        return function () {
            var args = arguments;
            if (timeoutId) {
                clearTimeout(timeoutId);
                timeoutId = null;
            }

            var now = (function () {
                return +new Date();
            })();
            if (now - last > delay) {
                fn.apply(this, args);
                last = now;
            } else {
                timeoutId = setTimeout(function () {
                    fn.apply(this, args);
                }, delay);
            }
        };
    }

    /**
     * render handlebars template with data
     * @param {string} source Template html
     * @param {object} data Template data
     * @return {string} Rendered template
     */
    function renderHandleBars(source, data) {
        var template = window.Handlebars.compile(source);
        return template(data);
    }

   /**
    * Will take an integer (or float) and format the number with
    * commas.
    *
    * Source: http://stackoverflow.com/questions/2901102/how-to-print-a-number-with-commas-as-thousands-separators-in-javascript/2901298#2901298
    */
    function convertToCommaFormat(number) {
        if(number !== undefined) {
            var parts = number.toString().split(".");
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");

            return parts.join(".");
        }
    }

    return {
        convertToCommaFormat: convertToCommaFormat,
        getHandlebarPartials: getHandlebarPartials,
        trapTabKey: trapTabKey,
        trapEscapeKey: trapEscapeKey,
        throttle: throttle,
        renderTemplate: renderHandleBars
    };
})();

/**
 * JSHint:
 * To allow bracket notation,
 * For example, test["placeholder"] vs test.placeholder
 */

/*jshint sub:true*/

citiShare.formValidation = (function() {
    "use strict";
    
    var email = /^(?=[a-zA-Z0-9.!#$%&@'*+/=?^_`{|}~-]{1,254}$)[^.](?:[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]|([._])(?!\1)){0,62}[^.]@[^.](?!.*\.{2})([a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+)([a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+)[^.]|[^.]+$/g;

    var commonFormats = {
        'required' : '.+',
        'number' : '^\\d+$',
        'email' : email,
        'zip' : '^\\d{5}$'
    };
    
    /**
     * Validate input value against a regular expression
     * @param  {jQuery|String} elemOrValue What need to be validated
     * @param  {string} type   Either a type from the commonFormats object or a regexp string
     * @return {boolean}
     */
    function validateInput(elemOrValue, type) {
        var ret = false,
            val = typeof elemOrValue === 'string' ? elemOrValue : $(elemOrValue).val(),
            typeToUse = commonFormats.hasOwnProperty(type) ? commonFormats[type] : type;

        // check if type exists in types object
        // if not, assume that a regular expression
        // is being passed in and validate against that

        if(val !== undefined) {
            ret = val.match(new RegExp(typeToUse)) ? true : false;
        }

        return ret;
    }

    /**
     * Do two input values match? The world wants to know
     * @param  {jQuery}  $input1 Element number one
     * @param  {jQuery}  $input2 Element number two
     * @return {Boolean}
     */
    function isMatchingInput($input1, $input2) {
        return $($input1).val() === $($input2).val();
    }

    /**
     * Format string or number with delimiter as thousand separator (12,345)
     * @param {string} numberStr String or integer, it depend on user input, ex: (12,345 is string), (12345 is integer)
     * @param {string} delimiter String to identify the spectator between numbers; default is ','
     */
    function formatNumericValues(numberStr, delimiter) {

        var formattedDelimiter;
        var valueToString = numberStr.toString();
        var regexExp = /(\d+)(\d{3})/;

        if ( typeof delimiter  !== 'undefined' ){
            formattedDelimiter = delimiter;
        }
        else {
            formattedDelimiter = ',';
        }

        while (regexExp.test(valueToString)){
            valueToString = valueToString.replace(regexExp, '$1'+ formattedDelimiter +'$2');
        }
        return valueToString;
    }

    /**
     * Format the points input value
     */
    function formatPointsInputValue ($input) {

        formatPointsToNumberOnly($input); // Replace any non digit with " "

        $input.blur(function(){
            $(this).val(formatNumericValues($(this).val(), ",").toString());
        });
    }

    /**
     * Replace any non digit with " "
     * Input field is preserved as text field to allow ","
     * in the formatPointsInputValue function
     * @private
     */
    function formatPointsToNumberOnly ($input) {

        $input.keyup(function() {
            $(this).val(formatNumberOnly($(this).val()).toString());
        });
    }

    /**
     * Form input validation
     * @param $input
     */
    function formInputValidation ($input) {

        $input.blur(function(e) {
            e.stopPropagation();

            // Set up toggle class based on data attr validation
            var dataAttr = $(this).data("input-error");
            var $errorEL = $(".error-message[data-input-error=" + dataAttr + "]");

            // Toggle error message display property
            if ( !memberNumberValidation($input) ){
                return $errorEL.addClass("is-visible");
            }
            else {
                return $errorEL.removeClass("is-visible");
            }
        });
    }


    function showErrorForElement($element) {
        var errorMessage = $element.data('validation-required');
        if (!!errorMessage) {
            hideErrorForElement($element);
            $element.children('#contact-invalid-phone').append("<p class='error-message is-invalid'>" + errorMessage + "</p>");
        }
    }

    function hideErrorForElement($element) {
        $element.find('.error-message').remove();
    }

    /**
     * Form phone split input validation
     * @param $inputGroup
     */
    // TODO:: make it nice
    function formSplitPhoneInputValidation($inputGroup) {
        $.each($inputGroup.find('[data-validate-type="split-phone"]'), function(index, element) {
            if (!!element.value) {
                $inputGroup.removeClass('error');
                hideErrorForElement($inputGroup);
            } else {
                $inputGroup.addClass('error');
                showErrorForElement($inputGroup);
            }
        });
    }

    /**
     * Member number validation
     * @param $input
     * @returns {boolean}
     */
    function memberNumberValidation ($input) {
        return new RegExp($input.attr('data-validation-regex')).test($input.val());
    }


    /**
     * Replace any non digit character with ""
     * @private
     */
    function formatNumberOnly ($input) {
        if ( typeof $input !== "number" ){
            return $input.replace(/[^\d\.]+/g, '');
        }
    }

    /**
     * Shows remaining characters for an input field...does not actually limit the character input
     * @param  {jQuery} $input     the input field
     * @param  {jQuery} $errorElem the element that will display the updated limit
     * @param  {Number} limit      the number of characters that are allowed in the field
     * @return {null}
     */
    function limitInputbyCharacterCount($input, $errorElem, limit){
        var  charLimit = limit ? limit : $input.attr('maxlength') ? Number( $input.attr('maxlength') ) : 500 ; //todo: refactor this for readability
        if ($input.val().length < charLimit) {
            $errorElem.text( charLimit - $input.val().length + ' character(s) left'); // todo: turn this error message into a citiConfig property
            $('span.count').text(charLimit - $input.val().length + 'character(s) left'); //only for accessibility;
        } else {
            $errorElem.text('0 characters left');
            $('span.count').text(charLimit - $input.val().length + 'character(s) left');
        }
    }

    return {
        validateInput: validateInput,
        isMatchingInput: isMatchingInput,
        formatNumericValues: formatNumericValues,
        formatPointsInputValue: formatPointsInputValue,
        formatNumberOnly : formatNumberOnly,
        limitInputbyCharacterCount: limitInputbyCharacterCount,
        memberNumberValidation: memberNumberValidation,
        formInputValidation: formInputValidation,
        formSplitPhoneInputValidation: formSplitPhoneInputValidation
    };

})();


// Initializes an OAA Accessibility Slider
//
// Source: http://oaa-accessibility.org/example/32/

/**
 * JSHint:
 * To allow bracket notation,
 * For example, test["placeholder"] vs test.placeholder
 */

/*jshint sub:true*/

citiShare.slider = (function() {
    "use strict";

    ////////////////////////////////////////////////////
    //
    // function slider() is a class to define an ARIA-enabled slider widget. The class
    // will create needed handles and define ARIA attributes for the slider
    //
    // @param(container_id string) container_id is the containing div for the slider
    //
    // @param(vert boolean) vert is true if the slider is vertical; false if horizontal
    //
    // @param(inc integer) inc is the increment value for the slider
    //
    // @param(jump integer) jump is the large increment value for the slider (pgUp/pgDown keys)
    //
    // @param(showVals boolean) showVals is true if the slider should display the value of the handles
    //
    // @param(range boolean) range is true if the slider is a range slider
    //
    // @param(val1 integer) val1 specifies the initial value of the slider or of the first
    //         slide handle if this is a range slider. Must be >= min.
    //
    // @param(val2 integer) val2 specifies the initial value of the second slide handle.
    //         Ignored if range is false (i.e. not a range slider). Must be <= max.
    //
    // @return N/A
    //
    function Slider(container_id, vert, min, max, inc, jump, showVals, range, val1, val2) {
        // define slider object properties
        this.keys = new KeyCodes();

        this.id = container_id;
        this.$container = $('#' + container_id);
        this.vert = vert;
        this.range = range;
        this.showVals = showVals;
        this.currency = this.$container.data('currency');

        // Store the size of the slider
        this.width = this.$container.outerWidth();
        this.height = this.$container.outerHeight();

        // Store the page position of the slider
        this.left = 0;
        this.top = 0;

        // Store the minimum and maximum and initial values
        this.min = min;
        this.max = max;
        this.inc = inc;
        this.jump = jump;
        this.val1 = val1;

        // If range is true, store the second value
        if (range === true) {
            this.val2 = val2;
        }
        /////////////// Create handles /////////////////

        this.$handle1 = undefined;
        this.$handle2 = undefined;

        if ( range === false) {
            // Create the handle
            this.$handle1 = this.createHandle(val1);
        } else {
            // create the range highlight div
            this.createRangeDiv();

            // Create the first handle
            this.$handle1 = this.createHandle(val1, 1);

            // create the second handle
            this.$handle2 = this.createHandle(val2, 2);
        }
    } // end slider constructor

    //
    // function keyCodes() is an object to contain key code values for the application
    //
    function KeyCodes() {
        // Define values for keycodes
        this.backspace  = 8;
        this.tab        = 9;
        this.enter      = 13;
        this.esc        = 27;

        this.space      = 32;
        this.pageup     = 33;
        this.pagedown   = 34;
        this.end        = 35;
        this.home       = 36;

        this.left       = 37;
        this.up         = 38;
        this.right      = 39;
        this.down       = 40;
    } // end keyCodes

    //
    // function createHandle() creates a handle for the slider. It defines ARIA attributes for
    // the handle and positions it at the specified value in the slider range. if showVals is true,
    // create and position divs to display the handle value.
    //
    // @param (val integer) val is the initial value of the handle
    //
    // @param (num integer) num is the handle number. (optional)
    //
    // @return (object) returns the object pointer of the newly created handle
    //
    Slider.prototype.createHandle = function(val, num) {
        var id = this.id + '_handle' + (num === undefined ? '' : num);
        var label = this.id + '_label' + (num === undefined ? '' : num);
        var controls = this.id + '_text' + (num === undefined ? '' : num);
        var $handle;

        var handleAttributes = {};

        if (document.getElementById(id)) {
            handleAttributes.id = id;
        }

        if (document.getElementById(label)) {
            handleAttributes['aria-labelledby'] = label;
        }

        if (document.getElementById(controls)) {
            handleAttributes['aria-controls'] = controls;
        }

        var handle = '<span id="' + id + '" class="' + (this.vert === true ? 'v':'h') +'sliderHandle" ' +
                          'role="slider" ' +
                          'aria-valuemin="' + this.min +
                          '" aria-valuemax="' + this.max;

        for (var attribute in handleAttributes) {
            if (handleAttributes.hasOwnProperty(attribute)) {
                handle += attribute + '="' + handleAttributes + '"';
            }
        }

        handle += '" tabindex="0"></span>';

        // Create the handle
        this.$container.append(handle);

        // store the handle object
        $handle = $('#' + id);

        if (this.showVals === true) {
            var valContainer = '<div id="' + id + '_val" class="' + (this.vert === true ? 'v':'h') + 'sliderValue" role="presentation"></div>';

            // Create the container.
            this.$container.append(valContainer);
        }

        // store the value object
        $handle = $('#' + id);

        // position handle
        this.positionHandle($handle, val);

        // bind handlers
        this.bindHandlers($handle);

        return $handle;
    }; // end createHandle()

    //
    // function createRangeDiv() creates a div for the highlight of a range slider. It sets the initial top or left position
    // to match that of the slider container.
    //
    // @return N/A
    //
    Slider.prototype.createRangeDiv = function() {
        var id = this.id + '_range';

        var range = '<div id="' + id + '" class="sliderRange"></div>';

        // Create the range div
        this.$container.append(range);

        // Store the div object
        this.$rangeDiv = $('#' + id);

        if (this.vert === false) { // horizontal slider
            this.$rangeDiv.css('top', this.top + 'px');
            this.$rangeDiv.css('height', this.$container.height() + 'px');
        } else { // vertical slider
            this.$rangeDiv.css('left', this.left + 'px');
            this.$rangeDiv.css('width', this.$container.width() + 'px');
        }
    }; // end createRangeDiv()

    //
    // function positionHandle() is a member function to position a handle at the specified value for the
    // slider. If showVal is true, it also positions and updates the displayed value container.
    //
    // @param($handle object) $handle is a pointer to the handle jQuery object to manipulate
    //
    // @param (val integer) val is the new value of the slider
    //
    // @return N/A
    //
    Slider.prototype.positionHandle = function($handle, val) {
        var handleHeight = $handle.outerHeight(); // the total height of the handle
        var handleWidth = $handle.outerWidth(); // the total width of the handle
        //var handleOffset; // the distance from the value position for centering the handle
        var xPos; // calculated horizontal position of the handle;
        var yPos; // calculated vertical position of the handle;
        var valPos; //calculated new pixel position for the value;

        if (this.vert === false) {
            // horizontal slider

            // calculate the horizontal pixel position of the specified value
            valPos = ((val - this.min) / (this.max - this.min)) * this.width + this.left;

            xPos = Math.round(valPos - (handleWidth / 2));
            yPos = Math.round(this.top + (this.height / 2) - (handleHeight / 2));
        } else {
            // vertical slider

            // calculate the vertical pixel position of the specified value
            valPos = ( (val - this.min) / (this.max - this.min) ) * this.height + this.top;

            xPos = Math.round(this.left + (this.width / 2) - (handleWidth / 2));
            yPos = Math.round(valPos - (handleHeight / 2));
        }

        // Set the position of the handle
        $handle.css('top', yPos + 'px');
        $handle.css('left', xPos + 'px');

        // Set the aria-valuenow position of the handle
        $handle.attr('aria-valuenow', val);

        // Update the stored handle values
        if (/1$/.test($handle.attr('id')) === true) {
            // first handle
            this.val1 = val;
        } else {
            // second handle
            this.val2 = val;
        }

        // if range is true, set the position of the range div
        if (this.range === true) {
            this.positionRangeDiv();
        }

        // if showVal is true, update the value container
        if (this.showVals === true) {
            this.updateValBox($handle, Math.round(valPos));
        }
    }; // end positionHandle()

    //
    // function positionRangeDiv() is a member function to reposition the range div when a handle is moved
    //
    // @return N/A
    //
    Slider.prototype.positionRangeDiv = function() {
        var pos; //calculated new range start position;
        var size; //calculated new range size;

        if (this.vert === false) { // Horizontal slider

            // calculate the range start position
            pos = Math.round( ((this.val1 - this.min) / (this.max - this.min)) * this.width) + this.left;

            // calculate the new range width
            size = Math.round( ((this.val2 - this.min) / (this.max - this.min)) * this.width) + this.left - pos;

            // set the new range position
            this.$rangeDiv.css('left', pos + 'px');

            // set the new range width
            this.$rangeDiv.css('width', size + 'px');
        } else {
            // calculate the range start position
            pos = Math.round(( (this.val1 - this.min) / (this.max - this.min)) * this.height)+ this.top;

            // calculate the new range width
            size = Math.round(( (this.val2 - this.min) / (this.max - this.min) ) * this.height) + this.top - pos;

            // set the new range position
            this.$rangeDiv.css('top', pos + 'px');

            // set the new range width
            this.$rangeDiv.css('height', size + 'px');
        }
    }; // end positionRangeDiv()

    //
    // function updateValBox() is a member function to reposition a handle value box and update its contents
    //
    // @param ($handle object) $handle is the jQuery object of the handle that was moved
    //
    // @param (valPos integer) is the pixel position of the slider value
    //
    // @return N/A
    //
    Slider.prototype.updateValBox = function($handle, valPos) {
        var $valBox = $('#' + $handle.attr('id') + '_val');

        var xPos; // horizontal pixel position of the box
        var yPos; // vertical pixel position of the box
        var commaValue = citiShare.util.convertToCommaFormat($handle.attr('aria-valuenow'));

        // Set the text in the box to the handle value
        $valBox.text(commaValue + ' ' + this.currency);

        // Trigger custom event with value data
        this.$container.trigger('sliderValue', [$handle.attr('aria-valuenow')]);

        // Set the position of the handle
        if (this.vert === false) {
            var boxWidth = $valBox.outerWidth();

            yPos = $handle.css('top');

            // Adjust the horizontal position to center the value box on the value position
            xPos = Math.round(valPos - (boxWidth / 2)) + 'px';
        } else {
            var boxHeight = $valBox.outerHeight();

            xPos = $handle.css('left');

            // Adjust the vertical position to center the value box on the value position
            yPos = Math.round(valPos - (boxHeight / 2)) + 'px';
        }

        // Set the position of the value box
        $valBox.css('top', yPos);
        $valBox.css('left', xPos);
    }; // end updateValBox()

    //
    // function bindHandlers() is a member function to bind event handlers to a slider handle
    //
    // @param ($handle object) $handle is the object pointer of the handle to bind handlers to
    //
    // @return N/A
    Slider.prototype.bindHandlers = function($handle) {
        var thisObj = this; // store the this pointer

        $handle.keydown(function(e) {
            return thisObj.handleKeyDown($handle, e);
        });

        $handle.keypress(function(e) {
            return thisObj.handleKeyPress($handle, e);
        });

        $handle.focus(function(e) {
            return thisObj.handleFocus($handle, e);
        });

        $handle.blur(function(e) {
            return thisObj.handleBlur($handle, e);
        });

        $handle.on('mousedown touchstart', function(e) {
            return thisObj.handleMouseDown($handle, e);
        });
    }; // end bindHandlers()

    //
    // function handleKeyDown() is a member function to process keydown events for a slider handle
    //
    // @param ($handle object) $handle is the object associated with the event
    //
    // @parem (evt object) evt is the event object associated witthe the event
    //
    // @return (boolean) true if propagating; false if consuming event
    //
    Slider.prototype.handleKeyDown = function($handle, evt) {
        var newVal, stopVal;

        if (evt.ctrlKey || evt.shiftKey || evt.altKey) {
            // Do nothing
            return true;
        }

        switch (evt.keyCode) {
            case this.keys.home: {
                // move the handle to the slider minimum
                if (this.range === false) {
                    this.positionHandle($handle, this.min);
                } else {
                    if (/1$/.test($handle.attr('id')) === true) {
                        // handle 1 - move to the min value
                        this.positionHandle($handle, this.min);
                    } else {
                        // handle 2 - move to the position of handle 1
                        this.positionHandle($handle, this.val1);
                    }
                }
                evt.stopPropagation();
                //return false;
                break;
            }
            case this.keys.end: {
                if (this.range === false) {
                    // move the handle to the slider maximum
                    this.positionHandle($handle, this.max);
                } else {
                    if (/1$/.test($handle.attr('id')) === true) {
                        // handle 1 - move to the position of handle 2
                        this.positionHandle($handle, this.val2);
                    }
                    else {
                        // handle 2 - move to the max value
                        this.positionHandle($handle, this.max);
                    }
                }
                evt.stopPropagation();
                //return false;
                break;
            }
            case this.keys.pageup: {
                // Decrease by jump value

                newVal = $handle.attr('aria-valuenow') - this.jump;
                stopVal = this.min; // where to stop moving
                
                if (this.range === true) {
                    // if this is handle 2, stop when we reach the value
                    // for handle 1
                    if (/2$/.test($handle.attr('id')) === true) {
                        stopVal = this.val1;
                    }
                }

                // move the handle one jump increment toward the slider minimum
                // If value is less than stopVal, set at stopVal instead
                this.positionHandle($handle, (newVal > stopVal ? newVal : stopVal));

                evt.stopPropagation();
                //return false;
                break;
            }
            case this.keys.pagedown: {
                // Increase by jump value

                newVal = parseInt($handle.attr('aria-valuenow')) + this.jump;
                stopVal = this.max; // where to stop moving

                if (this.range === true) {
                    // if this is handle 1, stop when we reach the value
                    // for handle 2
                    if (/1$/.test($handle.attr('id')) === true) {
                        stopVal = this.val2;
                    }
                }

                // move the handle one jump increment toward the slider maximum
                // If value is greater than maximum, set at maximum instead
                this.positionHandle($handle, (newVal < stopVal ? newVal : stopVal));

                evt.stopPropagation();
                //return false;
                break;
            }
            case this.keys.left:
            case this.keys.up: { // decrement
                newVal = $handle.attr('aria-valuenow') - this.inc;
                stopVal = this.min; // where to stop moving
                
                if (this.range === true) {
                    // if this is handle 2, stop when we reach the value
                    // for handle 1
                    if (/2$/.test($handle.attr('id')) === true) {
                      stopVal = this.val1;
                    }
                }

                // move the handle one jump increment toward the stopVal
                // If value is less than stopVal, set at stopVal instead
                this.positionHandle($handle, (newVal > stopVal ? newVal : stopVal));

                evt.stopPropagation();
                //return false;
                break;
            }
            case this.keys.right:
            case this.keys.down: { // increment
                newVal = parseInt($handle.attr('aria-valuenow')) + this.inc;
                stopVal = this.max; // where to stop moving

                if (this.range === true) {
                  // if this is handle 1, stop when we reach the value
                  // for handle 2
                  if (/1$/.test($handle.attr('id')) === true) {
                    stopVal = this.val2;
                  }
                }

                // move the handle one increment toward the slider maximum
                // If value is greater than maximum, set at maximum instead
                this.positionHandle($handle, (newVal < stopVal ? newVal : stopVal));

                evt.stopPropagation();
                //return false;
                break;
            }
        } // end switch

        return true;
    }; // end handleKeyDown

    //
    // function handleKeyPress() is a member function to process keypress events for a slider handle. Needed for
    // browsers that perform window scrolling on keypress rather than keydown events.
    //
    // @param ($handle object) $handle is the object associated with the event
    //
    // @parem (evt object) evt is the event object associated witthe the event
    //
    // @return (boolean) true if propagating; false if consuming event
    //
    Slider.prototype.handleKeyPress = function($handle, evt) {
        if (evt.ctrlKey || evt.shiftKey || evt.altKey) {
            // Do nothing
            return true;
        }
  
        switch (evt.keyCode) {
            case this.keys.home:
            case this.keys.pageup:
            case this.keys.end:
            case this.keys.pagedown:
            case this.keys.left:
            case this.keys.up:
            case this.keys.right:
            case this.keys.down: {
                // Consume the event
                evt.stopPropagation();
                //return false;
                break;
            }
        } // end switch
  
        return true;
    }; // end handleKeyDown

    //
    // function handleFocus() is a member function to process focus events for a slider handle
    //
    // @param ($handle object) $handle is the object associated with the event
    //
    // @parem (evt object) evt is the event object associated witthe the event
    //
    // @return (boolean) true if propagating; false if consuming event
    //
    Slider.prototype.handleFocus = function($handle) {
        $handle.addClass('focus');
        $handle.css('z-index', '20');

        return true;
    }; // end handleFocus()

    //
    // function handleBlur() is a member function to process blur events for a slider handle
    //
    // @param ($handle object) $handle is the object associated with the event
    //
    // @parem (evt object) evt is the event object associated witthe the event
    //
    // @return (boolean) true if propagating; false if consuming event
    //
    Slider.prototype.handleBlur = function($handle) {
        $handle.removeClass('focus');
        $handle.css('z-index', '10');

        return true;
    }; // end handleBlur()

    //
    // function handleMouseDown() is a member function to process mousedown events for a slider handle. The function
    // binds a mousemove handler
    //
    // @param ($handle object) $handle is the object associated with the event
    //
    // @parem (evt object) evt is the event object associated witthe the event
    //
    // @return (boolean) true if propagating; false if consuming event
    //
    Slider.prototype.handleMouseDown = function($handle, evt) {

        var thisObj = this; // store the this pointer

        // remove focus highlight from all other slider handles on the page
        $('.hsliderHandle').removeClass('focus').css('z-index', '10');
        $('.vsliderHandle').removeClass('focus').css('z-index', '10');

        // Set focus to the clicked handle
        $handle.focus();

        // bind a mousemove event handler to the document to capture the mouse
        $(document).on('mousemove touchmove', function(e) {
          thisObj.handleMouseMove($handle, e);
        });

        //bind a mouseup event handler to the document to capture the mouse
        $(document).on('mouseup touchend', function(e) {
            return thisObj.handleMouseUp($handle, e);
        });

        evt.stopPropagation();
        return false;
    }; // end handleMouseDown()

    //
    // function handleMouseUp() is a member function to process mouseup events for a slider handle. The function
    // unbinds the mousemove handler
    //
    // @param ($handle object) $handle is the object associated with the event
    //
    // @parem (evt object) evt is the event object associated witthe the event
    //
    // @return (boolean) true if propagating; false if consuming event
    //
    Slider.prototype.handleMouseUp = function($handle, evt) {
        // unbind the event listeners to release the mouse
        $(document).unbind('mousemove touchmove');
        $(document).unbind('mouseup touchend');

        evt.stopPropagation();
        return false;
    }; // end handleMouseUp()

    //
    // function handleMouseMove() is a member function to process mousemove events for a slider handle.
    //
    // @param ($handle object) $handle is the object associated with the event
    //
    // @parem (evt object) evt is the event object associated witthe the event
    //
    // @return (boolean) true if propagating; false if consuming event
    //
    Slider.prototype.handleMouseMove = function($handle, evt) {
        //var curVal = parseInt($handle.attr('aria-valuenow'));
        var newVal;
        var handleOffset;
        var sliderOffset = $('#' + this.id).offset().left;
        var startVal = this.min;
        var stopVal = this.max;

        if (this.range === true) {
            // if this is handle 1, set stopVal to be the value
            // for handle 2
            if (/1$/.test($handle.attr('id')) === true) {
                stopVal = this.val2;
            } else {
                // This is handle 2: Set startVal to be the value
                // for handle 1
                startVal = this.val1;
            }
        }

        if (this.vert === false) {
            // horizontal slider
            if (evt.pageX) {
                handleOffset = evt.pageX - sliderOffset;
            } else if (evt.originalEvent.changedTouches.length) {
                handleOffset = evt.originalEvent.changedTouches[0].pageX - sliderOffset;
            }
            // Calculate the new Slider value based on the horizontal pixel position of the mouse
            newVal = Math.round((handleOffset - this.left) / this.width * (this.max - this.min)) + this.min;
        } else {
            // vertical slider

            // Calculate the new Slider value based on the vertical pixel position of the mouse
            newVal = Math.round((evt.pageY - this.top) / this.height * (this.max - this.min)) + this.min;
        }

        if (newVal >= startVal && newVal <= stopVal) {
            // Do not move handle unless new value is a slider increment
            
            /* Pretty sure this is what they wanted to accomplish -Lucas*/
            this.positionHandle($handle, newVal - newVal%this.inc);
        } else if (newVal < startVal) {
            // value is less than minimum for slider - set handle to min
            this.positionHandle($handle, startVal);
        } else if (newVal > stopVal) {
            // value is greater than maximum for slider - set handle to max
            this.positionHandle($handle, stopVal);
        }

        evt.stopPropagation();
        return false;
    }; // end handleMouseMove

    Slider.prototype.updateSliderWidth = function() {
        var $handle = $('#' + this.id + '_handle');

        this.width = this.$container.outerWidth();
        this.positionHandle($handle, $handle.attr('aria-valuenow'));
    };

    function init(containerId, min, max, initialValue, increment, showMinClass, showMaxClass, formID) {
        var $sliderParent = $('#points-transfer-slider').parent();
        var slider = new Slider(containerId, false, min, max, increment, 5000, true, false, initialValue);

        $(window).resize(function() {
            citiShare.util.throttle(slider.updateSliderWidth());
        });

        if (showMinClass) {
            $sliderParent.find('.' + showMinClass).text(citiShare.util.convertToCommaFormat(min));
        }
        if (showMaxClass) {
            $sliderParent.find('.' + showMaxClass).text(citiShare.util.convertToCommaFormat(max));
        }

        if (formID) {
            $('#' + formID).on('sliderInputChange', function(e, sliderVal, $sliderHandle) {
                slider.positionHandle($sliderHandle, sliderVal);
            });
        }
    }

    return {
        init: init
    };
})();



/*
 * This function is used to calculate and handle multicolumn
 * accessible list.
 *
 * Parameters
 *   listId: UL element id
 *   nbOfColumn:  Number of columns
 *
 */
citiShare.accessibleMultiColumnList = function(listId, nbOfColumn) {

  "use strict";

  var config = {
    $list: $(listId),
    nbOfColumn: nbOfColumn,
    heights: [],
    tempColumnHeight: 0
  };

  /*
   * Calculate each column total height.
   */
  var getColumnsHeight = function getColumnsHeight() {

    // go through all the columns
    for(var i = 1; i <= config.nbOfColumn; i++) {
      var columnElements = config.$list.find('.my-account-accessible-list-column'+i);

      columnElements.each(_sumColumnElementsHeight);

      config.heights.push({
        position: i,
        height: config.tempColumnHeight
      });

      config.tempColumnHeight = 0;
    }
  };
  
  /*
   * Util function to sum columns height
   */
  var _sumColumnElementsHeight = function sumColumnElementsHeight() {
    config.tempColumnHeight += $(this).outerHeight(true);
  };

  /*
   * Set the margin top on the column reset element.
   */
  var setMarginTop = function setMarginTop() {

    for(var i = 0; i < config.heights.length - 1; i++) {
      var currentColumn = config.heights[i];
      var resetElement = config.$list.find('.reset'+currentColumn.position);

      // Set a negative margin top totalling the height of the previous column.
      resetElement.css('marginTop', Math.abs(currentColumn.height) * -1);
    }
  };

  /*
   * Set the height of the list.
   * This is necessary because the negative margin cause some height problems.
   */
  var setListHeight = function setListHeight() {

    var biggestHeight = 0;

    // Get the biggest height
    for(var i = 0; i < config.heights.length; i++) {
      var currentColumn = config.heights[i];
      if(currentColumn.height > biggestHeight) {
        biggestHeight = currentColumn.height;
      }
    }

    config.$list.css('height', biggestHeight);
  };


  /*
   * Resets list css.
   */
  var resetList = function resetList() {
    config.$list.find('li').css('margin-top', '');
    config.$list.css('height', '');
  };

  var placeList = function placeList() {
    getColumnsHeight();
    setMarginTop();
    setListHeight();
  };

  /*
   * Init the citiShare.accessibleMultiColumnList code.
   */
  var init = function init () {
    
    var resizeTimer;
    var gestureTime;

    placeList();

    $(window).on('resize', function() {
        clearTimeout(resizeTimer);
        // debounce functionality to prevent the laggity lag
        resizeTimer = setTimeout(function () {
          resetList();
          citiShare.showMore.resetHeights();
          if(window.innerWidth > 767) {
            placeList();
          }
        }, 100);
    });

    // Needed on ipad.
    $(window).on('gestureend', function() {
      clearTimeout(resizeTimer);
      // debounce functionality to prevent the laggity lag
      gestureTime = setTimeout(function() {
        var isIpad = /iPad/.test(navigator.userAgent) && !window.MSStream;
        if(isIpad) {
          resetList();
          placeList();
          citiShare.showMore.resetHeights();
        }
      }, 100);
    });
  };

  return {
    init: init,
    reset: resetList,
    place: placeList
  };
};

citiShare.backToTop = (function () {
  'use strict';
  var footerHeight = null;
  var backToTop = $('.back-to-top');
  var $categoryTitle = $('.category-title');
  var backToTopPadding = 0;
  var modalPointsTransferDisplay = null;

  function setBackToTopDesktop() {

    $(window).scroll(function () {

      footerHeight = $('#footer').outerHeight();
      modalPointsTransferDisplay = $('#modal-points-transfer').css('display') || 'none';

      if ($(this).scrollTop() && $(this).scrollTop() > 0 && modalPointsTransferDisplay === 'none') {
        backToTop.addClass('is-active');
      } else {
        backToTop.removeClass('is-active');
      }

      if ($(window).scrollTop() + $(window).height() > $(document).height() - footerHeight) {
        backToTop.addClass('stuck');
        backToTop.css('bottom', footerHeight + backToTopPadding + 'px');
      } else {
        backToTop.removeClass('stuck');
        backToTop.removeAttr('style');
      }

    });

    backToTop.click(function (e) {
      e.preventDefault();
      $('html, body').animate({
        scrollTop: 0
      }, 300, function () {
        backToTop.removeClass('is-active');
        $categoryTitle.attr('tabindex', '-1');
        $categoryTitle.focus();
      });

      return false;

    });
  }

  setBackToTopDesktop();

  return {
    setBackToTopDesktop: setBackToTopDesktop
  };

})();

"use strict";

/**
 * @namespace CITI
 */
var CITI = CITI || {};

/**
 * @memberof CITI
 * @function
 * @name exemple
 * @description This is my description function.
 *
 * @param {array}           p_array     Array element
 * @param {object|string}   p_element   Element to validate
 * @returns {boolean}
 *
 * @example
 * var exemple = CITI.exemple(['exemple1', 'exemple2'], 'exemple1');
 */
CITI.exemple = function (p_array, p_element) {
	var array	= p_array;
	var element = p_element;
	return (array === element);
};

citiShare.citiCarousel = (function($elem, settings) {
    
        'use strict';
        var _hasInited = false;
        var isResizing = false;
        var _carousel = $elem;
        var _nextArrow = '<button class="next-arrow omniture-slider-next" aria-label="Next Items"><label>Next Items</label><i class="icon icon_next-arrow"></button>';
        var _prevArrow = '<button class="prev-arrow omniture-slider-next omniture-slider-next" aria-label="Previous Items"><label>Previous Items</label><i class="icon icon_prev-arrow"></button>';
        var slickSettings = {
                dots:true,
                customPaging: function(slider, i) { 
                    if(i === 0){
                        return '<a href="#" class="omniture-slider-pagination" role="button"><span>Page '+parseInt(i+1)+' of '+Math.ceil(slider.slideCount/slider.options.slidesToShow)+' Selected</span></a>';
                    } else {
                        return '<a href="#" class="omniture-slider-pagination" role="button"><span>Page '+parseInt(i+1)+' of '+Math.ceil(slider.slideCount/slider.options.slidesToShow)+'</span></a>';
                    }
                },
                adaptiveHeight: true,
                accessibility: false,
                nextArrow:_nextArrow,
                prevArrow:_prevArrow,
                rows:1,
                swipe:true,
                touchMove:true,
                mobileFirst:true,
                slidesToShow:2,
                slidesToScroll:2,
                responsive: [
                            {
                                breakpoint:767,
                                settings:{
                                    slidesToShow:4,
                                    slidesToScroll:4
                                }
                            }
                            ]
        };

        var _settings = $.extend({}, slickSettings, settings);

        function _refresh() {
            console.log('refreshing');
        }

        function _init(){
            _carousel.on('afterChange', function() {
                setTimeout(function(){
                    if(isResizing === false) {
                        _carousel.find('.slick-slide').each(function(i, elem){
                            if($(elem).hasClass('slick-active')) {
                                $(elem).removeAttr('tabindex');
                                $(elem).find('a').removeAttr('tabindex');
                            } else {
                                $(elem).attr('tabindex',-1);
                                $(elem).find('a').attr('tabindex',-1);
                            }
                            _carousel.find('.slick-slide.slick-active:visible:first, .slick-slide.slick-active > a:visible:first').focus();
                        });
                    }
                }, 100);

                _carousel.find('.slick-dots li').removeAttr('aria-hidden');

                _carousel.find(".slick-dots a").each(function() {
                    var word = $(this).find('span').html().replace('Selected','');
                    $(this).find('span').html(word);
                });

                _carousel.find(".slick-dots li").each(function() {
                    if($(this).hasClass('slick-active')){
                        var word = $(this).find('a span:first-child').html() + " Selected";
                        $(this).find('a span:first-child').html(word);
                    }
                });
            });

            _carousel.on('beforeChange', function() {
                _carousel.find('.slick-dots a').blur();
                _carousel.find('.slick-dots li').removeAttr('aria-hidden');
            });

            _carousel.on('init', function() {

                setTimeout(function(){
                    _carousel.find('.slick-list').removeAttr('tabindex');
                    _carousel.slick('slickUnfilter');
                    _carousel.find('.slick-dots a').bind('click', function(){
                        $('.slick-dots li').removeAttr('aria-hidden');

                        _carousel.find(".slick-dots a").each(function() {
                            var word = $(this).find('span').html().replace('Selected','');
                            $(this).find('span').html(word);
                        });

                        var word = $(this).children('span').html() + " Selected";
                        $(this).children('span').html(word);
                    });

                    _carousel.find('.slick-dots li').removeAttr('aria-hidden');
                    var $prevbutton = _carousel.find('.prev-arrow');
                    var $nextbutton = _carousel.find('.next-arrow');
                    $prevbutton.insertAfter($nextbutton);
                    _checkForTabIndex();
                }, 100);
            });

            // on breakpoint changes, the buttons were moved back to their
            // original places breaking the tabbing order
            _carousel.on('breakpoint', function() {
                var $prevbutton = _carousel.find('.prev-arrow');
                var $nextbutton = _carousel.find('.next-arrow');
                $prevbutton.insertAfter($nextbutton);
                _checkForTabIndex();
            });

            _carousel = _carousel.slick(_settings);

            _carousel.on('setPosition', function() {
                var slidesShown = _carousel.slick('slickGetOption', 'slidesToShow');
                var numberOfSlides = _carousel.find('.slick-slide').length;
                
                if (slidesShown >= numberOfSlides) {
                    _carousel.find('.slick-track').css('left', '0');
                }
            });

            $('.slick-dots li').removeAttr('aria-hidden');
            _hasInited = true;
        }
        
        function _checkForTabIndex() {
            _carousel.find('.slick-slide').each(function(i, elem){
                if($(elem).hasClass('slick-active')) {
                    $(elem).removeAttr('tabindex');
                    $(elem).find('a').removeAttr('tabindex');
                } else {
                    $(elem).attr('tabindex',-1);
                    $(elem).find('a').attr('tabindex',-1);
                }
            });
        }

        function _destroy() {
            if(_hasInited) {
                _carousel.slick('unslick');
            }
        }

        function _set(option) {
            _carousel.slick(option);
        }

        return {
            carousel: _carousel,
            init:_init,
            set:_set,
            destroy:_destroy,
            refresh:_refresh
        };
});

/**
 * Bussiness rules for the validation of cart
 */

/*jshint unused:false, sub:true*/

citiShare.error = (function() {
    'use strict';

    var configs = {
      contactConfig: {
          SELECTOR: '[name="cart-checkout-contact"]',
          phone : {
            selector: "#input-cart-headerphone",
            validate: ["split-phone-group"]
          },
          email : {
            selector: "#input-cart-header-email",
            validate: ["email"]
          }
      },
      storeConfig: {
          SELECTOR: '[name="cart-instore-pickup-search"]',
          zip : {
            selector: "#instore-pickup-search-zip",
            validate: ['zip']
          },
          radius : {
            selector: "#instore-pickup-search-radius-button"
          }
      },
      egiftConfig: {
          SELECTOR: '[name="cart-items-egift-recipient"]',
          email : {
            selector: "#cart-items-edit-email",
            validate: ["email"]
          },
          email_confirm : {
            selector: "#cart-items-edit-confirm-email",
            validate: ["email", "match:cart-items-edit-email"],
            errors: {
              match:"#cart-items-recipient-invalid-email-match"
            }
          },
          name : {
            selector: "#cart-items-edit-name"
          }
      },
      shippingAddressConfig: {
        SELECTOR: '[name="cart-items-recipient"]',
        fname : {
          selector: "#input-cart-delivery-firstname"
        },
        lname : {
          selector: "#input-cart-delivery-lastname"
        },

        residential : {
          selector: "#radio-cart-delivery-residential"
        },
        business : {
          selector: "#radio-cart-delivery-business"
        },
        deliveryYes: {
          selector: "#radio-cart-delivery-yes",
          validate: ['required']
        },
        deliveryNo: {
          selector: "#radio-cart-delivery-no",
          validate: ['required']
        },
        address1 : {
          selector: "#input-cart-delivery-address1"
        },
        address2 : {
          selector: "#input-cart-delivery-address2",
          manual: true
        },
        city : {
          selector: "#input-cart-delivery-city"
        },
        district : {
          selector: "#input-cart-delivery-district"
        },
        phone : {
          selector: "#input-cart-delivery-phone"
        },
        email : {
          selector: "#input-cart-delivery-email"
        },
        state : {
          selector: "#input-cart-delivery-state"
        },
        zip : {
          selector: "#input-cart-delivery-zip",
          validate: ['zip']
        },
        country : {
          selector: "#input-cart-delivery-country"
        }
    },
    pointsToBuyConfig: {
        points : {
          selector: "#cart-purchase-points-1"
        },
        cardToBeBilled : {
          selector: "#cc-name"
        },
        cvv : {
          selector: "#cc-cvv"
        },
        expiration : {
          selector: "#cc-expiration-date-mm"
        },
        year : {
          selector: "#cc-expiration-date-yy"
        }
    },
    billingAddressConfig: {
        SELECTOR: '.cart-edit-point-to-buy-address',
        fname : {
          selector: "#input-cart-delivery-firstname"
        },
        lname : {
          selector: "#input-cart-delivery-lastname"
        },
        address1 : {
          selector: "#input-cart-delivery-address1"
        },
        city : {
          selector: "#input-cart-delivery-city"
        },
        state : {
          selector: "#input-cart-delivery-state"
        },
        zip : {
          selector: "#input-cart-delivery-zip",
          validate: ['zip']
        },
        country : {
          selector: "#input-cart-delivery-country"
        }
    }
    };

    function _standardizeInputs(){
        //should not be able to enter non numeric values
        $(configs.storeConfig.zip.selector, configs.shippingAddressConfig.zip.selector, configs.billingAddressConfig.zip.selector).keyup(function(){
            $(this).val(citiShare.formValidation.formatNumberOnly($(this).val()).toString());
        });
    }

    function _validateZipCode(){
        //web service code to validate zip code
        var $el = $(configs.storeConfig.zip.selector);

        /**
         * Length
         */
        if($el.val().length === 5){
            $('p[data-error-type="invalid-zip"]').removeClass('is-invalid');
            $el.removeClass('error');
            return false;
        }

        $('p[data-error-type="invalid-zip"]').addClass('is-invalid');
        $el.addClass('error');
        _focusElem($el);
        return true;
    }

    function _setFieldValid($field, includeError, valids) { 
      $field = $($field);
      includeError = typeof includeError !== 'undefined' ? includeError : true;
      valids = typeof valids !== 'undefined' ? valids : [];
      var $error = $field.closest('fieldset').find('#'+$field.attr('aria-describedby')+' .error-message');

      if ($field[0].tagName.toLowerCase() === 'select') {
        $field.next('.ui-selectmenu-button').removeClass('error');
      } else {
        $field.removeClass('error');
      }

      if (includeError) {
        $error.removeClass('is-invalid');
        valids.forEach(function(valid) {
          var errorId = $field.attr('data-client-validation-error-'+valid);
          if (errorId) {
            $(errorId).removeClass('is-invalid');
          }
        });
      }
    }
    function _setFieldInvalid($field, includeError, invalids) {
      $field = $($field);
      invalids = typeof invalids !== 'undefined' ? invalids : [];
      includeError = typeof includeError !== 'undefined' ? includeError : true;

      if ($field[0].tagName.toLowerCase() === 'select') {
        $field.next('.ui-selectmenu-button').addClass('error');
      } else {
        $field.addClass('error');
      }
      if (includeError) {
        //remove everything to start
        $field.closest('fieldset').find('#'+$field.attr('aria-describedby')+' .error-message').removeClass('is-invalid');
        invalids.forEach(function(invalid) {
          var errorId = $field.attr('data-client-validation-error-'+invalid);
          if (errorId) {
            $(errorId).addClass('is-invalid');
          }
        });

        //if it's only a match invalid, do not go on
        if (invalids.length === 1 && invalids[0] === 'match') {return;}

        var errorElem = $field.closest('fieldset').find('#'+$field.attr('aria-describedby')+' .error-message'); 
        if (invalids.indexOf('email') !== -1) {
           var filterElem = errorElem.filter('[data-error-type="invalid-email"]'); 
           if (filterElem.length > 0) {
             errorElem = filterElem;
           } 
        } else {
          errorElem = errorElem.first();
        }

        errorElem.addClass('is-invalid');
      }
    }

    function _isFieldValid($field) {
      $field = $($field);

      var validation = {
            valid: true,
            invalids:[],
            valids: []
          },
          isRequired = $field.attr('required'),
          pattern = $field.attr('pattern'),
          clientValidation = $field.attr('data-client-validation');

      if (!clientValidation) {return validation;}

      var validationTypes = clientValidation !== 'true' ? clientValidation.split(',') : [],
          val = '';

      if ($field.attr('type') === 'radio') {
        var name = $field.attr('name');
        var $checked = $field.closest('fieldset').find('[name="'+name+'"]:checked');
        if ($checked.length > 0) {
          val = $checked.val();
        }
      } else {
        val = $field.val();
      }

      if (isRequired) {
        validationTypes.push('required'); 
      }

      if (pattern) {
        validationTypes.push(pattern);
      }

      validationTypes.forEach(function(type) {
        if (type !== 'split-phone-group') { 
           if (type.match('match:')) {
             var $toMatch = $('#'+type.split(':')[1]);
             if ($toMatch.length > 0 && val !== $toMatch.val()) {
              validation.valid = false; 
              validation.invalids.push('match');
             } else {
               validation.valids.push('match');
             }
           } else if (!citiShare.formValidation.validateInput(val, type)) {
             validation.valid = false;
             validation.invalids.push(type);
           } else {
             validation.valids.push(type);
           }
        }
      });

      return validation;
    }

    function _validatePhoneGroup($parent) {
      var valid = true,
          $inputs = $parent.find('input');

      $inputs.each(function(i, elem) {
        var $el = $(elem),
            validation = _isFieldValid($el);

        if (!validation.valid) {
          valid = false;
          _setFieldInvalid($el, true, validation.invalids);
        } else {
          _setFieldValid($el, false, validation.valids);
        }
      });

      $inputs.each(function(i, elem) {
        if (valid) {
          _setFieldValid(elem);
        }
      });

      return valid;
    }

    function _validateField($field) {
      var validation = _isFieldValid($field);
      if (!validation.valid) {
        _setFieldInvalid($field, true, validation.invalids);
      } else {
        _setFieldValid($field, true, validation.valids);
      }

      return validation.valid;
    }

    function _validateFieldset(fieldset, config) {
      var valid = true,
          $fieldset = $(fieldset),
          $firstInvalid = null;

      for (var c in config) {
        if (config.hasOwnProperty(c) && typeof config[c].selector !== 'undefined') {
          var $el = $fieldset.find(config[c].selector);
          var $firstel = $fieldset.first().find(config[c].selector);

          if ($el.length > 0) {
            var thisValid = true;

            if ($el.hasClass('split-phone-group')) {
              thisValid = _validatePhoneGroup($el);
            } else {
              thisValid = _validateField($el);
            }
            if (!thisValid) {
              valid = false;

              if (!$firstInvalid) {
                $firstInvalid = $el;
              }
            }
          }
        }
      }

      if (!valid) {
        _focusElem($firstInvalid);
      }
      return valid;
    }

    function _validate(fieldsetElem) {
      var valid = true,
          $el = $(fieldsetElem);

      for (var c in configs) {
        if (configs.hasOwnProperty(c)) {
          var thisConfig = configs[c];

          if (typeof thisConfig.SELECTOR !== 'undefined') {
            if ($el.is(thisConfig.SELECTOR)) {
              return _validateFieldset($el, thisConfig);
            }
          } 
        }
      }

      return valid;
    }

    function _onClick(e) {
      e.preventDefault();
      var $e = $(e.target);
      var fieldsetElem = $e.closest('fieldset');

      if (_validate(fieldsetElem)) {
        return true;
        //CALL API
      }
    }

    function _validateAll() {
      var $fieldsets = $('fieldset');
      var valid = true;

      $fieldsets.each(function(i, fieldset) {
        var $f = $(fieldset);
        if ($f.hasClass('user-is-editing')) {
          var thisValid = _validate(fieldset);
          if (!thisValid) {
            valid = false;
          }
        }
      });
      
      if (!_validate($(configs.contactConfig.SELECTOR))) {
        valid = false;
      }

      return valid;
    }

    function _focusElem($el) {
      var $elToFocus = $($el);

      if (typeof $el === 'undefined' || typeof $elToFocus[0] === 'undefined') { return; }


      if ($elToFocus[0].tagName.toLowerCase() === 'select') {
        var elNext = $el.next('.ui-selectmenu-button');
        if (elNext.length > 0) {
          $elToFocus = elNext;
        }
      }

      $elToFocus.focus();
    }

    function _onContinueClick(e) {
      if (!_validateAll()) {
        e.preventDefault();
        $('.cart-summary .error-message').addClass('is-invalid');
        _focusElem($('input.error').first());
        return false;
      }
      $('.cart-summary .error-message').removeClass('is-invalid');
      return true;
    }

    function _onSubmit(e) {
      e.preventDefault();
    }

    function _onChange(e) {
      $(e.target).closest('[data-client-validation-fieldset]').addClass('user-is-editing');
      _onBlur(e);
    }

    function _onBlur(e) {
      var $field = $(e.target);
      if ($field.attr('data-client-validation').match('split-phone-group')) {
        _validatePhoneGroup($field.closest('.split-phone-group'));
      } else {
        _validateField($field);
      }
    }

    function _onQtyChange(e) {
      var $el = $(e.target),
          max = $el.attr('data-max'),
          val = $el.val();

      if (val === '' || parseInt(val, 10) === 0) {
        $el.val($el.attr('value'));
      } else if (max && parseInt(max, 10) < parseInt(val, 10)) {
        $el.val(max);
      }
    }

    function _bind() {
      $('form').submit(_onSubmit);
      $('body').on('change', '[data-client-validation]', _onChange);
      $('body').on('blur', '[data-client-validation]', _onBlur);
      $('body').on('click', 'form button[type="submit"]', _onClick);
      $('body').on('click', '.cart-buttons-continue', _onContinueClick);
      $('body').on('change blur', 'input[name="cart-checkout-item-qty"]', _onQtyChange);
    }

    function _initValidation() {

      var $forms = $('form');
      $forms.attr('novalidate', '');
    
      for (var config in configs) {
        if (configs.hasOwnProperty(config)) {
          var thisConfig = configs[config];
          var $thisFieldset = $(thisConfig.SELECTOR);
          $thisFieldset.attr('data-client-validation-fieldset', 'true');

          for (var c in thisConfig) {
            if (thisConfig.hasOwnProperty(c) && c !== 'SELECTOR') {
              var types = 'true';
              if (typeof thisConfig[c].validate !== 'undefined') {
                types = thisConfig[c].validate.join(',');
              }
              var $fields = $thisFieldset.find(thisConfig[c].selector);

              if ($fields.hasClass('split-phone-group')) {
                $fields = $fields.find('input');
              } 
              if (typeof thisConfig[c].manual === 'undefined' || !thisConfig[c].manual) {
                $fields.attr('data-client-validation', types);
              }

              if (typeof thisConfig[c].errors !== 'undefined') {
                for (var e in thisConfig[c].errors) {
                  if (thisConfig[c].errors.hasOwnProperty(e)) {
                    var error = thisConfig[c].errors[e];
                    $fields.attr('data-client-validation-error-'+e, error);
                  }
                }
              }
            }
          }
        }
      }

      _bind();
    }

    _standardizeInputs();

    return {
        initValidation: _initValidation,
        validateZipCode: _validateZipCode
    };

})();

citiShare.cart = (function() {
    'use strict';

    var cartConfig = {
        expiration : $('#cc-expiration-date-mm'),
        cvv : $('.cart-input[name="cart-cvv"]'),
        year : $('#cc-expiration-date-yy'),
        phoneGroup: $('.split-phone-group')
    };

    function _enableTabbbing() {
        // Enable tabbing and limit to numbers phone fields
        var $phoneSplitGroup = $('.split-phone-group').find('[data-validate-type="split-phone"]');
        if(typeof $phoneSplitGroup.autotab === 'function') {
          $phoneSplitGroup.autotab('number');
        }
    }

    function _openActiveFormPanel($targetContainer) {
        $targetContainer.find('.js-cart-edit').addClass('cart-edit-active');
        
        if($targetContainer.find('[name="cart-items-recipient"]').hasClass('cart-edit-active')){
            if($targetContainer.find('.js-cart-edit').find('p').first().hasClass('error-message')){
                $targetContainer.find('.js-cart-edit').find('input').first().focus();
            }else{
                $targetContainer.find('.js-cart-edit').find('p').first().attr('tabindex','0').focus();
            }
        }else{
            $targetContainer.find('.js-cart-edit').find('input').first().focus();
        }
        $targetContainer.find('.js-cart-edit-toggle-item').addClass('cart-hidden');
    }

    function _closeActiveFormPanels($formElements) {
        var $activeEl = $formElements.find('.cart-edit-active');
        $activeEl.removeClass('cart-edit-active').removeClass('user-is-editing').find('input').val('');
        $activeEl.find('.error').removeClass('error');
        $activeEl.find('.is-invalid').removeClass('is-invalid');
        $formElements.find('.js-cart-edit-toggle-item').removeClass('cart-hidden');
    }

    function _expirationOnChange(){
        cartConfig.expiration.on('selectmenuchange', function(){
            _calculateEnableSubmit(cartConfig.cvv.val(), cartConfig.expiration.val(), cartConfig.year.val());
        });
    }

    function _cartAccessibility(){
        $(window).bind('resize', function() {
            var pageWidth =  window.innerWidth || $(window).width();
            if(pageWidth > window.citiConfig.tabletBreakpoint){
                $('.cart-image-container > img').attr('role','presentation');
            }else{
                $('.cart-image-container > img').removeAttr('role');
            }
        }).trigger('resize');
    }

    function _yearOnChange(){
        cartConfig.year.on('selectmenuchange', function(){
            _calculateEnableSubmit(cartConfig.cvv.val(), cartConfig.expiration.val(), cartConfig.year.val());
        });
    }

    function _cvvOnChange(){
        cartConfig.cvv.on('blur', function(){
            _calculateEnableSubmit(cartConfig.cvv.val(), cartConfig.expiration.val(), cartConfig.year.val());
        });
    }

    function _showUpdateLink() {
        $('.cart-input-qty').on('input change', function() {
            var $el = $(this);
            var $editButton = $el.next('p.cart-items-edit');

            $editButton.removeClass('cart-hidden');
        });
    }

    function _calculateEnableSubmit(cvv,expiration,year){
        if((cvv !== undefined && cvv.length > 0) && expiration !== "1000" && year !== "1000"){
            $('button.cart-buttons-continue').removeClass('inactive');
            $('button.cart-buttons-continue').removeAttr('aria-disabled');
        }else{
            $('button.cart-buttons-continue').addClass('inactive');
            $('button.cart-buttons-continue').attr('aria-disabled','true');
        }
    }

    function _labelResponsiveTables(tableSelector) {
        var $tableCollection = $(tableSelector);

        $tableCollection.each(function() {
            var $tableEl = $(this);
            var $tableHeadings = $tableEl.find('th');
            var $tableRows =  $tableEl.find('tr');

            $tableRows.each(function() {
                var $tableCells = $(this).find('td');

                $tableHeadings.each(function(index) {
                    var label = $(this).html();
                    $tableCells.eq(index).prepend('<div class="cart-headers-item show-on-tablet-down ">'+ label +'</div>');
                });
            });
        });
    }
    
    function _showLocalPickup() {
      $('.cart-select-delivery-option').on('selectmenuchange', function() {
        if($('option:selected', this).data("local") === true) {
          $(this).parents().find('.cart-form-search-wrapper').show();
        } else {
          $(this).parents().find('.cart-form-search-wrapper').hide();
        }
      });
    }

    $('.js-cart-form-handler').on('click', 'a.js-cart-edit-open', function(event) {
        event.preventDefault();
        var error = false;
        var $target = $(this);
        var $formElements = $('.js-cart-form-handler');
        
        if($target.hasClass('submit-find')){
            error = citiShare.error.validateZipCode();
        }

        if ($target.hasClass('js-cart-edit-open') && !error) {
            if($target.attr('aria-expanded').length > 0){
                $target.attr('aria-expanded','true').addClass('isOpen');
            }
            var $targetContainer = $target.parents('.js-cart-edit-container');

            _closeActiveFormPanels($formElements);
            _openActiveFormPanel($targetContainer);
        }
        else {
            _closeActiveFormPanels($formElements);
        }
    });

    $("input[name=cart-result-option]").on('change', function(){
        $('.cart-items-value-tax').show();
        $('.cart-items-points-value-tax').css('display','block');
    });

    $('.js-cart-form-handler').on('click', 'a.js-cart-edit-close', function(event) {
        event.preventDefault();
        var $formElements = $('.js-cart-form-handler');

        _closeActiveFormPanels($formElements);
        $formElements.find('a.js-cart-edit-open').attr('aria-expanded','false');
        setTimeout(function() {
            $formElements.find('a.js-cart-edit-open.isOpen').focus();
            $formElements.find('a.js-cart-edit-open.isOpen').removeClass('isOpen');
        }, 1000);
    });

    $('textarea[name="cart-note"]').on('keyup', function() {
        var $this = $(this);
        // todo: maybe refactor this so that we're not so dependent
        // on html structure for the error field
        citiShare.formValidation.limitInputbyCharacterCount($this, $this.next('.js-cart-note-warning'));
    });

    $('input[type="radio"][name="cart-typeofaddress"]').on('change', function() {
        var $this = $(this);
        var type = $this.val();
        var $businessRadio = $this.closest('fieldset').find('input[value="business"]');
        var $businessWrapper = $this.closest('form').find('.input-cart-delivery-business-wrapper');

        if (type === 'business') {
            $businessWrapper.removeClass('is-hidden');
            $businessRadio.attr('aria-expanded','true');
        } else {
            $businessWrapper.addClass('is-hidden');
            $businessRadio.attr('aria-expanded','false');
        }
    });

    $('input[type="radio"][name="cart-typeofbuilding"]').on('change', function() {
        var $this = $(this);
        var type = $this.val();
        var $address2Error = $this.closest('form').find('#invalid-delivery-address-2 .error-message');
        var $address2Input = $this.closest('form').find('#input-cart-delivery-address2');

        if (type === 'yes') {
            $address2Input.attr('aria-required', 'true');
            $address2Input.attr('required', 'true');
            $address2Input.attr('data-client-validation', 'true');
        } else {
            $address2Error.removeClass('is-invalid');
            $address2Input.removeClass('error');
            $address2Input.attr('aria-required', 'false');
            $address2Input.attr('required', 'false');
            $address2Input.attr('data-client-validation', null);
        }
    });

    $('.cart-summary-totals label[for="toc"]').on('click', function() {
        if ($(".cart-summary-totals input").prop('checked') === true) {
            $('.cart-summary .cart-buttons-submit').addClass('inactive');
        } else {
            $('.cart-summary .cart-buttons-submit').removeClass('inactive');
        }
    });

    /**
     * "Change email recipient" behavior
     * Tough because you're hitting "Submit" on a form input
     * that isn't actually supposed to suibmit the form
     */
    var $itemForms = $('form[name="cart-checkout-cash-charity"]');
    $itemForms.on('click', '[name="cart-items-recipient"] :submit', function(event) {
        event.preventDefault();

        var $el = $(this);
        var $fieldset = $el.parents('fieldset[name="cart-items-recipient"]');
        var $form = $el.parents('form');
        var $formDOMEl = $form.get(0);
        var email, name, note;
        var $td;
        var cartHidden = 'cart-hidden';

        if (typeof $formDOMEl.checkValidity === 'function') {

            if ($formDOMEl.checkValidity() === true) {
                $td = $fieldset.parents('td');
                email = $fieldset.find('[name="cart-email"]').val();
                name = $fieldset.find('[name="cart-full-name"]').val();
                note = $fieldset.find('[name="cart-note"]').val();

                $fieldset.addClass(cartHidden).removeClass('cart-edit-active');

                $td.find('.cart-items-recipient-header').text('Sending to:');
                $td.find('.cart-items-recipient-email').text(email);
                $td.find('.cart-items-recipient-name').text(name).removeClass(cartHidden);
                if (note) {
                    $td.find('.cart-items-recipient-note').text(note).removeClass(cartHidden);
                }

                $td.find('.js-cart-edit-toggle-item').removeClass(cartHidden);
                $td.find('.cart-items-edit').addClass(cartHidden);
                $td.find('.cart-items-update').removeClass(cartHidden);
            }
            // else {
            //     // Handle invalid form input
            // }
        }
        // else {
        //     // How are we validating?
        // }

    });

    $itemForms.on('click', '.js-cart-edit-remove', function(event) {
        event.preventDefault();

        var $el = $(this);
        var $td = $el.parents('td');
        var $email = $td.find('.cart-items-recipient-email');
        var $name = $td.find('.cart-items-recipient-name');
        var $note = $td.find('.cart-items-recipient-note');
        var $header = $td.find('.cart-items-recipient-header');

        $header.text('Send to email on file:');
        $email.text('recipient@gmail.com');
        $name.text('').addClass('cart-hidden');
        $note.text('').addClass('cart-hidden');
        $td.find('.cart-items-edit').removeClass('cart-hidden');
        $td.find('.cart-items-update').addClass('cart-hidden');
    });

    // TODO:: on form submit trigger validateCartCheckout();

    _enableTabbbing();
    //_phoneNumberOnChange();
    _expirationOnChange();
    _yearOnChange();
    _cvvOnChange();
    _cartAccessibility();
    _labelResponsiveTables('section.cart-section:not(.cart-summary) table');
    _showUpdateLink();
    citiShare.error.initValidation();
    _showLocalPickup();

})();

/*jshint scripturl:true*/
//Based on the Deque University code, support added for multiple datepickers on the same page.
citiShare.datePicker = (function () {
  'use strict';

  function settupAccessibleDateicker() {
    $('.datepicker').datepicker({
      showOn: 'button',
      buttonImage: "", // File (and file path) for the calendar image
      buttonImageOnly: false,
      buttonText: 'Calendar View',
      dayNamesShort: [ "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday" ],
      showButtonPanel: true,
      closeText: 'Close',
      onClose: removeAria
    });

    // Add aria-describedby to the button referring to the label
    $('.ui-datepicker-trigger').attr('aria-describedby', 'datepickerLabel');

    dayTripper();
  }

  function dayTripper() {
    $('.ui-datepicker-trigger').click(function () {
      $(this).prev().addClass("datepickerOpened");
      setTimeout(function () {
        var today = $('.ui-datepicker-today a')[0];
        if (!today) {
          today = $('.ui-state-active')[0] ||
            $('.ui-state-default')[0];
        }


        // Hide the entire page (except the date picker)
        // from screen readers to prevent document navigation
        // (by headings, etc.) while the popup is open
        $("main").attr('id', 'dp-container');
        $("#dp-container").attr('aria-hidden', 'true');
        $("#skipnav").attr('aria-hidden', 'true');

        // Hide the "today" button because it doesn't do what
        // you think it supposed to do
        $(".ui-datepicker-current").hide();

        today.focus();
        datePickHandler();
      }, 0);
    });
  }

  function datePickHandler() {
    var activeDate;
    var container = document.getElementById('ui-datepicker-div');
    var input = document.getElementsByClassName('datepickerOpened');

    if (!container || !input) {
      return;
    }

    $(container).find('table').first().attr('role', 'grid');

    container.setAttribute('role', 'application');
    container.setAttribute('aria-label', 'Calendar view date-picker');

    // the top controls:
    var prev = $('.ui-datepicker-prev', container)[0],
      next = $('.ui-datepicker-next', container)[0];


// This is the line that needs to be fixed for use on pages with base URL set in head
    next.href = 'javascript:void(0)';
    prev.href = 'javascript:void(0)';

    next.setAttribute('role', 'button');
    next.removeAttribute('title');
    prev.setAttribute('role', 'button');
    prev.removeAttribute('title');

    appendOffscreenMonthText(next);
    appendOffscreenMonthText(prev);

    // delegation won't work here for whatever reason, so we are
    // forced to attach individual click listeners to the prev /
    // next month buttons each time they are added to the DOM
    $(next).on('click', handleNextClicks);
    $(prev).on('click', handlePrevClicks);

    monthDayYearText();

    $(container).on('keydown', function calendarKeyboardListener(keyVent) {
      var which = keyVent.which;
      var target = keyVent.target;
      var dateCurrent = getCurrentDate(container);

      if (!dateCurrent) {
        dateCurrent = $('a.ui-state-default')[0];
        setHighlightState(dateCurrent, container);
      }

      if (27 === which) {
        keyVent.stopPropagation();
        return closeCalendar();
      } else if (which === 9 && keyVent.shiftKey) { // SHIFT + TAB
        keyVent.preventDefault();
        if ($(target).hasClass('ui-datepicker-close')) { // close button
          $('.ui-datepicker-prev')[0].focus();
        } else if ($(target).hasClass('ui-state-default')) { // a date link
          $('.ui-datepicker-close')[0].focus();
        } else if ($(target).hasClass('ui-datepicker-prev')) { // the prev link
          $('.ui-datepicker-next')[0].focus();
        } else if ($(target).hasClass('ui-datepicker-next')) { // the next link
          activeDate = $('.ui-state-highlight') ||
            $('.ui-state-active')[0];
          if (activeDate) {
            activeDate.focus();
          }
        }
      } else if (which === 9) { // TAB
        keyVent.preventDefault();
        if ($(target).hasClass('ui-datepicker-close')) { // close button
          activeDate = $('.ui-state-highlight') ||
            $('.ui-state-active')[0];
          if (activeDate) {
            activeDate.focus();
          }
        } else if ($(target).hasClass('ui-state-default')) {
          $('.ui-datepicker-next')[0].focus();
        } else if ($(target).hasClass('ui-datepicker-next')) {
          $('.ui-datepicker-prev')[0].focus();
        } else if ($(target).hasClass('ui-datepicker-prev')) {
          $('.ui-datepicker-close')[0].focus();
        }
      } else if (which === 37) { // LEFT arrow key
        // if we're on a date link...
        if (!$(target).hasClass('ui-datepicker-close') && $(target).hasClass('ui-state-default')) {
          keyVent.preventDefault();
          previousDay(target);
        }
      } else if (which === 39) { // RIGHT arrow key
        // if we're on a date link...
        if (!$(target).hasClass('ui-datepicker-close') && $(target).hasClass('ui-state-default')) {
          keyVent.preventDefault();
          nextDay(target);
        }
      } else if (which === 38) { // UP arrow key
        if (!$(target).hasClass('ui-datepicker-close') && $(target).hasClass('ui-state-default')) {
          keyVent.preventDefault();
          upHandler(target, container, prev);
        }
      } else if (which === 40) { // DOWN arrow key
        if (!$(target).hasClass('ui-datepicker-close') && $(target).hasClass('ui-state-default')) {
          keyVent.preventDefault();
          downHandler(target, container, next);
        }
      } else if (which === 13) { // ENTER
        if ($(target).hasClass('ui-state-default')) {
          setTimeout(function () {
            closeCalendar();
          }, 100);
        } else if ($(target).hasClass('ui-datepicker-prev')) {
          handlePrevClicks();
        } else if ($(target).hasClass('ui-datepicker-next')) {
          handleNextClicks();
        }
      } else if (32 === which) {
        if ($(target).hasClass('ui-datepicker-prev') || $(target).hasClass('ui-datepicker-next')) {
          target.click();
        }
      } else if (33 === which) { // PAGE UP
        moveOneMonth(target, 'prev');
      } else if (34 === which) { // PAGE DOWN
        moveOneMonth(target, 'next');
      } else if (36 === which) { // HOME
        var firstOfMonth = $(target).closest('tbody').find('.ui-state-default')[0];
        if (firstOfMonth) {
          firstOfMonth.focus();
          setHighlightState(firstOfMonth, $('#ui-datepicker-div')[0]);
        }
      } else if (35 === which) { // END
        var $daysOfMonth = $(target).closest('tbody').find('.ui-state-default');
        var lastDay = $daysOfMonth[$daysOfMonth.length - 1];
        if (lastDay) {
          lastDay.focus();
          setHighlightState(lastDay, $('#ui-datepicker-div')[0]);
        }
      }
      $(".ui-datepicker-current").hide();
    });

  }

  function closeCalendar() {
    var container = $('#ui-datepicker-div');
    $(container).off('keydown');
    var input = $('.datepickerOpened');
    $(input).datepicker('hide');
    input.focus();
  }

  function removeAria() {
    // make the rest of the page accessible again:
    $("#dp-container").removeAttr('aria-hidden');
    $("#skipnav").removeAttr('aria-hidden');
    $(".datepickerOpened").removeClass("datepickerOpened");
  }

///////////////////////////////
//////////////////////////// //
///////////////////////// // //
// UTILITY-LIKE THINGS // // //
///////////////////////// // //
//////////////////////////// //
///////////////////////////////

  function moveOneMonth(currentDate, dir) {
    var button = (dir === 'next') ? $('.ui-datepicker-next')[0] : $('.ui-datepicker-prev')[0];

    if (!button) {
      return;
    }

    var ENABLED_SELECTOR = '#ui-datepicker-div tbody td:not(.ui-state-disabled)';
    var $currentCells = $(ENABLED_SELECTOR);
    var currentIdx = $.inArray(currentDate.parentNode, $currentCells);

    button.click();
    setTimeout(function () {
      updateHeaderElements();

      var $newCells = $(ENABLED_SELECTOR);
      var newTd = $newCells[currentIdx];
      var newAnchor = newTd && $(newTd).find('a')[0];

      while (!newAnchor) {
        currentIdx--;
        newTd = $newCells[currentIdx];
        newAnchor = newTd && $(newTd).find('a')[0];
      }

      setHighlightState(newAnchor, $('#ui-datepicker-div')[0]);
      newAnchor.focus();

    }, 0);

  }

  function handleNextClicks() {
    setTimeout(function () {
      updateHeaderElements();
      prepHighlightState();
      $('.ui-datepicker-next').focus();
      $(".ui-datepicker-current").hide();
    }, 0);
  }

  function handlePrevClicks() {
    setTimeout(function () {
      updateHeaderElements();
      prepHighlightState();
      $('.ui-datepicker-prev').focus();
      $(".ui-datepicker-current").hide();
    }, 0);
  }

  function previousDay(dateLink) {
    var container = document.getElementById('ui-datepicker-div');
    if (!dateLink) {
      return;
    }
    var td = $(dateLink).closest('td');
    if (!td) {
      return;
    }

    var prevTd = $(td).prev(),
      prevDateLink = $('a.ui-state-default', prevTd)[0];

    if (prevTd && prevDateLink) {
      setHighlightState(prevDateLink, container);
      prevDateLink.focus();
    } else {
      handlePrevious(dateLink);
    }
  }


  function handlePrevious(target) {
    var container = document.getElementById('ui-datepicker-div');
    if (!target) {
      return;
    }
    var currentRow = $(target).closest('tr');
    if (!currentRow) {
      return;
    }
    var previousRow = $(currentRow).prev();

    if (!previousRow || previousRow.length === 0) {
      // there is not previous row, so we go to previous month...
      previousMonth();
    } else {
      var prevRowDates = $('td a.ui-state-default', previousRow);
      var prevRowDate = prevRowDates[prevRowDates.length - 1];

      if (prevRowDate) {
        setTimeout(function () {
          setHighlightState(prevRowDate, container);
          prevRowDate.focus();
        }, 0);
      }
    }
  }

  function previousMonth() {
    var prevLink = $('.ui-datepicker-prev')[0];
    var container = document.getElementById('ui-datepicker-div');
    prevLink.click();
    // focus last day of new month
    setTimeout(function () {
      var trs = $('tr', container),
        lastRowTdLinks = $('td a.ui-state-default', trs[trs.length - 1]),
        lastDate = lastRowTdLinks[lastRowTdLinks.length - 1];

      // updating the cached header elements
      updateHeaderElements();

      setHighlightState(lastDate, container);
      lastDate.focus();

    }, 0);
  }

///////////////// NEXT /////////////////
  /**
   * Handles right arrow key navigation
   * @param  {HTMLElement} dateLink The target of the keyboard event
   */
  function nextDay(dateLink) {
    var container = document.getElementById('ui-datepicker-div');
    if (!dateLink) {
      return;
    }
    var td = $(dateLink).closest('td');
    if (!td) {
      return;
    }
    var nextTd = $(td).next(),
      nextDateLink = $('a.ui-state-default', nextTd)[0];

    if (nextTd && nextDateLink) {
      setHighlightState(nextDateLink, container);
      nextDateLink.focus(); // the next day (same row)
    } else {
      handleNext(dateLink);
    }
  }

  function handleNext(target) {
    var container = document.getElementById('ui-datepicker-div');
    if (!target) {
      return;
    }
    var currentRow = $(target).closest('tr'),
      nextRow = $(currentRow).next();

    if (!nextRow || nextRow.length === 0) {
      nextMonth();
    } else {
      var nextRowFirstDate = $('a.ui-state-default', nextRow)[0];
      if (nextRowFirstDate) {
        setHighlightState(nextRowFirstDate, container);
        nextRowFirstDate.focus();
      }
    }
  }

  function nextMonth() {
    var nextMon = $('.ui-datepicker-next')[0];
    var container = document.getElementById('ui-datepicker-div');
    nextMon.click();
    // focus the first day of the new month
    setTimeout(function () {
      // updating the cached header elements
      updateHeaderElements();

      var firstDate = $('a.ui-state-default', container)[0];
      setHighlightState(firstDate, container);
      firstDate.focus();
    }, 0);
  }

/////////// UP ///////////
  /**
   * Handle the up arrow navigation through dates
   * @param  {HTMLElement} target   The target of the keyboard event (day)
   * @param  {HTMLElement} cont     The calendar container
   * @param  {HTMLElement} prevLink Link to navigate to previous month
   */
  function upHandler(target, cont, prevLink) {
    prevLink = $('.ui-datepicker-prev')[0];
    var rowContext = $(target).closest('tr');
    if (!rowContext) {
      return;
    }
    var rowTds = $('td', rowContext),
      rowLinks = $('a.ui-state-default', rowContext),
      targetIndex = $.inArray(target, rowLinks),
      prevRow = $(rowContext).prev(),
      prevRowTds = $('td', prevRow),
      parallel = prevRowTds[targetIndex],
      linkCheck = $('a.ui-state-default', parallel)[0];

    if (prevRow && parallel && linkCheck) {
      // there is a previous row, a td at the same index
      // of the target AND theres a link in that td
      setHighlightState(linkCheck, cont);
      linkCheck.focus();
    } else {
      // we're either on the first row of a month, or we're on the
      // second and there is not a date link directly above the target
      prevLink.click();
      setTimeout(function () {
        // updating the cached header elements
        updateHeaderElements();
        var newRows = $('tr', cont),
          lastRow = newRows[newRows.length - 1],
          lastRowTds = $('td', lastRow),
          tdParallelIndex = $.inArray(target.parentNode, rowTds),
          newParallel = lastRowTds[tdParallelIndex],
          newCheck = $('a.ui-state-default', newParallel)[0];

        if (lastRow && newParallel && newCheck) {
          setHighlightState(newCheck, cont);
          newCheck.focus();
        } else {
          // theres no date link on the last week (row) of the new month
          // meaning its an empty cell, so we'll try the 2nd to last week
          var secondLastRow = newRows[newRows.length - 2],
            secondTds = $('td', secondLastRow),
            targetTd = secondTds[tdParallelIndex],
            linkCheck = $('a.ui-state-default', targetTd)[0];

          if (linkCheck) {
            setHighlightState(linkCheck, cont);
            linkCheck.focus();
          }

        }
      }, 0);
    }
  }

//////////////// DOWN ////////////////
  /**
   * Handles down arrow navigation through dates in calendar
   * @param  {HTMLElement} target   The target of the keyboard event (day)
   * @param  {HTMLElement} cont     The calendar container
   * @param  {HTMLElement} nextLink Link to navigate to next month
   */
  function downHandler(target, cont, nextLink) {
    nextLink = $('.ui-datepicker-next')[0];
    var targetRow = $(target).closest('tr');
    if (!targetRow) {
      return;
    }
    var targetCells = $('td', targetRow),
      cellIndex = $.inArray(target.parentNode, targetCells), // the td (parent of target) index
      nextRow = $(targetRow).next(),
      nextRowCells = $('td', nextRow),
      nextWeekTd = nextRowCells[cellIndex],
      nextWeekCheck = $('a.ui-state-default', nextWeekTd)[0];

    if (nextRow && nextWeekTd && nextWeekCheck) {
      // theres a next row, a TD at the same index of `target`,
      // and theres an anchor within that td
      setHighlightState(nextWeekCheck, cont);
      nextWeekCheck.focus();
    } else {
      nextLink.click();

      setTimeout(function () {
        // updating the cached header elements
        updateHeaderElements();

        var nextMonthTrs = $('tbody tr', cont),
          firstTds = $('td', nextMonthTrs[0]),
          firstParallel = firstTds[cellIndex],
          firstCheck = $('a.ui-state-default', firstParallel)[0];

        if (firstParallel && firstCheck) {
          setHighlightState(firstCheck, cont);
          firstCheck.focus();
        } else {
          // lets try the second row b/c we didnt find a
          // date link in the first row at the target's index
          var secondRow = nextMonthTrs[1],
            secondTds = $('td', secondRow),
            secondRowTd = secondTds[cellIndex],
            secondCheck = $('a.ui-state-default', secondRowTd)[0];

          if (secondRow && secondCheck) {
            setHighlightState(secondCheck, cont);
            secondCheck.focus();
          }
        }
      }, 0);
    }
  }

// add an aria-label to the date link indicating the currently focused date
// (formatted identically to the required format: mm/dd/yyyy)
  function monthDayYearText() {
    var cleanUps = $('.amaze-date');

    $(cleanUps).each(function (clean) {
      // each(cleanUps, function (clean) {
      clean.parentNode.removeChild(clean);
    });

    var datePickDiv = document.getElementById('ui-datepicker-div');
    // in case we find no datepick div
    if (!datePickDiv) {
      return;
    }

    var dates = $('a.ui-state-default', datePickDiv);

    $(dates).each(function (index, date) {
      var currentRow = $(date).closest('tr'),
        currentTds = $('td', currentRow),
        currentIndex = $.inArray(date.parentNode, currentTds),
        headThs = $('thead tr th', datePickDiv),
        dayIndex = headThs[currentIndex],
        daySpan = $('span', dayIndex)[0],
        monthName = $('.ui-datepicker-month', datePickDiv)[0].innerHTML,
        year = $('.ui-datepicker-year', datePickDiv)[0].innerHTML,
        number = date.innerHTML;

      if (!daySpan || !monthName || !number || !year) {
        return;
      }

      // AT Reads: {month} {date} {year} {day}
      // "December 18 2014 Thursday"
      var dateText = monthName + ' ' + date.innerHTML + ' ' + year + ' ' + daySpan.title;
      // AT Reads: {date(number)} {name of day} {name of month} {year(number)}
      // var dateText = date.innerHTML + ' ' + daySpan.title + ' ' + monthName + ' ' + year;
      // add an aria-label to the date link reading out the currently focused date
      date.setAttribute('aria-label', dateText);
    });
  }


// update the cached header elements because we're in a new month or year
  function updateHeaderElements() {
    var context = document.getElementById('ui-datepicker-div');
    if (!context) {
      return;
    }

    $(context).find('table').first().attr('role', 'grid');

    var prev = $('.ui-datepicker-prev', context)[0];
    var next = $('.ui-datepicker-next', context)[0];

    //make them click/focus - able
    next.href = 'javascript:void(0)';
    prev.href = 'javascript:void(0)';

    next.setAttribute('role', 'button');
    prev.setAttribute('role', 'button');
    appendOffscreenMonthText(next);
    appendOffscreenMonthText(prev);

    $(next).on('click', handleNextClicks);
    $(prev).on('click', handlePrevClicks);

    // add month day year text
    monthDayYearText();
  }


  function prepHighlightState() {
    var highlight;
    var cage = document.getElementById('ui-datepicker-div');
    highlight = $('.ui-state-highlight', cage)[0] ||
      $('.ui-state-default', cage)[0];
    if (highlight && cage) {
      setHighlightState(highlight, cage);
    }
  }

// Set the highlighted class to date elements, when focus is recieved
  function setHighlightState(newHighlight, container) {
    var prevHighlight = getCurrentDate(container);
    // remove the highlight state from previously
    // highlighted date and add it to our newly active date
    $(prevHighlight).removeClass('ui-state-highlight');
    $(newHighlight).addClass('ui-state-highlight');
  }


// grabs the current date based on the hightlight class
  function getCurrentDate(container) {
    return  $('.ui-state-highlight', container)[0];
  }

  /**
   * Appends logical next/prev month text to the buttons
   * - ex: Next Month, January 2015
   *       Previous Month, November 2014
   */
  function appendOffscreenMonthText(button) {
    var buttonText;
    var isNext = $(button).hasClass('ui-datepicker-next');
    var months = [
      'january', 'february',
      'march', 'april',
      'may', 'june', 'july',
      'august', 'september',
      'october',
      'november', 'december'
    ];

    var currentMonth = $('.ui-datepicker-title .ui-datepicker-month').text().toLowerCase();
    var monthIndex = $.inArray(currentMonth.toLowerCase(), months);
    var currentYear = $('.ui-datepicker-title .ui-datepicker-year').text().toLowerCase();
    var adjacentIndex = (isNext) ? monthIndex + 1 : monthIndex - 1;

    if (isNext && currentMonth === 'december') {
      currentYear = parseInt(currentYear, 10) + 1;
      adjacentIndex = 0;
    } else if (!isNext && currentMonth === 'january') {
      currentYear = parseInt(currentYear, 10) - 1;
      adjacentIndex = months.length - 1;
    }

    buttonText = (isNext) ? 'Next Month, ' + firstToCap(months[adjacentIndex]) + ' ' + currentYear : 'Previous Month, ' + firstToCap(months[adjacentIndex]) + ' ' + currentYear;

    $(button).find('.ui-icon').html(buttonText);

  }

// Returns the string with the first letter capitalized
  function firstToCap(s) {
    return s.charAt(0).toUpperCase() + s.slice(1);
  }

  settupAccessibleDateicker();
})();
citiShare.detailedList = (function () {
  'use strict';

  function _tabListKeyPress(event) {
    if (event.which === 37 || event.which === 38 ||
      (event.which === 33 && event.ctrlKey)) { //left/up/ctrl+pageup
      var prevItem = $(event.currentTarget).prev("li");
      if (prevItem.length > 0) {
        _focusTab(prevItem);
        event.preventDefault();
      } else {
        //go to the last one
        var lastItem = $(event.currentTarget).siblings("li").last();
        _focusTab(lastItem);
        event.preventDefault();
      }
    } else if (event.which === 39 || event.which === 40 ||
      (event.which === 34 && event.ctrlKey)) { //right/down/ctrl+pagedown
      var nextItem = $(event.currentTarget).next("li");
      if (nextItem.length > 0) {
        _focusTab(nextItem);
        event.preventDefault();
      } else {
        //go to the first one
        var firstItem = $(event.currentTarget).siblings("li").first();
        _focusTab(firstItem);
        event.preventDefault();
      }

    }
  }

  function _tabListClick(event) {
    _focusTab($(event.currentTarget));
  }

  function _focusTab(newTab) {
    // Identify existing focus tab and: 1) Unset aria-selected, 2) set tabindex=-1, 3) replace
    // active class with inactive on both the tab and the panel, 4) set aria-hidden on panel
    var activeTab = $('.tablist-points-header > li.active');

    activeTab
      .addClass("inactive")
      .removeClass("active")
      .attr("aria-selected", "false")
      .attr("tabindex", "-1");

    $("#" + activeTab.attr("aria-controls"))
      .addClass("inactive")
      .removeClass("active")
      .attr("aria-hidden", "true");

    // For newly focused tab: 1) Set aria-selected, 2) set tabindex=0, 3) replace inactive class
    // with active on both tab and panel, 4) unset aria-hidden on panel

    newTab
      .addClass("active")
      .removeClass("inactive")
      .attr("aria-selected", "true")
      .attr("tabindex", "0");

    $("#" + newTab.attr("aria-controls"))
      .addClass("active")
      .removeClass("inactive")
      .attr("aria-hidden", "false");

    newTab.focus();
  }

  /**
   * Open a detailed list based on the href of the link selected
   * The href attribute of the link should match the id of the detailed list container
   */
  function _toggleList() {
    $(".detailed-list-link:not([data-bounded='true'])").each(function () {
      var listLink = $(this),
        listsToShow = $(listLink.data("attached-lists"));
      listLink.attr("data-bounded", "true");

      $(listLink).click(function () {
        listsToShow.each(function () {
          if ($(this).attr("aria-hidden") === "true") {
            listLink.focus();
            $(this).show();
            $(listLink).find("span:first-child").addClass("turnover");
            $(listLink).attr("aria-expanded", "true");
            $(this).attr("aria-hidden", "false");
          } else {
            var listElement = $(this),
              listElementSubList = listElement.find(".sub-detailed-list"),
              listElementMini = listElement.find(".detailed-list-link-mini");

            listElement.hide();
            listElement.attr("aria-hidden", "true");

            listElementSubList.hide();
            listElementSubList.attr("aria-hidden", "true");

            $(listLink).find("span:first-child").removeClass("turnover");
            $(listLink).attr("aria-expanded", "false");

            listElementMini.attr("aria-expanded", "false");
          }
        });
      });
    });
  }

  function _initTabPanel() {
    $('.tablist-points-header > li')
      .keydown(_tabListKeyPress)
      .click(_tabListClick);
  }

  _toggleList();
  _initTabPanel();

  return {
    toggleList: _toggleList
  };
})();

'use strict';

var FAQsSection = function(element) {
  this.element = element;
  this.faqAccordion = element.querySelector('.faqs-accordion-section .information-accordion');

  this._init();
};

FAQsSection.prototype._init = function() {
  this._checkForExpandedAccordion();
};

FAQsSection.prototype._checkForExpandedAccordion = function() {
  var autoOpenMenu;

  if(this.faqAccordion) {
    autoOpenMenu = this.faqAccordion.querySelector('[data-open-onload="true"]');
  } else {
    return;
  }

  if(autoOpenMenu){
    this._openAccordionMenu(autoOpenMenu);
  } else {
    this._openAccordionMenu(this.faqAccordion.firstElementChild);
  }
};

FAQsSection.prototype._openAccordionMenu = function(parentElement) {
  var firstElementHeader = parentElement.querySelector('.accordion-toggle-header');
  var firstElementContent = parentElement.querySelector('.accordionSubMenu');

  firstElementHeader.setAttribute('aria-expanded', 'true');
  firstElementContent.setAttribute('aria-expanded', 'true');

  firstElementHeader.classList.add('expanded');
  firstElementContent.classList.add('expanded');

  firstElementHeader.classList.remove('is-hidden');
  firstElementContent.classList.remove('is-hidden');
};

FAQsSection.init = function() {
  var faqsElement = document.querySelector('.faqs');

  if (faqsElement) {
    return new FAQsSection(faqsElement);
  }
};

citiShare.faqsSection = (function() {
  FAQsSection.init();
})();

/*jshint unused:false, sub:true*/

'use strict';

function _toArray(arrayLike) {
  return Array.prototype.slice.call(arrayLike);
}

var FilterTabs = function(element) {
  /**
   * Base element
   * @type {Element}
   */
  this._element = element;

  /**
   * Base element
   * @type {jQuery}
   */
  this.$el = $(element);

  /**
   * Filter tabs
   * @type {Array}
   */
  this._$tabs = $('.' + FilterTabs.ClassName.TABS);

  /**
   * Filter tabs
   * @type {Array}
   */
  this._tabs = _toArray(this._$tabs);

  /**
   * Anchors elements within tabs
   * @type {Array}
   */
  this._$anchors = $('.' + FilterTabs.ClassName.ANCHOR);

  /**
   * Filter Dropdowns
   * @type {Array}
   */
  this._$filters = $('.filter-menu-wrapper ' + '.' + FilterTabs.ClassName.FILTER_DD);

  this._clickListener = this._handleClickEvent.bind(this);
  this._resizeListener = this._handleResize.bind(this);
  this._keydownListener = this._handleKeyPress.bind(this);

  this._isMobile = false;
  this._isDesktop = false;
  this._activeTab = null;

  this._widthClass = 'options-5';

  this._init();
};

/**
 * Initializes the filterTabs component
 */
FilterTabs.prototype._init = function() {
  this._processTabs();
  this._handleResize();
  this._bindEvents();

  //hard-coded first value
  this._activeTab = this._$tabs.eq(0)[0];
  $(this._activeTab).addClass('filter-tabs-tab--active');
  this._getFilterList();
};

/**
 * Adds aria states for screen readers
 */
FilterTabs.prototype._processTabs = function() {
  this.$el.attr('role', 'tablist');

  this._$tabs.attr({
    role: 'tab',
    tabIndex: 0
  });

  this._$anchors.attr({
    tabIndex: -1,
    'aria-selected': false
  });
};

/**
 * Binds window, click, and keypress events to tabs
 */
FilterTabs.prototype._bindEvents = function() {
  $(window).on('resize.filterTabs orientationchange.filterTabs', this._resizeListener);
  this._$tabs.on('click.filterTabs', this._clickListener);
  this._$tabs.on('keydown.filterTabs', this._keydownListener);
};

/**
 * Registers the active tab
 * @param {Event} e jQuery Event
 */
FilterTabs.prototype._handleClickEvent = function(e) {
  e.preventDefault();

  if (this._activeTab !== e.currentTarget) {
    if (this._activeTab !== null) {
      $(this._activeTab).removeClass('filter-tabs-tab--active');
    }

    citiShare.filterMenu.clearAllFilters();

    this._activeTab = e.currentTarget;
    $(this._activeTab).addClass('filter-tabs-tab--active');
    this._getFilterList();
  }
};

/**
 * Registers the active tab on `ENTER` keypress
 * and move between tabs on `LEFT` or `RIGHT` keypress
 * @param {Event} e jQuery Event
 */
FilterTabs.prototype._handleKeyPress = function(e) {

  var focusedTab = this._clamp(this._getFocusedTabIndex());

  switch(e.which) {
    case FilterTabs.Keys.ENTER:
      this._handleClickEvent(e);
      break;

    case FilterTabs.Keys.LEFT:
      focusedTab--;
      this._focusTab(focusedTab);
      break;

    case FilterTabs.Keys.RIGHT:
      focusedTab++;
      this._focusTab(focusedTab);
      break;
  }
};

/**
 * Focus on a tab.
 * @param {number} index Tab index to focus on.
 */
FilterTabs.prototype._focusTab = function(index) {
  this._$tabs.eq(index).focus();
};

/**
 * Clamp a value between valid indexes of the tabs.
 * @param {number} index Index to clamp.
 * @return {number} Clamped index.
 */
FilterTabs.prototype._clamp = function(index) {
  return Math.min(Math.max(index, 0), this._tabs.length - 1);
};

/**
 * Find the index of the currently focused tab.
 * @return {number}
 */
FilterTabs.prototype._getFocusedTabIndex = function() {
  var $focusedTab = $(document.activeElement).closest('.' + FilterTabs.ClassName.TABS);
  return this._$tabs.index($focusedTab);
};

/**
 * Gets the name of filters associated with the active tab
 */
FilterTabs.prototype._getFilterList = function() {
  var filters = this._activeTab.getAttribute('data-filters');
  this._filtersList = filters.split(',');
  this._determineActiveFilters();
};

/**
 * Shows the filters associated with the active tab, and hides
 * the rest
 */
FilterTabs.prototype._determineActiveFilters = function() {
  this._$filters.each(this._hideFilters.bind(this));
  this._setWidthClass();
  this._filtersList.forEach(this._setActiveFilter.bind(this));
};

/**
 * Hides filter dropdown and button
 * @param {Number} i Index of filter in array
 * @param {Element} el Filter dropdown DOM Element
 */
FilterTabs.prototype._hideFilters = function(i, el) {
  var $el = $(el);
  var button = $($el.next('button')[0]);
  button.addClass('is-hidden');
  button.attr('aria-hidden', true);
  button.removeClass(this._widthClass);
};

/**
 * Sets an active filter
 * @param {string} filter Filter id
 */
FilterTabs.prototype._setActiveFilter = function(filter) {
  var el = _toArray(this._$filters).filter(function(element) {
    return element.getAttribute('data-id') === filter;
  })[0];

  var elIndex = this._$filters.index(el);

  var $filterEl = this._$filters.eq(elIndex).next('button')[0];
  $filterEl = $($filterEl);
  $filterEl.removeClass('is-hidden');
  $filterEl.attr('aria-hidden', false);
  $filterEl.addClass(this._widthClass);
};

/**
 * Creates width class based on the number of active filters
 */
FilterTabs.prototype._setWidthClass = function() {
  this._widthClass = FilterTabs.ClassName.WIDTH_CLASS + '-' + this._filtersList.length;
};

/**
 * Enquire-esque resize events
 */
FilterTabs.prototype._handleResize = function() {
  var windowWidth = window.innerWidth || windowWidth;

  // if this is mobile
  if (windowWidth <= window.citiConfig.tabletBreakpoint) {
    //if we resized from desktop
    if (!this._isMobile) {
      this._isMobile = true;
      this._isDesktop = false;
      this._calculateMobileWidth();
    }
  }

  //if this is desktop
  if (windowWidth > window.citiConfig.tabletBreakpoint) {
    //if we resized from mobile
    if (!this._isDesktop) {
      this._isDesktop = true;
      this._isMobile = false;
      this._removeMobileWidth();
    }

    /*
     * Note @evan: For some reason, window resizes are triggered by DOM elements
     * so we need to reconfigure the DOM to display the active tab + filters
     */
    if (this._activeTab !== null) {
      this._getFilterList();
    }
  }
};

/**
 * Calculates tabs container width on mobile
 */
FilterTabs.prototype._calculateMobileWidth = function() {
  var totalWidth = 0;
  this._tabs.forEach(function(el) {
    totalWidth += el.getBoundingClientRect().width;
  });

  this._element.style.width = Math.ceil(totalWidth) + 'px';
};

/**
 * Removes width style property
 */
FilterTabs.prototype._removeMobileWidth = function() {
  this._element.style.width = '';
};


FilterTabs.ClassName = {
  BASE: 'filter-tabs',
  TABS: 'filter-tabs-tab',
  ANCHOR: 'filter-tabs-anchor',
  FILTER_DD: 'dropdown',
  WIDTH_CLASS: 'options'
};

FilterTabs.Events = {
  RENDERED: 'filterTabs::rendered',
};

FilterTabs.Keys = {
  ENTER: 13,
  LEFT: 37,
  RIGHT: 39,
};

function _createFilterTabs() {
  _toArray($('.filter-tabs')).forEach(function(el) {
    return new FilterTabs(el);
  });
}

FilterTabs.initializeAll = function() {
  $(window).on(FilterTabs.Events.RENDERED, function() {
    _createFilterTabs();
  });
};


citiShare.filterTabs = (function(){

  FilterTabs.initializeAll();

  return {
    initAll: FilterTabs.initializeAll,
    Events: FilterTabs.Events,
    ClassName: FilterTabs.ClassName
  };

})();

/**
 * JSHint:
 * To allow bracket notation,
 * For example, test["placeholder"] vs test.placeholder
 */

/*jshint unused:false, sub:true*/

citiShare.filterMenu = (function () {
  "use strict";

  var tagStore = [];
  var $filterButton = $('.btn-show-filters');
  var $sortButton = $('.btn-show-sort');
  var $ocContainer = $('.oc-container');
  var isSortVisible = false;
  var isFiltersVisible = false;
  var counterSort = 0;
  var scrollPoint = 0;
  var previousScroll = 0;
  var widthUnderTablet = false;

  function openFilterDropdown($filterMenu) {
    closeFilterDropdown();

    //check if filterMenu has checked
    var checked = $filterMenu.closest('.multiselect-dropdown')
      .addClass('is-open')
      .find(".js-multiselect-dropdown-option[aria-checked$='true']").length;

    if (checked <= 0) {
      $filterMenu.closest('.multiselect-dropdown')
        .addClass('is-open')
        .find('.js-multiselect-dropdown-options-wrapper input').first()
        .click();
    } else {
      $filterMenu.closest('.multiselect-dropdown')
        .addClass('is-open')
        .find(".js-multiselect-dropdown-option[aria-checked$='true']")
        .find('input')
        .focus();
    }

    $('.filter-wrapper').addClass('level-two-menu-open');
  }

  function closeFilterDropdown($filterMenu) {
    $('.multiselect-dropdown').removeClass('is-open');

    if ($filterMenu) {
      $filterMenu.focus();
    }
    $('.filter-wrapper').removeClass('level-two-menu-open');
  }

  // OPEN OVERLAY FOR SHOW FILTERS - SHOW FILTERS SEEMS TO BE THE DROPDOWN WITH MULTIPLE SELECT
  // Hide the body - prepend overlay outside body - show the overlay
  function openMobileFilterMenu(ev) {
    //This is the select button
    var $this = $(ev.get(0));
    $this.attr('data-overlay-is-visible', 'true');
    //Get the good filter wrapper the div just after the target of the click
    var thisFilterWrapper = $this.next('.filter-wrapper');
    // move out of the page flow so that we can hide the rest of the page
    thisFilterWrapper.prependTo('body');
    //Display the overlay
    thisFilterWrapper.addClass('show-filters');
    //Put the focus on the close sign in the overlay
    thisFilterWrapper.find('.sub-nav-close').focus();
    //Hide the body div
    $ocContainer.addClass('is-hidden');
    isFiltersVisible = true;
  }

  // CLOSE OVERLAY FOR SHOW FILTERS
  function closeMobileFilterMenu(ev) {
    //$this is the close button
    var $this = $(ev.get(0));
    //Get the filter wrapper linked to the button clicked, the div just after the target of the click
    var thisFilterWrapper = $this.closest('.filter-wrapper');
    //Display none the overlay
    thisFilterWrapper.removeClass('show-filters');
    var clickedButton = '[data-overlay-is-visible="true"]';
    //Re-insert the filter wrap where it came (under the button js-show-sort)
    thisFilterWrapper.insertAfter(clickedButton);
    //Hide the body div
    $ocContainer.removeClass('is-hidden');
    //Focus back on the button clicked before the opening of the overlay
    closeFilterDropdown($(clickedButton));
    //Data that signal the overlay is close for this button
    $('.js-show-sort').attr('data-overlay-is-visible', 'false');
    isFiltersVisible = false;
    //Scroll to the position before the overlay was open
    $(window).scrollTop(scrollPoint);
  }


  // OPEN OVERLAY MOBILE - Hide the body - prepend overlay outside body - show the overlay
  function openMobileSortMenu(ev) {
    //This is the select button
    var $this = $(ev.get(0));
    $this.attr('data-overlay-is-visible', 'true');
    //Get the good filter wrapper the div just after the target of the click
    var thisFilterWrapper = $this.next('.filter-wrapper');
    // move out of the page flow so that we can hide the rest of the page
    thisFilterWrapper.prependTo('body');
    //Display the overlay
    thisFilterWrapper.addClass('show-sort');
    //Put the focus on the close sign in the overlay
    thisFilterWrapper.find('.sub-nav-close').focus();
    thisFilterWrapper.find('.sort-menu-item').addClass('sort-is-open');
    //Hide the body div
    $ocContainer.addClass('is-hidden');
    isSortVisible = true;
  }


  // CLOSE THE MOBILE OVERLAY on click
  function closeMobileSortMenu(ev) {
    //$this is the close button
    var $this = $(ev.get(0));
    //Get the filter wrapper linked to the button clicked, the div just after the target of the click
    var thisFilterWrapper = $this.closest('.filter-wrapper');
    //Display none the overlay
    thisFilterWrapper.removeClass('show-sort');
    var clickedButton = '[data-overlay-is-visible="true"]';
    //Re-insert the filter wrap where it came (under the button js-show-sort)
    thisFilterWrapper.insertAfter(clickedButton);
    //Hide the body div
    $ocContainer.removeClass('is-hidden');
    //Focus back on the button clicked before the opening of the overlay
    closeFilterDropdown($(clickedButton));
    //Data that signal the overlay is close for this button
    $('.js-show-sort').attr('data-overlay-is-visible', 'false');
    isSortVisible = false;
    //Scroll to the position before the overlay was open
    $(window).scrollTop(scrollPoint);
  }

  function closeOnDesktopResize() {
    //Close dropdown
    closeFilterDropdown();
    //Close the visible overlay mobile
    if (isSortVisible || isFiltersVisible) {
      //Re insert filter in desktop under the button
      $('.filter-wrapper.show-sort').insertAfter('[data-overlay-is-visible="true"]');
      $('.filter-wrapper.show-filters').insertAfter('[data-overlay-is-visible="true"]');
      //Remove overlay style that show it in mobile
      $('.filter-wrapper').removeClass('show-sort');
      $('.filter-wrapper').removeClass('show-filters');
      //Remove mobile body class hidden on container
      $ocContainer.removeClass('is-hidden');
      //Flag button and overlay off
      $('.js-show-sort').attr('data-overlay-is-visible', 'false');
      isSortVisible = false;
      isFiltersVisible = false;
    }
  }


  function menuNavigation($menuButton, key, event) {
    var menuButtonIndex = $('.js-multiselect-dropdown-button').index($menuButton),
      menuLength = $('.js-multiselect-dropdown-button').length - 1;

    // we call this function on all inputs and dropdown buttons but we need to
    // do different things depending on where we are in the dom
    if ($menuButton.hasClass('js-multiselect-dropdown-button')) {
      if (key === 'left') {
        if (menuButtonIndex <= menuLength) {
          closeFilterDropdown($menuButton.closest('.multiselect-dropdown'));
          $('.js-multiselect-dropdown-button').eq(menuButtonIndex - 1).focus();
        }
      } else if (key === 'right') {
        if (menuButtonIndex < menuLength) {
          closeFilterDropdown($menuButton.closest('.multiselect-dropdown'));
          $('.js-multiselect-dropdown-button').eq(menuButtonIndex + 1).focus();
        } else {
          $('.js-multiselect-dropdown-button').eq(0).focus();
        }
      } else if (key === 'down') {
        openFilterDropdown($menuButton.closest('.multiselect-dropdown'));
        if ($('.js-multiselect-dropdown-options-wrapper:visible input:checked').length > 0) {
          $('.js-multiselect-dropdown-options-wrapper:visible [aria-checked=true] input').focus();
        } else {
          $('.js-multiselect-dropdown-options-wrapper:visible li:first-child input').focus();
        }
      }
    } else if ($menuButton.hasClass('js-multiselect-dropdown-option-input')) {
      if (key === 'left') {
        event.preventDefault();
        closeFilterDropdown($menuButton.closest('.multiselect-dropdown'));
        menuNavigation($menuButton.closest('.multiselect-dropdown').find('.js-multiselect-dropdown-button'), 'left', event);
      } else if (key === 'right') {
        event.preventDefault();
        closeFilterDropdown($menuButton.closest('.multiselect-dropdown'));
        menuNavigation($menuButton.closest('.multiselect-dropdown').find('.js-multiselect-dropdown-button'), 'right', event);
      } else if (key === 'esc') {
        closeFilterDropdown($menuButton.closest('.multiselect-dropdown').find('.js-multiselect-dropdown-button'));
      }
    }

  }

  $('.js-multiselect-dropdown-option-input').on('change', function (event) {
    if ($(this).closest('.js-multiselect-dropdown-option').attr('aria-checked') === 'true') {
      $(this)[0].checked = true;
    } else {
      $(this)[0].checked = false;
    }
  });

  $('.js-multiselect-dropdown-option-input').on('focus', function(e) {

    var $element = $(this).siblings('label');
    var elementRect = $element[0].getBoundingClientRect();
    var $scrollableDiv = $element.parents('.multiselect-dropdown-options-wrapper');
    var scrollableDivRect = $scrollableDiv[0].getBoundingClientRect();

    var documentTop  = window.pageYOffset || document.documentElement.scrollTop;
    var elementPos = {
      top:  elementRect.top + documentTop,
      bottom: elementRect.bottom + documentTop
    };
    var scrollableDivPos = {
      top: scrollableDivRect.top + documentTop,
      bottom: scrollableDivRect.bottom + documentTop
    };

    if(elementPos.top < scrollableDivPos.top) {
      var topDifference = scrollableDivPos.top - elementPos.top;
      var topCurrentScrollTop = $scrollableDiv.scrollTop();
      $scrollableDiv.scrollTop(topCurrentScrollTop - topDifference);
    }

    if(elementPos.bottom > scrollableDivPos.bottom) {
      var bottomDifference = elementPos.bottom - scrollableDivPos.bottom;
      var bottomCurrentScrollTop = $scrollableDiv.scrollTop();
      $scrollableDiv.scrollTop(bottomCurrentScrollTop + bottomDifference + 5);
    }

    return false;
  });

  function addTags($input) {
    if (!_.some(tagStore, {inputVal: $input.val()})) {
      tagStore.push({time: Date.now(), inputVal: $input.val(), $elem: $input});
    }
    showTags();
  }

  function showTags() {
    tagStore = _.sortBy(tagStore, ['time']);

    //Special case made for my-account to not impact the live site
    if ($("body:not('.my-account')").length > 0) {
      $('.tag-list, .multiselect-dropdown .mobile-selections-list').empty();
    } else {
      $('.tag-list').empty();
    }

    _.each(tagStore, function (val) {
      addTagsToDom(val.$elem);
      return;
    });

    // only focus on the first tag if there's no menu item open
    if ($('.multiselect-dropdown.is-open').length === 0) {
      $('.tag-list a').first().focus();
    }
  }

  function addTagsToDom($input) {
    if ($input.val() !== 'see-all') {
      $('.tag-container').addClass('is-visible');
      $('.tag-list').append(createTag($input));
      //Special case made for my-account to not impact the live site
      if ($("body:not('.my-account')").length > 0) {
        $input.closest('.multiselect-dropdown')
          .find('.mobile-selections-list')
          .append(createMobileTag($input));
      } else {
        $input.closest('.multiselect-dropdown')
          .find('.mobile-selections-list')
          .html(createMobileTag($input));
      }
    }
  }

  function removeTag(inputVal) {
    var tagIndex;
    _.each(tagStore, function (val, key) {
      if (val.inputVal === String(inputVal)) {
        tagIndex = key;
        val.$elem[0].checked = false;
      }
    });

    if (tagIndex !== undefined) {
      tagStore.splice(tagIndex, 1);
    }

    if (tagStore.length > 0) {
      showTags();
    } else {
      $('.tag-container').removeClass('is-visible');
    }

  }

  function createTag($input) {
    return "<li class='tag-item js-remove-filter-tag' data-option-name='" + $input.val() + "'>" +
      "<span aria-hidden='true' class='icon-x-hidden'>x</span>" +
      " <a href='javascript:void(0)' title='Remove Selection'>" +
      "<span class='visuallyhidden'>Remove</span>" + $input.data('display-name') +
      "<span class='visuallyhidden'>Selection</span></a></li>";
  }

  function createMobileTag($input) {
    return "<span class='mobile-selection' data-option-name='" + $input.val() + "'>" + $input.attr('data-display-name') + "</span>";
  }

  function scrollToFilters() {
    if ($(window).width() > window.citiConfig.tabletBreakpoint && $('.filter-sticky-wrapper').hasClass('is-stuck')) {
      $('html, body').animate({
        scrollTop: 0
      }, 300);
    }
  }

  function init() {
    var keys = {
      9: 'tab',
      13: 'enter',
      27: 'esc',
      32: 'space',
      37: 'left',
      38: 'up',
      39: 'right',
      40: 'down'
    };

    //Open and Close the desktop dropdown
    $('.js-filter-menu-wrapper').on('click', '.js-multiselect-dropdown-button', function (event) {
      if ($(this).closest('.multiselect-dropdown').hasClass('is-open') && $(window).width() > window.citiConfig.tabletBreakpoint) {
        closeFilterDropdown($(this));
      } else {
        openFilterDropdown($(this));
      }
    });

    //Click that show the overlay show-filters
    $('.js-show-filters').click(function () {
      //Save the position before the opening of the overlay
      scrollPoint = $(window).scrollTop();
      openMobileFilterMenu($(this));
    });

    //Click that show the overlay show-sort
    $('.js-show-sort').click(function () {
      //Save the position before the opening of the overlay
      scrollPoint = $(window).scrollTop();
      openMobileSortMenu($(this));
    });

    //Click that hide mobile overlay
    $('.js-hide-filters').click(function () {
      if (isSortVisible === true) {
        closeMobileSortMenu($(this));
      } else {
        closeMobileFilterMenu($(this));
      }
    });

    $('.js-filter-menu-wrapper').on('click', '.js-filter-nav-back', function () {
      closeFilterDropdown($(this).closest('.js-multiselect-dropdown-button'));
    });

    $('.js-update-products').on('click', function () {
      if ($('.js-filter-nav-back:visible').length > 0) {
        $('.js-filter-nav-back:visible').click();
      } else {
        $('.js-hide-filters:visible').click();
      }
    });

    $('.js-clear-filters').on('click', function () {
      var $isOpen = $('.multiselect-dropdown.is-open').length ? $('.multiselect-dropdown.is-open') : $('.multiselect-dropdown.sort-is-open');
      //Special case made for my-account to not impact the live site
      if ($("body:not('.my-account')").length > 0) {
        $isOpen.find('.mobile-selections-list').empty();
      } else {
        var list = $isOpen.find('.mobile-selections-list'),
          selection = $isOpen.find('.mobile-selection');
        selection.attr("data-option-name", list.attr("data-default-code-value"));
        selection.html(list.attr("data-default-value"));
        list.parents("button").find(".multiselect-overlay-title").html(list.attr("data-default-value"));
        selection.parents(".multiselect-dropdown").find("li").each(function () {
          var listElement = $(this);
          listElement.attr("aria-checked", "false");
          if (listElement.attr("data-value") === selection.attr("data-option-name")) {
            listElement.attr("aria-checked", "true");
            listElement.find("input").trigger('customEventLoadAjax');
          }
        });
      }
    });

    $('.js-filter-menu-wrapper').on('keydown', '.js-multiselect-dropdown-button, .js-multiselect-dropdown-option-input', function (event) {
      if ($(window).width() < window.citiConfig.tabletBreakpoint) {
        return;
      } else {
        menuNavigation($(this), keys[event.which], event);
      }
    });

    $('.js-filter-menu-wrapper').on('keydown', '.multiselect-dropdown', function (event) {
      if (keys[event.which] === 'tab') {
        closeFilterDropdown($(this));
        var count = $(this).index() - 1;
        $('.has-selections').html('items selected ' + count + ' of ' + $('.multiselect-dropdown').length);
      }
    });

    $('.js-filter-menu-wrapper').on('click', '.js-multiselect-dropdown-option-label', function () {

    });

    $('.js-filter-menu-wrapper').on('click keydown', '.js-multiselect-dropdown-option', function (event) {
      var $this = $(this);

      if ($(window).width() > window.citiConfig.tabletBreakpoint) {
        var t = setTimeout(function () {
          checkMenuItem($this, event);
        }, 100);
      } else {
        checkMenuItem($this, event);
      }

    });

    function setStuck() {

      var $window = $(window);
      var $filterWaypoint = $('.sticky-filter-waypoint');
      var $categoryTitle = $('.category-title');
      var $filterWrapper = $('.filter-sticky-wrapper');
      var $filterPagination = $('.sticky-pagination-wrapper');

      if ($filterWaypoint.length > 0) {
        if ($window.scrollTop() >= $filterWaypoint.offset().top + $categoryTitle.height() && $('button.ui-multiselect').length > 0) {
          $filterWrapper.addClass('is-stuck');
          $filterWaypoint.css('height', $filterWrapper.height() + $filterPagination.height() + $categoryTitle.height());
        }
        else {
          $filterWrapper.removeClass('is-stuck');
          $filterWaypoint.css('height', 'auto');
        }
      }

      previousScroll = $window.scrollTop();
    }

    function checkMenuItem($this, event) {

      if (event.type === 'click' || keys[event.which] === 'enter' || keys[event.which] === 'space') {

        var currentTaggedValue = $this.closest('.multiselect-dropdown')
          .find('button .mobile-selections-list .mobile-selection').data('option-name');

        $this.find('input').focus();

        removeTag(currentTaggedValue);

        $this.closest('.multiselect-dropdown')
          .find('label')
          .attr('aria-live', 'off');

        $this.closest('.js-multiselect-dropdown-options-wrapper')
          .find('.js-multiselect-dropdown-option')
          .attr('aria-checked', 'false');

        $this.find('label').attr('aria-live', 'assertive');
        $this.attr('aria-checked', 'true');


        if ($this.closest('.multiselect-dropdown').hasClass('filter-menu-item') && $this.find('input').val() !== 'see-all') {
          addTags($this.find('input'));
        }


        //check if sort
        var sortFirstChecked = $this.find('input').parent().parent().find('li').first().attr('aria-checked');

        if ($this.closest('.multiselect-dropdown').hasClass('sort-menu-item') && sortFirstChecked !== 'true') {
          $this.closest('.multiselect-dropdown').find('button > span:first').text($this.find('label span:first').text());
          counterSort++;
        } else if ($this.closest('.multiselect-dropdown').hasClass('sort-menu-item') && sortFirstChecked !== 'false') {
          //default value
          if (counterSort > 0) {
            $this.closest('.multiselect-dropdown').find('button > span:first').text($this.find('label span:first').text());
          }
        }

        //Event for the load ajax used in my-account pages
        $this.find('input').trigger('customEventLoadAjax');
      }
    }

    $('.js-filter-menu-wrapper').on('click', 'input', function (event) {
      event.stopPropagation();
    });

    $('.tag-container').on('click keypress', '.js-remove-filter-tag', function (event) {
      if (event.type === 'click' || keys[event.which] === 'enter') {
        removeTag($(this).closest('.tag-item').data('option-name'));
      }
    });

    $('.filter-wrapper').on('click', '.tag-clear-all, .js-reset-selections', function () {
      if ($("body:not('.my-account')").length > 0) {
        $('.js-remove-filter-tag').each(function (index, el) {
          removeTag($(el).data('option-name'));
        });
        $('.mobile-selections-list').empty();
      } else {
        var listCount = $('.mobile-selections-list').length;
        tagStore = [];
        $('.tag-list').empty();
        $('.mobile-selections-list').each(function (index) {
          var selection = $(this).find('.mobile-selection');
          selection.attr("data-option-name", $(this).attr("data-default-code-value"));
          selection.html($(this).attr("data-default-value"));
          selection.parents(".multiselect-dropdown").find("li").each(function () {
            var listElement = $(this);
            listElement.attr("aria-checked", "false");
            if (listElement.attr("data-value") === selection.attr("data-option-name")) {
              var searchKey = listElement.data("search-key"),
                value = listElement.data("value"),
                parent = listElement.parents(".multiselect-list-container");
              parent.data(searchKey, value);
              listElement.attr("aria-checked", "true");
              if (index === listCount - 1) {
                listElement.find("input").trigger('customEventLoadAjax');
              }
            }
          });
        });
      }
    });

    $('.filter-wrapper').on('click', '.js-apply-selections', function () {
      if (isSortVisible === true) {
        closeMobileSortMenu();
      } else {
        closeMobileFilterMenu($(this));
      }
    });

    //makes sure that if user clicks anywhere on the document the dropdowns close
    $(document).click(function (event) {
      if (!$(event.target).closest('button.multiselect-dropdown-button').length) {
        if ($('.multiselect-dropdown').hasClass('is-open')) {
          // Needed for IE, click would trigger on key down causing accessibility issue.
          if(event.clientX > 0 && event.clientY > 0) {
            closeFilterDropdown();
          }
        }
      }
    });

    $(window).resize(function () {
      if ($(window).width() > window.citiConfig.tabletBreakpoint) {
        //Close all mobile overlays on desktop resize
        closeOnDesktopResize();
      }

      //Remove the desktop stuck in my-account pages
      if ($(".my-account-container").length > 0) {

        //If the multiselect-container max-width <= 959px set the variable at true.
        if (parseInt(jQuery(".multiselect-container").css("max-width"), 10) <= window.citiConfig.tabletBreakpoint) {
          widthUnderTablet = true;
        } else {
          widthUnderTablet = false;
        }

        if( widthUnderTablet == false ) {
          $('.filter-sticky-wrapper').removeClass('is-stuck');
          $('.sticky-filter-waypoint').css('height', 'auto');
        }
      }
    });

    $(window).scroll(function () {
      if ($(".my-account-container").length > 0) {
        if( widthUnderTablet == true ) {
          setStuck();
        }
      } else {
        setStuck();
      }
    });
  }

  init();

  return {
    menuNavigation: menuNavigation
  };

})();
// https://github.com/assemble/handlebars-helpers

// Copyright (c) 2013 Jon Schlinkert, Brian Woodward

// Permission is hereby granted, free of charge, to any person
// obtaining a copy of this software and associated documentation
// files (the "Software"), to deal in the Software without
// restriction, including without limitation the rights to use,
// copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the
// Software is furnished to do so, subject to the following
// conditions:

// The above copyright notice and this permission notice shall be
// included in all copies or substantial portions of the Software.

// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
// OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
// HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
// WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
// OTHER DEALINGS IN THE SOFTWARE.

//module.exports.register = function(Handlebars) {

(function (root, factory) {
  'use strict';
  if (typeof module === 'object' && module.exports) {
    module.exports = function(cfg) {
      return factory(require('handlebars'), cfg);
    };

  } else {
    factory(window.Handlebars, window);
  }
})(this, function(hbars, context) {
  'use strict';
  return hbars.registerHelper({
      currencyNamePlural: function () {
          return context.citiConfig.currencyNamePlural;
      },
      gt: function (value, test, options) {
          if (value > test) {
              return options.fn(this);
          } else {
              return options.inverse(this);
          }
      },
      hyphenate: function (str) {
          if(str && typeof str === "string") {
              return str.split(" ").join("-");
          }
      },
      isnt: function (value, test, options) {
          if (value !== test) {
              return options.fn(this);
          } else {
              return options.inverse(this);
          }
      },
      is: function (value, test, options) {
          if (value === test) {
              return options.fn(this);
          } else {
              return options.inverse(this);
          }
      },
      either: function (value, test, options) {
          var matches = test.split(";"),
              matchFound = false;
          for(var i = 0; i < matches.length; i++) {
              if(matches[i] === value) {
                  matchFound = true;
              }
          }
          if (matchFound) {
              return options.fn(this);
          } else {
              return options.inverse(this);
          }
      },
      length: function (array) {
          return (!array) ? 0 : array.length;
      },
      lowercase: function (str) {
         if(str && typeof str === "string") {
           return str.toLowerCase();
         }
      },
      pageType: function(value, options) {
          if (context.pageType === value) {
              return options.fn(this);
          } else {
              return options.inverse(this);
          }
      },
      tooltipClass: function(options) {
  
          var klass='tooltip-target omniture-tooltip';
  
          if (options.color) {
              if (options.color === 'dark') {
                  klass += ' tooltip-dark';
              }
          }
  
          if (options.size) {
              if (options.size === 'xl') {
                  klass += ' xl';
              }
          }
  
          return klass;
      },
      loc: function(value, def) {

        var toReturn = null;

        try {
          var evalString = 'localizationDictionary.'+context.path.country+'.'+context.path.lang+'.'+context.path.tier+'.'+value.toString();

          if (typeof window !== 'undefined') {
            toReturn = eval("window."+evalString);
          } else {
            toReturn = eval("context."+evalString);
          }
        } catch(e) {}

        //USE THIS IF YOU WANT TO SEE WHAT IS BEING LOCALIZED
        //return toReturn ? ('$:' + toReturn) : (def ? ('%:'+def) : ''); 
        //
        return toReturn ? toReturn : (def ? def : ''); 

      },
      stringify: function(object) {
        return new hbars.SafeString(JSON.stringify(object));
      },
      showNavItem: function(value, options) {
        var checkStates = typeof value.states !== 'undefined',
            show = true;

        if (checkStates) {
          var map = ["anonymous","cookied","loggedin","obo"],
              idx = map.indexOf(context.path.state);

          if (value.states.indexOf(idx) === -1) {
            show = false;
          }
       }

       if (show) {
          return options.fn(this);
       } else {
         return options.inverse(this);
       }
      },
      navName: function(value) {
        return typeof value === 'string' ? value : value.name;
      }
  });
});


citiShare.homepage = function() {
	'use strict';

	var config = {
		$mobileTabsLinks: $('.section-sub-nav.mobile li a')
	};

	// Adds and remove class to allow proper css styling
	function _setFocusHandlerTabsLinks() {
		config.$mobileTabsLinks.on('focus', function() {
			var parent = $(this).parent();
			parent.addClass('link-is-focused');
			if(parent.index() > 0) {
				parent.prev().addClass('next-link-is-focused');
			}
		});
		config.$mobileTabsLinks.on('blur', function() {
			var parent = $(this).parent();
			parent.removeClass('link-is-focused');
			if(parent.index() > 0) {
				parent.prev().removeClass('next-link-is-focused');
			}
		});
	}

	function _init() {
		_setFocusHandlerTabsLinks();
	}

	return {
		init: _init,
		config: config
	};

};

citiShare.mfa = (function() {
    "use strict";

    var mfaConfig = {
            previousModal: '',
            currentModal: '',
            codeExpirationTime: 600000,
            $expiredCodeLink: $('#expired-code-get-new-code').find('a'),
            phoneNumberDefault: 'Choose a phone number:',
            $modal: $('.modal-overlay'),
            $dropdownMenuMenu: $('#dropdown-menu-menu'),
            $dropdownWrapper: $('#dropdown-wrapper'),
            $confirmIdForm: $('#confirm-identity'),
            $confirmIdButton: $('#confirm-identity-button'),
            $enterCodeForm: $('#enter-code'),
            $enterCodeButton: $('#enter-code-button'),
            $closeButton: $('.mfa-close'),
            enterCodeTimer: null,
            confirmIdFormValues: {},
            $msgAgreementCheck: $('#message-agreement'),
            $msgAgreementContainer: $('.modal-confirm-identity-message-agreement-container'),
            $retryCodeButton: $('.mfa-retry-code'),
            $faqModal: $('#modal-mfa-faq'),
            $faqLink: $('.mfa-faq'),
            $faqBack: $('#modal-mfa-faq').find('.modal-mfa-faq-back')
        },
        modalName = {
            confirmID: 'confirm-identity',
            enterCode: 'enter-code',
            thankYou: 'mfa-thankyou',
            codeExpired: 'expired-code',
            faq: 'mfa-faq',
            customerService: 'mfa-customer-service',
            accountLocked: 'mfa-account-locked'
        },
        handlebarTemplates = ['dropdown-component'];

    function transitionModal(toModal, fromModal) {
        if (toModal === modalName.enterCode) {
            mfaConfig.enterCodeTimer = setTimeout(function() {
                console.log(mfaConfig.currentModal);
                transitionModal(modalName.codeExpired, mfaConfig.currentModal);
            }, mfaConfig.codeExpirationTime);
        } else if (mfaConfig.enterCodeTimer && toModal === modalName.thankYou || toModal === modalName.confirmID || toModal === modalName.accountLocked) {
            clearTimeout(mfaConfig.enterCodeTimer);
        }

        citiShare.AccessibleModal({ modal: $('#modal-' + fromModal) }).hide();

        mfaConfig.currentModal = toModal;
        citiShare.AccessibleModal({ modal: $('#modal-' + toModal) }).show();
    }

    function loadHandlebarTemplates() {
        handlebarTemplates.forEach(function(template) {
            citiShare.util.getHandlebarPartials(template);
        });

        loadNumberDropdown();
    }

    /* ------- load data for phone number dropdown ------- */
    function loadNumberDropdown() {
        $.ajax({
            url: citiConfig.endPointHost + citiConfig.mfaEndPointPath + modalName.confirmID + '.json',
            type: 'get',
            dataType: 'json'
        })
        .done(function(data) {
            data.sort[0].defaultValue = mfaConfig.phoneNumberDefault;

            mfaConfig.$dropdownWrapper
                .append(
                    citiShare.util.renderTemplate(window.Handlebars.partials['dropdown-component'], data.sort[0])
                );

            citiShare.selectMenuForElement();
                
            var selectMenuItem = mfaConfig.$dropdownWrapper.find('select');
            
            /* -------- phone number hidden dropdown -------- */
            $('document,body').on('selectmenuchange', selectMenuItem, function(e) {
                var $this = $(e.target),
                    $selectLabel = $('#dropdown-wrapper').find('label[for="dropdown-menu-button"]');

                checkInputValues();

                if ($this.val().toString().trim() !== data.sort[0].defaultValue.toString().trim()) {
                    $selectLabel.addClass('visible');
                    $selectLabel.attr('aria-hidden', 'false');
                } else {
                    $selectLabel.removeClass('visible');
                    $selectLabel.attr('aria-hidden', 'true');
                }
            });
        })
        .fail(function(error) {
            console.log('error: ', error.responseText);
        });
    }

    function checkInputValues() {
        var formInputValues = {
                messageType: mfaConfig.$confirmIdForm.find('input[type="radio"]:checked').val(),
                phoneNumber: mfaConfig.$confirmIdForm.find('#dropdown-menu').val(),
                agreeToMessage: mfaConfig.$msgAgreementCheck.prop('checked')
            },
            isValidData = true;

        for (var input in formInputValues) {
            if (formInputValues.hasOwnProperty(input)) {
                if (formInputValues[input]) {
                    mfaConfig.confirmIdFormValues[input] = formInputValues[input];
                } else {
                    isValidData = false;
                }

                if (input === 'phoneNumber' && formInputValues[input] === mfaConfig.phoneNumberDefault) {
                    isValidData = false;
                }
            }
        }

        if (isValidData) {
            mfaConfig.$confirmIdButton.prop('disabled', false).removeClass('inactive');
        } else {
            mfaConfig.$confirmIdButton.prop('disabled', true).addClass('inactive');
        }
    }

    mfaConfig.$confirmIdForm.find('.modal-confirm-identity-radio-container').on('click', function() {
        checkInputValues();
    });

    mfaConfig.$msgAgreementCheck.on('click', function() {
        checkInputValues();
    });

    /* -------- confirm identity form handler --------- */
    mfaConfig.$confirmIdButton.on('click', function() {
        var formInputValues = {
                messageType: mfaConfig.$confirmIdForm.find('input[type="radio"]:checked').val(),
                phoneNumber: mfaConfig.$confirmIdForm.find('#dropdown-menu').val(),
                agreeToMessage: mfaConfig.$msgAgreementCheck.prop('checked')
            };

        for (var input in formInputValues) {
            if (formInputValues.hasOwnProperty(input)) {
                mfaConfig.confirmIdFormValues[input] = formInputValues[input];
            }
        }


        // check if user agreed to receive a message via text or call
        if (!isNaN(parseInt(formInputValues.phoneNumber.slice(8))) && formInputValues.agreeToMessage) {
            $.ajax({
                // TODO: use post url
                url: citiConfig.endPointHost + citiConfig.mfaEndPointPath + modalName.enterCode + '.json',
                type: 'get'
            })
            .done(function() {
                transitionModal(modalName.enterCode, modalName.confirmID);
            })
            .fail(function() {
                // TODO: what about server errors?
            });
        } else if (isNaN(parseInt(formInputValues.phoneNumber.slice(-4)))) {
            transitionModal(modalName.customerService, modalName.confirmID);
        } else {
            if (!mfaConfig.$msgAgreementContainer.hasClass('error')) {
                mfaConfig.$msgAgreementContainer.addClass('error');
            }
        }
    });

    mfaConfig.$closeButton.on('click', function(e) {
        e.preventDefault();
        $('#modal-overlay').trigger('click');
    });

    /* ------- send user back to confirm-identity modal ------- */
    mfaConfig.$retryCodeButton.on('click', function(e) {
        e.preventDefault();
        console.log($(e.target).data('modal'));
        transitionModal(modalName.confirmID, $(e.target).data('modal'));
    });

    /* -------- send user input for code verification -------- */
    mfaConfig.$enterCodeButton.on('click', function() {
        $.ajax({
            // TODO: use post url
            url: citiConfig.endPointHost + citiConfig.mfaEndPointPath + modalName.enterCode + '.json',
            type: 'get',
            dataType: 'json'
        })
        .done(function(data) {
            // TODO: remove code-checking logic

            // ultimately the following logic will be
            // on the server the 'post' request is
            // made to; for now we keep it for testing
            // purposes
            var code = data.identityCode,
                userCodeInput = mfaConfig.$enterCodeForm.find('.modal-enter-code-input').val().toString(),
                $enterIdWrapper = $('.modal-enter-code-wrapper');

            if (userCodeInput === code) {
                transitionModal(modalName.thankYou, modalName.enterCode);
            } else {
                if (!$enterIdWrapper.hasClass('error')) {
                    $enterIdWrapper.addClass('error');
                }
            }
        })
        .fail(function(error) {
            // TODO: if user has tried too many times, server should return error
            // and then we will transition to account locked modal:
            // transitionModal(modalName.accountLocked, modalName.enterCode);
            console.log('error: ' + error);
        });
    });

    mfaConfig.$modal.on('click', '.error', function() {
        $(this).removeClass('error');
    });

    mfaConfig.$expiredCodeLink.on('click', function(e) {
        e.preventDefault();
        transitionModal(modalName.confirmID, modalName.codeExpired);
    });

    mfaConfig.$faqLink.on('click', function(e) {
        e.preventDefault();
        mfaConfig.previousModal = $(this).data('modal');
        transitionModal(modalName.faq, mfaConfig.previousModal);
    });

    mfaConfig.$faqBack.on('click', function(e) {
        e.preventDefault();
        transitionModal(mfaConfig.previousModal, modalName.faq);
    });

    /* ------ "back" for close button for the FAQ modal ------- */
    mfaConfig.$faqModal.on('click', '.modal-close-button', function() {
        transitionModal(mfaConfig.previousModal, modalName.faq);
    });

    /* ------ pluses and minuses the answer copy for the FAQ modal ------- */
    mfaConfig.$faqModal.on('click', '.modal-mfa-faq-plus-minus', function(e) {
        var $target = $(e.target),
            $container = $target.parent();

        if ($container.hasClass('open')) {
            $container.removeClass('open');
            $(e.target).attr('aria-expanded', 'false');
        } else {
            $container.addClass('open');
            $(e.target).attr('aria-expanded', 'true');
        }
    });

    // TODO: use a more specific hook to load dropdown when necessary
    if(mfaConfig.$faqModal.length) {
        loadHandlebarTemplates();
    }

    return;
})();

/**
 * JSHint:
 * To allow bracket notation,
 * For example, test["placeholder"] vs test.placeholder
 */

/*jshint sub:true*/

citiShare.mockEndPoint = (function() {
    'use strict';

    var mockData = {
        "accountNumber": "12345",
        "multiplier" : 1,
        "currencySeparator" : ",",
        "steps" : 1000,
        "minimumExchange" : 1000,
        "maximumExchange" : 20000,
        "identityCode": "1111"
    };

    return mockData;
})();


// Based on the code from: https://github.com/gdkraus/accessible-modal-dialog

/*

 ============================================
 License for Application
 ============================================

 This license is governed by United States copyright law, and with respect to matters
 of tort, contract, and other causes of action it is governed by North Carolina law,
 without regard to North Carolina choice of law provisions.  The forum for any dispute
 resolution shall be in Wake County, North Carolina.

 Redistribution and use in source and binary forms, with or without modification, are
 permitted provided that the following conditions are met:

 1. Redistributions of source code must retain the above copyright notice, this list
 of conditions and the following disclaimer.

 2. Redistributions in binary form must reproduce the above copyright notice, this
 list of conditions and the following disclaimer in the documentation and/or other
 materials provided with the distribution.

 3. The name of the author may not be used to endorse or promote products derived from
 this software without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE AUTHOR "AS IS" AND ANY EXPRESS OR IMPLIED
 WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
 AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR BE
 LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
 ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

 */


citiShare.AccessibleModal = function(settings) {
    "use strict";

    if(!settings.modal){
        console.warn("modal property required for AccessibleModal");
        return false;
    }

    var _defaultSettings = {
        mainPage: $('#oc-container'),
        overlay: $('#modal-overlay'),
        closeButton: settings.modal.find('.modal-close-button'),
        onOpen: undefined,
        onClose: undefined,
        previousElement: undefined,
        modalType:'complex'
    };

    var _settings = $.extend({}, _defaultSettings, settings);

    // $ formatted selector to search for focusable items
    var _focusableElementsString = "*[data-modal-header], a[href], area[href], .tabbable-element, input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed,  *[contenteditable], *[data-modal-focusable]";

    function init() {
      if(_settings.modalType === 'complex') {
        _settings.overlay.bind('click', function(){
            _hideModal();
        });

        _settings.closeButton.bind('click', function() {
            _hideModal();
        });

        _settings.modal.bind('keydown', function(e) {
            _trapTabKey(_settings.modal, e);
        });

        _settings.modal.bind('keydown', function(e) {
            _trapEscapeKey(_settings.modal, e);
        });

        _showModal();

      } else {
        _settings.overlay.bind('click', function(){
          _hideSimpleModal();
        });
  
        _settings.closeButton.bind('click', function() {
          _hideSimpleModal();
        });
  
        _settings.modal.bind('keydown', function(e) {
          _trapTabKey(_settings.modal, e);
        });
  
        _settings.modal.bind('keydown', function(e) {
          _trapEscapeKey(_settings.modal, e);
        });

        _showSimpleModal();
      }
    }

    function _trapEscapeKey(obj, evt) {
        // if escape pressed
        if (evt.which === 27) {
            _settings.closeButton.click();
            evt.preventDefault();
        }

    }

    function _trapTabKey(obj, evt) {
        // if tab or shift-tab pressed
        if (evt.which === 9) {

            // get list of all children elements in given object
            var o = obj.find('*');

            // get list of focusable items
            var focusableItems;
            focusableItems = o.filter(_focusableElementsString).filter(':visible');

            // get currently focused item
            var focusedItem;
            focusedItem = $(':focus');

            // get the number of focusable items
            var numberOfFocusableItems;
            numberOfFocusableItems = focusableItems.length;

            // get the index of the currently focused item
            var focusedItemIndex;
            focusedItemIndex = focusableItems.index(focusedItem);

            if (evt.shiftKey) {
                //back tab
                // if focused on first item and user presses back-tab, go to the last focusable item
                if (focusedItemIndex === 0) {
                    focusableItems.get(numberOfFocusableItems - 1).focus();
                    evt.preventDefault();
                }

            } else {
                //forward tab
                // if focused on the last item and user presses tab, go to the first focusable item
                if (focusedItemIndex === numberOfFocusableItems - 1) {
                    focusableItems.get(0).focus();
                    evt.preventDefault();
                }
            }
        }

    }

    function _onModalResize() {

        var modalContainer = _settings.modal.find('.has-overflow');
        modalContainer.css('height', 'auto'); // reset previous inline height for proper calculation

        var headerHeight = _settings.modal.find('.modal-header-title').outerHeight();
        var closeHeight = _settings.modal.find('.close-btn-container').outerHeight();
        var modalHeight = _settings.modal.outerHeight();

        var contentHeight = modalHeight - (headerHeight + closeHeight);

        modalContainer.css('height', contentHeight);
    }

    function _showModal(obj) {
      if(!obj) {
        obj = _settings.modal;
      }
      _settings.mainPage.attr('aria-hidden', 'true'); // mark the main page as hidden
      _settings.overlay.addClass('opened'); // insert an overlay to prevent clicking and make a visual change to indicate the main apge is not available
      _settings.modal.css('display', 'block'); // make the modal window visible
      _settings.modal.attr('aria-hidden', 'false'); // mark the modal window as visible

      citiShare.closeSearch();
      var paddingTop = 0;
      var modalDesktopPadding = 180;
      var windowWidth = window.innerWidth || $(window).width();
      var windowTallEnough = (_settings.modal.height() + modalDesktopPadding < window.innerHeight);
      if(windowWidth > 768 && windowTallEnough) {
        paddingTop = modalDesktopPadding;
      }
      var theTop = (window.pageYOffset || document.documentElement.scrollTop)  - ( document.documentElement.clientTop || 0) + paddingTop;
      _settings.modal.css({
        'position':'absolute',
        'top': theTop + 'px'
      });

      // get list of all children elements in given object
      var o = obj.find('*');

      // Safari and VoiceOver shim
      // if VoiceOver in Safari is used, set the initial focus to the modal window itself instead of the first keyboard focusable item. This causes VoiceOver to announce the aria-labelled attributes. Otherwise, Safari and VoiceOver will not announce the labels attached to the modal window.

      // set the focus to the first keyboard focusable item
      o.filter(_focusableElementsString).filter(':visible').first().focus();
      if(_settings.onOpen) {
        _settings.onOpen.call();
      }
      if (_settings.modal.find('.has-overflow').length > 0) {
        _onModalResize();
        $(window).resize(_onModalResize);
      }
    }

    function _showSimpleModal(obj) {
      if(!obj) {
        obj = _settings.modal;
      }
      _settings.mainPage.attr('aria-hidden', 'true'); // mark the main page as hidden
      _settings.modal.attr('aria-hidden', 'false'); // mark the modal window as visible

      // get list of all children elements in given object
      var o = obj.find('*');

      // Safari and VoiceOver shim
      // if VoiceOver in Safari is used, set the initial focus to the modal window itself instead of the first keyboard focusable item. This causes VoiceOver to announce the aria-labelled attributes. Otherwise, Safari and VoiceOver will not announce the labels attached to the modal window.

      // set the focus to the first keyboard focusable item
      o.filter(_focusableElementsString).filter(':visible').first().focus();
      if(_settings.onOpen) {
        _settings.onOpen.call();
      }
    }

    function _hideModal() {
        $(window).unbind('resize', _onModalResize);
        _settings.modal.find('.has-overflow').css('height','auto');
        _settings.overlay.removeClass('opened'); // remove the overlay in order to make the main screen available again
        _settings.modal.css('display', 'none'); // hide the modal window
        _settings.modal.attr('aria-hidden', 'true'); // mark the modal window as hidden

        var windowWidth = window.innerWidth || $(window).width();

        if(windowWidth <= 768){
            _settings.mainPage.removeAttr('aria-hidden');
            if(_settings.previousElement) {
                _settings.previousElement.focus();
            }
        }else{
            setTimeout(function() {
              _settings.mainPage.removeAttr('aria-hidden');
              if(_settings.previousElement) {
                    _settings.previousElement.focus();
                }
            }, 1000);
        }

        if(_settings.onClose) {
            _settings.onClose.call();
        }

    }

    function _hideSimpleModal() {
      _settings.mainPage.attr('aria-hidden', 'false'); // mark the main page as viewable
      _settings.modal.attr('aria-hidden', 'true'); // mark the modal window as hidden

      if(_settings.onClose) {
          _settings.onClose.call();
      }

  }

    init();

    return {
        show:_showModal,
        hide:_hideModal
    };
};

"use strict";

citiShare.ajaxCalls = (function () {

  var ajaxConfig = {
    $ajaxSelects: $('.ajax-select'),
    $ajaxMultiSelects: $('.ajax-multi-select'),
    $ajaxMultiSelectSort: $('.ajax-multi-select-sort'),
    $ajaxGets: $('.ajax-get'),
    $ajaxOverlays: $('.ajax-overlay'),
    $ajaxPosts: $('.ajax-post'),
    $ajaxDeletes: $('.ajax-delete'),
    $ajaxSorts: $('.ajax-sort'),
    $ajaxSearch: $('.ajax-search'),
    $ajaxReinstatePoints: $('.ajax-reinstate'),
    $dateRangeSelects: $('.date-range-ajax-search'),
    $pointsSummaryTabs: $('.points-details .tablist li')
  };

  // Ajax call to get and append HTML
  // destination is where the html will be injected
  // url is the fragment get in ajax
  var _ajaxGetAndAppend = function _ajaxGetAndAppend(e) {
    e.preventDefault();
    var dest = $(this).data("destination");
    var url = $(this).data("url");

    $.get(url, function (data) {
      $('.' + dest).html(data);
      $(document).trigger('get.success');
    });
  };

  //CALL AJAX ORDER HISTORY
  var _orderHistorySort = function _orderHistorySort() {

    var dest = $(this).parents("li").data("destination"),
        url = $(this).parents("li").data("url"),
        searchKey = $(this).parents("li").data("search-key"),
        value = $(this).parents("li").data("value");

    $(".multiselect-list-container[data-" + searchKey + "]").data(searchKey, value);

    var timeframeValue = $(".multiselect-list-container[data-timeframe]").data("timeframe"),
      sortValue = $(".multiselect-list-container[data-sort]").data("sort");

    url += "?timeframe=" + timeframeValue + "&sort=" + sortValue;

    $.get(url, function (data) {
      $('.' + dest).html(data);
      $(document).trigger('get.success');
    });
  };

  // Ajax call to get and append HTML via a multiselect filter
  // destination is where the html will be injected
  // url is the fragment get in ajax
  var _ajaxSearchGetAndAppend = function _ajaxSearchGetAndAppend() {
    var dest = $(this).parents("li").data("destination"),
      url = $(this).parents("li").data("url"),
      searchKey = $(this).parents("li").data("search-key"),
      value = $(this).parents("li").data("value"),
      label = $(this).parents("li").find("label span:first-child").html();

    url += "?" + searchKey + "=" + value;

    $.get(url, function (data) {
      $('.' + dest).html(data);
    });
    $("span[data-message-type='" + searchKey + "']").html(label);
  };

  // Ajax call to get and append HTML
  // destination is where the html will be injected, in this case can be multiple seperated by commas
  // url is the fragment get in ajax, in this case can be multiple seperated by commas
  // searchKey is a customizable key found on the element itself
  // searchGroup is a validation to ensure we pass only parameters from a group of selects
  var _ajaxGetSearchByDateRange = function _ajaxGetSearchByDateRange() {
    var $this = $(this),
      url = $(".date-range-active").data("url"),
      destination = $(".date-range-active .ajax-receiver"),
      searchKey = $this.parents("li").data("search-key"),
      value = $this.parents("li").data("value"),
      parent = $this.parents(".multiselect-list-container"),
      monthNames = $(".date-range").data("months").split(","),
      loadingAction = $(".date-range").data("loading-action"),
      errorClass = "";

    //Hide the error messages
    $(".date-range-error-messages span").hide();
    $(".date-range-error-messages span").attr("aria-hidden", true);
    $(".date-range-error span").remove();

    //Update the value selected for the search
    parent.data(searchKey, value);

    var startDate = new Date(parent.data("startDateYear").toString(), parent.data("startDateMonth")),
      endDate = new Date(parent.data("endDateYear").toString(), parent.data("endDateMonth")),
      age = endDate.getFullYear() - startDate.getFullYear();

    var labelEndMonth = $("button[aria-describedby='label-end-date-month']").find(".multiselect-overlay-title"),
      mobileLabelEndMonth = $("button[aria-describedby='label-end-date-month']").find(".mobile-selection"),
      labelEndYear = $("button[aria-describedby='label-end-date-year']").find(".multiselect-overlay-title"),
      mobileLabelEndYear = $("button[aria-describedby='label-end-date-year']").find(".mobile-selection");

    //First validate if the date range is valid
    if (startDate > endDate) {
      if ($(this).attr("id").indexOf("start-date") >= 0) {
        errorClass = "date-range-error-end-date";
        endDate = new Date(startDate);
        parent.data("startDateYear", startDate.getFullYear());
        parent.data("startDateMonth", startDate.getMonth());


        if (labelEndMonth.html().charAt(0) === "[") {
          labelEndMonth.html("[" + monthNames[endDate.getMonth()] + "]");
          mobileLabelEndMonth.html("[" + monthNames[endDate.getMonth()] + "]");
          labelEndYear.html("[" + endDate.getFullYear() + "]");
          mobileLabelEndYear.html("[" + endDate.getFullYear() + "]");
        } else {
          labelEndMonth.html(monthNames[endDate.getMonth()]);
          mobileLabelEndMonth.html(monthNames[endDate.getMonth()]);
          labelEndYear.html(endDate.getFullYear());
          mobileLabelEndYear.html(endDate.getFullYear());
        }

        $("ul.end-date-month li").attr("aria-checked", "false");
        $("ul.end-date-month li[data-value='" + endDate.getMonth() + "']").attr("aria-checked", "true");
        $("ul.end-date-year li").attr("aria-checked", "false");
        $("ul.end-date-year li[data-value='" + endDate.getFullYear() + "']").attr("aria-checked", "true");

        $(".date-range-error-end-date").append("<span style=\"display: inline\">" + monthNames[startDate.getMonth()] + ", " + startDate.getFullYear() + ".");

      } else {
        errorClass = "date-range-error-start-date";
        startDate = new Date(endDate);
        parent.data("startDateYear", startDate.getFullYear());
        parent.data("startDateMonth", startDate.getMonth());

        var labelStartMonth = $("button[aria-describedby='label-start-date-month']").find(".multiselect-overlay-title"),
          mobileLabelStartMonth = $("button[aria-describedby='label-start-date-month']").find(".mobile-selection"),
          labelStartYear = $("button[aria-describedby='label-start-date-year']").find(".multiselect-overlay-title"),
          mobileLabelStartYear = $("button[aria-describedby='label-start-date-year']").find(".mobile-selection");

        if (labelStartMonth.html().charAt(0) === "[") {
          labelStartMonth.html("[" + monthNames[startDate.getMonth()] + "]");
          mobileLabelStartMonth.html("[" + monthNames[startDate.getMonth()] + "]");
          labelStartYear.html("[" + startDate.getFullYear() + "]");
          mobileLabelStartYear.html("[" + startDate.getFullYear() + "]");
        } else {
          labelStartMonth.html(monthNames[startDate.getMonth()]);
          mobileLabelStartMonth.html(monthNames[startDate.getMonth()]);
          labelStartYear.html(startDate.getFullYear());
          mobileLabelStartYear.html(startDate.getFullYear());
        }

        $("ul.start-date-month li").attr("aria-checked", "false");
        $("ul.start-date-month li[data-value='" + startDate.getMonth() + "']").attr("aria-checked", "true");
        $("ul.start-date-year li").attr("aria-checked", "false");
        $("ul.start-date-year li[data-value='" + startDate.getFullYear() + "']").attr("aria-checked", "true");

        $(".date-range-error-start-date").append("<span style=\"display: inline\">" + monthNames[endDate.getMonth()] + ", " + endDate.getFullYear() + ".");
      }

    } else {
      //If not check if the date range is inside 3 years
      if (endDate.getMonth() < startDate.getMonth() - 1) {
        age--;
      }

      if (startDate.getMonth() - 1 === endDate.getMonth() && endDate.getDay() < startDate.getDay()) {
        age--;
      }

      if (age > 3) {
        errorClass = "date-range-timespan-error";
        endDate = new Date(startDate);
        endDate.setFullYear(endDate.getFullYear() + 3);
        parent.data("endDateYear", endDate.getFullYear());
        parent.data("endDateMonth", endDate.getMonth());

        if (labelEndMonth.html().charAt(0) === "[") {
          labelEndMonth.html("[" + monthNames[endDate.getMonth()] + "]");
          mobileLabelEndMonth.html("[" + monthNames[endDate.getMonth()] + "]");
          labelEndYear.html("[" + endDate.getFullYear() + "]");
          mobileLabelEndYear.html("[" + endDate.getFullYear() + "]");
        } else {
          labelEndMonth.html(monthNames[endDate.getMonth()]);
          mobileLabelEndMonth.html(monthNames[endDate.getMonth()]);
          labelEndYear.html(endDate.getFullYear());
          mobileLabelEndYear.html(endDate.getFullYear());
        }

        $("ul.end-date-month li").attr("aria-checked", "false");
        $("ul.end-date-month li[data-value='" + endDate.getMonth() + "']").attr("aria-checked", "true");
        $("ul.end-date-year li").attr("aria-checked", "false");
        $("ul.end-date-year li[data-value='" + endDate.getFullYear() + "']").attr("aria-checked", "true");
      }
    }

    url += "?";
    $.each(parent.data(), function (key, value) {
      url += key + "=" + value + "&";
    });

    $.get(url.slice(0, -1), function (data) {
      $(destination).html(data);
      $('.date-range-mobile-update .start-month').html(monthNames[startDate.getMonth()]);
      $('.date-range-mobile-update .start-year').html(startDate.getFullYear());
      $('.date-range-mobile-update .end-month').html(monthNames[endDate.getMonth()]);
      $('.date-range-mobile-update .end-year').html(endDate.getFullYear());
      updateAriaLiveMessage(loadingAction + " " + monthNames[startDate.getMonth()] + " " + startDate.getFullYear() + " - " + monthNames[endDate.getMonth()] + " " + endDate.getFullYear());
      citiShare.detailedList.toggleList();
    });

    if (errorClass !== "") {
      $(".date-range-error-messages ." + errorClass).show();
      $(".date-range-error-messages ." + errorClass).attr("aria-hidden", false);
      $(".date-range-error-messages ." + errorClass).focus();
    }
  };

  var _ajaxGetSearchByDateRangeSimplified = function _ajaxGetSearchByDateRangeSimplified() {
    var $this = $(this).find("a");
    if (!$($this.attr("href")).hasClass("date-range-active")) {
      var url = $($this.attr("href")).data("url"),
        destination = $($this.attr("href")).data("destination"),
        parent = $(".date-range .multiselect-list-container"),
        monthNames = $(".date-range").data("months").split(","),
        loadingAction = $(".date-range").data("loading-action"),
        startDate = new Date(parent.data("startDateYear").toString(), parent.data("startDateMonth")),
        endDate = new Date(parent.data("endDateYear").toString(), parent.data("endDateMonth"));

      url += "?";
      $.each(parent.data(), function (key, value) {
        url += key + "=" + value + "&";
      });

      $.get(url.slice(0, -1), function (data) {
        $("." + destination).html(data);
        $('.date-range-mobile-update .start-month').html(monthNames[startDate.getMonth()]);
        $('.date-range-mobile-update .start-year').html(startDate.getFullYear());
        $('.date-range-mobile-update .end-month').html(monthNames[endDate.getMonth()]);
        $('.date-range-mobile-update .end-year').html(endDate.getFullYear());
        updateAriaLiveMessage(loadingAction + " " + monthNames[startDate.getMonth()] + " " + startDate.getFullYear() + " - " + monthNames[endDate.getMonth()] + " " + endDate.getFullYear());
        citiShare.detailedList.toggleList();
      });
      $(".date-range-active").removeClass("date-range-active");
      $($this.attr("href")).addClass("date-range-active");
    }
  };

  /* Post data to provided url via AJAX and handles JSON and HTML response.
   * Accepts a callback as a parameter.
   * Depends on
   *   - form "action" attribute (the url to make the post request to delete)
   *   - data-id attribute (the id of the element to delete)
   *   - data-url attribute (the url to get the updated html fragment)
   *   - data-destination attribute (where to append the new html fragment)
   */
  var _ajaxPost = function _ajaxPost(e, done) {

    var $form = $(this);
    var serializedData = $form.serializeArray();
    var postUrl = $form.attr('action');
    var getHtmlUrl = $form.data('url');
    var htmlFragmentDest = $form.data('destination');
    var isDynamic = $form.data('dynamic') || false;

    $.each(serializedData, function(i, obj) {
      var $relatedInput = $('#' + obj.name);
      obj.value = $relatedInput.data('value') || $relatedInput.val();
    });

    var postAjax = $.post(postUrl, serializedData);

    // Post the data
    postAjax.done(function (jsonRes) {

      // Check if response is an object
      if (typeof jsonRes !== 'object') {
        return done('error', {message: "Response from the server isn't a json object."});
      }

      // Handle success/error depending on json response.
      // TODO: At the same time do the error messages for Legal Notices and Email Settings.
      if (jsonRes.hasOwnProperty('success') && jsonRes.success !== '') {
        var htmlAjax = $.get(getHtmlUrl);

        // Handle success
        htmlAjax.done(function (htmlRes) {
          $(htmlFragmentDest).empty();
          $(htmlFragmentDest).append(htmlRes);

          var $ajaxDelete = $('.ajax-delete');
          if($ajaxDelete.length > 0) {
            $ajaxDelete.off('form:delete', '**');
            $ajaxDelete.on('form:delete', _ajaxDelete);
          }

          return done('success', jsonRes, isDynamic);
        });

        // Handle error
        htmlAjax.fail(function (err) {
          console.log("Problem getting the html after a post request.", err);
          return done('error', err, isDynamic);
        });
      }
      else if (jsonRes.hasOwnProperty('error') && jsonRes.error !== '') {
        return done('error', jsonRes, isDynamic);
      }
    });

    // Test this
    postAjax.fail(function (response) {

      var jsonRes = {};

      if (response.hasOwnProperty('error')) {
        jsonRes.error = response.error;
      }

      if (response.hasOwnProperty('responseJSON')) {
        jsonRes = response.responseJSON;
      }

      return done('error', jsonRes, isDynamic);
    });
  };

  /*
   * Bind click event on all .ajax-delete elements
   * This makes a POST request with the ID of the element to delete.
   * Depends on
   *   - data-action attribute (the url to make the post request to delete)
   *   - data-id attribute (the id of the element to delete)
   *   - data-url attribute (the url to get the updated html fragment)
   *   - data-destination attribute (where to append the new html fragment)
   */
  var _ajaxDelete = function _ajaxDelete(e, done) {

    e.preventDefault();

    var $link = $(e.currentTarget);
    var $form = $link.parents('form');

    var postUrl = $link.data('action');
    var getHtmlUrl = $link.data('url');
    var htmlFragmentDest = $link.data('destination');
    var isDynamic = $form.data('dynamic') || false;

    var data = {
      "id": $link.data('id')
    };

    var postAjax = $.post(postUrl, data);

    // Post the data
    postAjax.done(function (jsonRes) {

      // Check if response is an object
      if (typeof jsonRes !== 'object') {
        console.log('Response from the server is not and object.');
        return;
      }

      var htmlAjax = $.get(getHtmlUrl);

      // Handle success
      htmlAjax.done(function (htmlRes) {
        $(htmlFragmentDest).empty();
        $(htmlFragmentDest).append(htmlRes);

        var $ajaxDelete = $('.ajax-delete');
        $ajaxDelete.off('form:delete', '**');
        $ajaxDelete.on('form:delete', _ajaxDelete);

        if(done) {
          return done('success', jsonRes, isDynamic);
        }
      });

      // Handle error
      htmlAjax.fail(function (err) {
        console.log("Problem getting the html after the post request to delete the item.", err);
        if(done) {
          return done('error', jsonRes, isDynamic);
        }
      });
    });

    postAjax.fail(function (response) {
      console.log("Problem making the post request to delete the item.", response);

      if(done) {

        var jsonRes = {};

        if (response.hasOwnProperty('error')) {
          jsonRes.error = response.error;
        }

        if (response.hasOwnProperty('responseJSON')) {
          jsonRes = response.responseJSON;
        }

        return done('error', jsonRes, isDynamic);
      }
    });

    return false;
  };

// Ajax call to get, sort and append HTML
// destination is where the html will be injected
// url is the fragment get in ajax
// direction is a toggle
// message is a treated message to be passed to an element with aria-live
  var _ajaxGetSortAndAppend = function _ajaxGetSortAndAppend() {
    var $this = $(this);
    $(".multiselect-sort-message").hide();
    $(".multiselect-sort-message").attr("aria-hidden", "true");
    //Weird trick to reuse the function for multiselects
    if ($this.is("input")) {
      $this = $this.parents("li");
    }
    var sortType = $this.data("sort-type") || "sort-less",
      pageNumber = $this.data("page-number") || "1",
      sortableOptions = $("body"),
      currentDirection = "ascending",
      ajaxUrl = $this.data("url");

    if ((sortType !== "sort-less")) {
      //A sort option was chosen
      ajaxUrl += "?sortby=" + sortType;
      if ($this.data("sort-direction")) {
        //First lets see if a direction was given
        currentDirection = $this.data("sort-direction");
        sortableOptions.data("last-direction-sorted", currentDirection);
        ajaxUrl += "&direction=" + currentDirection + "&page=" + pageNumber;
      } else if ($this.data("page-number") === undefined) {
        //Else, lets check if the link had a page number
        //check first if the sort must be reversed
        if (sortType === sortableOptions.data("last-sort-done")) {
          //If the same sort was requested twice, reverse it
          //then remove it since all others will be ascending
          currentDirection = "descending";
          sortableOptions.removeData("last-sort-done");
        } else {
          //else sort asending and remember the type
          sortableOptions.data("last-sort-done", sortType);
        }
        //Remember the direction for the pagination
        sortableOptions.data("last-direction-sorted", currentDirection);
        ajaxUrl += "&direction=" + currentDirection + "&page=" + pageNumber;
      } else {
        //If a page number was requested and a sort option was chosen previously
        //check first if a direction was saved
        currentDirection = sortableOptions.data("last-direction-sorted");
        ajaxUrl += "&direction=" + currentDirection + "&page=" + pageNumber;
      }
    } else {
      //No sort were chosen, hence we just ask for a page number
      ajaxUrl += "?page=" + pageNumber;
    }

    $.get(ajaxUrl, function (data) {
      $('.' + $this.data("destination")).html(data);
    }).done(function () {
        var link = sortableOptions.find("table [data-sort-type='" + sortType + "']"),
          actions = $(".accessibility-actions"),
          message = "";
        link.addClass("sorted-" + currentDirection);

        if (sortType !== "sort-less") {
          $(".my-account-pagination a").data("sort-type", sortType);
          $(".multiselect-sort-message[data-sort-type='" + sortType + "']").show();
          $(".multiselect-sort-message[data-sort-type='" + sortType + "']").attr("aria-hidden", "false");
          message += actions.data("message-sort") + " " + sortType + ", ";
          if (currentDirection === "ascending") {
            message += actions.data("message-ascending") + ", ";
          } else {
            message += actions.data("message-descending") + ", ";
          }
        }
        message += actions.data("message-page") + " " + pageNumber;
        updateAriaLiveMessage(message);
        $('#' + $this.get(0).id).focus();
      }
    );
  };

  var _ajaxReinstatePoints = function _ajaxReinstatePoints(event) {
    event.preventDefault();
    var $this = $(this),
      serializedData = $this.serializeArray(),
      formUrl = $this.data('form-url'),
      formDestination = $this.data('form-destination'),
      pointsUrl = $this.data('points-total-url'),
      pointsDestination = $this.data('points-total-destination'),
      confirmation = $(".reinstate-points-confirmation");

    confirmation.hide();
    confirmation.attr("aria-hidden", "true");

    var postAjax = $.post($this.attr("action"), serializedData);
    // Post the data
    postAjax.done(function () {
      $.get(formUrl, function (data) {
        $('.' + formDestination).html(data);
      }).done(function () {
        $.get(pointsUrl, function (data) {
          $('.' + pointsDestination).html(data);
        });
      });
      confirmation.show();
      confirmation.attr("aria-hidden", "false");
      confirmation.focus();
      return false;
    });
  };

// Bind the _ajaxGetAndAppend on the selectmenuchange event of jquery ui selects.
  if (ajaxConfig.$ajaxSelects.length > 0) {
    ajaxConfig.$ajaxSelects.on('selectmenuchange', _ajaxGetAndAppend);
  }

  // Bind the _ajaxGetAndAppend on the click events of select li elements
  // Custom event from filters.js
  if (ajaxConfig.$ajaxMultiSelects.length > 0) {
    ajaxConfig.$ajaxMultiSelects.find(".js-multiselect-dropdown-option-input").on('customEventLoadAjax', _orderHistorySort);
  }

  // Bind the _ajaxGetSearchByDateRange on the selectmenuchange event of jquery ui selects.
  // Custom event from filters.js
  if (ajaxConfig.$dateRangeSelects.length > 0) {
    ajaxConfig.$dateRangeSelects.find(".js-multiselect-dropdown-option-input").on('customEventLoadAjax', _ajaxGetSearchByDateRange);
  }

  // Bind the _ajaxGetAndAppend on the click event
  if (ajaxConfig.$ajaxGets.length > 0) {
    //Note that .selector is deprecated in jQuery, it's the only way that I know to do this and still support our current syntax.
    $(document).on('click', ajaxConfig.$ajaxGets.selector, _ajaxGetAndAppend);
  }

  // Bind the _ajaxGetAndAppend on the inputs of the multiselects.
  if (ajaxConfig.$ajaxSearch.length > 0) {
    ajaxConfig.$ajaxSearch.find(".js-multiselect-dropdown-option-input").on('customEventLoadAjax', _ajaxSearchGetAndAppend);
  }

  // Special treatment must be made to announce the action made by the sort for screen-readers
  //Note that .selector is deprecated in jQuery, it's the only way that I know to do this and still support our current syntax.
  $(document).on('click', ajaxConfig.$ajaxSorts.selector, _ajaxGetSortAndAppend);

// Special treatment must be made to announce the action made by the sort for screen-readers
  if (ajaxConfig.$ajaxMultiSelectSort.length > 0) {
    ajaxConfig.$ajaxMultiSelectSort.find(".js-multiselect-dropdown-option-input").on('customEventLoadAjax', _ajaxGetSortAndAppend);
  }

// Special treatment must be made to announce the action made by the sort for screen-readers
  if (ajaxConfig.$ajaxReinstatePoints.length > 0) {
    $(document).on('form:reinstate', ajaxConfig.$ajaxReinstatePoints.selector, _ajaxReinstatePoints);
  }

  // Launch a search by date rage for a content of block
  if (ajaxConfig.$pointsSummaryTabs.length > 0) {
    ajaxConfig.$pointsSummaryTabs.on('focus', _ajaxGetSearchByDateRangeSimplified);
    ajaxConfig.$pointsSummaryTabs.on('click', _ajaxGetSearchByDateRangeSimplified);
  }

  //Display error message from an ajax call 404 CTA
  function displayCtaErrorMessage(previousElement) {
    var theElementToShow = $(previousElement).closest(".order-item-bottom").find(".malfunction-error-cta-message");

    //Accessibility that prevent the users.
    theElementToShow.attr("role", "alert");
    theElementToShow.attr("aria-live", "assertive");

    theElementToShow.show();
  }

// Bind the click event to all the .ajax-post elements.
// On click get the url of the modal fragment via ajax
// then show it in the page.
  if (ajaxConfig.$ajaxOverlays.length > 0) {

    ajaxConfig.$ajaxOverlays.on("click.ajaxCall", function () {

      var url = $(this).data("url");
      var previousElement = null;

      if( $(this).hasClass("cancel-order-btn") ) {
        previousElement = $(this).closest(".order-item-bottom .cta-container").find("a:first");
      } else {
        previousElement = $(this).get(0);
      }

      $.ajax({
        type: 'GET',
        url: url,
        success: function(data){
          // Append the dark background behind the overlay
          $('#modal-overlay').remove();
          $('body').append('<div id="modal-overlay"></div>');

          // Remove the existant overlays
          $('.ajax-modal-container').remove();

          $("body").append('<div class="ajax-modal-container">' + data + '</div>');
          var $modal = $('.ajax-modal-container .modal');
          var modalInstance = citiShare.AccessibleModal({modal: $modal, previousElement: previousElement});
          modalInstance.show();
          //Call the function that bind buttons (Close button)
          bindOverlay();
        },
        statusCode: {
          202: function() {
            displayCtaErrorMessage(previousElement);
          },

          404: function() {
            displayCtaErrorMessage(previousElement);
          },

          500: function() {
            displayCtaErrorMessage(previousElement);
          }
        }
      });
    });
  }

  /*
   * Bind the form:post event to all the .ajax-overlay elements.
   */
  if (ajaxConfig.$ajaxPosts.length > 0) {
    ajaxConfig.$ajaxPosts.on('form:post', _ajaxPost);
  }

// Bind the proper event for ajax-delete elements.
  if (ajaxConfig.$ajaxDeletes.length > 0) {
    ajaxConfig.$ajaxDeletes.on('form:delete', _ajaxDelete);
  }

//AjaxReplace used for replace the blocks in the modal already existing
  var _ajaxGetAndReplace = function _ajaxGetAndReplace() {

    var dest = $(this).data("destination");
    var url = $(this).data("url");

    $.get(url, function (data) {
      $('.' + dest).html(data);
      var modal = $('.ajax-modal-container .modal');
      citiShare.AccessibleModal({modal: modal});
      bindOverlay();
    });

  };

//Bind the close button on the overlays
//Trigger a click on the modal-overlay that close the modal
  function bindOverlay() {

    var accountOverlay = {
      $closeSelector: $('.triggerCloseModalBtn'),
      $closeTargetSelector: $('#modal-overlay'),
      $confirmedSelector: $('.triggerConfirmed')
    };

    accountOverlay.$closeSelector.on("click", function () {
      if( $(this).hasClass("reloadList") ) {
        $(".multiselect-container:first li:first-child").find('input').trigger('customEventLoadAjax');
      }
      accountOverlay.$closeTargetSelector.click();
    });
  }

// Creates a span which will be read by screen readers and add a message to it.
// If it already exists, simply replace the html with the message.
  function updateAriaLiveMessage(message) {
    var $messageContainer = $('.message-update');
    if ($messageContainer.length === 0) {
      var node = document.createElement("span"),
        textnode = document.createTextNode(message);
      node.appendChild(textnode);
      node.setAttribute("class", "message-update visuallyhidden");
      node.setAttribute("aria-live", "assertive");
      document.body.appendChild(node);
    } else {
      $messageContainer.html(message);
    }
  }

  $(document.body).on('click', '.ajax-replace', _ajaxGetAndReplace);

  return {
    ajaxDelete: _ajaxDelete
  };

})
();

/**
 * Number stepper
 * @type {{numericStepper}}
 */

citiShare.numericStepper = (function() {
    "use strict";

    /**
     * Init stepper
     */
    function numericStepperSetup(){

        var $parentEl =  $(".stepper-buttons");
        var $inputStepperEl = $(".numeric-stepper > input");
        var maxQuantity = parseInt($inputStepperEl.attr("max"));
        var minQuantity = parseInt($inputStepperEl.attr("min"));
        var $decreaseButton =  $("[data-stepper=decrease]");
        var $increaseButton =  $("[data-stepper=increase]");

        // Allow numbers only (no decimal)
        $inputStepperEl.numeric({
            decimal: false,
            decimalPlaces : -1
        });

        $parentEl.on("click", function(e){

            e.preventDefault();
            var getCurrentValue = parseInt($inputStepperEl.val());
            var valueAdjustment = parseInt($(this).attr("data-quantity-adjustment"));
            var setValue = getCurrentValue + valueAdjustment;

            function setIncreaseButton () {
                if ( setValue <= maxQuantity ) {
                    $inputStepperEl.val(setValue);
                    return $increaseButton.prop("disabled", false);
                }
                else {
                    return $increaseButton.prop("disabled", true);
                }
            }

            function setDecreaseButton () {
                if ( setValue < minQuantity ){
                    return $decreaseButton.prop("disabled", true);
                }
                else {
                    $inputStepperEl.val(setValue);
                    return $decreaseButton.prop("disabled", false);
                }
            }

            if ( getCurrentValue > minQuantity ){
                return setIncreaseButton();
            }
            else {
                return setDecreaseButton();
            }

        });
    }

    return {
        numericStepperSetup: numericStepperSetup
    };

})();


/*
 *
 * This function is used to initialize and handle everything related
 * to the order history page
 *
 * Depends on
 *  - Having a DIV with a class of `order-history`
 *  - jQuery
 *
 */
citiShare.orderHistory = (function () {

  "use strict";

  /*
   * Init the accessible list
   */
  var initLists = function initLists() {
    //Order details -> Order summary list
    citiShare.accessibleMultiColumnList('.order-details-summary-list', 3).init();

    $('.order-item-information-list-container.three-column').each(function () {
      //Order history -> Order items list for three column
      citiShare.accessibleMultiColumnList(this, 3).init();
    });

    $('.order-item-information-list-container.two-column').each(function () {
      //Order history -> Order items list for two column
      citiShare.accessibleMultiColumnList(this, 2).init();
    });


    $('.order-item-international-list-container').each(function () {
      //Order history -> Order items list for two column
      citiShare.accessibleMultiColumnList(this, 3).init();
    });

  };

  /*
   * Init the citiShare.order-history code.
   * Basically bind all necessary events.
   */
  var init = function init() {
    initLists();
  };

  if ($('.order-history').length > 0 || $('.order-details').length > 0) {
    init();
  }

})();

/**
 * simplePagination.js Plugin Documentation :
 * http://flaviusmatis.github.io/simplePagination.js/
 */

"use strict";

citiShare.pagination = (function() {

    /**
     * Init the pagination plugin on PLP
     *
     * @param {jQuery} $selector Targeted list items
     * @param {jQuery} paginationClass Pagination row container
     * @param {Number} itemsPerPage Number of items per page to display
     */
    function initPagination($selector, paginationClass, itemsPerPage) {

        var totalItems = $selector.length;
        var maxItems = 48;
        $selector.slice(itemsPerPage).hide();
        
        if(typeof $(paginationClass).pagination === 'function') {
          $(paginationClass).pagination({
              items: totalItems,
              itemsOnPage: itemsPerPage,
              onInit: function() {
  
                  // One page
                  if ( itemsPerPage >= totalItems ) {
                      itemsPerPage = totalItems;
                      $(".pagination").addClass("is-hidden");
                      $('.pagination-next').hide();
                      $('.pagination-prev').hide();
                      $('.pagination-summary.top').addClass('top-padding');
                  }
  
                  $('.pagination-next > a').attr("href","#" + (2));
                  $('.pagination-prev > a').hide();
  
                  $('.next').parent().addClass('border');
                  $('.prev').parent().addClass('border');
  
                  $(".current-page").html("1");
                  $(".show-to-page").html(itemsPerPage);
  
                  if(totalItems > maxItems ){
                      $(".total-pages").html(totalItems + "<span class='pipe'> | </span>");
                  }else{
                      $(".total-pages").html(totalItems);
                  }
  
                  setupAccessibility();
              },
              onPageClick: function(pageNumber) {
  
                  var showFrom = itemsPerPage * (pageNumber - 1);
                  var showTo = showFrom + itemsPerPage;
                  var windowWidth = window.innerWidth || $(window).width();
  
                  if(windowWidth <= 960){
                      $('.prev').parent().hide();
                      $('.next').parent().hide();
                  }
                  // Set max
                  if ( showTo >= totalItems ) {
                      showTo = totalItems;
                  }
  
                  // Set min
                  if ( showFrom <= 1 ){
                      showFrom = 0;
                  }
  
                  //close modals
                  $('.modal-close-button').trigger('click');
  
                  var total = $(paginationClass).pagination('getPagesCount');
  
                  if(pageNumber <= 1){
                      $('.pagination-prev > a').hide();
                      $('.pagination-next > a').show();
                  }else if(pageNumber > 1 && pageNumber < total) {
                      $('.pagination-prev > a').show();
                      $('.pagination-next > a').show();
                  }else{
                      $('.pagination-next > a').hide();
                      $('.pagination-prev > a').show();
                  }
  
                  $(".current-page").html(showFrom === 0 ? 1 : showFrom);
                  $(".show-to-page").html(showTo);
                  $(".total-pages").html(totalItems);
  
  
  
                  var next = $('.next').parent().addClass('border');
                  var prev = $('.prev').parent().first().addClass('border');
  
                  prev.insertBefore(next);
  
                  $('.prev').each(function(){
                      if(!$(this).parent().hasClass('border')){
                          $(this).parent().remove();
                      }
                  });
  
                  setupAccessibility();
  
                  if(itemsPerPage >= maxItems ){
                      $(".total-pages").html(totalItems + "<span class='pipe'> | </span>");
                  }else{
                      $(".total-pages").html(totalItems);
                  }
  
                  $selector.hide().slice(showFrom, showTo).show();
  
  
                  $('html, body').animate({ scrollTop: 0 }, 'slow');
              }
          });
        }


    }

    function setupAccessibility(){
        $('.page-link').each(function(){
            if(!$(this).parent().hasClass('border')){
                $(this).prepend('<span class="visuallyhidden">Page </span>');
            }
            if (!$(this).hasClass('border')) {
                $(this).addClass('omniture-pagination-page');
            }
        });
        var prevHtml = $('.prev').first().html();
        var nextHtml = $('.next').first().html();
        $('.current').prepend('<span class="visuallyhidden">Page</span>');

        $('.prev').html(prevHtml + '<span class="visuallyhidden">Page</span>').addClass('omniture-pagination-previous');
        $('.next').html(nextHtml + '<span class="visuallyhidden">Page</span>').addClass('omniture-pagination-next');
    }


    /**
     * Desktop view pagination button display logic
     */
    function setDesktopPaginationButtons () {

        var parentContainer = $(".pagination > ul > li");

        parentContainer.css({
            "width": "auto"
        });
    }

    /**
     * Mobile view pagination button display logic
     */
    function setMobilePaginationButtons () {

        $('.dyn-next').on('click', function(e){
            e.preventDefault();
            $('li.border > a.next').trigger('click');
        });

        $('.dyn-prev').on('click', function(e){
            e.preventDefault();
            $('li.border > a.prev').trigger('click');
        });

        if($('.pagination-summary').prev().hasClass('tag-container')){
            $('.tag-container').next().addClass('top');
        }

        if($('.pagination-summary').prev().hasClass('product-list')){
            $('.product-list').next().addClass('bottom');
        }

        $(window).resize(function(){
            var windowWidth = window.innerWidth || $(window).width();

            //  To match include_media 959px tablet breakpoint
            if(windowWidth < 959){
                $('.pagination-summary.top').siblings('.pagination-prev').addClass('top');
                $('.pagination-summary.top').siblings('.pagination-next').addClass('top');
                $('.prev').parent().hide();
                $('.next').parent().hide();
            }else{
                $('.prev').parent().show();
                $('.next').parent().show();
            }
        }).trigger('resize');
    }

    function init(){
        setMobilePaginationButtons();
    }

    return {
        init: init,
        initPagination: initPagination,
        setDesktopPaginationButtons: setDesktopPaginationButtons,
        setMobilePaginationButtons: setMobilePaginationButtons
    };

})();

/*jshint unused:false, sub:true*/

'use strict';

function _toArray(arrayLike) {
  return Array.prototype.slice.call(arrayLike);
}

var PointsTransferFilters = function(element) {
  /**
   * Base jQuery element
   *
   * @type {jQuery}
   * @private
   */
  this._$element = $(element);

  /**
   * Main application wrapper.
   *
   * @type {jQuery}
   * @private
   */
  this._$mainWrapper = null;

  /**
   * window element.
   *
   * @type {jQuery}
   * @private
   */
  this._html = $('html');

  /**
   * window element.
   *
   * @type {jQuery}
   * @private
   */
  this._$window = $(window);

  /**
   * Reward elements which will be filtered.
   *
   * @type {jQuery}
   * @private
   */
  this._$rewardElements = null;

  /**
   * Reward elements silod into their specific categories.
   *
   * @type {Object}
   * @private
   */
  this._rewards = {};

  /**
   * Window width or inner width
   *
   * @type {Number}
   * @private
   */
  this._windowWidth = null;

  /**
   * Modal open CTA for mobile.
   *
   * @type {jQuery}
   * @private
   */
  this._$modalLaunchCTA = null;

  /**
   * The inner content of the modal wrap.
   *
   * @type {jQuery}
   * @private
   */
  this._filterInnerContent = null;

  /**
   * The mobile title for the header. Gets removed
   * from the DOM and cached into this instance
   * variable.
   *
   * @type {jQuery}
   * @private
   */
  this._mobileTitle = null;

  /**
   * Has the modal been destroyed by the switch in the viewport
   * orientation.
   *
   * @type {Boolean}
   * @private
   */
  this._modalDestroyedByViewportSwitch = false;

  /**
   * Boolean to check if modal is open or not.
   *
   * @type {Boolean}
   * @private
   */
  this._modalOpen = false;

  /**
   * Filter Dropdowns
   *
   * @type {jQuery}
   * @private
   */
  this._$filters = null;

  /**
   * Boolean to determine if on mobile.
   *
   * @type {Boolean}
   * @private
   */
  this._isMobile = false;

  /**
   * Boolean to determine if on desktop
   *
   * @type {Boolean}
   * @private
   */
  this._isDesktop = false;

  /**
   * Array of the current active filters.
   *
   * @type {Array}
   * @private
   */
  this._activeFilters = [];


  this._init();
};



/**
 * Initializes the filterTabs component
 */
PointsTransferFilters.prototype._init = function() {
  this._$mainWrapper = this._$element.closest('.' + PointsTransferFilters.ClassName.MAIN);

  this._$filters = this._$element.find('.' + PointsTransferFilters.ClassName.FILTER);

  this._mobileTitle = this._$element.find('.' + PointsTransferFilters.ClassName.MOBILE_TITLE);

  this._$modalLaunchCTA = this._$mainWrapper.find('.' + PointsTransferFilters.ClassName.MODAL_LAUNCH);

  this._$rewardElements = this._$mainWrapper.find('.' + PointsTransferFilters.ClassName.REWARDS);

  this._filterInnerContent = this._$element.html();

  this._rewards = this._getRewards();

  this._initializeBindings();
};


/**
 * _initializeFilters
 * Will initialize the filters.
 */
PointsTransferFilters.prototype._initializeFilters = function() {

};

/**
 * _initializeBindings
 * Will initialize the bindings and event listeners for the form inputs
 * on the page.
 *
 * @private
 */
PointsTransferFilters.prototype._initializeBindings = function() {
  // handle resize events
  this._$window.on('resize orientationchange', $.debounce(250, $.proxy(this._handleResize, this)));

  this._$modalLaunchCTA.on('click', this._handleModalLaunch.bind(this));

  this._initializeFilterBindings();
};

/**
 * _initializeFilterBindings
 * Will inistalize event delegation for the filters.
 */
PointsTransferFilters.prototype._initializeFilterBindings = function() {
  this._$filters = this._$element.find(
    '.' + PointsTransferFilters.ClassName.FILTER);

  // handle keypresses on checkboxes.
  this._$filters.on(
    'keypress',
    this._handleCheckboxKeypress.bind(this));

  // handle click handles on checkboxes.
  this._$filters.on(
    'click',
    this._handleCheckboxToggle.bind(this));
};

/**
 * _removeFilterBindings
 * Remove event listeners on the filers.
 *
 * @private
 */
PointsTransferFilters.prototype._removeFilterBindings = function() {
  this._$filters.off('keypress');
  this._$filters.off('click');
};

/**
 * _handleResize
 * Will handle window resize and or orientation changes
 *
 * @param {Object} evt
 * @private
 */
PointsTransferFilters.prototype._handleResize = function(evt) {
  this._windowWidth = window.innerWidth || this._windowWidth;

  // Handle if mobile
  if (this._windowWidth <= window.citiConfig.tabletBreakpoint) {
    if (!this._isMobile) {
      this._isMobile = true;
      this._isDesktop = false;
      this._toggleAllFilters(false);
      this._initialzieMobileLayout();
    }
  }

  // Handle if desktop
  if (this._windowWidth > window.citiConfig.tabletBreakpoint) {
    if (!this._isDesktop) {
      this._isDesktop = true;
      this._isMobile = false;
      this._closeModal(true);
      this._destroyMobileLayout();
    }
  }
};

/**
 * _handleCheckboxKeypress
 * Will handle events for when there is a keypress.
 *
 * @param {object} evt
 * @private
 */
PointsTransferFilters.prototype._handleCheckboxKeypress = function(evt) {
  if (evt.charCode === PointsTransferFilters.Keys.SPACE ||
      evt.charCode === PointsTransferFilters.Keys.ENTER) {
    evt.preventDefault();
    this._handleCheckboxToggle(evt);
    return;
  }

  if (evt.which === PointsTransferFilters.Keys.UP ||
      evt.which === PointsTransferFilters.Keys.DOWN) {
    this._handleCheckboxKeyNavigate(evt.which);
  }
};

/**
 * _handleModalLaunch
 * Will handle when the modal CTA is clicked.
 * NOTE: this doesn't instantiate the modal. That is done
 * via a CITI plugin.
 *
 * @param {Object} evt
 * @private
 */
PointsTransferFilters.prototype._handleModalLaunch = function(evt) {
  $('.oc-container').removeAttr('aria-hidden'); //this removes from outer main parent aria-hidden
  
  //loop through all sections in dom and apply aria-hidden except for filter container
  $('section, header, footer, #header-desktop').attr('aria-hidden','true');
  $('.points-transfer-landing-body-filters-container').attr('aria-hidden','false');
  
  var $modal = this._$element.find('#' + PointsTransferFilters.ClassName.MODAL_ID);
  var isHidden = $modal.attr('aria-hidden');

  if (this._modalDestroyedByViewportSwitch) {
    new citiShare.AccessibleModal({
      modal: $modal,
      previousElement: evt.target
    });
  }

  // TODO:: CITI-2205 WIP, clean it up
  $('.points-transfer-landing-body-filters-mobile-wrap').attr('aria-hidden', 'true');

  if (isHidden === 'false') {
    this._modalOpen = true;
  } else {
    this._modalOpen = false;
  }
  
  setTimeout(function() {
    var closeButton = $modal.find('.modal-close-button');
    closeButton.attr('tabindex', '-1');
    closeButton.focus();
  }, 1000);

  $(window).scrollTop(0);
  this._$element.find('#modal-points-transfer').attr('style', 'display:block');
  this._html.addClass(PointsTransferFilters.ClassName.NO_SCROLL);
};

/**
 * _unSelectCheckbox
 * Will toggle a chekcbox based on the value provided.
 *
 * @param {string } val
 * @private
 */
PointsTransferFilters.prototype._unSelectCheckbox = function(val) {
  var filter = this._$filters.filter("[for='" + val + "']");
  var checkbox = filter.find(
    '.' + PointsTransferFilters.ClassName.CHECKBOX);

  if (filter.attr('aria-checked')) {
    filter.attr('aria-checked', 'false');
    checkbox.removeClass('is-checked');
  }
};

/**
 * _handleCheckboxToggle
 * Will handle the checkbox toggling and set aria properties.
 *
 * @param {object} evt
 * @private
 */
PointsTransferFilters.prototype._handleCheckboxToggle = function(evt) {
  var el = $(evt.target);
  var filter = el.closest(
    '.' + PointsTransferFilters.ClassName.FILTER);
  var checkbox = filter.find(
    '.' + PointsTransferFilters.ClassName.CHECKBOX);
  var value = checkbox.data('value').toLowerCase();

  if (value === 'all') {
    // determine if on or of
    var val = (filter.attr('aria-checked') === 'false') ? true : false;

    filter.attr('aria-checked', val);

    if (val) {
        this._toggleAllFilters(false);
        checkbox.addClass('is-checked');
    } else {
        checkbox.removeClass('is-checked');
    }

    return this._handleCheckboxTrigger(val, filter);
  }

  if (filter.attr('aria-checked') === 'false') {
    filter.attr('aria-checked', 'true');
    checkbox.addClass('is-checked');
    this._handleCheckboxTrigger('true', filter);
  } else {
    filter.attr('aria-checked', 'false');
    checkbox.removeClass('is-checked');
    this._handleCheckboxTrigger('false', filter);
  }
};

/**
 * _handleClearFilters
 * Will handle when the user wants to clear the checkboxes.
 * By looping through each checkbox and triggering a click event
 * if the checkbox is enabled.
 *
 * @param {Object} evt
 * @private
 */
PointsTransferFilters.prototype._handleClearFilters = function(evt) {
  var filter = this._$element.find(
    '.' + PointsTransferFilters.ClassName.FILTER);
  var i = 0;

  if (evt.type === 'click' ||
      evt.keyCode === PointsTransferFilters.Keys.SPACE ||
      evt.keyCode === PointsTransferFilters.Keys.ENTER) {

    this._toggleAllFilters(false);
  }
};

/**
 * _toggleAllFilters
 * Will clear the filters.
 *
 * @param {Boolean} apply
 * @private
 */
PointsTransferFilters.prototype._toggleAllFilters = function(apply) {
  var filter = this._$element.find(
    '.' + PointsTransferFilters.ClassName.FILTER);
  var i = 1;
  var applyFilters = (apply) ? 'true' : 'false';

  for(; i < filter.length; i++) {
    var currFilter = filter.eq(i);
    var checkbox = filter.find(
      '.' + PointsTransferFilters.ClassName.CHECKBOX);
    checkbox.toggleClass('is-checked', apply);

    currFilter.attr('aria-checked', applyFilters);
    currFilter.trigger('change');
    this._handleCheckboxTrigger(applyFilters, currFilter);
  }
};

/**
 * _handleCheckboxTrigger
 * Will handle events for when the checkbox value changes and needs
 * to trigger an event.
 *
 * @param {string} val
 * @param {jQuery} el
 *
 * @private
 */
PointsTransferFilters.prototype._handleCheckboxTrigger = function(val, el) {
  var data = {
    'value': val,
    'reward': el.attr('for').toLowerCase(),
    'element': el
  };

  this._$mainWrapper.trigger('Citi:FiltersTriggered', data);
  this._applyFilters(data);
};

/**
 * _initializeMobileListeners
 *
 * @param {jQuery} el
 * @private
 */
PointsTransferFilters.prototype._initializeMobileListeners = function(el) {
  var $closeBtn = el.find(
    '.' + PointsTransferFilters.ClassName.CLOSE_BTN);
  var $clearBtn = el.find(
    '.' + PointsTransferFilters.ClassName.MODAL_BUTTON_CLEAR);
  var $acceptBtn = el.find(
    '.' + PointsTransferFilters.ClassName.MODAL_BUTTON_ACCEPT);

  $closeBtn.on(
    'click',
    this._closeModal.bind(this, false));

  $clearBtn.on(
    'keypress',
    this._handleClearFilters.bind(this));

  $acceptBtn.on(
    'keypress',
    this._handleAcceptFilters.bind(this));

  $clearBtn.on(
    'click',
    this._handleClearFilters.bind(this));

  $acceptBtn.on(
    'click',
    this._handleAcceptFilters.bind(this));
};

/**
 * _initialzieMobileLayout
 * Will build the mobile layout and initialize the mobile bindings.
 *
 * @private
 */
PointsTransferFilters.prototype._initialzieMobileLayout = function() {
  this._$modalElement = this._buildModalElements();

  this._removeFilterBindings();

  // empty the current DOM from the modal
  this._$element.empty();
  this._$element.addClass('show');

  this._$element.append(this._$modalElement);

  this._initializeMobileListeners(this._$element);
  this._initializeFilterBindings();
};

/**
 * _buildModalElements
 * Will build DOM and populate the DOM based for the modal.
 *
 * @private
 * @return {jQuery|Element}
 */
PointsTransferFilters.prototype._buildModalElements = function() {
  var $modalWrap = $('<div>');
  var $titleElementOffscreen = $('<div>');
  var $titleElement = $('<h2>');
  var modalContent = this._filterInnerContent;
  var $modalContent = $(modalContent).clone();
  var content = this._$element.data('content');
  var $closeButton = $('<button>');
  var $closeicon = $('<i>');
  var $filterList = $modalContent.find('.' + PointsTransferFilters.ClassName.FILTER_LIST);

  // build modal wrap attributes
  $modalWrap.attr('aria-hidden', 'false');
  $modalWrap.attr('id', PointsTransferFilters.ClassName.MODAL_ID);
  $modalWrap.attr('aria-labelledby', PointsTransferFilters.ARIA.MODAL_LABEL);
  $modalWrap.attr('aria-describedby', PointsTransferFilters.ARIA.MODAL_DESCRIBE);
  $modalWrap.attr('role', 'dialog');
  $modalWrap.addClass(PointsTransferFilters.ClassName.MODAL_CLASS);

  // build title offscreen element attributes
  $titleElementOffscreen.attr('id', PointsTransferFilters.ARIA.MODAL_DESCRIBE);
  $titleElementOffscreen.addClass(PointsTransferFilters.ClassName.OFFSCREEN);
  $titleElementOffscreen.text(content.title);

  // build title element attributes
  $titleElement.addClass(PointsTransferFilters.ClassName.MODAL_HEADER);
  $titleElement.text(content.title);

  // Close UI
  $closeButton.addClass('modal-close-button');
  $closeButton.attr('aria-label', 'Close Modal Window');
  $closeicon.addClass('icon icon_x');

  var $optionOuterWrap = this._buildModalButtons(content);

  // append the close button
  $closeButton.append($closeicon);

  // append the element together
  $modalWrap.append($closeButton);
  $modalWrap.append($titleElement);
  $modalWrap.append($modalContent);
  $modalWrap.append($optionOuterWrap);

  return $modalWrap;
};


/**
 * _buildModalButtons
 * Will build the modal u/filti for the filter modal.
 *
 * @param {Object} content
 * @return {jQuery} Elements
 *
 * @private
 */
PointsTransferFilters.prototype._buildModalButtons = function(content) {
  var $ui;

  // UI for accept / clear
  var $optionOuterWrap = $('<div>');

  var $leftButtonWrap = $('<div>');
  var $rightButtonWrap = $('<div>');

  var $acceptModalButton = $('<button>');
  var $clearModalButton = $('<button>');

  $leftButtonWrap.addClass(PointsTransferFilters.ClassName.MODAL_BUTTON_WRAP);
  $optionOuterWrap.addClass(PointsTransferFilters.ClassName.MODAL_OPTIONS_WRAP);

  $acceptModalButton.text(content.accept);
  $clearModalButton.text(content.clear);

  $acceptModalButton.attr('tabindex', 0);
  $clearModalButton.attr('tabindex', 0);

  $acceptModalButton.addClass('btn' + ' ' + PointsTransferFilters.ClassName.MODAL_BUTTON_ACCEPT);
  $clearModalButton.addClass('btn' + ' ' + PointsTransferFilters.ClassName.MODAL_BUTTON_CLEAR);

  $leftButtonWrap.append($clearModalButton);
  $rightButtonWrap.append($acceptModalButton);

  $optionOuterWrap.append($rightButtonWrap);

  $ui = $optionOuterWrap;

  return $ui;
};

/**
 * _handleAcceptFilters
 * Will handle the user selecting the accept button.
 * This essentially simply just closes the modal.
 *
 * @param {Object} evt
 * @private
 */
PointsTransferFilters.prototype._handleAcceptFilters = function(evt) {
  if (evt.keyCode === PointsTransferFilters.Keys.SPACE ||
      evt.keyCode === PointsTransferFilters.Keys.ENTER) {
    this._closeModal(true);
    return;
  }

  this._closeModal(true);
};

/**
 * _getRewards
 * Will silo the reward elements into their specific teirs so they can be
 * quickly shown and hidden based on filters.
 *
 * @private
 */
PointsTransferFilters.prototype._getRewards = function() {
  var obj = {};

  for (var i = 0; i < this._$rewardElements.length; i++) {
    var currReward = this._$rewardElements.eq(i);
    var currRewardType = currReward.data('reward-type').toLowerCase();

    if (obj[currRewardType]) {
      obj[currRewardType].push(currReward);
    } else {
      obj[currRewardType] = [];
      obj[currRewardType].push(currReward);
    }
  }

  return obj;
};

/**
 * _applyFilters
 * Will apply filters and hide or show filters based on which are applied
 * and not.
 *
 * @param {Object} data
 * @private
 */
PointsTransferFilters.prototype._applyFilters = function(data) {
  var hiddenRewards = [];
  var activeRewards = [];

  // are we adding or removing the filter?
  this._activeFilters = (data.value === 'true') ?
    this._addFilters(data) :
    this._removeFilters(data);

  // if there aren't any filters don't do any logic.
  if (this._activeFilters.length) {
    this._showRewards();
    this._unSelectCheckbox('All');
  } else {
    this._showAllRewards();
    $('.' + PointsTransferFilters.ClassName.FILTER + '[for="All"]').attr('aria-checked', 'true');
    $('.' + PointsTransferFilters.ClassName.FILTER + '[for="All"] .' + PointsTransferFilters.ClassName.CHECKBOX).addClass('is-checked');
  }

};

/**
 * _addFilters
 * Will add the filters from the main active filters
 * instance variable.
 *
 * @param {Object} data
 * @return {Array}
 */
PointsTransferFilters.prototype._addFilters = function(data) {
  var arr = this._activeFilters.slice(0);
  var index = arr.indexOf(data.reward);

  if (index < 0) {
    arr.push(data.reward);
  }

  return arr;
};

/**
 * _removeFilters
 * Will remove the filters from the main active filters
 * instance variable.
 *
 * @param {Object} data
 * @return {Array}
 */
PointsTransferFilters.prototype._removeFilters = function(data) {
  var arr = this._activeFilters.slice(0);
  var index = arr.indexOf(data.reward);

  if (index > -1) {
    arr.splice(index, 1);
  }

  return arr;
};

/**
 * _showAllRewards
 * Will display all rewards by removing all classes an adding
 * active classes to them.
 */
PointsTransferFilters.prototype._showAllRewards = function() {
  for (var i = 0; i < this._$rewardElements.length; i++ ) {
    var currRewardElement = this._$rewardElements.eq(i);

    this._showReward(currRewardElement);
  }
};

/**
 * _showRewards
 * Will show filter elements from the user's selected options.
 *
 * @private
 */
PointsTransferFilters.prototype._showRewards = function() {
  // loop through the active filters
  for (var i = 0; i < this._activeFilters.length; i++) {
    var activeFilter = this._activeFilters[i];
    var filterElements = this._rewards[activeFilter];

    if (filterElements) {
      // loop through each item in the silo'd filters obj
      for (var j = 0; j < filterElements.length; j++) {
        var currFilterElement = filterElements[j];
        this._showReward(currFilterElement);
      }
    }
  }

  this._hideInactiveFilters();
};

/**
 * _hideInactiveFilters
 * Will loop and gather all the current filters then run a loop
 * against active filters and hide all elements that remain
 * in the filters list.
 *
 * @private
 */
PointsTransferFilters.prototype._hideInactiveFilters = function() {
  if (!this._activeFilters.length) {
    return;
  }

  var inactiveFilters = [];
  var filters = this._activeFilters;
  var allindex = filters.indexOf('all');

  // populate the filters array with all possible filters.
  for(var keys in this._rewards) {
    if (keys) {
      inactiveFilters.push(keys);
    }
  }

  // we need to also splice out 'all' if it's a possibility
  // since its messing with the array length.
  if (allindex >= 0 && filters.length > 1) {
    filters.splice(allindex, 1);
  }

  // splice out the active filters.
  for (var i = 0; i < this._activeFilters.length; i++) {
    var filter = this._activeFilters[i];
    var index = inactiveFilters.indexOf(filter);

    inactiveFilters.splice(index, 1);
  }

  for (var j = 0; j < inactiveFilters.length; j++) {
    var activeFilter = inactiveFilters[j];
    var filterElements = this._rewards[activeFilter];

    // if there isnt an active filter don't break the application.
    if (!activeFilter) {
      return;
    }
    // loop through each item in the silo'd filters obj
    for (var k = 0; k < filterElements.length; k++) {
      var currFilterElement = filterElements[k];
      this._hideReward(currFilterElement);
    }
  }
};

/**
 * _showReward
 * Will display reward element and apply proper ARIA attributes.
 *
 * @param {jQuery} el
 * @private
 */
PointsTransferFilters.prototype._showReward = function(el) {
  el.removeClass(
    PointsTransferFilters.ClassName.HIDDEN);
  el.addClass(
    PointsTransferFilters.ClassName.ACTIVE);

  el.removeAttr('aria-hidden');
};

/**
 * _hideReward
 * Will hide reward element and apply proper ARIA attributes.
 *
 * @param {jQuery} el
 * @private
 */
PointsTransferFilters.prototype._hideReward = function(el) {
  el.removeClass(
    PointsTransferFilters.ClassName.ACTIVE);
  el.addClass(
    PointsTransferFilters.ClassName.HIDDEN);

  el.attr('aria-hidden', true);
};

/**
 * _closeModal
 * Will close the modal if it's open.
 *
 * @param {Boolean} triggerClick
 */
PointsTransferFilters.prototype._closeModal = function(triggerClick) {
  
  $('section, header, footer, #header-desktop').removeAttr('aria-hidden');
  $('.points-transfer-landing-body-filters-mobile-wrap').attr('aria-hidden', 'false');
  $('#modal-overlay').removeClass('opened');  

  if (this._modalOpen) {
    this._html.removeClass(PointsTransferFilters.ClassName.NO_SCROLL);
    this._$element.find('#modal-points-transfer').attr('style', 'display:none;');
    this._modalOpen = false;
  }

  if (triggerClick) {
    var $closeBtn = this._$element.find('.' + PointsTransferFilters.ClassName.CLOSE_BTN);
    $closeBtn.trigger('click');
  }

  $('.modal-points-transfer-launch').focus();

};

/**
 * _destroyMobileLayout
 * Will destroy the
 *
 * @private
 */
PointsTransferFilters.prototype._destroyMobileLayout = function() {
  if (this._modalOpen) {
    this._closeModal(true);
    this._modalDestroyedByViewportSwitch = true;
  }

  this._$element.empty();
  this._$element.removeClass('show');
  this._$element.append(this._filterInnerContent);
  this._initializeFilterBindings();
};




PointsTransferFilters.ClassName = {
  BASE: 'points-transfer-landing-body-filters-wrap',
  MAIN: 'oc-container',
  NO_SCROLL: 'no-scroll',
  FILTER: 'points-transfer-checkbox-wrap',
  FILTER_LIST: 'points-transfer-landing-filters-list',
  FILTER_LIST_ITEM: 'points-transfer-landing-item',
  CHECKBOX: 'points-transfer-checkbox',
  MODAL_CLASS: 'modal modal-overlay modal-points-transfer',
  MODAL_ID: 'modal-points-transfer',
  MODAL_HEADER: 'modal-header-title',
  MOBILE_TITLE: 'points-transfer-landing-mobile-content',
  MODAL_LAUNCH: 'modal-points-transfer-launch',
  MODAL_OPTIONS_WRAP: 'filter-btn-wrap level-one-buttons grid-container',
  MODAL_BUTTON_WRAP: 'btn-wrapper grid-100 mobile-grid-100',
  MODAL_BUTTON_ACCEPT: 'points-transfer-landing-accept',
  MODAL_BUTTON_CLEAR: 'points-transfer-landing-clear',
  REWARDS: 'points-transfer-landing-body-points-reward',
  CLOSE_BTN: 'modal-close-button',
  OFFSCREEN: 'screen-reader-offscreen',
  ACTIVE: 'is-active',
  HIDDEN:'is-hidden',
};

PointsTransferFilters.ARIA = {
  MODAL_LABEL: 'modal-points-transfer-title',
  MODAL_DESCRIBE:'modal-points-transfer-description',
};

PointsTransferFilters.Events = {
  RENDERED: 'filterTabs::rendered',
};

PointsTransferFilters.Keys = {
  ENTER: 13,
  SPACE: 32,
  LEFT: 37,
  RIGHT: 39,
};

function _createPointsTransferFilters() {
  _toArray($('.' + PointsTransferFilters.ClassName.BASE)).forEach(function(el) {
    return new PointsTransferFilters(el);
  });
}

PointsTransferFilters.initializeAll = function() {
  _createPointsTransferFilters();
};


citiShare.pointsTransferFilters = (function(){

  PointsTransferFilters.initializeAll();

  return {
    initAll: PointsTransferFilters.initializeAll,
    Events: PointsTransferFilters.Events,
    ClassName: PointsTransferFilters.ClassName
  };

})();

/**
 * JSHint:
 * To allow bracket notation,
 * For example, test["placeholder"] vs test.placeholder
 */

/*jshint sub:true*/

citiShare.transfer = (function() {
    'use strict';

    var config = {
        allowableKeys: [48,49,50,51,52,53,54,55,56,57,8,9,0], // numbers 0-9, del, and tab
        pointsTransferIncrement: 1000,
        pointsTransferMin: 1000,
        thankyouPointsToTransfer: 1000,
        brandPointsToGain: 0,
        thankyouPoints: 0,
        pointTransferRate: 1.5,
        grCountryArray: ['australia', 'bahrain', 'hong kong', 'philippines', 'thailand', 'singapore', 'mexico', 'uae', 'malaysia'],
        $termsConditionsCheckboxError: $('.points-transfer-detail-terms-and-conditions-checkbox-error-message'),
        $showMore: $('#points-transfer-detail-showmore'),
        $heroCopy: $('#promotion-hero-copy'),
        $pointsToTransfer: $('#points-to-transfer'),
        $brandPoints: $('#brand-points'),
        $brandPointsMessage: $('#brand-points-message'),
        $pointsTransferDetailContainer: $('.points-transfer-detail-container'),
        $form: $('#points-transfer-form'),
        $termsAndConditionsCheckbox: $('#terms-and-conditions-checkbox'),
        $transferContinueButton: $('#points-transfer-detail-form-continue-button'),
        $pointsTransferMessage: $('#points-to-transfer-message'),
        $pointsTransferError: $('#points-to-transfer-error'),
        $errorMessage: $('.points-transfer-detail-page-error-message'),
        $pointsTransferDetailContent: $('.points-transfer-detail-container-content'),
        $pointsTransferDetailErrorOverlay: $('.points-transfer-detail-full-page-error-overlay'),
        $pointsTransferDetailFullPageError: $('.points-transfer-detail-full-page-error'),
        formData: {
            memberName: '',
            memberNumber: '',
            memberRememberNumber: false,
            memberPassword: '',
            memberPointsToTransfer: 0
        },
        minHeroCopyLength: 164,
        truncatedCopy: '',
        setSeeMore: false
    };

    /*
    * Toggle the full page error state.
    */
    function toggleFullPageError() {

        var dataError = config.$pointsTransferDetailContent.data('full-page-error');
        var hasError = false;

        if (typeof dataError !== 'undefined' && dataError.length !== 0) {
            try {
                hasError = JSON.parse(dataError);
            }
            catch(err) {
                console.warn('Couldn\'t parse `data-full-page-error` as a boolean, fallback to comparing with the string directly.');
                hasError = dataError;
            }
        }

        if(hasError || hasError === 'true') {

            config.$pointsTransferDetailErrorOverlay.addClass('show');
            config.$pointsTransferDetailFullPageError.addClass('error');

            config.$pointsTransferDetailContent.attr('aria-hidden', 'true');

            // needed because some slider elements are created dynamically after this function is called
            window.setTimeout(function() {
                config.$form.find('*').attr('aria-hidden', 'true');
                config.$form.find('*').attr('aria-disabled', 'true');
                config.$form.find('*').attr('tabindex', '-1');
            }, 100);

        }

    }

    /**
     * Toggle Accordion : Terms and Conditions
     */
    function toggleAccordion() {
        var $toggleAccordionEl = $('#expand-terms-and-conditions'),
            $termsLabel = $('#terms-and-conditions-accordian-label');

        $toggleAccordionEl.on('click', function(e) {
            var $this = $(this),
                $parent = $this.parent(),
                $errorMessage = $parent.next();

            e.stopPropagation();
            e.preventDefault();
            if ($errorMessage.hasClass('error')) {
                $errorMessage.removeClass('error');
            }

            $parent.toggleClass('open');

            if ($parent.hasClass('open')) {
                $this.attr('aria-expanded', true);
                $('#terms-and-conditions').attr('aria-hidden', false);
                $('#terms-and-conditions [tabindex]').each(function(index, el) {
                    $(el).attr('tabindex', '0');
                });
                $('.points-transfer-detail-form-continue-container').removeClass('show-tooltip');
            } else {
                $this.attr('aria-expanded', false);
                $('#terms-and-conditions').attr('aria-hidden', true);
                $('#terms-and-conditions [tabindex]').each(function(index, el) {
                    $(el).attr('tabindex', '-1');
                });

                if (config.$termsAndConditionsCheckbox[0].checked === false) {
                    $('.points-transfer-detail-form-continue-container').addClass('show-tooltip');
                }

                if (config.$termsAndConditionsCheckbox.hasClass('error')) {
                    config.$termsAndConditionsCheckbox.removeClass('error');
                    config.$termsConditionsCheckboxError.removeClass('error');
                }

                if ($parent.hasClass('error')) {
                    $errorMessage.addClass('error');
                }
            }

        });

        $termsLabel.on('click', function() {
            $toggleAccordionEl.trigger('click');
        });
    }

    /**
     * Get user information for the specified step
     * @param {string} step : Points Transfer step (transfer, review or confirmation)
     *
     */
    function getStepData(step) {

        var countryLowercase = citiConfig.country.toLowerCase();
        var jsonDataUrl = citiConfig.endPointHost + citiConfig.pointsTransferDetailEndPointPath + step + '-step';
        var isCountryGR = config.grCountryArray.indexOf(countryLowercase) >= 0;

        if(isCountryGR) {
            jsonDataUrl = jsonDataUrl + '-gr';
        }

        $.ajax({
            url: jsonDataUrl + '.json',
            type: 'get',
            dataType: 'json'
        })
        .done(function(data) {
            // TODO: load data into corresponding elements
            switch (step) {
                case 'confirmation':
                    setConfirmationData(data, isCountryGR);
                    break;
                case 'review':
                    setReviewData(data);
                    break;
                default:
                    setTransferData(data);
                    break;
            }
        })
        .fail(function(error) {
            // TODO: server error in retrieving user info?
            console.log('error: ');
            console.log(error);
        });
    }

    /**
     * Take provided data and set it to the transfer page
     *
     *
     */
    function setTransferData(data) {

        var nameInput = $('#name');

        if ($('.custom-points').length && data.points) {
            config.pointsTransferIncrement = parseInt(data.points.increment, 10);
            config.pointTransferRate = parseInt(data.points.transferRate, 10);
            config.pointsTransferMin = parseInt(data.points.min, 10);
            config.thankyouPointsToTransfer = config.pointsTransferMin;
        }

        nameInput.val(data.user.name);
        nameInput.addClass(data.class || "");

        $('#points-left-after-transfer').val(data.user.thankyouPoints - config.thankyouPointsToTransfer);

        config.thankyouPoints = data.user.thankyouPoints;
        config.brandPointsToGain = parseInt(config.thankyouPointsToTransfer, 10) * config.pointTransferRate;

        config.$pointsTransferMessage.find('span').text(citiShare.util.convertToCommaFormat(config.pointsTransferIncrement));
        config.$brandPointsMessage.find('span').text(citiShare.util.convertToCommaFormat(config.pointsTransferIncrement * config.pointTransferRate));
        config.$brandPoints.val(citiShare.util.convertToCommaFormat(config.brandPointsToGain));
        citiShare.slider.init('points-transfer-slider', config.pointsTransferMin, config.thankyouPoints, config.thankyouPointsToTransfer, config.pointsTransferIncrement, 'points-transfer-detail-slider-minimum', 'points-transfer-detail-slider-maximum', 'points-transfer-form');
    }

    /**
     * Take provided data and set it to the review page
     *
     *
     */
    function setReviewData(data) {

        config.thankyouPoints = data.user.thankyouPoints;
        config.thankyouPointsToTransfer = data.user.thankyouPointsToTransfer;

        config.$pointsToTransfer.val(citiShare.util.convertToCommaFormat(config.thankyouPointsToTransfer));

        if(config.$pointsToTransfer.val() !== undefined) {
            var pointsToTransferVal = parseInt(config.$pointsToTransfer.val().split(',').join(''));
            var brandPointsFormatted = citiShare.util.convertToCommaFormat(pointsToTransferVal * config.pointTransferRate);
            config.$brandPoints.val(brandPointsFormatted);
        }

        $('#points-left-after-transfer').val(citiShare.util.convertToCommaFormat(config.thankyouPoints - config.thankyouPointsToTransfer));

        $('#points-transfer-member-name').text(data.user.name);
        $('#points-transfer-member-number').text(data.user.memberNumber);
    }

    /**
     * Take provided data and set it to the confirmation page
     *
     *
     */
    function setConfirmationData(data, isCountryGR) {

        setReviewData(data);

        $('#points-transfer-confirmation-number').text(data.user.confirmationNumber);

        /*------- setup print page ------*/
        if(isCountryGR) {
            $('#points-to-transfer-print').text('XXX,XXX');
            $('#brand-points-print').text('XXX,XXX');
            $('#points-left-after-transfer-print').text('XXX,XXX');
        }
        else {
            $('#points-to-transfer-print').text(citiShare.util.convertToCommaFormat(config.thankyouPointsToTransfer));
            $('#brand-points-print').text(0);
            $('#points-left-after-transfer-print').text(citiShare.util.convertToCommaFormat(config.thankyouPoints - config.thankyouPointsToTransfer));
        }

        $('#points-transfer-confirmation-number-print').text(data.user.print.confirmationNumber || data.user.confirmationNumber);
        $('#points-transfer-member-name-print').text(data.user.print.name || data.user.name);
        $('#points-transfer-member-number-print').text(data.user.print.memberNumber || data.user.memberNumber);

        $('#points-transfer-thankyou-account-name-print').text(data.user.thankYou.name);
        $('#points-transfer-thankyou-account-number-print').text(data.user.thankYou.accountNumber);
    }

    /*----- use template classname to get the current PTDP step -----*/
    function getPointsTransferStep() {
        if (config.$pointsTransferDetailContainer.hasClass('points-transfer-detail-transfer')) {
            return 'transfer';
        } else if (config.$pointsTransferDetailContainer.hasClass('points-transfer-detail-review')) {
            return 'review';
        } else if (config.$pointsTransferDetailContainer.hasClass('points-transfer-detail-confirmation')) {
            return 'confirmation';
        }
    }

    /*----- calculate the brand and thankyou points -----*/
    function calculatePointsTransfered(isBrandField) {
        var brandPointsLive = $('#brand-points-live'),
            pointsLeftAfterTransferLive =  $('#points-left-after-transfer-live'),
            pointsToTransferLive = $('#points-to-transfer-live'),
            convertedBrandPointsToGain = 0,
            convertedPointsLeft = 0;


        if (isBrandField) {
            // calculate values from brandpoints
            // do *not* use parseInt() on the pointTransferRate...
            config.thankyouPointsToTransfer = Math.floor((1 / config.pointTransferRate) * parseInt(config.brandPointsToGain, 10));
            config.$pointsToTransfer.val(citiShare.util.convertToCommaFormat(config.thankyouPointsToTransfer));
        } else {
            config.brandPointsToGain = config.pointTransferRate * parseInt(config.thankyouPointsToTransfer, 10);
            convertedBrandPointsToGain = citiShare.util.convertToCommaFormat(parseInt(config.brandPointsToGain, 10));
            config.$brandPoints.val(convertedBrandPointsToGain);
        }

        convertedBrandPointsToGain = citiShare.util.convertToCommaFormat(config.brandPointsToGain);
        convertedPointsLeft = citiShare.util.convertToCommaFormat(config.thankyouPoints - config.thankyouPointsToTransfer);

        pointsToTransferLive.html(pointsToTransferLive.data('label') + ' ' + config.thankyouPointsToTransfer);
        brandPointsLive.html(brandPointsLive.data('label') + ' ' + convertedBrandPointsToGain);
        pointsLeftAfterTransferLive.html(pointsLeftAfterTransferLive.data('label') + ' ' + convertedPointsLeft);

        $('#points-left-after-transfer').val(convertedPointsLeft);
    }

    function toggleErrMsg($el, $elErr, showErr) {
        if (showErr) {
            $el.addClass('error');
            $elErr.addClass('error');
            $elErr.attr('aria-hidden', false);
        } else {
            $el.removeClass('error');
            $elErr.removeClass('error');
            $elErr.attr('aria-hidden', true);
        }
    }

    function checkFormInputs() {

        var email = $('#brand-member-email');
        var emailError = $('.brand-member-email-error');
        var number = $('#brand-member-number');
        var numberError = $('.brand-member-number-error');
        var confirmNumber = $('#confirm-brand-member-number');
        var confirmNumberError = $('.confirm-brand-member-number-error');
        var password = $('#brand-member-password');
        var passwordError = $('.brand-member-password-error');
        var rememberNumber = $('#remember-brand-member-number');
        var rememberNumberError = $('.remember-brand-member-number-error');
        var nbLoyaltyProgram = rememberNumber.data('nb-loyalty-program');
        var maxLoyaltyProgram = rememberNumber.data('max-loyalty-program');        

        if(email.length && email.val().trim().length === 0 || !citiShare.formValidation.validateInput(email.val(),'email')) {
            toggleErrMsg(email, emailError, true);
        } else {
            toggleErrMsg(email, emailError, false);
        }

        if (number.length && number.val().trim().length === 0) {
            toggleErrMsg(number, numberError, true);
        } else {
            toggleErrMsg(number, numberError, false);
        }

        if (confirmNumber.length && confirmNumber.val().trim() !== number.val().trim() || confirmNumber.val().trim().length === 0) {
            toggleErrMsg(confirmNumber, confirmNumberError, true);
        } else {
            toggleErrMsg(confirmNumber, confirmNumberError, false);
        }

        if (password.length && password.val().trim().length === 0) {
            toggleErrMsg(password, passwordError, true);
        } else {
            toggleErrMsg(password, passwordError, false);
        }

        if(rememberNumber.length && rememberNumber.is(':checked') && nbLoyaltyProgram >= maxLoyaltyProgram) {
            toggleErrMsg(rememberNumber, rememberNumberError, true);
        } else {
            toggleErrMsg(rememberNumber, rememberNumberError, false);
        }
    }

    function bindFormContinueButton() {
        config.$transferContinueButton.on('click', function() {
            var $accordionContainer = $('.points-transfer-detail-terms-and-conditions-accordian-container'),
                numberOfErrors = $('.points-transfer-detail-form-error.error').length;

            if (!$accordionContainer.hasClass('open') && !$('#terms-and-conditions-checkbox').is(':checked')) {
                $accordionContainer.addClass('error');
                $('#terms-and-conditions-checkbox').addClass('error');
                $('.points-transfer-detail-terms-and-conditions-error-message').addClass('error');
            } else if (!$('#terms-and-conditions-checkbox').is(':checked')) {
                $accordionContainer.addClass('error');
                $('#terms-and-conditions-checkbox').addClass('error');
                config.$termsConditionsCheckboxError.addClass('error');
            }
            checkFormInputs();
            numberOfErrors = $('.points-transfer-detail-form-error.error').length;
            if (numberOfErrors === 0) {
                postUserInput();
            } else {
                $('#number-of-errors').text(numberOfErrors);

                if (numberOfErrors === 1) {
                    $('#plural-errors').text('');
                } else if (numberOfErrors > 1) {
                    $('#plural-errors').text('s');
                }

                config.$errorMessage.addClass('error');
                config.$errorMessage.attr('tabindex', '-1');
                config.$errorMessage.attr('aria-live','assertive');
                config.$errorMessage.attr('aria-hidden','false');
                
                $('html,body').animate({
                    scrollTop: config.$errorMessage.offset().top - 50
                });
                
                config.$errorMessage.focus();
            }
        });
    }

    function postUserInput() {
        config.$errorMessage.removeClass('error');
        config.$errorMessage.attr('tabindex', '-1');

        config.formData.memberName = $('#name').val();
        config.formData.memberNumber = $('#brand-member-number').val();
        config.formData.memberRememberNumber = $('#remember-brand-member-number').val();
        config.formData.memberPointsToTransfer = config.thankyouPointsToTransfer;
        config.formData.memberPassword = $('#brand-member-password').val();

        // TODO: use POST type and correct the url
        $.ajax({
            url: citiConfig.endPointHost + citiConfig.pointsTransferDetailEndPointPath + 'review-step.json',
            type: 'get',
            dataType: 'json'
        })
        .done(function() {
            window.location.href = window.location.origin + window.location.pathname.split('/').slice(0,-1).join('/') + '/points-transfer-detail-ty-review.html';
        })
        .fail(function(error) {
            console.log('error: ');
            console.log(error);
        });
    }

    function bindTransitionButtons() {
        $('#points-transfer-detail-back').on('click', function(e) {
            window.location.href = window.location.origin + window.location.pathname.split('/').slice(0,-1).join('/') + '/points-transfer-detail-ty.html';
            e.preventDefault();
        });

        $('#points-transfer-detail-cancel-button').on('click', function(e) {
            citiShare.AccessibleModal({ modal: $('#modal-pointstransfer-review-cancel') }).show();
            e.preventDefault();
        });

        $('#points-transfer-detail-confirm').on('click', function() {
            window.location.href = window.location.origin + window.location.pathname.split('/').slice(0,-1).join('/') + '/points-transfer-detail-ty-confirmation.html';
        });
    }

    function bindTermsConditionsCheckbox() {
        $('#terms-and-conditions-checkbox').on('click', function() {
            if ($(this).hasClass('error')) {
                config.$termsConditionsCheckboxError.removeClass('error');
                $(this).removeClass('error');
                $(this).closest('.error').removeClass('error');
            }

            if ($(this).is(':checked')) {
                $('.points-transfer-detail-form-continue-container').removeClass('show-tooltip');
                $('#continue-button-tooltip').attr('aria-hidden', true);
                $('#continue-button-tooltip').attr('role', '');
                config.$transferContinueButton.attr('aria-describedby', '');
            } else {
                $('.points-transfer-detail-form-continue-container').addClass('show-tooltip');
                $('#continue-button-tooltip').attr('aria-hidden', false);
                $('#continue-button-tooltip').attr('role', 'tooltip');
                config.$transferContinueButton.attr('aria-describedby', 'continue-button-tooltip');
            }
        });
    }

    function bindBrandPointsInput() {
        config.$brandPoints.on('focusout keyup', function(e) {
            var $this = $(this),
                data,
                $thisVal = $this.val().split(',').join(''),
                inputVal = '',
                inputRemainder;

            if (e.which !== 13 && e.which !== 0 && e.which !== undefined) {
                return;
            }

            if (!isNaN($thisVal)) {
                // Use minimum value when user enters value less than the minimum
                if (parseInt($thisVal, 10) < (parseInt(config.pointsTransferMin, 10) * config.pointTransferRate) || $thisVal.length === 0) {
                    config.brandPointsToGain = config.pointTransferRate * parseInt(config.pointsTransferMin, 10);
                    inputVal = parseInt(config.brandPointsToGain, 10);
                    $this.val(citiShare.util.convertToCommaFormat(inputVal));
                    config.$brandPointsMessage.show();
                    config.$brandPointsMessage.attr('aria-hidden', false);
                    data = $('#brand-points-message').data('message-up');
                    $('#brand-points-message').html(data);
                    $('#brand-points-message span').text(citiShare.util.convertToCommaFormat(config.pointsTransferIncrement * config.pointTransferRate));
                    config.$pointsTransferMessage.html('');
                // Use maximum value when user enters value greater than the maximum
                } else if (parseInt($thisVal, 10) > (config.pointTransferRate * config.thankyouPoints)) {
                    config.brandPointsToGain = config.pointTransferRate * parseInt(config.thankyouPoints, 10);
                    inputVal = parseInt(config.brandPointsToGain, 10);
                    $this.val(citiShare.util.convertToCommaFormat(inputVal));
                    config.$brandPointsMessage.show();
                    config.$brandPointsMessage.attr('aria-hidden', false);
                    data = $('#brand-points-message').data('message-down');
                    $('#brand-points-message').html(data);
                    $('#brand-points-message span').text(citiShare.util.convertToCommaFormat(config.pointsTransferIncrement * config.pointTransferRate));
                    config.$pointsTransferMessage.html('');
                } else {
                    inputRemainder = $thisVal % parseInt(config.pointsTransferIncrement * config.pointTransferRate, 10);
                    if (inputRemainder === 0) {
                        config.$brandPointsMessage.hide();
                        config.$brandPointsMessage.attr('aria-hidden', true);
                        config.brandPointsToGain = $thisVal;
                    } else {
                        config.$brandPointsMessage.show();
                        config.$brandPointsMessage.attr('aria-hidden', false);
                        config.brandPointsToGain = $thisVal - inputRemainder;
                        //area where it needs to 
                        data = $('#brand-points-message').data('message-down');
                        $('#brand-points-message').html(data);
                        $('#brand-points-message span').text(citiShare.util.convertToCommaFormat(config.pointsTransferIncrement * config.pointTransferRate));
                        config.$pointsTransferMessage.html('');
                    }
                    inputVal = parseInt(config.brandPointsToGain, 10);
                    $this.val(citiShare.util.convertToCommaFormat(inputVal));
                }

                calculatePointsTransfered(true);
                $('#points-transfer-detail-slider').trigger('sliderInputChange', [config.thankyouPointsToTransfer, $('#points-transfer-slider_handle')]);
            }
        });

        setInputConstraints(config.$brandPoints);
    }

    function bindSliderInput() {
        config.$pointsToTransfer.on('focusout keyup', function(e) {
            var $this = $(this),
                data,
                $thisVal = $this.val().split(',').join(''),
                inputRemainder;

            if (e.which !== 13 && e.which !== 0 && e.which !== undefined) {
                return;
            }

            if (!isNaN($thisVal)) {
                if (parseInt(config.thankyouPoints.split(',').join(''), 10) >= $thisVal) {
                    inputRemainder = $thisVal % config.pointsTransferIncrement;

                    if (inputRemainder === 0) {
                        config.$pointsTransferMessage.html('');
                        config.$pointsTransferMessage.attr('aria-hidden', true);
                        config.thankyouPointsToTransfer = $thisVal;
                    } else {
                        //config.$pointsTransferMessage.show();
                        config.$pointsTransferMessage.attr('aria-hidden', false);
                        config.thankyouPointsToTransfer = $thisVal - inputRemainder;
                        data = $('#points-to-transfer-message').data('message-down');
                        $('#points-to-transfer-message').html(data);
                        $('#points-to-transfer-message span:nth-child(1)').text(citiShare.util.convertToCommaFormat(config.pointsTransferIncrement));
                        $('#points-to-transfer-message span:nth-child(2)').show();
                        config.$brandPointsMessage.html('');
                    }

                    $this.val(config.thankyouPointsToTransfer);
                } else {
                    $this.val(config.thankyouPoints);
                    config.thankyouPointsToTransfer = config.thankyouPoints;
                    data = $('#points-to-transfer-message').data('message-down');
                    $('#points-to-transfer-message').html(data);
                    $('#points-to-transfer-message span').text(citiShare.util.convertToCommaFormat(config.pointsTransferIncrement));
                    config.$brandPointsMessage.html('');
                }

                if ($thisVal < config.pointsTransferMin) {
                    config.$pointsTransferMessage.attr('aria-hidden', false);
                    config.thankyouPointsToTransfer = config.pointsTransferMin;
                    data = $('#points-to-transfer-message').data('message-up');
                    $('#points-to-transfer-message').html(data);
                    $('#points-to-transfer-message span').text(citiShare.util.convertToCommaFormat(config.pointsTransferIncrement));
                    config.$brandPointsMessage.html('');
                }

                calculatePointsTransfered();
                $('#points-transfer-detail-slider').trigger('sliderInputChange', [config.thankyouPointsToTransfer, $('#points-transfer-slider_handle')]);
            } else {
                $this.addClass('not-a-number-error error');
            }
        });

        setInputConstraints(config.$pointsToTransfer);
    }

    function setInputConstraints($el) {
        $el.on('keypress', function(e) {
            if (config.allowableKeys.indexOf(e.which) === -1 || $(this).val().length > 49) {
                e.preventDefault();
                return;
            }
        }).on('keyup change', function() {
            var $this = $(this),
                val = $this.val();

            val = val.split(',').join('');
            $this.val(citiShare.util.convertToCommaFormat(val));
        }).on('paste', function(e) {
            e.preventDefault();
        });
    }

    function bindSeeMoreBrands() {
        $('#see-more-brands-link').on('click', function(e) {
            var $this = $(this),
                $brandsContainer = $this.next();

            if ($brandsContainer.hasClass('open')) {
                $this.find('span').html('');
                $this.find('span').text('+');
                $brandsContainer.removeClass('open');
            } else {
                $this.find('span').text('');
                $this.find('span').html('&mdash;');
                $brandsContainer.addClass('open');
            }

            e.preventDefault();
        });
    }

    function bindHeroSeeMore() {
        var tabletWidth = 768,
            isMobileWidth = false;

        $(window).on('resize', function() {
            citiShare.util.throttle(function() {
                var windowWidth = window.innerWidth || $(window).width();

                if (windowWidth < tabletWidth) {
                    isMobileWidth = true;
                } else {
                    isMobileWidth = false;
                }

                if (isMobileWidth && !config.setSeeMore) {
                    truncate();
                    config.$showMore.show();
                    config.setSeeMore = true;
                } else if (!isMobileWidth && config.setSeeMore) {
                    config.$showMore.hide();
                    config.setSeeMore = false;

                    if (!config.$showMore.hasClass('open')) {
                        unTruncate();
                    } else {
                        config.$showMore.removeClass('open');
                        config.$showMore.html(config.$showMore.data('more'));
                    }
                }
                
                if(isMobileWidth){
                    $('.points-transfer-detail-form-continue').removeAttr('aria-describedby');
                }else{
                    $('.points-transfer-detail-form-continue').attr('aria-describedby','continue-button-tooltip');
                }
                
            }(), 500);
        }).trigger('resize');
    }

    function bindEmailError(){

        var email = $('#brand-member-email');
        var emailError = $('.brand-member-email-error');
        
        $(email).on('blur',function(){
            if(email.length && email.val().trim().length === 0 || !citiShare.formValidation.validateInput(email.val(),'email')) {
                toggleErrMsg(email, emailError, true);
            } else {
                toggleErrMsg(email, emailError, false);
            }
        });
    }

    function bindShowMoreButton() {
        var moreCopy = config.$showMore.data('more'),
            lessCopy = config.$showMore.data('less');

        config.$showMore.on('click', function(e) {
            var $this = $(this);

            e.preventDefault();
            e.stopPropagation();
            if ($this.hasClass('open')) {
                $this.removeClass('open');
                $this.html(moreCopy);
                truncate();
            } else {
                $this.addClass('open');
                $this.html(lessCopy);
                unTruncate();
            }
        });
    }

    function truncate() {
        if (config.minHeroCopyLength !== null && config.$heroCopy.html() !== undefined) {
            config.truncatedCopy = config.$heroCopy.html().substring(config.minHeroCopyLength);
            config.$heroCopy.html(config.$heroCopy.html().substring(0, config.minHeroCopyLength) + '...');
        }
    }

    function unTruncate() {
        if (config.$heroCopy.length) {
            config.$heroCopy.html(config.$heroCopy.html().slice(0,-3) + config.truncatedCopy);
        }
    }

    bindShowMoreButton();

    function _init() {
        var pointsTransferStep = getPointsTransferStep();

        if (pointsTransferStep !== undefined) {
            getStepData(pointsTransferStep);

            toggleAccordion();

            bindTransitionButtons();

            config.$form.on('sliderValue', function(e, param) {
                config.$pointsToTransfer.val(param).trigger('change');
                config.thankyouPointsToTransfer = param;
            });

            bindFormContinueButton();

            bindTermsConditionsCheckbox();

            config.$pointsToTransfer.on('change', function(e) {
                config.thankyouPointsToTransfer = parseInt(e.target.value.split(',').join(''), 10);
                calculatePointsTransfered();
                $(this).removeClass('error');
            });

            bindSliderInput();
            bindBrandPointsInput();
        }

        bindSeeMoreBrands();
        bindHeroSeeMore();
        toggleFullPageError();
        bindEmailError();

        // Check if there is a minimum points error for this user.
        // If so, prevent tabbing and display overlay with the message
        if ($('.points-transfer-detail-minimum-points-error').hasClass('show-minimum-points-error')) {
            config.$pointsTransferDetailContent.attr('tabindex', 0);
            $('#minimum-points-error-overlay').show();
            $('.points-transfer-detail-minimum-points-error').show();
        }
    }

    return {
        config: config,
        init: _init
    };
})();


citiShare.polyfills = (function() {
    "use strict";

    function css3Columns(){

    	// columnize the all brands variation of the category landing page
    	$('.category-brand-wrapper').addClass('dontsplit');
        
        if ($(window).width() < 480) {
            $('.category-brands-wrapper').columnize({
                width: $('.oc-content').width() / 1, 
                buildOnce: true,
                target: $('.no-css-columns-wrapper')
            });
        } else if ($(window).width() < 755) {
            $('.category-brands-wrapper').columnize({
                width: $('.oc-content').width() / 2, 
                buildOnce: true,
                target: $('.no-css-columns-wrapper')
            });
        } else if ($(window).width() < 960) {
            $('.category-brands-wrapper').columnize({
                width: $('.oc-content').width() / 3, 
                buildOnce: true,
                target: $('.no-css-columns-wrapper')
            });
        } else {
            $('.category-brands-wrapper').columnize({
                width: $('.oc-content').width() / 4, 
                buildOnce: true,
                target: $('.no-css-columns-wrapper')
            });
        }
        

    }


    function init() {
      if (!Modernizr.csscolumns) {
        if(typeof $.throttle === 'function') {
          $(window).resize($.throttle(500, css3Columns));
        }
      }
    }
    init();
    return {};
})();

/*
 *
 * This function is used to initialize and handle everything related
 * to the My Profile page
 *
 * Depends on
 *  - Having a DIV with a class of `my-profile`
 *  - jQuery
 *  - citiShare.AccessibleModal
 *
 */
citiShare.profile = (function() {

  "use strict";

  var config = {
    $editLinks: $('.profile-edit-link'),
    $cancelLinks: $('.my-profile-cancel-link'),
    contactInformationLists: [],
    ajaxDeleteSelector: '.ajax-delete',

    formGroupErrorSelector: '.form-group-error',

    editLinkSelector: '.profile-edit-link',

    moduleSelector: '.module',
    staticContainerSelector: '.module-static',
    editableContainerSelector: '.module-editable',
    moduleMessagesSelector: '.my-profile-messages',
    cancelEditsModalSelector: '#modal-confirm-cancel',

    $accountSelectionForm: $('#my-profile-account-selection-form'),
    accountSelectionModalSelector: '#modal-account-selection-confirm',
    
    $contactInformationForm: $('#my-profile-contact-information-form'),
    $contactInformationEmailInput: $('#eMail, #eMail-confirm'),
    $contactInformationPhonesInput: $('#homePhone, #businessPhone, #mobilePhone'),

    $securityInformationForm: $('#my-profile-security-information-form'),
    $emailSettingsForm: $('#my-profile-email-settings-form'),
    $legalNoticesForm: $('#my-profile-legal-notices-form'),

    $securityInformationMaskedInput: $('#answer, #answer-confirm'),
    $securityInformationUsername: $('#userName'),

    $loyaltyProgramsForm: $('#my-profile-loyalty-programs-form'),
    $loyaltyProgramsDoneButton: $('.my-profile-loyalty-programs .my-profile-save-link'),
    $loyaltyProgramsRemoveButton: $('.my-profile-loyalty-programs .my-profile-loyalty-programs-remove-link'),
    $loyaltyProgramsNumberInput: $('#loyalty-programs-number'),

    radioButtonGroupSelector: '.my-profile-radio-button-group'
  };



  /*
   * Turn On editable mode on a section
   */
  var editSection = function editSection() {

    var $clickedLink = $(this);
    var $module = $clickedLink.parents(config.moduleSelector);

    // Reinsert data for contact information.
    if($module.hasClass('my-profile-contact-information')) {
      var $inputs = $module.find('input');
      var $selects = $module.find('select');

      $inputs.each(function() {
        $(this).val($(this).attr('value'));
      });

      $selects.each(function() {
        var selected = $(this).data('value');
        $(this).val(selected);
        $(this).selectmenu('refresh');
      });
    }

    _toggleSection($module, true);
  };



  /*
   * Submit account selection form
   */
  var onSubmitAccountSelection = function onSubmitAccountSelection() {

    var $error = $(this).parents('.module').find(config.formGroupErrorSelector);
    var selection = $(this).serializeArray();

    if(selection.length === 0 || selection[0].value === '') {
      $error.css('display', 'block');
      $error.text($error.data('text'));
    }
    else {

      var redirect = selection[0].value;

      $error.css('display', 'none');
      $error.text('');

      window.location.href = redirect;
    }
  };

  /*
   * Submit Contact Information form
   */
  var onSubmitContactInformation = function onSubmitContactInformation(e) {

    var $form = $(this);
    var formElements = _getContextFormElements($form);
    var formData = _parseInputs(formElements.$allInputs);
    
    // hide previous errors
    _hideErrors(formElements);

    var invalidData = _validateFormData(formData);

    var email = formData.eMail;
    var confirmEmail = formData['eMail-confirm'];

    invalidData = _validateFieldsAreTheSame(email, confirmEmail, invalidData);

    if(invalidData.numberOfErrors > 0) {
      _showErrors(formElements.$globalMessage, invalidData);
      e.preventDefault();
      return false;
    }

    // if everything is valid submit the form
    $(this).trigger('form:post', [_ajaxDone.bind(this, formElements)]);
  };

  /*
   * Submit Security Information form
   */
  var onSubmitSecurityInformation = function onSubmitSecurityInformation() {

    var formElements = _getContextFormElements($(this));
    var formData = _parseInputs(formElements.$allInputs);

    // hide previous errors
    _hideErrors(formElements);

    var invalidData = _validateFormData(formData);

    var password = formData.password;
    var retypePassword = formData['password-confirm'];
    var answer = formData.answer;
    var retypeAnswer = formData['answer-confirm'];

    invalidData = _validateFieldsAreTheSame(password, retypePassword, invalidData);
    invalidData = _validateFieldsAreTheSame(answer, retypeAnswer, invalidData);

    if(invalidData.numberOfErrors > 0) {
      _showErrors(formElements.$globalMessage, invalidData);
      return false;
    }

    // if everything is valid submit the form
    $(this).trigger('form:post', [_ajaxDone.bind(this, formElements)]);
  };

  /*
   * Submit Security Information form
   */
  var onSubmitRadioButtonForm = function onSubmitRadioButtonForm() {

    var formElements = _getContextFormElements($(this));
    var formData = $(this).serializeArray();

    if(formData.length === 0) {
      console.log('must select a radio button');
      return false;
    }

    // if everything is valid submit the form
    $(this).trigger('form:post', [_ajaxDone.bind(this, formElements)]);
  };

  /*
   * Submit Loyalty Programs form
   */
  var onSubmitLoyaltyProgramsForm = function onSubmitLoyaltyProgramsForm() {

    var formElements = _getContextFormElements($(this));
    var formData = _parseInputs(formElements.$allInputs);

    // hide previous errors
    _hideErrors(formElements);

    var invalidData = _validateFormData(formData);

    if(invalidData.numberOfErrors > 0) {
      _showErrors(formElements.$globalMessage, invalidData);
      return false;
    }

    $(this).trigger('form:post', [_ajaxDone.bind(this, formElements)]);

    // empty the form
    $(this)[0].reset();
    $(this).find('select')[0].selectedIndex = 0;
    $(this).find('select').selectmenu('refresh');
    $(this).find('input').attr('data-val', '');
    
    window.setTimeout(function() {
      $('.ajax-delete').on('click', onRemoveLoyaltyProgram);
    }, 100);
  };

  /*
   * On remove loyalty programs
   */
  var onRemoveLoyaltyProgram = function onRemoveLoyaltyProgram(e) {

    // prevent from weird redirection to ajax html
    if(e && e.preventDefault) {
      e.preventDefault();
    }

    var $form = $(this).parents('form');
    var formElements = _getContextFormElements($form);
    _hideErrors(formElements);

    $(this).trigger('form:delete', [_ajaxDone.bind(this, formElements)]);
  };

  /*
   * On click for the save CTA in loyalty programs
   */
  var onDoneLoyaltyProgram = function onDoneLoyaltyProgram() {

    var $module = $(this).parents('.module');

    _toggleSection($module, false);
    _showGlobalMessage($module.find(config.moduleMessagesSelector), '[Confirmation Message Goes Here]', 'confirmation');
  };

  /*
   * Global on get success event.
   */
  var onGetSuccess = function onGetSuccess() {

    // Loyalty Programs
    var $loyaltyModule = $('.my-profile-loyalty-programs');

    if($loyaltyModule.length > 0) {
      var $editLink = $loyaltyModule.find('.profile-edit-link');
      var $loyaltyProgramsRows = $loyaltyModule.find('.my-profile-loyalty-programs-static-tbody tr');

      if($loyaltyProgramsRows.length > 0) {
        $editLink.text($loyaltyModule.data('edit'));
      }
      else {
        $editLink.text($loyaltyModule.data('add'));
      }
    }
  };

  /*
   * Cancel the edits, warn user if any modifications.
   */
  var cancelEdits = function cancelEdits(e) {

    var $clickedLink = $(e.currentTarget);
    var $module = $clickedLink.parents(config.moduleSelector);
    var $form = $module.find('form');
    var values = $form.serializeArray();
    var formIsModified = false;
    
    // Check if the form was modified.
    $.each(values, function(i, object) {
      if(object.value.length > 0) {
        formIsModified = true;
        return false;
      }
    });

    $('.module').each(function(){
      $(this).attr('aria-hidden','true');
    });

    $module.attr('aria-hidden','false');
    
    _toggleSection($module, false);
  };

  var accessibleRadioButtons = function accessibleRadioButtons() {

    var $this = $(this);
    var $inputs = $this.parents(config.radioButtonGroupSelector).find('input');

    $inputs.attr('aria-checked', 'false');
    $this.attr('aria-checked', 'true');
  };


  /*
   * Util function to toggle On or Off a section.
   */
  var _toggleSection = function _toggleSection($module, isEditable) {

    var $editLink = $module.find(config.editLinkSelector);
    var $staticContainer = $module.find(config.staticContainerSelector);
    var $editableContainer = $module.find(config.editableContainerSelector);
    var $errors = $module.find(config.formGroupErrorSelector);
    var $globalMessage = $module.find(config.moduleMessagesSelector);
    var $notes = $module.find('.my-profile-form-notes-required');
    var $firstInput = $module.find('p').eq(0);

    if(isEditable) {
      $editableContainer.css('display', 'block');
      $editableContainer.attr('aria-hidden', 'false');
      $staticContainer.eq(0).css('display', 'none');
      $staticContainer.eq(0).attr('aria-hidden', 'true');
      $editLink.css('display', 'none');

      if($notes.length > 0) {
        $notes.attr('tabindex', '-1');
        $notes.focus();
      }
      else {
        $firstInput.attr('tabindex', '-1');
        $firstInput.focus();
      }

      _hideGlobalMessage($globalMessage);
    }
    else {

      // Resets input if any value would've been entered.
      $module.find('form').trigger('reset');
      $module.find(':input').not(':button, :submit, :reset, :hidden, :checkbox, :radio').val('').removeClass('error');
      $module.find('select').val('').removeClass('error').selectmenu('refresh'); // resets select input and refresh jquery ui select
      $module.find(':checkbox, :radio').prop('checked', false).removeClass('error');
      $module.find('.my-profile-radio-button-group .my-profile-form-radio').eq(0).prop('checked', true); // select first radio button of a group
      $module.find('.my-profile-messages').removeClass('error confirmation');

      $notes.removeAttr('tabindex');

      $staticContainer.css('display', 'block');
      $staticContainer.attr('aria-hidden', 'false');

      $editLink.css('display', 'block');
      $editableContainer.css('display', 'none');
      $editableContainer.attr('aria-hidden', 'true');

      $errors.css('display', 'none');

      setTimeout(function() {
        $module.find('h2').attr('tabindex','-1');
        $module.find('h2').focus();
        $('.module').each(function(){
          $(this).attr('aria-hidden','false');
        });
      }, 1);
      
      _hideGlobalMessage($globalMessage);
    }

    $(window).trigger('resize');
  };

  /*
   * Get necessary DOM elements for saving a form
   */
  var _getContextFormElements = function _getContextFormElements($form) {

    var $module = $form.parents(config.moduleSelector);
    var $inputs = $form.find(':input').not(':button, :submit, :hidden, :reset, :checkbox, :radio');
    var $selects = $form.find('select');
    var $allInputs = $inputs.add($selects);

    // todo: Refactor return allInputs to inputs only.
    return {
      $module: $module,
      $errors: $form.find(config.formGroupErrorSelector),
      $globalMessage: $module.find(config.moduleMessagesSelector),
      $allInputs: $allInputs
    };
  };
  
  /*
   * Util function to parse a form a return a JSON representation of the inputs
   */
  var _parseInputs = function _parseInputs($inputs) {

    var formData = {};

    $.each($inputs, function(i, object) {

      var $object = $(object);
      var name = $object.attr('name');

      formData[name] = {};
      formData[name].name = name;
      formData[name].type = $object.attr('type') || $object.data('type') || 'select';
      formData[name].dataType = $object.data('type') || 'text';
      formData[name].value = $object.attr('data-val') || $object.val();
      formData[name].required = $object.prop('required');
    });

    return formData;
  };

  /*
   * Util function to check if fields is valid
   * Return: an array of invalid field name.
   */
  var _validateFormData = function _validateFormData(formData) {

    var invalidData = {
      numberOfErrors: 0,
      inputs: []
    };

    $.each(formData, function(i, data) {

      var dataType = data.dataType;

      if(data.required && data.value === '') {
        invalidData.numberOfErrors += 1;
        invalidData.inputs.push({
          "name": data.name,
          "errorType": "required"
        });
        return true;
      }

      if(dataType === 'email') {
        // regex email validation
        var emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/g;

        if(!emailRegex.test(data.value)) {
          invalidData.numberOfErrors += 1;
          invalidData.inputs.push({
            "name": data.name,
            "errorType": "invalid"
          });
          return true;
        }
      }

      // simply checks if strings contains only numbers, parenthesis or plus sign
      if(dataType === 'phone') {
        var phoneRegex = /^[0-9-+\s()]*$/;
        if(!phoneRegex.test(data.value)) {
          invalidData.numberOfErrors += 1;
          invalidData.inputs.push({
            "name": data.name,
            "errorType": "invalid"
          });
          return true;
        }
      }

      if(dataType === 'zip') {
        var zipRegex =/^[a-z0-9\-\ ]+$/i;
        if(!zipRegex.test(data.value)) {
          invalidData.numberOfErrors += 1;
          invalidData.inputs.push({
            "name": data.name,
            "errorType": "invalid"
          });
        }
      }
    });

    return invalidData;
  };

  /*
   * Util function to check two fields are the same
   * Return: the initial modified array of invalid values
   */
  var _validateFieldsAreTheSame = function _validateFieldsAreTheSame(field1, field2, invalidData) {

    if(field1.value !== '' || field2.value !== '') {

      if(field1.value !== field2.value) {

        var indexs = [];

        // Remove previous error with the same name
        for (var i = 0; i < invalidData.inputs.length; i++) {
          if (invalidData.inputs[i].name === field1.name || invalidData.inputs[i].name === field2.name) {
            indexs.push(i);
          }
        }

        for (var j = indexs.length - 1; j >= 0; j--) {
          invalidData.inputs.splice(indexs[j], 1);
        }

        // Adjust the number of errors based on the removed errors.
        invalidData.numberOfErrors = invalidData.numberOfErrors - indexs.length;

        // Add the new error.
        invalidData.inputs.push({
          "name": field1.name,
          "errorType": "not-matching"
        });

        invalidData.inputs.push({
          "name": field2.name,
          "errorType": "not-matching"
        });

        // Not matching only count as one errors.
        invalidData.numberOfErrors += 1;
      }
      
      // This is left comment out in case Michael decide that if 2 field are the same
      // but both are invalid counts only has 1 error.
      else {

        var sameButInvalid = [];

        for (var l = 0; l < invalidData.inputs.length; l++) {
          if (invalidData.inputs[l].name === field1.name || invalidData.inputs[l].name === field2.name) {
            sameButInvalid.push(invalidData.inputs[l]);
          }
        }

        if(sameButInvalid.length === 2) {
          invalidData.numberOfErrors -= 1;
        }
      }
    }

    return invalidData;
  };

  /*
   * Util function to show confirmation message of a module
   */
  var _showGlobalMessage = function _showGlobalMessage($globalMessage, message, stateClass) {
    $globalMessage.css('display', 'block');
    $globalMessage.text(message);
    $globalMessage.attr('tabindex', '-1');
    $globalMessage.focus();
    $globalMessage.addClass(stateClass);
  };

  /*
   * Util function to show errors of a form/module
   */
  var _showErrors = function _showErrors($globalMessage, invalidData) {

    $globalMessage.css('display', 'block');
    $globalMessage.addClass('error');
    
    var text = $.parseHTML($globalMessage.attr('data-error'));
    text[1].innerText = invalidData.numberOfErrors;
    $globalMessage.append(text);
    
    $globalMessage.attr('tabindex', '-1');
    $globalMessage.focus();

    $.each(invalidData.inputs, function(i, input) {
      var $error = $('#' + input.name + '-error');
      var $field = $('#' + input.name);
      var $formGroups = $error.parents('.my-profile-form-section').find('.form-group');
      var errorRowNumber = $error.parents('.form-group').index();

      if($(window).width() > 767) {
        $formGroups.each(function() {
          var styleAttr = $(this).attr('style');
          var formGroupRowNumber = $(this).index();
          if(errorRowNumber === formGroupRowNumber) {
            if(!styleAttr || styleAttr.indexOf('height') === -1) {
              $(this).css('height', $error.outerHeight(true) + $(this).outerHeight());
            }
          }
        });
      }

      $error.text($field.data(input.errorType));
      $field.addClass('error');
      $error.css('display', 'block');
    });
  };

  /*
   * Util function to hide errors
   */
  var _hideErrors = function _hideErrors(formElements) {
    formElements.$errors.css('display', 'none');
    formElements.$allInputs.removeClass('error');
    formElements.$module.find('.form-group').removeAttr('style');
    _hideGlobalMessage(formElements.$globalMessage);
  };

  /*
   * Util function to hide module messages
   */
  var _hideGlobalMessage = function _hideGlobalMessage($message) {
    $message.css('display', 'none');
    $message.text('');
    $message.removeClass('confirmation');
    $message.removeClass('error');
    $message.removeAttr('tabindex');
  };

  /*
   * Handle when the ajax is done
   */
  var _ajaxDone = function _ajaxDone(formElements, status, jsonRes, isDynamic) {

    if(status === 'success') {
      if(!isDynamic) {
        _toggleSection(formElements.$module, false);
      }

      _showGlobalMessage(formElements.$globalMessage, jsonRes.success, 'confirmation');

      var $ajaxDelete = $(config.ajaxDeleteSelector);
      $ajaxDelete.on('click', onRemoveLoyaltyProgram);

      initLists();
      $(window).trigger('resize');
    }

    if (status === 'error') {
      _hideGlobalMessage(formElements.$globalMessage);
      _showGlobalMessage(formElements.$globalMessage, jsonRes.error, 'error');
    }
  };

  /*
   * Unmask the data.
   */
  var _unmaskData =  function _unmaskData() {

    var $input = $(this);

    var unmaskValue = $input.attr('data-val') || '';

    if($input.attr('data-val')) {
      unmaskValue = unmaskValue.replace(/[\[\]]+/g, '');
    }

    unmaskValue = unmaskValue.trim();
    $input.val(unmaskValue);
  };

  /*
   * Mask the username input in security information.
   * Result should be
   *  - 1234
   *  - 12*45
   *  - 12*****89
   */
  var _maskUsername = function _maskUsername() {

    var $input = $(this);
    var enteredValue = $input.val().trim();
    var maskedValue = '';
    var numberOfStars = 0;

    $input.attr('data-val', enteredValue);

    // Don't mask if less than 5 char.
    if(enteredValue.length <= 2) {
      maskedValue = enteredValue;
    }
    else if(enteredValue.length > 2 && enteredValue.length < 5) {
      numberOfStars = enteredValue.length - 2;
      maskedValue = enteredValue.substr(0, 2) + new Array(numberOfStars + 1).join('*');
    }
    // Mask the middle char if string is 5 char long.
    else if(enteredValue.length === 5) {
      maskedValue = enteredValue.substr(0, 2) + '*' + enteredValue.substr(3, enteredValue.length);
    }
    // Keep the first and the last 2 char and add appropriate amount of stars.
    else {
      numberOfStars = enteredValue.length - 4;
      var beginning = enteredValue.substr(0, 2);
      var ending = enteredValue.substr(enteredValue.length - 2, enteredValue.length);
      var stars = new Array(numberOfStars + 1).join('*');
      maskedValue = beginning + stars + ending;
    }

    $input.val(maskedValue);
  };

  /*
   * Mask the email input in contact information.
   * Result should be
   *  - a@citi.com
   *  - a*@citi.com
   *  - a**@ citi.com
   *  - a**3@citi.com
   *  - a*****3@citi.com
   */
  var _maskEmail = function _maskEmail() {

    var $input = $(this);
    var maskedValue = '';
    var enteredValue = {
      complete: $input.val().trim(),
      local: '',
      domain: ''
    };

    $input.attr('data-val', enteredValue.complete);

    var atChar = enteredValue.complete.indexOf('@');
    enteredValue.local = enteredValue.complete.substr('0', atChar);
    enteredValue.domain = enteredValue.complete.substr(atChar, enteredValue.complete.length);


    var firstChar = enteredValue.local.substr(0, 1);
    var lastChar = enteredValue.local.substr(atChar - 1, atChar);
    var stars = null;

    // Don't mask for 1 char
    if (enteredValue.local.length <= 1) {
      maskedValue = enteredValue.complete;
    }
    // For 2 and 3 char, leave the first char unmask
    else if (enteredValue.local.length <= 3) {
      stars = new Array(enteredValue.local.length).join('*');
      maskedValue = firstChar + stars + enteredValue.domain;
    }
    // Leave first and last local char unmask, mask the rest of the local part.
    else if (enteredValue.local.length >= 4) {
      stars = new Array(enteredValue.local.length - 1).join('*');
      maskedValue = firstChar + stars + lastChar + enteredValue.domain;
    }

    $input.val(maskedValue);
  };

  /*
   * Mask the phone number in contact information
   * Result should be
   * - ***-***-1111
   * - (***) *** - 1111
   * - ***1111
   * - ******1111
   * - 1111
   * - *1111
   */
  var _maskPhoneNumber = function _maskPhoneNumber() {

    var $input = $(this);
    var replaceRegex = /([0-9a-zA-Z])/g;
    var enteredValue = {
      complete: $input.val().trim(),
      beginning: '',
      ending: ''
    };

    var maskedValue = enteredValue.complete;
    $input.attr('data-val', enteredValue.complete);

    if(enteredValue.complete.length > 4) {
      enteredValue.beginning = enteredValue.complete.substr(0, enteredValue.complete.length - 4);
      enteredValue.ending = enteredValue.complete.substr(enteredValue.complete.length - 4, enteredValue.complete.length);
      maskedValue = enteredValue.beginning.replace(replaceRegex, '*') + enteredValue.ending;
    }

    $input.val(maskedValue);
  };

  /*
   * Mask the loyalty program number
   * Result should be
   * - **********ABCD
   * - ***ABCD
   * - ABCD
   */
  var _maskLoyaltyProgramNumber = function _maskLoyaltyProgramNumber() {

    var $input = $(this);
    var enteredValue = {
      complete: $input.val(),
      beginning: '',
      ending: ''
    };

    $input.attr('data-val', enteredValue.complete);

    if(enteredValue.complete.length > 4) {
      enteredValue.beginning = enteredValue.complete.substr(0, enteredValue.complete.length - 4);
      enteredValue.ending = enteredValue.complete.substr(enteredValue.complete.length - 4, enteredValue.complete.length);
      $input.val(new Array(enteredValue.beginning.length + 1).join('*') + enteredValue.ending);
    }
  };

  /*
   * Init the accessible list
   */
  var initLists = function initLists() {

    $('.profile-contact-information-list').each(function() {
      var list = citiShare.accessibleMultiColumnList(this, 3);
      list.init();
      config.contactInformationLists.push(list);
    });

    citiShare.accessibleMultiColumnList('.profile-security-information-list', 3).init();
  };

  /*
   * Add functionality to the select so they open when pressing enter
   */
  var onEnterSelect = function onEnterSelect(e) {

    if(e.which === 13) {

      var $this = $(this);
      var select = $this.prev('select');

      if($(this).attr('aria-expanded') === 'false') {

        select.selectmenu('open');

        // Unbind event and rebind on close.
        // This is done because the behavior on the enter key when the dropdown
        // is open is already taken care by the plugin.
        $this.off('keydown.enter');
        select.on('selectmenuclose', function() {
          $this.on('keydown.enter', onEnterSelect);
        });
      }
    }
  };

  /*
   * Init the citiShare.profile code.
   * Basically bind all necessary events.
   */
  var init = function init () {

    // Toggling section functionality
    config.$editLinks.click(editSection);
    config.$cancelLinks.click(cancelEdits);

    // Submit events
    config.$accountSelectionForm.on('submit', onSubmitAccountSelection);
    config.$contactInformationForm.on('submit', onSubmitContactInformation);
    config.$securityInformationForm.on('submit', onSubmitSecurityInformation);
    config.$emailSettingsForm.on('submit', onSubmitRadioButtonForm);
    config.$legalNoticesForm.on('submit', onSubmitRadioButtonForm);
    config.$loyaltyProgramsForm.on('submit', onSubmitLoyaltyProgramsForm);
    config.$loyaltyProgramsDoneButton.on('click', onDoneLoyaltyProgram);

    // prevent form submission on enter
    $('.my-profile form').on('keypress', function(e) {
      return e.which !== 13;
    });

    // allow form submission on submit button enter
    $('.my-profile form input[type=submit]').on('keypress', function(e) {
      if(e.which === 13) {
        $(this).parents('form').trigger('submit');
      }
    });

    $(config.ajaxDeleteSelector).on('click', onRemoveLoyaltyProgram);

    // Security answer show/hide text functionality
    config.$securityInformationMaskedInput.focus(function() {
      $(this).attr('type', 'text');
    });

    config.$securityInformationMaskedInput.blur(function() {
      $(this).attr('type', 'password');
    });

    config.$securityInformationUsername.focus(_unmaskData);
    config.$securityInformationUsername.blur(_maskUsername);

    config.$contactInformationEmailInput.focus(_unmaskData);
    config.$contactInformationEmailInput.blur(_maskEmail);

    config.$contactInformationPhonesInput.focus(_unmaskData);
    config.$contactInformationPhonesInput.blur(_maskPhoneNumber);

    config.$loyaltyProgramsNumberInput.focus(_unmaskData);
    config.$loyaltyProgramsNumberInput.blur(_maskLoyaltyProgramNumber);

    // Accessible radio buttons
    $(config.radioButtonGroupSelector + ' input').on('click', accessibleRadioButtons);

    // Add open on enter for select menu
    $('.dropdown').find('.ui-selectmenu-button').on('keydown.enter', onEnterSelect);
    $('.dropdown select').selectmenu('refresh');

    // On ajax get success.
    $(document).on('get.success', onGetSuccess);

    // Accessible lists.
    initLists();
  };

  if($('.my-profile').length > 0) {
    init();
  }

})();

/*jshint debug:true */

citiShare.quickView = (function () {
  'use strict';

  /**
   *
   */
  function openDrawer() {

    // shift focus to quickview and lock the keyboard user in
    $(".js-product-detail-module").on('keydown', function (event) {
      citiShare.util.trapTabKey($('.js-product-detail-module'), event);
      citiShare.util.trapEscapeKey($('.js-product-detail-module'), event);
    });

    $('.js-product-list-placeholder').on("click", ".quickview-label", function () {

      // Items per row
      var productId = $(this).closest('.product-list-item').data('product-id');


      // Clean up any active drawer
      // TODO: Show when ajax is done :
      $('.product-detail.quick-view').removeClass('is-active');
      closeDrawer($(this));

      // Add "active" class to parent div
      $(this).parent().addClass("active");


      // TODO: Insert ajax here
      $('.js-product-detail-module').empty();
      citiShare.getProductDetailItem($('.js-product-detail-module'), '#js-product-detail-template', window.json, productId, initQuickviewModal.bind($(this)));

      lockQuickViewToPlaceholder();


    });

  }

  function initQuickviewModal() {
    /* jshint validthis: true */
    // forcing jshint to validate use of 'this' keyword within this function
    // because we need to maintain scope as we're passing this as a callback
    // to citiShare.getProductDetailItem

    // Items per row
    var $quickViewButton = $(this),
      perRow = 3,
      currentContainerIndex = $quickViewButton.closest('.product-list-item').index('.product-list-item') + 1,
      currentRowEndIndex = findNextRowBreak(currentContainerIndex, perRow) - 1;

    // Check for filter height
    var filterHeight = $(".filter-sticky-wrapper").outerHeight();

    citiShare.createZoom();
    citiShare.createTabs();
    citiShare.createTooltips();
    citiShare.createButtonSets();
    citiShare.selectMenuForElement();
    citiShare.numericStepperSetup();

    $('.js-product-detail-module-placeholder')
      .show()
      .insertAfter($(".quickview-enable").eq(currentRowEndIndex).closest('.product-list-item'))
      .animate({height: 450}, 500);

    $('.product-detail.quick-view').addClass('is-active');

    $('html, body').animate({
      scrollTop: $('.js-product-detail-module-placeholder').offset().top - filterHeight + Number($('.js-product-detail-module-placeholder').css('margin-top').replace('px', ''))
    }, 1000, function () {

      $(".js-product-detail-module-placeholder").height($('.js-product-detail-module').height());

      $('.js-product-detail-module').css({
        top: $(".js-product-detail-module-placeholder").offset().top - filterHeight + Number($('.js-product-detail-module-placeholder').css('margin-top').replace('px', ''))
      });

      $('.js-product-detail-module .js-product-title').focus();

      $('#oc-container, .live-chat-wrapper').attr('aria-hidden', 'true');

      $('.js-product-detail-module').on("click", ".modal-close-button", function () {
        closeDrawer($quickViewButton);
      });

      $(window).trigger('scroll');

    });

    $('#oc-container').click(function () {
      // if the quickview container is not empty, close the drawer when clicking on #oc-container
      if ($('.js-product-detail-module:visible')[0].hasChildNodes()) {
        closeDrawer($quickViewButton);
      }
    });

    $(window).on('scroll', function () {
      lockQuickViewToPlaceholder();
    });

    citiShare.tooltip.refresh();
  }


  // visually attach quickview container to quickview placeholder
  function lockQuickViewToPlaceholder() {
    $('.js-product-detail-module').css({
      top: $(".js-product-detail-module-placeholder").offset().top - $(document).scrollTop(),
      left: $(".js-product-detail-module-placeholder").offset().left
    });
  }

  /**
   * Reposition quickview panel on windows resize
   */
  function positionQuickViewWindowResize() {
    $(window).resize(function () {
      lockQuickViewToPlaceholder();
    });
  }

  /**
   * Close drawer
   */
  function closeDrawer($quickViewButton) {
    $('.product-detail.quick-view').removeClass('is-active');
    $('.js-product-detail-module').empty();
    $('.js-product-detail-module-placeholder').hide();
    $('#oc-container, .live-chat-wrapper').attr('aria-hidden', 'false');
    window.setTimeout(function () {
      if ($quickViewButton !== undefined) {
        $quickViewButton.focus();
      }
    }, 500);
  }


  /**
   * Close drawer on window resize
   */
  function closeDrawerWindowResize() {
    $(window).resize(function () {
      var windowWidth = window.innerWidth || $(window).width();
      if (windowWidth < 960) {
        closeDrawer();
      }
    });
  }

  /**
   * Trigger click event key enter
   */
  function addKeyboardEnterKey() {
    $(document).on("keydown", function (e) {
      if (e.keyCode === 13) {
        $(this).click();
      }
    });
  }

  /**
   * Find the next closest row break for injecting the quickview template
   * @param currentContainerIndex
   * @param itemsPerRow
   * @returns {number} Index number of the next row break
   */
  function findNextRowBreak(currentContainerIndex, itemsPerRow) {

    var nextRowBreakIndex;

    //First row
    if (currentContainerIndex <= itemsPerRow) {
      // need to check to see if we even have itemsPerRow number of products
      if ($('.product-list-item').length > itemsPerRow) {
        nextRowBreakIndex = itemsPerRow;
      } else {
        nextRowBreakIndex = $('.product-list-item').length;
      }
    }
    else {
      if (currentContainerIndex % itemsPerRow === 0) {
        nextRowBreakIndex = currentContainerIndex;
      }
      else {
        nextRowBreakIndex = (itemsPerRow - currentContainerIndex % itemsPerRow) + currentContainerIndex;
      }
    }
    return nextRowBreakIndex;
  }

  if ($('.js-product-detail-module').length > 0) {
    // TODO: Re-write this so that it happens automagically.
    ['buttonset-component', 'submit-button-component', 'tooltip-component', 'dropdown-component', 'numeric-stepper-component'].forEach(function (template) {
      citiShare.util.getHandlebarPartials(template);
    });

    openDrawer();
    closeDrawerWindowResize();
    addKeyboardEnterKey();
    positionQuickViewWindowResize();
  }

  return {
    addKeyboardEnterKey: addKeyboardEnterKey,
    closeDrawerWindowResize: closeDrawerWindowResize,
    lockQuickViewToPlaceholder: lockQuickViewToPlaceholder,
    openDrawer: openDrawer,
    positionQuickViewWindowResize: positionQuickViewWindowResize
  };
})();

citiShare.reinstateCurrency = (function () {

  "use strict";

  var config = {
    $container: $(".reinstate-points-container"),
  };

  var setupCheckboxes = function setupCheckboxes() {
    config.$container.on("keypress", "input[type=checkbox]", function (event) {
      if (event.which === 13) {
        event.preventDefault();
        $(this).prop("checked", !$(this).prop("checked"));
        $(this).trigger("change");
      }
    });

    config.$container.on("change", "input[type=checkbox]", function () {
      var $options = config.$container.find("input[type=checkbox]"),
        enableSubmit = false;

      $options.each(function () {
        if ($(this).is(':checked')) {
          enableSubmit = true;
        }
      });

      if (enableSubmit) {
        config.$container.find("input[type=submit]").removeAttr("disabled");
      } else {
        config.$container.find("input[type=submit]").get(0).disabled = true;
      }
    });
  };

  var init = function init() {
    setupCheckboxes();
    config.$container.on("click", "input[type=submit]", function (event) {
      event.preventDefault();
      config.$container.find("form").trigger("form:reinstate");
    });
  };

  if ($('.my-profile')) {
    init();
  }

})();
citiShare.search = (function() {
    'use strict';

    var templatePartials = [
        {
            dataProperty: 'travelResults',
            template: 'travel-results-header'
        },
        {
            dataProperty: 'suggestionTerms',
            template: 'search-suggestions'
        },
        {
            dataProperty: 'shopWithPoints',
            template: 'shop-with-points-result'
        },
        {
            dataProperty: 'tabs',
            template: 'filter-tabs'
        }
    ];

    var templates = [];

    templatePartials.forEach(function(partialData) {
        templates.push(partialData.template);
    });

    function showSearchResults(){

    	$.ajax({
    		url: window.citiConfig.endPointHost + window.citiConfig.searchResultsEndPointPath + window.searchEndpoint,
    		type: 'GET',
    		dataType: 'json'
    	})
    	.done(function(data) {
            var $contentWrapper = $('.js-search-page-header-content-wrapper');

            templatePartials.forEach(function(partial){
                if(data.hasOwnProperty(partial.dataProperty)) {
                    $contentWrapper.append(citiShare.util.renderTemplate(window.Handlebars.partials[partial.template], data));

                    if(partial.dataProperty === 'tabs') {
                        //needed for variant where travel results + tabs are displayed together
                        $contentWrapper.addClass('js-search-page-header-content-wrapper--has-tabs');
                        $(window).trigger(citiShare.filterTabs.Events.RENDERED);
                    }
                }
            });

    	})
    	.fail(function() {
    		console.log("error");
    	})
    	.always(function() {
    		console.log("complete");
    	});

    }


    // TODO: Re-write this so that it happens automagically.
    function defineSearchPartials(){
		templates.forEach(function(template){
	        citiShare.util.getHandlebarPartials(template);
	    });
    }


	if($('.js-search-page-header-content-wrapper').length > 0){
        defineSearchPartials();
		showSearchResults();
    }

    return {
        defineSearchPartials: defineSearchPartials
    };
})();

/**
 * @fileoverview Line clamper item for CitiBank.
 * @author Nathan Buchar
 */

'use strict';

/**
 * Clamp.js 0.7.0
 *
 * Copyright 2011-2013, Joseph Schmitt http://joe.sh
 * Released under the WTFPL license
 * http://sam.zoy.org/wtfpl/
 */
function $clamp(element, options) {
  options = options || {};

  var win = window,
    opt = {
      clamp: options.clamp || 2,
      useNativeClamp: typeof(options.useNativeClamp) !== 'undefined' ? options.useNativeClamp : true,
      splitOnChars: options.splitOnChars || ['.', '-', '', '', ' '], //Split on sentences (periods), hypens, en-dashes, em-dashes, and words (spaces).
      animate: options.animate || false,
      truncationChar: options.truncationChar || '&#8230;',
      truncationHTML: options.truncationHTML
    },

    sty = element.style,
    originalText = element.innerHTML,

    supportsNativeClamp = typeof(element.style.webkitLineClamp) !== 'undefined',
    clampValue = opt.clamp,
    isCSSValue = clampValue.indexOf && (clampValue.indexOf('px') > -1 || clampValue.indexOf('em') > -1),
    truncationHTMLContainer;

  if (opt.truncationHTML) {
    truncationHTMLContainer = document.createElement('span');
    truncationHTMLContainer.innerHTML = opt.truncationHTML;
  }


  // UTILITY FUNCTIONS __________________________________________________________

  /**
   * Return the current style for an element.
   * @param {HTMLElement} elem The element to compute.
   * @param {string} prop The style property.
   * @returns {number}
   */
  function computeStyle(elem, prop) {
    if (!win.getComputedStyle) {
      win.getComputedStyle = function(el) {
        this.el = el;
        this.getPropertyValue = function(prop) {
          var re = /(\-([a-z]){1})/g;
          if (prop === 'float') {
            prop = 'styleFloat';
          }
          if (re.test(prop)) {
            prop = prop.replace(re, function() {
              return arguments[2].toUpperCase();
            });
          }
          return el.currentStyle && el.currentStyle[prop] ? el.currentStyle[prop] : null;
        };
        return this;
      };
    }

    return win.getComputedStyle(elem, null).getPropertyValue(prop);
  }

  /**
   * Returns the maximum number of lines of text that should be rendered based
   * on the current height of the element and the line-height of the text.
   */
  function getMaxLines(height) {
    var availHeight = height || element.clientHeight,
      lineHeight = getLineHeight(element);

    return Math.max(Math.floor(availHeight / lineHeight), 0);
  }

  /**
   * Returns the maximum height a given element should have based on the line-
   * height of the text and the given clamp value.
   */
  function getMaxHeight(clmp) {
    var lineHeight = getLineHeight(element);
    return lineHeight * clmp;
  }

  /**
   * Returns the line-height of an element as an integer.
   */
  function getLineHeight(elem) {
    var lh = computeStyle(elem, 'line-height');
    if (lh === 'normal') {
      // Normal line heights vary from browser to browser. The spec recommends
      // a value between 1.0 and 1.2 of the font size. Using 1.1 to split the diff.
      lh = parseInt(computeStyle(elem, 'font-size')) * 1.2;
    }
    return parseInt(lh);
  }


  // MEAT AND POTATOES (MMMM, POTATOES...) ______________________________________
  var splitOnChars = opt.splitOnChars.slice(0),
    splitChar = splitOnChars[0],
    chunks,
    lastChunk;

  /**
   * Gets an element's last child. That may be another node or a node's contents.
   */
  function getLastChild(elem) {
    //Current element has children, need to go deeper and get last child as a text node
    if (elem.lastChild.children && elem.lastChild.children.length > 0) {
      return getLastChild(Array.prototype.slice.call(elem.children).pop());
    }
    //This is the absolute last child, a text node, but something's wrong with it. Remove it and keep trying
    else if (!elem.lastChild || !elem.lastChild.nodeValue || elem.lastChild.nodeValue === '' || elem.lastChild.nodeValue === opt.truncationChar) {
      elem.lastChild.parentNode.removeChild(elem.lastChild);
      return getLastChild(element);
    }
    //This is the last child we want, return it
    else {
      return elem.lastChild;
    }
  }

  /**
   * Removes one character at a time from the text until its width or
   * height is beneath the passed-in max param.
   */
  function truncate(target, maxHeight) {
    if (!maxHeight) {
      return;
    }

    /**
     * Resets global variables.
     */
    function reset() {
      splitOnChars = opt.splitOnChars.slice(0);
      splitChar = splitOnChars[0];
      chunks = null;
      lastChunk = null;
    }

    var nodeValue = target.nodeValue.replace(opt.truncationChar, '');

    //Grab the next chunks
    if (!chunks) {
      //If there are more characters to try, grab the next one
      if (splitOnChars.length > 0) {
        splitChar = splitOnChars.shift();
      }
      //No characters to chunk by. Go character-by-character
      else {
        splitChar = '';
      }

      chunks = nodeValue.split(splitChar);
    }

    //If there are chunks left to remove, remove the last one and see if
    // the nodeValue fits.
    if (chunks.length > 1) {
      lastChunk = chunks.pop();
      applyEllipsis(target, chunks.join(splitChar));
    }
    //No more chunks can be removed using this character
    else {
      chunks = null;
    }

    //Insert the custom HTML before the truncation character
    if (truncationHTMLContainer) {
        target.nodeValue = target.nodeValue.replace(opt.truncationChar, '');
        element.innerHTML = target.nodeValue + opt.truncationChar + ' ' + truncationHTMLContainer.innerHTML ;
    }

    //Search produced valid chunks
    if (chunks) {
      //It fits
      if (element.clientHeight <= maxHeight) {
        //There's still more characters to try splitting on, not quite done yet
        if (splitOnChars.length >= 0 && splitChar !== '') {
          applyEllipsis(target, chunks.join(splitChar) + splitChar + lastChunk);
          chunks = null;
        }
        //Finished!
        else {
          return element.innerHTML;
        }
      }
    }
    //No valid chunks produced
    else {
      //No valid chunks even when splitting by letter, time to move
      //on to the next node
      if (splitChar === '') {
        applyEllipsis(target, '');
        target = getLastChild(element);

        reset();
      }
    }

    //If you get here it means still too big, let's keep truncating
    if (opt.animate) {
      setTimeout(function() {
        truncate(target, maxHeight);
      }, opt.animate === true ? 10 : opt.animate);
    } else {
      return truncate(target, maxHeight);
    }
  }

  function applyEllipsis(elem, str) {
    elem.nodeValue = str + opt.truncationChar;
  }


  // CONSTRUCTOR ________________________________________________________________

  if (clampValue === 'auto') {
    clampValue = getMaxLines();
  } else if (isCSSValue) {
    clampValue = getMaxLines(parseInt(clampValue));
  }

  var clampedText;
  if (supportsNativeClamp && opt.useNativeClamp) {
    sty.overflow = 'hidden';
    sty.textOverflow = 'ellipsis';
    sty.webkitBoxOrient = 'vertical';
    sty.display = '-webkit-box';
    sty.webkitLineClamp = clampValue;

    if (isCSSValue) {
      sty.height = opt.clamp + 'px';
    }
  } else {
    var height = getMaxHeight(clampValue);
    if (height < element.clientHeight) {
      clampedText = truncate(getLastChild(element), height);
    }
  }

  return {
    'original': originalText,
    'clamped': clampedText
  };
}

/**
 * SeeMoreItem
 */
var SeeMoreItem = function (element, options) {

  /**
   * The base element for this item.
   *
   * @type {HTMLElement}
   * @private
   */
  this._element = element;

  /**
   * The clamp options.
   *
   * @type {Object}
   * @private
   */
  this._options = options;

  /**
   * The clamp Object.
   *
   * @type {Object}
   * @default null
   * @private
   */
  this._clamp = null;

  /**
   * The see more button.
   *
   * @type {HTMLElement}
   * @default null
   * @private
   */
  this._seeMoreButton = null;
  
  /**
   * The see less button.
   *
   * @type {HTMLElement}
   * @default null
   * @private
   */
  this._seeLessButton = null;

  /**
   * Called when "see more" is pressed and delegates to the appropriate method
   * with the proper lexical scope.
   *
   * @type {Object}
   * @private
   */
  this._onSeeMoreClick = this._handleSeeMoreClick.bind(this);
  
  /**
   * Called when "see less" is pressed and delegates to the appropriate method
   * with the proper lexical scope.
   *
   * @type {Object}
   * @private
   */
  this._onSeeLessClick = this._handleSeeLessClick.bind(this);

  this._init();
};

/**
 * Initializes the SeeMoreItem instance.
 *
 * @private
 */
SeeMoreItem.prototype._init = function () {
  this._stripTags();
  this._clampItem();
};

/**
 * Strip tags from the content. $clamp will not work as intended if there's more
 * than one child per target node.
 *
 * @private
 */
SeeMoreItem.prototype._stripTags = function () {
  this._element.textContent = this._element.innerHTML.replace(/(<([^>]+)>)/ig, '');
};

/**
 * Re-clamps the SeeMoreItem instance. This is destructive.
 *
 * @private
 */
SeeMoreItem.prototype._update = function () {
  this._clampItem();
};

/**
 * Clamps the SeeMoreItem instance.
 *
 * @private
 */
SeeMoreItem.prototype._clampItem = function () {
  this._resetSeeMoreButton();

  this._clamp = $clamp(this._element, {
    clamp: this._options.numLines,
    useNativeClamp: false,
    splitOnChars: ['.', '-', '', '', ' '],
    truncationChar: '&#8230;',
    truncationHTML: SeeMoreItem.TruncationHTML,
    animate: false
  });

  this._registerSeeMoreButton();
};

/**
 * Caches a reference to the see more button pointer and adds a click event
 * listener.
 *
 * @private
 */
SeeMoreItem.prototype._registerSeeMoreButton = function () {
  this._seeMoreButton = this._element.querySelector(SeeMoreItem.Selectors.BUTTON_MORE);

  if (this._seeMoreButton) {
    this._seeMoreButton.addEventListener('click', this._onSeeMoreClick);
  }
};

SeeMoreItem.prototype._registerSeeLessButton = function () {
  this._seeLessButton = this._element.querySelector(SeeMoreItem.Selectors.BUTTON_LESS);

  if (this._seeLessButton) {
    this._seeLessButton.addEventListener('click', this._onSeeLessClick);
  }
};

/**
 * Called when the "see more" button is pressed.
 *
 * @param {Event} evt
 * @private
 */
SeeMoreItem.prototype._handleSeeMoreClick = function (evt) {
  evt.preventDefault();

  this._element.innerHTML = this._clamp.original + ' ' + SeeMoreItem.ReverseTruncationHTML;
  this._resetSeeMoreButton();
  this._registerSeeLessButton();
};

/**
 * Called when the "see less" button is pressed.
 *
 * @param {Event} evt
 * @private
 */
SeeMoreItem.prototype._handleSeeLessClick = function (evt) {
  evt.preventDefault();

  this._element.innerHTML = this._clamp.clamped;
  this._resetSeeLessButton();
  this._registerSeeMoreButton();
};

/**
 * Resets the "see more" button by removing the event listener and setting the
 * internal pointer to null. This assumes that the "see more" button has been
 * destroyed after being clicked.
 *
 * @private
 */
SeeMoreItem.prototype._resetSeeMoreButton = function () {
  if (this._seeMoreButton !== null) {
    this._seeMoreButton.removeEventListener('click', this._onSeeMoreClick);
    this._seeMoreButton = null;
  }
};

/**
 * Resets the "see less" button by removing the event listener and setting the
 * internal pointer to null. This assumes that the "see less" button has been
 * destroyed after being clicked.
 *
 * @private
 */
SeeMoreItem.prototype._resetSeeLessButton = function () {
  if (this._seeLessButton !== null) {
    this._seeLessButton.removeEventListener('click', this._onSeeLessClick);
    this._seeLessButton = null;
  }
};


/**
 * The see more button HTML.
 *
 * @readonly
 */
SeeMoreItem.TruncationHTML =
  '<a class="see-more-button" href="#" style="font: inherit;" title="See More">Show More +</a>';

SeeMoreItem.ReverseTruncationHTML =
  '<a class="see-less-button" href="#" style="font: inherit;" title="See Less">Show Less -</a>';

/**
 * Related Selectors for SeeMoreItem.
 *
 * @enum {string}
 * @readonly
 */
SeeMoreItem.Selectors = {
  BUTTON_MORE : '.see-more-button',
  BUTTON_LESS : '.see-less-button'
};

citiShare.clampItem = SeeMoreItem;

/**
 * @fileoverview "See More" for CitiBank.
 * @author Nathan Buchar <nathan@odopod.com>
 */

'use strict';

var SeeMore = {

  /**
   * All added "see more" items.
   *
   * @type {SeeMoreItem[]}
   * @private
   */
  _items: [],

  /**
   * Updates all added SeeMore items.
   *
   * @access public
   */
  update: function () {
    this._items.forEach(function (item) {
      item._update();
    });
  },

  /**
   * Registers the given elements with our instance.
   *
   * @param {HTMLElement[]} elements
   * @param {Object} options
   * @returns {SeeMoreIrem[]}
   * @access public
   */
  add: function (elements, options) {
    return elements.map(function (element) {
      var item = new citiShare.clampItem(element, options);

      this._items.push(item);

      return item;
    }.bind(this));
  },

  /**
   * Initializes all clamped elements within the given context (or the document
   * body if no context is specified).
   *
   * @param {Object} [options]
   * @param {Object} [context=document.body]
   * @returns {SeeMoreIrem[]}
   * @access public
   */
  initializeAll: function (options, context) {
    var ctx = context || document.body;
    var opts = $.extend({}, SeeMore.Defaults, options || {});
    var elements = ctx.querySelectorAll(SeeMore.Selectors.BASE);

    return SeeMore.add(SeeMore.toArray(elements), opts);
  }
};

/**
 * Static helper that will convert a NodeList into a proper Array.
 *
 * @param {NodeList} nodeList
 * @returns {HTMLElement[]}
 * @static
 */
SeeMore.toArray = function (nodeList) {
  return Array.prototype.slice.call(nodeList);
};

/**
 * Related class names for SeeMore.
 *
 * @enum {string}
 * @readonly
 */
SeeMore.ClassNames = {
  BASE: 'see-more'
};

/**
 * Related Selectors for SeeMore.
 *
 * @enum {string}
 * @readonly
 */
SeeMore.Selectors = {
  BASE: '.see-more'
};

/**
 * @enum {mixed} Defaults
 * @readonly
 */
SeeMore.Defaults = {
  numLines: 5
};

/**
 * CitiBank SeeMore public API.
 *
 * @enum {Object}
 * @readonly
 */
citiShare.seeMore = {
  initAll: SeeMore.initializeAll,
  update: SeeMore.update
};

citiShare.seeMore.initAll();

citiShare.showMore = (function () {
  'use strict';

  function checkStartString(string, stringToFind) {
    return string.indexOf(stringToFind, 0) === 0;
  }

  function checkEndString(string, searchString) {
    var subjectString = string,
      position = subjectString.length;
    position -= searchString.length;
    var lastIndex = subjectString.lastIndexOf(searchString, position);
    return lastIndex !== -1 && lastIndex === position;
  }

  var config = {
    $showMoreComponent: $('.show-more-component'),
    minCopyLength: 160
  };

  function _initShowMore() {
    $.each(config.$showMoreComponent, function () {
      var $this = $(this),
        textSelector = $this.siblings(".message-more");
      $this.data("more", truncate(textSelector));
      $this.data("less", textSelector.html());


      if (textSelector.html().replace(/<!--[\s\S]*?-->/g, "").trim().length > config.minCopyLength) {
        $this.show();
        $this.addClass("open");
        detectTrunc($this, textSelector);
        $this.on('click', function (e) {
          e.preventDefault();
          e.stopPropagation();
          detectTrunc($this, textSelector);
        });
      }
    });
  }

  function detectTrunc(link, selector) {
    if (link.hasClass('open')) {
      link.removeClass('open');
      selector.html(link.data("more"));
      link.html(link.data("more-action"));
      link.attr("aria-expanded", "false");
    } else {
      link.addClass('open');
      selector.html(link.data("less"));
      link.html(link.data("less-action"));
      link.attr("aria-expanded", "true");
    }
    checkColumnHeight(selector.parents("ul"));
  }

  function checkColumnHeight(list) {
    var heightToUpdate = 0;
    $.each(list.find(".my-account-accessible-list-column1"), function () {
      heightToUpdate += $(this).outerHeight(true);
    });
    list.css("height", heightToUpdate);
    list.find(".reset1").css("margin-top", heightToUpdate * -1);
  }

  function _resetHeights() {
    $.each(config.$showMoreComponent, function () {
      checkColumnHeight($(this).parents("ul"));
    });
  }

  function truncate(selector) {
    var truncatedText = selector.html(),
      truncatedTextTrimmed = truncatedText.replace(/<!--[\s\S]*?-->/g, "").trim();

    truncatedText = truncatedTextTrimmed.substring(0, config.minCopyLength) + '...';
    if (checkStartString(selector.html().trim(), "<!-- Data Start -->")) {
      truncatedText = "<!-- Data Start -->" + truncatedText;
    }
    if (truncatedTextTrimmed.slice(-1) === "]") {
      truncatedText += "]";
    }
    if (checkEndString(selector.html().trim(), "<!--- Data End ---->")) {
      truncatedText = truncatedText + "<!--- Data End ---->";
    }
    return truncatedText;
  }

  setTimeout(function () {
    _initShowMore();
  }, 300);

  return {
    resetHeights: _resetHeights
  };

})();

'use strict';

var Tabs = function(element) {
  /**
   * Base element
   * @type {Element}
   */
  this._element = element;

  /**
   * Base element
   * @type {jQuery}
   */
  this.$el = $(element);

  /**
   * Filter tabs
   * @type {jQuery}
   */
  this._$tabs = $('.' + Tabs.ClassName.TABS);

  /**
   * Filter tabs
   * @type {Array}
   */
  this._tabs = Tabs.toArray(this._$tabs);

  /**
   * Tab panes
   * @type {Array}
   */
  this._panes = this._tabs.map(function(tab) {
    return document.querySelector('.tabs-pane[data-for="'+ tab.getAttribute('data-id') +'"]');
  });

  this._clickListener = this._handleClickEvent.bind(this);
  this._keydownListener = this._handleKeyPress.bind(this);
  this._activeTab = null;
  this.tabId = '';

  this._init();
};

Tabs.toArray = function(arrayLike) {
  return Array.prototype.slice.call(arrayLike);
};

/**
 * Initializes the Tabs component
 */
Tabs.prototype._init = function() {
  this._processTabs();
  this._bindEvents();

  //hard-coded first value
  this.setActiveTab(this._$tabs.eq(0)[0]);
};

Tabs.prototype.setActiveTab = function(tab) {
  this._$tabs.removeClass(Tabs.ClassName.ACTIVE_TAB);
  this._$tabs.attr('aria-selected', 'false');
  this._activeTab = tab;
  $(this._activeTab).addClass(Tabs.ClassName.ACTIVE_TAB);
  $(this._activeTab).attr('aria-selected', 'true');
  this.tabId = this._activeTab.getAttribute('data-id');
  this._showPane();
};

/**
 * Adds aria states for screen readers
 */
Tabs.prototype._processTabs = function() {
  this.$el.attr('role', 'tablist');

  this._$tabs.attr({
    role: 'tab',
    tabIndex: 0
  });

  this._panes.forEach(function(el) {
    el.setAttribute('aria-hidden', true);
  });
};

/**
 * Binds window, click, and keypress events to tabs
 */

Tabs.prototype._bindEvents = function() {
  $(window).on('resize.tabs orientationchange.tabs', this._resizeListener);
  this._$tabs.on('click.tabs', this._clickListener);
  this._$tabs.on('keydown.tabs', this._keydownListener);
};

/**
 * Registers the active tab
 * @param {Event} jQuery Event
 */
Tabs.prototype._handleClickEvent = function(e) {
  e.preventDefault();

  if (this._activeTab !== e.currentTarget) {
    this.setActiveTab(e.currentTarget);
  }
};

/**
 * Registers the active tab on `ENTER` keypress
 * and move between tabs on `LEFT` or `RIGHT` keypress
 * @param {Event} jQuery Event
 */
Tabs.prototype._handleKeyPress = function(e) {

  var focusedTab = this._clamp(this._getFocusedTabIndex());

  switch(e.which) {
    case Tabs.Keys.ENTER:
      this._handleClickEvent(e);
      break;

    case Tabs.Keys.LEFT:
      focusedTab--;
      this._focusTab(focusedTab);
      break;

    case Tabs.Keys.RIGHT:
      focusedTab++;
      this._focusTab(focusedTab);
      break;
  }
};

/**
 * Focus on a tab.
 * @param {number} index Tab index to focus on.
 */
Tabs.prototype._focusTab = function(index) {
  this._$tabs.eq(index).focus();
};

/**
 * Clamp a value between valid indexes of the tabs.
 * @param {number} index Index to clamp.
 * @return {number} Clamped index.
 */
Tabs.prototype._clamp = function(index) {
  return Math.min(Math.max(index, 0), this._tabs.length - 1);
};

/**
 * Find the index of the currently focused tab.
 * @return {number}
 */
Tabs.prototype._getFocusedTabIndex = function() {
  var $focusedTab = $(document.activeElement).closest('.' + Tabs.ClassName.TABS);
  return this._$tabs.index($focusedTab);
};

Tabs.prototype._showPane = function() {
  var _this = this;

  var activePane = this._panes.filter(function(pane) {
    return pane.getAttribute('data-for') === _this.tabId;
  })[0];

  var inactivePanes = this._panes.filter(function(pane) {
    return pane.getAttribute('data-for') !== _this.tabId;
  });

  this._hidePanes(inactivePanes);

  $(activePane).addClass(Tabs.ClassName.ACTIVE_PANE);
  $(activePane).removeClass('hidden');
  activePane.setAttribute('aria-hidden', false);
};

Tabs.prototype._hidePanes = function(panes) {
  panes.forEach(function(el) {
    el.setAttribute('aria-hidden', true);
    $(el).addClass('hidden');
    $(el).removeClass(Tabs.ClassName.ACTIVE_PANE);
  });
};

Tabs.Keys = {
  ENTER: 13,
  LEFT: 37,
  RIGHT: 39,
};


Tabs.ClassName = {
  BASE: 'tabs',
  TABS: 'tabs-tab',
  ACTIVE_TAB: 'tabs-tab-is-active',
  ACTIVE_PANE: 'tabs-pane-is-active'
};

Tabs.initializeAll = function() {
  Tabs.toArray($('.tabs.faq-tabs')).forEach(function(el) {
    return new Tabs(el);
  });
};

Tabs.init = function(element) {
  return new Tabs(element);
};

citiShare.tabs = (function(){

  return {
    init: Tabs.init,
    initAll: Tabs.initializeAll,
    Events: Tabs.Events,
    ClassName: Tabs.ClassName
  };

})();

var siteTags = [
    {
        "class": ".omniture-accordion-toggle",
        "opts" : ""
    },
    {
        "class": ".omniture-add-to-cart",
        "opts" : ""
    },
    {
        "class": ".omniture-breadcrumb-item",
        "opts" : ""
    },
    {
        "class": ".omniture-breadcrumb-link",
        "opts" : ""
    },
    {
        "class": ".omniture-buttonset",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-billing-address-edit",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-checkout-header-cancel",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-checkout-gift-cards-shipping-faq",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-checkout-gift-cards-in-store-pickup-faq",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-checkout-shipping-address-edit",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-checkout-shipping-address-type-change",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-checkout-change-recipient",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-checkout-change-recipient-edit-message",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-checkout-change-recipient-cancel",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-checkout-change-recipient-apply",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-checkout-item-add",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-checkout-item-remove",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-checkout-summary-continue",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-checkout-summary-cancel",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-confirmation-order-history",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-confirmation-continue-shopping",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-confirmation-print",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-confirmation-gift-cards-shipping-faq",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-confirmation-in-store-pickup-faq",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-review-gift-cards-shipping-faq",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-review-gift-cards-in-store-pickup-faq",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-review-header-cancel",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-review-header-return",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-review-summary-submit",
        "opts" : ""
    },
    {
        "class": ".omniture-cart-review-summary-cancel",
        "opts" : ""
    },
    {
        "class": ".omniture-category-cta",
        "opts" : ""
    },
    {
        "class": ".omniture-category-index-link",
        "opts" : ""
    },
    {
        "class": ".omniture-category-item",
        "opts" : ""
    },
    {
        "class": ".omniture-delivery-terms",
        "opts" : ""
    },
    {
        "class": ".omniture-dropdown-menu",
        "opts" : ""
    },
    {
        "class": ".omniture-dropdown-option",
        "opts" : ""
    },
    {
        "class": ".omniture-account-dropdown-menu",
        "opts" : ""
    },
    {
        "class": ".omniture-account-dropdown-option",
        "opts" : ""
    },
    {
        "class": ".omniture-footer-facebook",
        "opts" : ""
    },
    {
        "class": ".omniture-footer-link",
        "opts" : ""
    },
    {
        "class": ".omniture-footer-sitemap",
        "opts" : ""
    },
    {
        "class": ".omniture-footer-twitter",
        "opts" : ""
    },
    {
        "class": ".omniture-footer-youtube",
        "opts" : ""
    },
    {
        "class": ".omniture-filter-done",
        "opts" : ""
    },
    {
        "class": ".omniture-filter-reset",
        "opts" : ""
    },
    {
        "class": ".omniture-filter-tab",
        "opts" : ""
    },
    {
        "class": ".omniture-header-cart",
        "opts" : ""
    },
    {
        "class": ".omniture-header-check-balance",
        "opts" : ""
    },
    {
        "class": ".omniture-header-citi",
        "opts" : ""
    },
    {
        "class": ".omniture-header-login",
        "opts" : ""
    },
    {
        "class": ".omniture-header-logout",
        "opts" : ""
    },
    {
        "class": ".omniture-header-merchandise",
        "opts" : ""
    },
    {
        "class": ".omniture-header-search-button",
        "opts" : ""
    },
    {
        "class": ".omniture-header-search-field",
        "opts" : ""
    },
    {
        "class": ".omniture-header-travel",
        "opts" : ""
    },
    {
        "class": ".omniture-input-field",
        "opts" : ""
    },
    {
        "class": ".omniture-live-chat-btn",
        "opts" : ""
    },
    {
        "class": ".omniture-modal-add-to-cart-launch",
        "opts" : ""
    },
    {
        "class": ".omniture-modal-add-to-cart-close",
        "opts" : ""
    },
    {
        "class": ".omniture-modal-add-to-cart-continue-shopping",
        "opts" : ""
    },
    {
        "class": ".omniture-modal-add-to-cart-go-to-cart",
        "opts" : ""
    },
    {
        "class": ".omniture-modal-session-ended-launch",
        "opts" : ""
    },
    {
        "class": ".omniture-modal-session-ended-close",
        "opts" : ""
    },
    {
        "class": ".omniture-modal-session-timeout-launch",
        "opts" : ""
    },
    {
        "class": ".omniture-modal-session-timeout-close",
        "opts" : ""
    },
    {
        "class": ".omniture-modal-session-timeout-no",
        "opts" : ""
    },
    {
        "class": ".omniture-modal-session-timeout-yes",
        "opts" : ""
    },
    {
        "class": ".omniture-modal-session-visitor-launch",
        "opts" : ""
    },
    {
        "class": ".omniture-modal-visitor-close",
        "opts" : ""
    },
    {
        "class": ".omniture-modal-visitor-continue",
        "opts" : ""
    },
    {
        "class": ".omniture-modal-visitor-sign-on",
        "opts" : ""
    },
    {
        "class": ".omniture-numeric-stepper-increase",
        "opts" : ""
    },
    {
        "class": ".omniture-numeric-stepper-input",
        "opts" : ""
    },
    {
        "class": ".omniture-pagination-next",
        "opts" : ""
    },
    {
        "class": ".omniture-pagination-previous",
        "opts" : ""
    },
    {
        "class": ".omniture-pagination-page",
        "opts" : ""
    },
    {
        "class": ".omniture-plp-detail",
        "opts" : ""
    },
    {
        "class": ".omniture-product-detail-title",
        "opts" : ""
    },
    {
        "class": ".omniture-promo-cta",
        "opts" : ""
    },
    {
        "class": ".omniture-quickview-close",
        "opts" : ""
    },
    {
        "class": ".omniture-quickview-details",
        "opts" : ""
    },
    {
        "class": ".omniture-quickview-open",
        "opts" : ""
    },
    {
        "class": ".omniture-search-suggestion",
        "opts" : ""
    },
    {
        "class": ".omniture-slider-item",
        "opts" : ""
    },
    {
        "class": ".omniture-slider-next",
        "opts" : ""
    },
    {
        "class": ".omniture-slider-previous",
        "opts" : ""
    },
    {
        "class": ".omniture-slider-pagination",
        "opts" : ""
    },
    {
        "class": ".omniture-sticky-filter",
        "opts" : ""
    },
    {
        "class": ".omniture-swp-details",
        "opts" : ""
    },
    {
        "class": ".omniture-tab",
        "opts" : ""
    },
    {
        "class": ".omniture-tab-product-info",
        "opts" : ""
    },
    {
        "class": ".omniture-tab-product-delivery",
        "opts" : ""
    },
    {
        "class": ".omniture-tooltip",
        "opts" : ""
    },
    {
        "class": ".omniture-travel-results",
        "opts" : ""
    },
    {
        "class": ".omniture-travel-results-book",
        "opts" : ""
    }
];

function fireTags(){
    'use strict';
    siteTags.forEach(function(elem) {
        $(elem.class).click(function() {
            //console.log("let's fire a tag here");
        });
    });
}

fireTags();

'use strict';

var TermsSection = function(element) {
  this.element = element;
  this.$el = $(element);

  this.trigger = this.$el.find('.js-terms-trigger');
  this._dropdown = this.element.getElementsByClassName('omniture-dropdown-menu')[0];

  this._button = $('.ui-selectmenu-button');

  this.tabsSection = null;
  this._triggerClick = this._handleTriggerClick.bind(this);

  this._init();

  this._initialized = false;

  this._determineActiveTabs();
};

TermsSection.prototype._init = function() {
  var tabs = this.$el.find('.faq-tabs')[0];
  this.tabsSection = citiShare.tabs.init(tabs);

  this.trigger.on('click', this._triggerClick);
  this._button.on('click', this._handleDropdownClick.bind(this));

  this._setFirstAccordionsOpen();
  this._setSelectUIWidth();
  this._setInnerTabIndex();
};

TermsSection.prototype._handleDropdownClick = function(e) {
  e.preventDefault();

  this._hideFirstOption();
  this._initialized = true;
};

TermsSection.prototype._handleTriggerClick = function(e) {
  e.preventDefault();
  this._determineActiveTabs();
  this._hideFirstOption();
  this._initialized = true;
};

TermsSection.prototype._hideFirstOption = function() {
  if (this._initialized) {
    return;
  }
  var dropdown = $('.ui-selectmenu-menu');
  var dropdownElements = dropdown.find('.ui-menu-item');
  var currentDropdownElement = dropdownElements.eq(0);
  
  dropdownElements.removeClass('is-hidden');
  currentDropdownElement.addClass('is-hidden');
};

TermsSection.prototype._determineActiveTabs = function() {
  var tabs;
  var index;

  var dropdown = $('.ui-selectmenu-menu');

  if(this._dropdown) {
    index = this._dropdown.selectedIndex;
    var optionSelected = this._dropdown.getElementsByTagName('option')[index];
    tabs = optionSelected.getAttribute('data-tabs').replace(/\s/g, '').split(',');
  } else {
    index = 0;
    tabs = this.tabsSection._$tabs.toArray().map(function(el) {
      return el.getAttribute('data-id');
    });
  }

  if (dropdown) {
    var dropdownElements = dropdown.find('.ui-menu-item');
    var currentDropdownElement = dropdownElements.eq(index);
    
    dropdownElements.removeClass('is-hidden');
    currentDropdownElement.addClass('is-hidden');
  }

  this._showTabs(tabs);
};

TermsSection.prototype._setSelectUIWidth = function() {
  var $selectUI = $('.ui-selectmenu-menu');
  $selectUI.addClass('terms-and-conditions-select-dropdown');
};

TermsSection.prototype._showTabs = function(tabs) {
  this.tabsSection._$tabs.addClass('tabs-tab-is-hidden');
  this.tabsSection._$tabs.removeClass('tabs-tab-is-visible');
  this.tabsSection._$tabs.attr('aria-hidden', true);

  var _this = this;
  var $el;

  var activeTabs = tabs.map(function(id) {
    return _this.$el.find('.tabs-tab[data-id="'+id+'"]')[0];
  });

  this.tabsSection.setActiveTab(activeTabs[0]);

  this._setTabWidths(activeTabs.length);

  activeTabs.forEach(function(el) {
    $el = $(el);
    $el.removeClass('tabs-tab-is-hidden');
    $el.addClass('tabs-tab-is-visible');
    $el.attr('aria-hidden', false);
  });
};

TermsSection.prototype._setTabWidths = function(numberOfTabs) {
  $(this.tabsSection._element).attr('data-tabs-count', numberOfTabs);
};

TermsSection.prototype._setInnerTabIndex = function() {
  var innerLists = this.$el.find('.terms-and-conditions-accordion-content');

  innerLists.each(function(i, el) {
    var $el = $(el);
    var item = $el.find('.terms-and-conditions-accordion-content-item').eq(0);
    item.attr('tabindex', 0);
  });
};

TermsSection.prototype._setFirstAccordionsOpen = function() {
  var $tabPanes = this.$el.find('.tabs-pane');
  $tabPanes.each($.proxy(function(index, el) {
    var accordionContent = $(el).find('.terms-and-conditions-accordion .terms-and-conditions-accordion-content-wrap')[0];
    if(accordionContent) {
      this._openAccordionMenu(accordionContent);
    }
  }, this));
};

TermsSection.prototype._openAccordionMenu = function(parentElement) {
  var firstElementHeader = parentElement.querySelector('.accordion-toggle-header');
  var firstElementContent = parentElement.querySelector('.accordionSubMenu');

  firstElementHeader.setAttribute('aria-expanded', 'true');
  firstElementContent.setAttribute('aria-expanded', 'true');

  firstElementHeader.classList.add('expanded');
  firstElementContent.classList.add('expanded');

  firstElementHeader.classList.remove('is-hidden');
  firstElementContent.classList.remove('is-hidden');
};

TermsSection.init = function() {
  var termsElement = document.querySelector('.terms-and-conditions-section');

  if (termsElement) {
    return new TermsSection(termsElement);
  }
};

citiShare.termsSection = (function() {
  TermsSection.init();
})();

citiShare.tabs = (function() {
    'use strict';

    /**
     * Toggle Tabs
     * For example, citiShare.productDetails.toggleTabs("js-toggle-details", "tab", "js-product-details");
     */
    function toggleTabs(linkClass, type, showClass){

        var $toggleTabEls = $(linkClass);

        $toggleTabEls.on("click keypress", function(e) {
            if (e.which === 13 || e.type === 'click') {
                e.stopPropagation();

                var dataAttr = $(this).data(type);

                var $showDetailsEl = $(showClass + "[data-" + type + "=" + dataAttr + "]");
                var $hideDetailsEl = $(showClass + "[data-" + type + "!=" + dataAttr + "]");
                // Set the tabindex
                $( linkClass + "[data-tab='" + dataAttr + "']").attr("tabindex", 0).focus();
                $( linkClass + "[data-tab!='" + dataAttr + "']").attr("tabindex", -1);

                //If self is clicked, do not toggle
                var isToggled = $showDetailsEl.hasClass("is-hidden");

                if ( isToggled ) {
                    $toggleTabEls.toggleClass("product-active");

                    $( linkClass + "[data-" + "tab" + "=" + dataAttr + "]" ).attr("aria-selected", true);
                    $( linkClass + "[data-" + "tab" + "!=" + dataAttr + "]" ).attr("aria-selected", false);

                    // Toggle details
                    $hideDetailsEl.toggleClass("is-hidden");
                    $showDetailsEl.toggleClass("is-hidden");
                }
            }
        });
    }

    return {
        toggleTabs: toggleTabs
    };
})();

/**
 * JSHint:
 * To allow bracket notation,
 * For example, test["placeholder"] vs test.placeholder
 */

/*jshint sub:true*/

citiShare.tooltipRemove = (function() {
    "use strict";
    
    var currentlyOpenedRemoveTooltip;

    function _removeItem(argument) {
        // a function to remove an item from the cart
        console.log('in _removeItem', argument);
        _closeTooltip();
    }

    function _openTooltip($removeButton){
        $removeButton.find('.tooltip-remove-wrapper').addClass('is-active');
        currentlyOpenedRemoveTooltip = new citiShare.AccessibleModal({
          modal: $removeButton.find(".tooltip-remove-dialog-wrapper:first"),
          previousElement: $removeButton,
          closeButton: $removeButton.find(".tooltip-remove-button-cancel"),
          modalType: 'simple'
        });
    }

    function _closeTooltip(){
        $('.tooltip-remove-wrapper').removeClass('is-active');
        currentlyOpenedRemoveTooltip = undefined;
    }

    function _init() {
        $(document).on('click', '.checkout-item-remove', function(event) {
            event.preventDefault();
            _closeTooltip($('.tooltip-remove-wrapper'));

            if (!$(this).find('.tooltip-remove-wrapper').hasClass('is-active')) {
                _openTooltip($(this));
            } else {
                _closeTooltip($(this));
            }
        });

        $(document).on('click', '.oc-content', function(event) {
            if( event.target.tagName !== undefined &&
                $(event.target).closest('.tooltip-remove-wrapper').length === 0 &&
                !$(event.target).is('.checkout-item-remove')) {
                    _closeTooltip();
            }        
        });


        $(document).on('click', '.tooltip-remove-button-confirm', function(event) {
            event.stopPropagation();
            _removeItem();
        });

        $(document).on('click keypress', '.tooltip-remove-button-cancel', function(event) {
          if (event.which === 13 || event.type === 'click') {
            event.stopPropagation();
            _closeTooltip();
          }
        });
    }
    _init();
    return {
        
    };
})();


/**
 * JSHint:
 * To allow bracket notation,
 * For example, test["placeholder"] vs test.placeholder
 */

/*jshint sub:true*/

citiShare.tooltip = (function () {
  "use strict";

  var EXITER_CLASS = 'tooltip-exiter',
    TARGET_CLASS = 'tooltip-target',
    TARGET_SELECTOR = '.' + TARGET_CLASS,
    EXITER_SELECTOR = '.' + EXITER_CLASS,
    TOP_ALIGNED_CLASS = 'tooltip-top-position',
    TOOLTIP_TOP_CLASS = 'top-aligned';

  var $wrapper = null,
    $box = null,
    $content = null,
    $arrow = null,
    $currentBase = null,
    currentContent = null,
    isOpen = false,
    exiterBefore = null,
    exiterAfter = null,
    initialArrowMargin = 0,
    initialized = false;

  function _refreshAttrs($base) {
    var label = $base.attr('aria-label');
    var content = $base.attr('data-tooltip-content');
    var toShow = content ? content : label;

    $base.attr('data-tooltip-content', toShow);
    $base.attr('aria-label', label.replace(/<br ?\/>/g, ''));
    $base.attr('tabindex', '0');
  }

  //Call this if dynamic content occurs so the tips can be positioned
  function refresh() {

    if (isOpen) {
      hide();
    }

    $(TARGET_SELECTOR).each(function () {
      var $this = $(this);

      _refreshAttrs($this);

      //This may need to be modified as use-cases arise.
      if ($this.css('vertical-align') !== 'top') {
        return;
      }
      var $parent = $this.parent();
      var $prev = $this.prev();
      var $guide = null;
      var translateY = 0;

      if ($prev.length > 0) {
        $guide = $prev;
      } else {
        $guide = $parent;
      }

      var guideHeight = $guide.height();
      var tipHeight = $this.height();
      if (tipHeight > guideHeight) {
        translateY = ((tipHeight - guideHeight) / 2) * -1;
      } else {
        translateY = (guideHeight / 2) - (tipHeight / 2);
      }
    });
  }

  function show(content, $base) {

    isOpen = true;

    $currentBase.attr('title', '');
    $currentBase.addClass('tooltip-active');
    if ($base.hasClass(TOP_ALIGNED_CLASS)) {
      $wrapper.addClass(TOOLTIP_TOP_CLASS);
    }
    $wrapper.css('display', 'block');
    $content.html(content);

    var position = _getPositionForBase($base);

    if (position.offset !== 0) {
      var newMargin = initialArrowMargin;

      if (position.offset < 0) {
        newMargin += Math.abs(position.offset);
      } else {
        newMargin -= position.offset;
      }
      $arrow.css('margin-left', newMargin);
    } else {
      $arrow.css('margin-left', initialArrowMargin);
    }

    $wrapper.css({
      opacity: 1,
      top: position.top,
      left: position.left
    });

  }

  function hide() {

    isOpen = false;

    $currentBase.removeClass('tooltip-active ');
    $currentBase.attr('title', currentContent);
    $content.html('');
    $wrapper.removeClass(TOOLTIP_TOP_CLASS);
    $wrapper.css({
      display: 'none',
      opacity: 0,
      top: 0,
      left: -9999
    });
  }

  function _getPositionForBase($base) {
    var $b = $($base),
      baseOffset = $b.offset(),
      baseHeight = $b.outerHeight(),
      baseWidth = $b.outerWidth(),
      tipHeight = $wrapper.height(),
      tipWidth = $wrapper.width(),
      winWidth = $(window).width(),
      isTopPositioned = $base.hasClass(TOP_ALIGNED_CLASS);


    var top = isTopPositioned ? baseOffset.top - (tipHeight + 10) : baseOffset.top + baseHeight,
      left = baseOffset.left - (tipWidth / 2) + (baseWidth / 2),
      right = left + tipWidth,
      leftBounds = 25,
      rightBounds = winWidth - leftBounds,
      offset = 0;

    if (left < leftBounds) {
      offset = leftBounds - left;
      left = leftBounds;
    } else if (right > rightBounds) {
      offset = (right - rightBounds) * -1;
      left = rightBounds - tipWidth;
    }

    return {
      top: top,
      left: left,
      offset: offset
    };

  }

  function _unsetExiters() {
    if (exiterBefore) {
      exiterBefore.attr('tabindex', null).removeClass(EXITER_CLASS);
    }
    if (exiterAfter) {
      exiterAfter.attr('tabindex', null);
    }
    exiterBefore = null;
    exiterAfter = null;
  }

  function _setExiters() {
    _unsetExiters();

    var nextSibling = $currentBase.next();
    var previousSibling = $currentBase.prev();

    if (nextSibling.length > 0) {
      exiterAfter = nextSibling;
    } else {
      var tries = 0;
      var $thisParent = $currentBase.parent();
      exiterAfter = null;

      do {
        var $parentSibling = $thisParent.next();

        if ($parentSibling.length > 0) {
          var isHidden = $parentSibling.attr('aria-hidden') || 'false';
          if(isHidden === 'false') {

            var tag = $parentSibling[0].tagName.toLowerCase();
            if (tag !== 'div') {
              exiterAfter = $parentSibling;
            } else {
              var $firstChild = $parentSibling.find('a, td, th, input, span, p, h1, h2, h3, h4, h5, h6, button, label').first();
              var $parentSiblingNext = $parentSibling.next();
              if ($firstChild.length > 0) {
                if (!exiterAfter) {
                  exiterAfter = $firstChild;
                }
              }
              if($parentSiblingNext.length > 0) {
                if(!exiterAfter) {
                  exiterAfter = $parentSiblingNext;
                }
              }
            }
          }
        }

        tries += 1;
        $thisParent = $thisParent.parent();
      } while (tries < 6 && !exiterAfter);
    }
    if (previousSibling.length > 0) {
      exiterBefore = previousSibling;
    } else {
      exiterBefore = $currentBase.parent();
    }

    exiterBefore.attr('tabindex', '0').addClass(EXITER_CLASS);
    if (exiterAfter) {
      exiterAfter.attr('tabindex', '0').addClass(EXITER_CLASS);
    }
  }

  function _onLeave(e) {
    _unsetExiters();

    var $related = e.relatedTarget;
    var isFocused = e.currentTarget === document.activeElement;
    if ($related !== $wrapper[0] && !$.contains($wrapper[0], $related) && !isFocused) {
      hide();
    }
  }

  function _onEnter(e) {
    var $targ = $(e.currentTarget);

    if ($targ.is('body')) {
      $targ = $(e.target);
    }

    $currentBase = $targ;
    currentContent = $currentBase.attr('data-tooltip-content');

    if (currentContent && currentContent !== '') {
      show(currentContent, $currentBase);
    }

    if (Modernizr.touch) {
      _setExiters();
    } else {
      if (e.which === 0) {
        _unsetExiters();
      } else {
        _setExiters();
      }
    }

  }

  function _onClick(e) {
    e.preventDefault();
    var element = $(e.target);
    var tagName = element.prop('tagName');

    if (isOpen && tagName !== 'INPUT') {
      hide();
    } else {
      element.focus();
      _onEnter(e);
    }
  }

  function _onWrapperLeave() {
    var activeElement = $(document.activeElement).prop('tagName');
    if (isOpen && activeElement !== 'INPUT') {
      hide();
    }
  }

  function _onViewportUpdate() {
    refresh();
  }

  function _onExiterLeave(e) {
    if (!$(e.relatedTarget).is(TARGET_SELECTOR)) {
      _unsetExiters();
    }
  }

  function _bind() {
    var $body = $('body');

    if (Modernizr.touch) {
      $body[0].addEventListener('touchend', function (e) {
        var $targ = $(e.target);
        var isTip = $targ.is('.tooltip-wrapper') || $targ.closest('.tooltip-wrapper').length > 0;
        if ($targ.is(TARGET_SELECTOR) || (isOpen && !isTip)) {
          _onClick(e);
        }
      }, false);
    } else {
      $body.on('click', TARGET_SELECTOR, _onClick);
    }
    $body.on('mouseover focus', TARGET_SELECTOR, _onEnter);
    $body.on('mouseout blur', TARGET_SELECTOR, _onLeave);
    $wrapper.on('mouseleave', _onWrapperLeave);
    $body.on('blur', EXITER_SELECTOR, _onExiterLeave);

    citiShare.on('viewport:update', _onViewportUpdate);
  }

  function _createHolder() {
    if ($wrapper) {
      return;
    }

    $arrow = $('<span class="tooltip-arrow"></span>');
    $wrapper = $('<div role="tooltip" class="tooltip-wrapper"></div>');
    $box = $('<div class="ui-tooltip ui-widget ui-corner-all ui-widget-content tooltip-box"></div>');
    $content = $('<div class="ui-tooltip-content"></div>');

    $wrapper.css({
      display: 'none',
      opacity: 0
    });

    $wrapper.append($arrow);
    $wrapper.append($box);
    $box.append($content);
    $('body').append($wrapper);

    initialArrowMargin = parseInt($arrow.css('margin-left'), 10);
  }

  function _init() {
    if (initialized) {
      return;
    }

    initialized = true;

    _createHolder();
    refresh();
    _bind();
  }

  _init();

  return {
    refresh: refresh,
    show: show,
    hide: hide
  };

})();


//This is global to keep track of browser dimensions, etc.  Add functionality here as needed (i.e. scroll, hashParams, etc)
//
citiShare.viewport = (function() {
    "use strict";

    var win = {
      width:0,
      height:0
    };

    function _get() {
      return {
        win:win
      };
    }

    function _win() {
      return win;
    }

    function _onResize() {
      var w = window.innerWidth || $(window).width();
      var h = window.innerHeight || $(window).height();
      var updated = win.width !== w || win.height !== h;

      win.width = w;
      win.height = h;

      if (updated) {
        citiShare.trigger('viewport:update', win);
      }

    }

    function _bind() {
      $(window).on('resize', citiShare.util.throttle(_onResize, 50));
    }

    function _init() {
      _bind();
      $(window).trigger('resize');
    }

    _init();

    return {
      get:_get,
      win:_win
    };
})();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNpdGktY29uZmlnLmpzIiwiY2l0aS1zaGFyZS5qcyIsInV0aWwuanMiLCJmb3JtLXZhbGlkYXRpb24uanMiLCJzbGlkZXIuanMiLCJhY2Nlc3NpYmxlLW11bHRpY29sdW1uLWxpc3QuanMiLCJiYWNrLXRvLXRvcC5qcyIsImJhc2UuanMiLCJjYXJvdXNlbC5qcyIsImNhcnQtZXJyb3IuanMiLCJjYXJ0LmpzIiwiZGF0ZXBpY2tlci5qcyIsImRldGFpbGVkLWxpc3QuanMiLCJmYXFzLXNlY3Rpb24uanMiLCJmaWx0ZXItdGFicy5qcyIsImZpbHRlcnMuanMiLCJoYW5kbGViYXItaGVscGVycy5qcyIsImhvbWVwYWdlLmpzIiwibWZhLmpzIiwibW9jay1lbmRwb2ludC5qcyIsIm1vZGFscy5qcyIsIm15LWFjY291bnQtYWpheC5qcyIsIm51bWVyaWMtc3RlcHBlci5qcyIsIm9yZGVyLWhpc3RvcnkuanMiLCJwYWdpbmF0aW9uLmpzIiwicG9pbnRzLXRyYW5zZmVyLWZpbHRlcnMuanMiLCJwb2ludHMtdHJhbnNmZXIuanMiLCJwb2x5ZmlsbHMuanMiLCJwcm9maWxlLmpzIiwicXVpY2t2aWV3LmpzIiwicmVpbnN0YXRlLWN1cnJlbmN5LmpzIiwic2VhcmNoLmpzIiwic2VlLW1vcmUtaXRlbS5qcyIsInNlZS1tb3JlLmpzIiwic2hvdy1tb3JlLWNvbXBvbmVudC5qcyIsInRhYnMuanMiLCJ0YWdnaW5nLmpzIiwidGVybXMtc2VjdGlvbi5qcyIsInRvZ2dsZS10YWJzLmpzIiwidG9vbHRpcC1yZW1vdmUuanMiLCJ0b29sdGlwLmpzIiwidmlld3BvcnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyK0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcExBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdHVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0lBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3Z0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaFNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3REQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbG1CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbktBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1UUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDblJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOXJCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL01BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDajdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzd2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzM0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ROQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3ZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25IQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2xvYmFsLXYyLmpzIiwic291cmNlc0NvbnRlbnQiOlsid2luZG93LmNpdGlDb25maWcgPSAoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGVuZFBvaW50SG9zdCA9IFwiLi4vLi4vLi4vLi4vanMvbW9jay1lbmRwb2ludHMvXCI7XG4gICAgdmFyIGNhdGVnb3J5RW5kUG9pbnRQYXRoID0gXCJtb2NrLWNhdGVnb3J5LWJyYW5kcy9hbHBoYWJldGljYWwvXCI7XG4gICAgdmFyIHByb2R1Y3RMaXN0aW5nRW5kUG9pbnRQYXRoID0gXCJtb2NrLXByb2R1Y3QtbGlzdGluZy9cIjtcbiAgICB2YXIgc2VhcmNoUmVzdWx0c0VuZFBvaW50UGF0aCA9IFwibW9jay1zZWFyY2gvXCI7XG4gICAgdmFyIG1mYUVuZFBvaW50UGF0aCA9IFwibW9jay1tZmEvXCI7XG4gICAgdmFyIHBvaW50c1RyYW5zZmVyRGV0YWlsRW5kUG9pbnRQYXRoID0gXCJtb2NrLXBvaW50cy10cmFuc2Zlci1kZXRhaWwvXCI7XG4gICAgdmFyIGhhbmRsZWJhclRlbXBsYXRlc0RpciA9ICcuLi8uLi8uLi8uLi90ZW1wbGF0ZXMuaGJzLyc7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBjYXRlZ29yeUVuZFBvaW50UGF0aDogY2F0ZWdvcnlFbmRQb2ludFBhdGgsXG4gICAgICAgIGVuZFBvaW50SG9zdDogZW5kUG9pbnRIb3N0LFxuICAgICAgICBoYW5kbGViYXJUZW1wbGF0ZXNEaXI6IGhhbmRsZWJhclRlbXBsYXRlc0RpcixcbiAgICAgICAgcHJvZHVjdExpc3RpbmdFbmRQb2ludFBhdGg6IHByb2R1Y3RMaXN0aW5nRW5kUG9pbnRQYXRoLFxuICAgICAgICBzZWFyY2hSZXN1bHRzRW5kUG9pbnRQYXRoOiBzZWFyY2hSZXN1bHRzRW5kUG9pbnRQYXRoLFxuICAgICAgICBtZmFFbmRQb2ludFBhdGg6IG1mYUVuZFBvaW50UGF0aCxcbiAgICAgICAgcG9pbnRzVHJhbnNmZXJEZXRhaWxFbmRQb2ludFBhdGg6IHBvaW50c1RyYW5zZmVyRGV0YWlsRW5kUG9pbnRQYXRoXG4gICAgfTtcbn0pKCk7XG4iLCIvKiBnbG9iYWwgTCAqL1xuLyoqXG4gKiBKU0hpbnQ6XG4gKiBUbyBhbGxvdyBicmFja2V0IG5vdGF0aW9uLFxuICogRm9yIGV4YW1wbGUsIHRlc3RbXCJwbGFjZWhvbGRlclwiXSB2cyB0ZXN0LnBsYWNlaG9sZGVyXG4gKi9cblxuLypqc2hpbnQgc3ViOnRydWUqL1xuXG4vKipcbiAqIE9iamVjdCBzaGFyZWQgYWNyb3NzIGRpZmZlcmVudCBjb3VudHJpZXNcbiAqL1xudmFyIGNpdGlTaGFyZSA9IChmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG5cbiAgdmFyIHB1YnN1YiA9IG51bGw7XG5cbiAgdmFyIEtleWJvYXJkID0ge1xuICAgIEVOVEVSOiAxMyxcbiAgICBUQUI6IDksXG4gICAgRVNDQVBFOiAyNyxcbiAgICBTUEFDRTogMzIsXG4gICAgTEVGVDogMzcsXG4gICAgUklHSFQ6IDM5LFxuICAgIFVQOiAzOCxcbiAgICBET1dOOiA0MFxuICB9O1xuXG4gIHZhciBIZWFkZXIgPSB7XG4gICAgbW9iaWxlTWVudUluc3RhbnRpYXRlZDogZmFsc2UsXG4gICAgZGVza3RvcE1lbnVJbnN0YW50aWF0ZWQ6IGZhbHNlLFxuICAgIHdpbmRvd1dpZHRoOiB3aW5kb3cuaW5uZXJXaWR0aCB8fCAkKHdpbmRvdykud2lkdGgoKSxcbiAgICBzZWFyY2hPcGVuOiBmYWxzZSxcbiAgICBpc1Jlc2l6aW5nOiBmYWxzZSxcbiAgICBvcGVuZWRTdWJOYXY6IG51bGwsXG4gICAgcmVzaXppbmdUaW1lb3V0OiBudWxsLFxuICAgIHNlYXJjaEljb246ICQoJyNkZXNrdG9wLWhlYWRlci1zZWFyY2ggLmNvbnRyb2wgaSwgI21vYmlsZS1oZWFkZXItc2VhcmNoIC5jb250cm9sIGknKVxuICB9O1xuXG4gIC8vaW5pXG5cbiAgLyoqXG4gICAqIEhlYWRlciBhbmQgTWVudSBJbml0aWFsaXphdGlvbnNcbiAgICovXG4gIGZ1bmN0aW9uIF9pbml0aWFsaXplTWVudSgpIHtcbiAgICAkKHdpbmRvdykuYmluZCgncmVzaXplJywgZnVuY3Rpb24gKCkge1xuICAgICAgSGVhZGVyLmlzUmVzaXppbmcgPSB0cnVlO1xuICAgICAgSGVhZGVyLndpbmRvd1dpZHRoID0gd2luZG93LmlubmVyV2lkdGggfHwgJCh3aW5kb3cpLndpZHRoKCk7XG5cbiAgICAgIGlmIChIZWFkZXIud2luZG93V2lkdGggPCA5NjAgJiYgIUhlYWRlci5tb2JpbGVNZW51SW5zdGFudGlhdGVkKSB7XG4gICAgICAgIGluaXRNb2JpbGUoKTtcbiAgICAgIH1cbiAgICAgIGlmIChIZWFkZXIud2luZG93V2lkdGggPj0gOTYwICYmICFIZWFkZXIubW9iaWxlTWVudUluc3RhbnRpYXRlZCkge1xuICAgICAgICBpbml0RGVza3RvcCgpO1xuICAgICAgfVxuXG4gICAgICBpZiAoJChcIiNoZWFkZXItZGVza3RvcFwiKS5jc3MoXCJkaXNwbGF5XCIpID09PSBcImJsb2NrXCIgJiYgJChcIi5vYy1jb250YWluZXJcIikuaGFzQ2xhc3MoXCJvYy1wdXNoXCIpKSB7XG4gICAgICAgICQoJyNtZW51LWJ1dHRvbicpLmNsaWNrKCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChIZWFkZXIucmVzaXppbmdUaW1lb3V0KSB7XG4gICAgICAgIGNsZWFyVGltZW91dChIZWFkZXIucmVzaXppbmdUaW1lb3V0KTtcbiAgICAgIH1cbiAgICAgIEhlYWRlci5yZXNpemluZ1RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgSGVhZGVyLmlzUmVzaXppbmcgPSBmYWxzZTtcbiAgICAgIH0sIDIwMDApO1xuXG4gICAgfSkudHJpZ2dlcigncmVzaXplJyk7XG5cbiAgICBzZXR1cE1lbnVzKCk7XG4gICAgc2V0dXBNb2JpbGVUYWJsZXRTZWFyY2goKTtcbiAgICBzZXR1cEFjY291bnROYW1lT3ZlcmZsb3coKTtcbiAgICBzZXR1cE5hdmlnYXRpb25hMTF5KCk7XG4gICAgc2V0dXBQbGFjZWhvbGRlcigpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0dXBQbGFjZWhvbGRlcigpIHtcbiAgICAkKCdpbnB1dCcpLm9uKCdrZXl1cCBmb2N1cycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICQodGhpcykucHJldignbGFiZWwnKS5hZGRDbGFzcygndmlzaWJsZScpO1xuICAgIH0pO1xuXG4gICAgJCgnaW5wdXQnKS5vbignYmx1cicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICgkKHRoaXMpLnZhbCgpLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICQodGhpcykucHJldignbGFiZWwnKS5yZW1vdmVDbGFzcygndmlzaWJsZScpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIHRvIGRldGVybWluZSBvbiBwYWdlIGxvYWQgdGhlIHdpZHRoIG9mIHRoZSB3aW5kb3cgYW5kIHdoZXRoZXIgb3Igbm90XG4gICAqIHRvIHVzZSB0aGUgaW5pdE1vYmlsZSgpIG9yIHRoZSBpbml0RGVza3RvcCgpXG4gICAqXG4gICAqIEBwYXJhbSBzUGFyYW0gKHdpbmRvV2lkdGgpXG4gICAqL1xuICBmdW5jdGlvbiBzZXR1cE1lbnVzKHNQYXJhbSkge1xuICAgIGlmIChzUGFyYW0gPCA5NjApIHtcbiAgICAgIGluaXRNb2JpbGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaW5pdERlc2t0b3AoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgdGhlIG1vYmlsZSB2ZXJzaW9uIG9mIHRoZSBoZWFkZXJcbiAgICovXG4gIGZ1bmN0aW9uIGluaXRNb2JpbGUoKSB7XG4gICAgc2V0dXBNb2JpbGVNZW51KCk7XG4gICAgbW9iaWxlRmlsdGVyTGlzdCgpO1xuICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnaW5pdCcpO1xuICAgIEhlYWRlci5tb2JpbGVNZW51SW5zdGFudGlhdGVkID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplcyB0aGUgZGVza3RvcCB2ZXJzaW9uIG9mIHRoZSBoZWFkZXJcbiAgICovXG4gIGZ1bmN0aW9uIGluaXREZXNrdG9wKCkge1xuICAgICQoJ2JvZHknKS5hZGRDbGFzcygnaW5pdCcpO1xuICAgIHNldHVwRGVza3RvcE1lbnUoKTtcbiAgICBIZWFkZXIuZGVza3RvcE1lbnVJbnN0YW50aWF0ZWQgPSB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHVwcyBza2lwIG5hdmlhdGlvblxuICAgKi9cbiAgZnVuY3Rpb24gc2V0dXBOYXZpZ2F0aW9uYTExeSgpIHtcbiAgICAkKCcuc2tpcG5hdicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgkKCdoMScpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAkKCdoMScpLmF0dHIoJ3RhYmluZGV4JywgJzAnKS5mb2N1cygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQoJ2gyJykuYXR0cigndGFiaW5kZXgnLCAnMCcpLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgIH0sIDUwMCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU3RhcnRzIHRoZSBhY2Nlc3NpYmxlTWVnYU1lbnUgamF2YXNjcmlwdCBmb3IgdGhlIGhlYWRlciBpbXBsZW1lbnRhdGlvblxuICAgKi9cbiAgZnVuY3Rpb24gc2V0dXBEZXNrdG9wTWVudSgpIHtcbiAgICAkKCcubWVnYW1lbnUnKS5hY2Nlc3NpYmxlTWVnYU1lbnUoKTtcbiAgICAvLyBoYWNrIHNvIHRoYXQgdGhlIG1lZ2FtZW51IGRvZXNuJ3Qgc2hvdyBmbGFzaCBvZiBjc3MgYW5pbWF0aW9uIGFmdGVyIHRoZSBwYWdlIGxvYWRzLlxuICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnaW5pdCcpO1xuICB9XG5cblxuICAvKipcbiAgICogR2V0cyBVUkwgcGFyYW1ldGVyc1xuICAgKlxuICAgKiBAcGFyYW0gc1BhcmFtXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAqL1xuICBmdW5jdGlvbiBfZ2V0VXJsUGFyYW1ldGVyKHNQYXJhbSkge1xuXG4gICAgaWYgKHNQYXJhbSkge1xuICAgICAgdmFyIHNQYWdlVVJMID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7XG4gICAgICB2YXIgc1VSTFZhcmlhYmxlcyA9IHNQYWdlVVJMLnNwbGl0KCcmJyk7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc1VSTFZhcmlhYmxlcy5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgIHZhciBzUGFyYW1ldGVyTmFtZSA9IHNVUkxWYXJpYWJsZXNbaV0uc3BsaXQoJz0nKTtcbiAgICAgICAgaWYgKHNQYXJhbWV0ZXJOYW1lWzBdID09PSBzUGFyYW0pIHtcbiAgICAgICAgICByZXR1cm4gc1BhcmFtZXRlck5hbWVbMV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIG1vYmlsZUZpbHRlckxpc3QoKSB7XG4gICAgJChcIi5maWx0ZXItc3VibmF2LWNvbnRyb2xcIikuYmluZCgnY2xpY2suY2l0aXNoYXJlJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgICB2YXIgJHN1Ym5hdiA9ICQoJy4nICsgJHRoaXMuYXR0cignYXJpYS1jb250cm9scycpKTtcblxuICAgICAgb3BlblN1Yk5hdigkc3VibmF2LCAkdGhpcyk7XG5cbiAgICAgICRzdWJuYXYuZmluZCgnLnN1Yi1uYXYtYmFjaycpLmJpbmQoJ2NsaWNrIHRvdWNoZW5kJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgY2xvc2VTdWJOYXYoJHN1Ym5hdiwgJHRoaXMpO1xuICAgICAgICAkKHRoaXMpLnVuYmluZCgnY2xpY2snKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJCgnI21vYmlsZS1tZW51IGE6dmlzaWJsZTpmaXJzdCcpLmZvY3VzKCk7XG4gICAgICAgIH0sIDI1KTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcblxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdXAgdGhlIG1vYmlsZSBtZW51XG4gICAqL1xuICBmdW5jdGlvbiBzZXR1cE1vYmlsZU1lbnUoKSB7XG5cbiAgICAkKCcubW9iaWxlLXN1Ym5hdi1jb250cm9sJykuYmluZCgnY2xpY2suY2l0aXNoYXJlJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgICB2YXIgJHN1Ym5hdiA9ICQoJyMnICsgJHRoaXMuYXR0cignYXJpYS1jb250cm9scycpKTtcblxuICAgICAgb3BlblN1Yk5hdigkc3VibmF2LCAkdGhpcyk7XG5cbiAgICAgICRzdWJuYXYuZmluZCgnLnN1Yi1uYXYtYmFjaycpLmJpbmQoJ2NsaWNrIHRvdWNoZW5kJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgY2xvc2VTdWJOYXYoJHN1Ym5hdiwgJHRoaXMpO1xuICAgICAgICAkKHRoaXMpLnVuYmluZCgnY2xpY2snKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJCgnI21vYmlsZS1tZW51IGE6dmlzaWJsZTpmaXJzdCcpLmZvY3VzKCk7XG4gICAgICAgIH0sIDI1KTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcblxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcnMgY2xvc2Ugc2VhcmNoIGFuZCByZW1vdmVzIHBhZGRpbmcgdG9wIHdoZW5cbiAgICAgKiBicm93c2VyIGlzIHJlc2l6ZWQgdG8gbGFyZ2VyIHRoYW4gdGFibGV0IDk2MHB4XG4gICAgICpcbiAgICAgKiBDb25kaXRpb25zOiBJZiB0aGUgYnJvd3NlciB3aWR0aCBpcyBsYXJnZXIgdGhhbiB0YWJsZXQsXG4gICAgICogYW5kIHNlYXJjaCBiYXIgaXMgb3BlbmVkICh0cnVlIHN0YXRlIHNldCBpbiBvcGVuU2VhcmNoKCkpXG4gICAgICovXG4gICAgJCh3aW5kb3cpLmJpbmQoJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChIZWFkZXIud2luZG93V2lkdGggPiA5NjAgJiYgSGVhZGVyLnNlYXJjaE9wZW4pIHtcbiAgICAgICAgY2xvc2VTZWFyY2goKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGluaXRNZW51KCk7XG4gIH1cblxuICAvKipcbiAgICogVGFibGV0IFNlYXJjaCBJbXBsZW1lbnRhdGlvblxuICAgKi9cbiAgZnVuY3Rpb24gc2V0dXBNb2JpbGVUYWJsZXRTZWFyY2goKSB7XG5cbiAgICB2YXIgc2VhcmNoRm9ybSA9ICQoJyNkZXNrdG9wLXNlYXJjaC1mb3JtLCAjbW9iaWxlLXNlYXJjaC1mb3JtJyk7XG5cbiAgICAkKFwiI2Rlc2t0b3AtaGVhZGVyLXNlYXJjaCBhLCAjbW9iaWxlLWhlYWRlci1zZWFyY2ggYSwgI2Rlc2t0b3AtaGVhZGVyLXNlYXJjaC1mb3JtIGFcIikub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmICgkKGUuY3VycmVudFRhcmdldCkuYXR0cignYXJpYS1jb250cm9scycpID09PSBcInNlYXJjaFwiKSB7XG4gICAgICAgIGlmICgkKFwiI3NlYXJjaFwiKS52YWwoKSA9PT0gXCJcIikge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYoJChcIiNyZXNwb25zaXZlLXBhZ2VcIikudmFsKCkgIT09IFwibm9uZS1yZXNwb25zaXZlXCIpe1xuICAgICAgICAgIGlmIChIZWFkZXIud2luZG93V2lkdGggPCAxMjYwKSB7XG4gICAgICAgICAgICBzZWFyY2hCb3hBY3Rpb24oKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2xvc2VTZWFyY2goKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2VhcmNoQm94QWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICAkKHdpbmRvdykuYmluZCgncmVzaXplJywgZnVuY3Rpb24gKCkge1xuXG4gICAgICBpZiAoSGVhZGVyLndpbmRvd1dpZHRoID49IDEyNjApIHtcbiAgICAgICAgJCgnI2Rlc2t0b3Atc2VhcmNoLWZvcm0nKS5hdHRyKCdhcmlhLWhpZGRlbicsIGZhbHNlKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSWYgdGhlIHNlYXJjaCBmb3JtIGlzIG9wZW5lZCBmcm9tIG1vYmlsZSB2aWV3LFxuICAgICAgICAgKiBhbmQgdGhlIGJyb3dzZXIgaXMgcmVzaXplZCB0byBkZXNrdG9wIHZpZXcsXG4gICAgICAgICAqIGNsb3NlIHRoZSBvcGVuZWQgc2VhcmNoIGZvcm0uXG4gICAgICAgICAqL1xuICAgICAgICBpZiAoc2VhcmNoRm9ybS5oYXNDbGFzcyhcIm9wZW5lZFwiKSkge1xuICAgICAgICAgIHJldHVybiBzZWFyY2hGb3JtLnJlbW92ZUNsYXNzKFwib3BlbmVkXCIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkKCcjZGVza3RvcC1zZWFyY2gtZm9ybScpLmF0dHIoJ2FyaWEtaGlkZGVuJywgdHJ1ZSk7XG4gICAgICB9XG4gICAgfSkudHJpZ2dlcigncmVzaXplJyk7XG4gIH1cblxuICBmdW5jdGlvbiBzZWFyY2hCb3hBY3Rpb24oKXtcbiAgICBpZiAoSGVhZGVyLnNlYXJjaEljb24uaGFzQ2xhc3MoJ2hpZGUtc2VhcmNoJykpIHtcbiAgICAgIG9wZW5TZWFyY2goKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2xvc2VTZWFyY2goKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIE9wZW5zIHRoZSBzdWIgbmF2IGluIG1vYmlsZSB2aWV3XG4gICAqL1xuICBmdW5jdGlvbiBvcGVuU3ViTmF2KHN1Ym5hdiwgc3VibmF2VGl0bGUpIHtcbiAgICBzdWJuYXYuYXR0cignYXJpYS1leHBhbmRlZCcsIHRydWUpLmF0dHIoJ2FyaWEtaGlkZGVuJywgZmFsc2UpLmFkZENsYXNzKCdvcGVuZWQnKTtcbiAgICBzdWJuYXZUaXRsZS5hdHRyKCdhcmlhLWV4cGFuZGVkJywgdHJ1ZSk7XG4gICAgc3VibmF2VGl0bGUuYWRkQ2xhc3MoJ3N1Yi1tZW51LW9wZW5lZCcpLmF0dHIoJ2FyaWEtaGlkZGVuJywgdHJ1ZSk7XG4gICAgSGVhZGVyLm9wZW5lZFN1Yk5hdiA9IHN1Ym5hdlRpdGxlO1xuXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAkKCcjbW9iaWxlLW1lbnUgPiBvbCA+IGxpID4gYScpLm5vdCgnLnN1Yi1tZW51LW9wZW5lZCcpLnBhcmVudCgpLmVhY2goZnVuY3Rpb24gKGksIGVsZW0pIHtcbiAgICAgICAgJChlbGVtKS5hdHRyKCdhcmlhLWhpZGRlbicsIHRydWUpO1xuICAgICAgfSk7XG4gICAgICAkKCcjb2MtdHJpZ2dlcicpLmF0dHIoJ2FyaWEtaGlkZGVuJywgdHJ1ZSk7XG4gICAgICAkKCcuc3ViLW5hdi1iYWNrOnZpc2libGU6Zmlyc3QnKS5mb2N1cygpO1xuICAgIH0sIDI1KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbG9zZXMgdGhlIHN1YiBuYXYgaW4gbW9iaWxlIHZpZXdcbiAgICovXG4gIGZ1bmN0aW9uIGNsb3NlU3ViTmF2KHN1Ym5hdiwgc3VibmF2VGl0bGUpIHtcbiAgICBzdWJuYXYucmVtb3ZlQ2xhc3MoJ29wZW5lZCcpLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCBmYWxzZSkuYXR0cignYXJpYS1oaWRkZW4nLCB0cnVlKTtcbiAgICBzdWJuYXZUaXRsZS5hdHRyKCdhcmlhLWV4cGFuZGVkJywgdHJ1ZSkuYmx1cigpO1xuICAgICQoJyNtb2JpbGUtbWVudSA+IG9sID4gbGkgPiBhJykubm90KCcuc3ViLW1lbnUtb3BlbmVkJykucGFyZW50KCkuZWFjaChmdW5jdGlvbiAoaSwgZWxlbSkge1xuICAgICAgJChlbGVtKS5yZW1vdmVBdHRyKCdhcmlhLWhpZGRlbicpO1xuICAgIH0pO1xuICAgICQoJyNvYy10cmlnZ2VyJykucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4nKTtcblxuICAgIHN1Ym5hdlRpdGxlLnJlbW92ZUNsYXNzKCdzdWItbWVudS1vcGVuZWQnKTtcbiAgICBzdWJuYXZUaXRsZS5yZW1vdmVBdHRyKCdhcmlhLWhpZGRlbicpO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgSGVhZGVyLm9wZW5lZFN1Yk5hdi5mb2N1cygpO1xuICAgIH0sIDUwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPcGVuIHNlYXJjaCBpbiB0aGUgaGVhZGVyIHdoZW4gc3RpbGwgbm90IGluIG1vYmlsZSB2aWV3XG4gICAqL1xuICBmdW5jdGlvbiBvcGVuU2VhcmNoKCkge1xuICAgIEhlYWRlci5zZWFyY2hJY29uLnJlbW92ZUNsYXNzKCdoaWRlLXNlYXJjaCcpO1xuICAgIEhlYWRlci5zZWFyY2hPcGVuID0gdHJ1ZTtcbiAgICBIZWFkZXIuc2VhcmNoSWNvbi5yZW1vdmVDbGFzcygnaWNvbl9zZWFyY2gnKS5hZGRDbGFzcygnaWNvbl94IGNsb3NlLXNlYXJjaCcpO1xuXG4gICAgaWYgKEhlYWRlci53aW5kb3dXaWR0aCA8IDk2MCkge1xuICAgICAgJCgnbWFpbi5vYy1jb250ZW50JykuY3NzKHtcbiAgICAgICAgJ3BhZGRpbmctdG9wJzogJzQycHgnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAkKCcjbW9iaWxlLWhlYWRlci1hY2NvdW50LWluZm8nKS5hZGRDbGFzcygnc2VhcmNoLW9wZW4nKTtcbiAgICAkKCcjbW9iaWxlLWFjY291bnQtbWVudS1sb2dnZWQtb3V0JykuYWRkQ2xhc3MoJ3NlYXJjaC1vcGVuJyk7XG4gICAgJCgnI2Rlc2t0b3AtaGVhZGVyLXNlYXJjaCBhLCAjZGVza3RvcC1oZWFkZXItc2VhcmNoLCAjbW9iaWxlLWhlYWRlci1zZWFyY2ggYSwgI21vYmlsZS1oZWFkZXItc2VhcmNoJykuYWRkQ2xhc3MoJ29wZW5lZCcpO1xuICAgICQoJyNkZXNrdG9wLXNlYXJjaC1mb3JtLCAjbW9iaWxlLXNlYXJjaC1mb3JtJykuYWRkQ2xhc3MoJ29wZW5lZCcpO1xuICAgICQoJyNkZXNrdG9wLXNlYXJjaC1mb3JtLCAjbW9iaWxlLXNlYXJjaC1mb3JtJykuYXR0cignYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcbiAgICAkKCcjZGVza3RvcC1zZWFyY2gtZm9ybSBpbnB1dCwgI21vYmlsZS1oZWFkZXItc2VhcmNoIGlucHV0JykuZm9jdXMoKTtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICQoJyNkZXNrdG9wLXNlYXJjaC1mb3JtIGlucHV0LCAjbW9iaWxlLWhlYWRlci1zZWFyY2ggaW5wdXQnKS5mb2N1cygpO1xuICAgIH0sIDUwKTtcblxuICAgICQoXCIjbW9iaWxlLWhlYWRlci1zZWFyY2ggaW5wdXRcIikuY3NzKHsncGFkZGluZyc6ICcwIDVweCcsICdtYXJnaW4tbGVmdCc6ICcwJ30pO1xuICAgICQoJy5tb2RhbC1wb2ludHMtdHJhbnNmZXInKS5jc3MoJ3RvcCcsICcxNzBweCcpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsb3NlIHNlYXJjaCBpbiB0aGUgaGVhZGVyXG4gICAqL1xuICBmdW5jdGlvbiBjbG9zZVNlYXJjaCgpIHtcblxuICAgIEhlYWRlci5zZWFyY2hPcGVuID0gZmFsc2U7XG4gICAgJChcIiNtb2JpbGUtaGVhZGVyLXNlYXJjaCBpbnB1dFwiKS5jc3MoeydwYWRkaW5nJzogJzEzcHggMTZweCAxMnB4IDEwcHgnLCAnbWFyZ2luLWxlZnQnOiAnMCd9KTtcbiAgICBIZWFkZXIuc2VhcmNoSWNvbi5hZGRDbGFzcygnaGlkZS1zZWFyY2gnKTtcbiAgICBIZWFkZXIuc2VhcmNoSWNvbi5yZW1vdmVDbGFzcygnaWNvbl94JykuYWRkQ2xhc3MoJ2ljb25fc2VhcmNoJyk7XG4gICAgJCgnI2Rlc2t0b3AtaGVhZGVyLXNlYXJjaCBhLCAjbW9iaWxlLWhlYWRlci1zZWFyY2ggYScpLnJlbW92ZUNsYXNzKCdvcGVuZWQnKTtcbiAgICAkKCcjbW9iaWxlLWhlYWRlci1hY2NvdW50LWluZm8nKS5yZW1vdmVDbGFzcygnc2VhcmNoLW9wZW4nKTtcbiAgICAkKCcjbW9iaWxlLWFjY291bnQtbWVudS1sb2dnZWQtb3V0JykucmVtb3ZlQ2xhc3MoJ3NlYXJjaC1vcGVuJyk7XG4gICAgJCgnbWFpbi5vYy1jb250ZW50JykuY3NzKHtcbiAgICAgICdwYWRkaW5nLXRvcCc6IDBcbiAgICB9KTtcbiAgICAkKCcjZGVza3RvcC1zZWFyY2gtZm9ybSwgI21vYmlsZS1zZWFyY2gtZm9ybScpLnJlbW92ZUNsYXNzKCdvcGVuZWQnKTtcbiAgICAkKCcjZGVza3RvcC1oZWFkZXItc2VhcmNoIGlucHV0LCAjbW9iaWxlLWhlYWRlci1zZWFyY2ggaW5wdXQnKS5ibHVyKCk7XG4gICAgJCgnI2Rlc2t0b3AtaGVhZGVyLXNlYXJjaCBhLCAjbW9iaWxlLWhlYWRlci1zZWFyY2ggYScpLmJsdXIoKTtcbiAgICAkKCcjZGVza3RvcC1zZWFyY2gtZm9ybSwgI21vYmlsZS1zZWFyY2gtZm9ybScpLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcbiAgICAkKCcjZGVza3RvcC1zZWFyY2gtZm9ybSBpbnB1dCwgI21vYmlsZS1oZWFkZXItc2VhcmNoIGlucHV0JykudW5iaW5kKCdibHVyJyk7XG4gICAgJChcIiNtb2JpbGUtaGVhZGVyLXNlYXJjaCBpbnB1dFwiKS5jc3MoeydwYWRkaW5nJzogJzAnfSk7XG4gICAgJCh3aW5kb3cpLnVuYmluZCgna2V5dXAnKTtcbiAgICAkKCcubW9kYWwtcG9pbnRzLXRyYW5zZmVyJykuY3NzKCd0b3AnLCAnMTM4cHgnKTtcbiAgfVxuXG5cbiAgLyoqXG4gICAqIEFjY291bnQgTmFtZSBvdmVyZmxvdyBmdW5jdGlvblxuICAgKi9cbiAgZnVuY3Rpb24gc2V0dXBBY2NvdW50TmFtZU92ZXJmbG93KCkge1xuXG4gICAgLy8gRGVza3RvcCBuYW1lXG4gICAgdmFyIGhlaWdodCA9ICczMHB4JztcbiAgICB2YXIgJG5hbWUgPSAkKCcjYWNjb3VudC1tZW51LWxvZ2dlZC1pbiAuZ3JlZXRpbmcnKTtcbiAgICB2YXIgJHBvaW50cyA9ICQoJyNhY2NvdW50LW1lbnUtbG9nZ2VkLWluIC5wb2ludHMnKTtcbiAgICB2YXIgJHBhcmVudCA9ICQoJyNhY2NvdW50LW1lbnUtbG9nZ2VkLWluID4gYScpO1xuICAgIGlmICgkbmFtZS5sZW5ndGggPD0gMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgICRuYW1lLmJpbmQoJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnNvbGUubG9nKCRuYW1lLnRleHQoKS5sZW5ndGgpO1xuICAgIH0pO1xuXG4gICAgdmFyIGxlbiA9ICRuYW1lLnRleHQoKS5sZW5ndGg7XG5cbiAgICB2YXIgZWxlbSA9ICRuYW1lLmdldCgwKTtcbiAgICAvL2lmIHRleHQgaXMgb3ZlcmZsb3dpbmcgY29udGFpbmVyXG4gICAgaWYgKGxlbiA8IDM2KSB7XG4gICAgICAkbmFtZS5jc3Moe1xuICAgICAgICAnZm9udC1zaXplJzogJzEzcHgnXG4gICAgICB9KTtcbiAgICAgICRwb2ludHMuY3NzKHtcbiAgICAgICAgJ2ZvbnQtc2l6ZSc6ICcxM3B4J1xuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChlbGVtLm9mZnNldFdpZHRoIDwgZWxlbS5zY3JvbGxXaWR0aCkge1xuXG5cbiAgICAgIGlmIChsZW4gPj0gMzcgJiYgbGVuIDwgODYpIHtcbiAgICAgICAgJG5hbWUuY3NzKHtcbiAgICAgICAgICAnaGVpZ2h0JzogJ2F1dG8nLFxuICAgICAgICAgICdwYWRkaW5nLXJpZ2h0JzogJzdweCcsXG4gICAgICAgICAgJ3doaXRlLXNwYWNlJzogJ25vcm1hbCcsXG4gICAgICAgICAgJ3dvcmQtYnJlYWsnOiAnYnJlYWstd29yZCdcbiAgICAgICAgfSk7XG4gICAgICAgICRwYXJlbnQuY3NzKHtcbiAgICAgICAgICAncGFkZGluZyc6ICc2cHggMTBweCAzcHggMTBweCdcbiAgICAgICAgfSk7XG4gICAgICAgICRwb2ludHMuY3NzKHtcbiAgICAgICAgICAnZm9udC1zaXplJzogJzExcHgnXG4gICAgICAgIH0pO1xuXG4gICAgICB9XG4gICAgICAvL3R3byBsaW5lcyBuZWVkcyBkb3Rkb3Rkb3RcbiAgICAgIGlmIChsZW4gPj0gODYpIHtcblxuICAgICAgICAkcGFyZW50LmNzcyh7XG4gICAgICAgICAgJ3BhZGRpbmcnOiAnNXB4IDEwcHgnXG4gICAgICAgIH0pO1xuICAgICAgICAkbmFtZS5jc3Moe1xuICAgICAgICAgICdoZWlnaHQnOiAnMjVweCcsXG4gICAgICAgICAgJ2ZvbnQtc2l6ZSc6ICc5cHgnLFxuICAgICAgICAgICdwYWRkaW5nLXJpZ2h0JzogJzdweCdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJG5hbWUuZG90ZG90ZG90KCk7XG4gICAgICAgICQoJyNhY2NvdW50LW1lbnUtbG9nZ2VkLWluJykuaG92ZXIoXG4gICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJG5hbWUuY3NzKHtcbiAgICAgICAgICAgICAgJ2hlaWdodCc6ICdhdXRvJyxcbiAgICAgICAgICAgICAgJ21hcmdpbi1ib3R0b20nOiAnMTBweCcsXG4gICAgICAgICAgICAgICdmb250LXNpemUnOiAnMTFweCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJG5hbWUudHJpZ2dlcihcIm9yaWdpbmFsQ29udGVudFwiLCBmdW5jdGlvbiAoY29udGVudCkge1xuICAgICAgICAgICAgICAkbmFtZS5lbXB0eSgpLmFwcGVuZChjb250ZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJG5hbWUuY3NzKHtcbiAgICAgICAgICAgICAgJ2hlaWdodCc6IGhlaWdodFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkbmFtZS5kb3Rkb3Rkb3QoKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICB9XG5cbiAgICAvLyBNb2JpbGUgbmFtZVxuICAgIHZhciAkbW9iaWxlR3JlZXRpbmcgPSAkKCcjbW9iaWxlLWhlYWRlci1hY2NvdW50LWluZm8gLmdyZWV0aW5nJyk7XG4gICAgaWYgKCRtb2JpbGVHcmVldGluZy5sZW5ndGggPiAwICYmICRtb2JpbGVHcmVldGluZy50ZXh0KCkubGVuZ3RoID4gNjQpIHtcbiAgICAgICRtb2JpbGVHcmVldGluZy5jc3Moe1xuICAgICAgICBoZWlnaHQ6ICc0MHB4JyxcbiAgICAgICAgJ3dvcmQtd3JhcCc6ICdicmVhay13b3JkJ1xuICAgICAgfSk7XG4gICAgICAkbW9iaWxlR3JlZXRpbmcuZG90ZG90ZG90KHtcbiAgICAgICAgd2F0Y2g6IHRydWVcbiAgICAgIH0pO1xuICAgIH1cblxuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemVzIGFuZCByZXNldHMgdGhlIG1lbnUgZm9yIG1vYmlsZSBvbmx5XG4gICAqL1xuICBmdW5jdGlvbiBpbml0TWVudSgpIHtcblxuICAgIHZhciAkbWVudSA9ICQoJyNtb2JpbGUtbWVudScpO1xuICAgIHZhciAkbWVudVRyaWdnZXIgPSAkKCcjb2MtdHJpZ2dlcicpO1xuICAgIHZhciAkdHJpZ2dlciA9ICQoJyNtZW51LWJ1dHRvbicpO1xuICAgIHZhciBpc09wZW4gPSBmYWxzZTtcblxuICAgICR0cmlnZ2VyLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnKTtcbiAgICAkdHJpZ2dlci5hdHRyKCdhcmlhLWxhYmVsJywgJ01lbnUnKTtcbiAgICAkdHJpZ2dlci5hdHRyKCdhcmlhLWNvbnRyb2xzJywgJ21vYmlsZS1tZW51Jyk7XG5cbiAgICAkbWVudS5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gICAgJG1lbnUuYXR0cignYXJpYS1sYWJlbGxlZGJ5JywgJ21lbnUtYnV0dG9uJyk7XG5cbiAgICB2YXIgJGNvbnRhaW5lciA9ICQoJyNvYy1jb250YWluZXInKTtcblxuXG4gICAgZnVuY3Rpb24gcmVzZXRNZW51KCkge1xuICAgICAgJG1lbnVUcmlnZ2VyLmZpbmQoJz4gYSwgPiBkaXYnKS5ub3QoJyNtZW51LWJ1dHRvbicpLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuJyk7XG4gICAgICAkdHJpZ2dlci5hdHRyKCdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyk7XG4gICAgICAkbWVudS5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gICAgICAkY29udGFpbmVyLnJlbW92ZUNsYXNzKCdvYy1tZW51LW9wZW4nKTtcbiAgICAgICRjb250YWluZXIucmVtb3ZlQ2xhc3MoJ29jLXB1c2gnKTtcbiAgICAgIGlzT3BlbiA9IGZhbHNlO1xuICAgICAgJHRyaWdnZXIucmVtb3ZlQ2xhc3MoJ29wZW5lZCcpO1xuICAgICAgJHRyaWdnZXIuYXR0cignYXJpYS1leHBhbmRlZCcsICdmYWxzZScpO1xuICAgICAgJG1lbnUuYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuICAgICAgJG1lbnUuYXR0cignYXJpYS1leHBhbmRlZCcsICdmYWxzZScpO1xuICAgICAgJCgnI21lbnUtYnV0dG9uJykuYmx1cigpO1xuICAgICAgJCgnLm9jLWNvbnRlbnQnKS5yZW1vdmVBdHRyKCdhcmlhLWhpZGRlbicpO1xuICAgICAgJCgnI2Zvb3RlcicpLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuJyk7XG4gICAgICAkKCcuYmFjay10by10b3AnKS5yZW1vdmVBdHRyKCdhcmlhLWhpZGRlbicpO1xuICAgICAgJHRyaWdnZXIuYXR0cignYXJpYS1sYWJlbCcsICdNZW51Jyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYm9keUNsaWNrRm4oKSB7XG4gICAgICBpZiAoaXNPcGVuKSB7XG4gICAgICAgIHJlc2V0TWVudSgpO1xuICAgICAgfVxuICAgIH1cblxuXG4gICAgJCgnI21vYmlsZS1tZW51IGE6bGFzdCcpLmJpbmQoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAkdHJpZ2dlci5mb2N1cygpO1xuICAgIH0pO1xuICAgICR0cmlnZ2VyLmJpbmQoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoJCgnLm9jLW1lbnUtb3BlbicpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgJCgnI21vYmlsZS1tZW51IGE6Zmlyc3QnKS5mb2N1cygpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgJCgnI21lbnUtYnV0dG9uJykuYmluZCgnY2xpY2sgdG91Y2hzdGFydCcsIGZ1bmN0aW9uIChldikge1xuICAgICAgaWYgKGlzT3Blbikge1xuICAgICAgICByZXNldE1lbnUoKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaXNPcGVuID0gdHJ1ZTtcbiAgICAgICRtZW51VHJpZ2dlci5maW5kKCc+IGEsID4gZGl2Jykubm90KCcjbWVudS1idXR0b24nKS5hdHRyKCdhcmlhLWhpZGRlbicsIHRydWUpO1xuICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAkdHJpZ2dlci5hdHRyKCdhcmlhLWxhYmVsJywgJ0Nsb3NlIE1lbnUnKTtcbiAgICAgICR0cmlnZ2VyLmFkZENsYXNzKCdvcGVuZWQnKTtcbiAgICAgICR0cmlnZ2VyLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpO1xuICAgICAgJG1lbnUucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4nKTtcbiAgICAgICRtZW51LmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpO1xuICAgICAgJCgnLm9jLWNvbnRlbnQnKS5hdHRyKCdhcmlhLWhpZGRlbicsIHRydWUpO1xuICAgICAgJCgnI2Zvb3RlcicpLmF0dHIoJ2FyaWEtaGlkZGVuJywgdHJ1ZSk7XG4gICAgICAkKCcuYmFjay10by10b3AnKS5hdHRyKCdhcmlhLWhpZGRlbicsIHRydWUpO1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICQoJyNtb2JpbGUtbWVudSBhOnZpc2libGU6Zmlyc3QnKS5mb2N1cygpO1xuICAgICAgfSwgMjUpO1xuXG4gICAgICAkY29udGFpbmVyLmFkZENsYXNzKCdvYy1jb250YWluZXInKTsgLy8gY2xlYXJcbiAgICAgICRjb250YWluZXIuYWRkQ2xhc3MoJ29jLXB1c2gnKTtcbiAgICAgICRjb250YWluZXIuYWRkQ2xhc3MoJ29jLW1lbnUtb3BlbicpO1xuXG4gICAgICAkKCcub2MtY29udGVudCcpLmJpbmQoJ2NsaWNrIHRvdWNoc3RhcnQnLCBib2R5Q2xpY2tGbik7XG4gICAgfSk7XG5cblxuICAgIC8vIEhhbmRsZSAnZXNjJyBldmVudFxuICAgIC8vIEtleWJvYXJkIFR3ZWFrcyB2aWEgU2NvdHQgVmlua2xlXG4gICAgdmFyIGVzY2FwZU1lbnUgPSBmdW5jdGlvbiAoZXYpIHtcbiAgICAgIGlmIChldi53aGljaCA9PT0gS2V5Ym9hcmQuRVNDQVBFKSB7XG4gICAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXNldE1lbnUoKTtcbiAgICAgICAgJHRyaWdnZXIuZm9jdXMoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgJHRyaWdnZXIuYmluZCgna2V5ZG93bicsIGZ1bmN0aW9uIChldikge1xuICAgICAgZXNjYXBlTWVudShldik7XG4gICAgfSk7XG5cbiAgICAkbWVudS5iaW5kKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2KSB7XG4gICAgICBlc2NhcGVNZW51KGV2KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHBhcmFtZXRlciBieSBuYW1lXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAqL1xuICBmdW5jdGlvbiBfZ2V0UGFyYW1ldGVyQnlOYW1lKG5hbWUpIHtcblxuICAgIHZhciBmb3JtYXR0ZWROYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXS8sIFwiXFxcXFtcIikucmVwbGFjZSgvW1xcXV0vLCBcIlxcXFxdXCIpLFxuICAgICAgcmVnZXggPSBuZXcgUmVnRXhwKFwiW1xcXFw/Jl1cIiArIGZvcm1hdHRlZE5hbWUgKyBcIj0oW14mI10qKVwiKSxcbiAgICAgIHJlc3VsdHMgPSByZWdleC5leGVjKGxvY2F0aW9uLnNlYXJjaCk7XG5cbiAgICByZXR1cm4gcmVzdWx0cyA9PT0gbnVsbCA/IFwiXCIgOiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1sxXS5yZXBsYWNlKC9cXCsvZywgXCIgXCIpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHVwIHNlY3Rpb24gc3ViLW5hdnMgKGkuZS4gdHJhdmVsIHNlY3Rpb24gY2Fycy9ob3RlbHMvcG9pbnRzKVxuICAgKi9cbiAgZnVuY3Rpb24gX3NldHVwU2VjdGlvblN1Yk5hdnMoKSB7XG5cbiAgICB2YXIgZGVmYXVsdFRhYiA9IDA7XG4gICAgLy8gbG9vayBmb3IgZGVmYXVsdCB0YWIgY2xhc3NcbiAgICBpZiAoJCgnI3RyYXZlbC10YWJzIC5kZWZhdWx0LXRhYicpLmxlbmd0aCA+IDApIHtcbiAgICAgIGRlZmF1bHRUYWIgPSAkKCcjdHJhdmVsLXRhYnMgLmRlZmF1bHQtdGFiJykuaW5kZXgoKTtcbiAgICB9XG5cbiAgICBpZiAoJCgnI3RyYXZlbC10YWJzIC51aS1zdGF0ZS1hY3RpdmUnKS5sZW5ndGggPiAwKSB7XG4gICAgICBkZWZhdWx0VGFiID0gJCgnI3RyYXZlbC10YWJzIC51aS1zdGF0ZS1hY3RpdmUnKS5pbmRleCgpO1xuICAgIH1cblxuICAgICQoJyN0cmF2ZWwtdGFicyBsaScpLm5vdCgnLmFjdGl2YXRlZCcpLnJlbW92ZSgpO1xuXG4gICAgJChcIiN0cmF2ZWwtdGFic1wiKS50YWJzKHtcbiAgICAgIGFjdGl2ZTogZGVmYXVsdFRhYlxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdXAgdHJhdmVsIHZhbGlkYXRpb25cbiAgICovXG4gIGZ1bmN0aW9uIF9zZXR1cFRyYXZlbFZhbGlkYXRpb24oKSB7XG5cbiAgICAkKCcuc3ViLXNlY3Rpb24nKS5lYWNoKGZ1bmN0aW9uIChpLCBlbGVtKSB7XG4gICAgICB2YXIgJHNlY3Rpb24gPSAkKGVsZW0pO1xuICAgICAgdmFyICRpbnB1dHMgPSAkc2VjdGlvbi5maW5kKCdpbnB1dFt0eXBlPVwidGV4dFwiXScpO1xuICAgICAgdmFyICRlcnJvck1lc3NhZ2UgPSAkc2VjdGlvbi5maW5kKCcuZXJyb3ItbWVzc2FnZScpLmF0dHIoJ3RhYmluZGV4JywgMCk7XG5cblxuICAgICAgZnVuY3Rpb24gdmFsaWRhdGVTZWN0aW9uKGUpIHtcblxuICAgICAgICAkKCcuaGFzLWVycm9yJykucmVtb3ZlQ2xhc3MoJ2hhcy1lcnJvcicpO1xuICAgICAgICAkc2VjdGlvbi5yZW1vdmVDbGFzcygnaGFzLWVycm9yJyk7XG4gICAgICAgIHZhciBlcnJvcnMgPSBmYWxzZTtcbiAgICAgICAgdmFyIGVycm9yRWxlbWVudHMgPSBbXTtcblxuICAgICAgICAvL3Rlc3QgaW5wdXRzXG4gICAgICAgICRpbnB1dHMuZWFjaChmdW5jdGlvbiAoaSwgZWxlbSkge1xuICAgICAgICAgIGlmICgkKGVsZW0pLnZhbCgpID09PSAnJykge1xuICAgICAgICAgICAgZXJyb3JzID0gdHJ1ZTtcbiAgICAgICAgICAgIGVycm9yRWxlbWVudHMucHVzaChlbGVtKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChlcnJvcnMpIHtcbiAgICAgICAgICAkc2VjdGlvbi5hZGRDbGFzcygnaGFzLWVycm9yJyk7XG4gICAgICAgICAgJC5lYWNoKGVycm9yRWxlbWVudHMsIGZ1bmN0aW9uIChpLCBlbGVtKSB7XG4gICAgICAgICAgICAkKGVsZW0pLmJpbmQoJ2NoYW5nZSBrZXl1cCBzZWxlY3RtZW51Y2hhbmdlJywgdmFsaWRhdGVTZWN0aW9uKS5hZGRDbGFzcygnaGFzLWVycm9yJyk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAoZS50eXBlID09PSBcImNsaWNrXCIpIHtcbiAgICAgICAgICAgICRlcnJvck1lc3NhZ2UuZm9jdXMoKS5iaW5kKCdibHVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAkaW5wdXRzLmZpcnN0KCkuZm9jdXMoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgIH0vL2VuZCBhLmJ0biBjbGljayBldmVudFxuXG4gICAgICAkc2VjdGlvbi5maW5kKCdhLmJ0bicpLmJpbmQoJ2NsaWNrJywgdmFsaWRhdGVTZWN0aW9uKTtcblxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuYWJsZXMgZnVuY3Rpb25hbGl0eSBmb3Igc2hvd2luZy9oaWRpbmcgc3ViIHNlY3Rpb25zIGJhc2VkIHVwb24gc3ViIHNlY3Rpb24gbmF2c1xuICAgKi9cbiAgZnVuY3Rpb24gX3Nob3dIaWRlU3ViU2VjdGlvbnMoKSB7XG5cbiAgICAkKFwibGlbcm9sZT0ndGFiJ11cIikuY2xpY2soZnVuY3Rpb24gKCkge1xuXG4gICAgICAkKFwibGlbcm9sZT0ndGFiJ106bm90KHRoaXMpXCIpLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsIFwiZmFsc2VcIik7XG4gICAgICAkKHRoaXMpLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsIFwidHJ1ZVwiKTtcblxuICAgICAgdmFyIHRhYnBhbmlkID0gJCh0aGlzKS5hdHRyKFwiYXJpYS1jb250cm9sc1wiKTtcbiAgICAgIHZhciB0YWJwYW4gPSAkKFwiI1wiICsgdGFicGFuaWQpO1xuXG4gICAgICAkKFwiZGl2W3JvbGU9J3RhYnBhbmVsJ106bm90KHRhYnBhbilcIikuYXR0cihcImFyaWEtaGlkZGVuXCIsIFwidHJ1ZVwiKTtcbiAgICAgICQoXCJkaXZbcm9sZT0ndGFicGFuZWwnXTpub3QodGFicGFuKVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcblxuICAgICAgdGFicGFuLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgdGFicGFuLmF0dHIoXCJhcmlhLWhpZGRlblwiLCBcImZhbHNlXCIpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdXAganF1ZXJ5LXVpIHNlbGVjdCBtZW51IGZvciBzZWxlY3QgZWxlbWVudHMgKHBvaW50cyB0cmFuc2ZlciBkcm9wZG93bnMpXG4gICAqL1xuICBmdW5jdGlvbiBfc2VsZWN0TWVudUZvckVsZW1lbnQoKSB7XG5cbiAgICAkKCcuZHJvcGRvd246bm90KC5kZXNrdG9wLWZpbHRlciknKS5maW5kKCdzZWxlY3QnKS5lYWNoKGZ1bmN0aW9uIChpLCBlbGVtKSB7XG4gICAgICB2YXIgJGVsZW0gPSAkKGVsZW0pO1xuICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgICBpY29uczoge1xuICAgICAgICAgIGJ1dHRvbjogJ2ljb24gaWNvbl9jYXJldC1kb3duJ1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBpZiAoJGVsZW0uYXR0cignZGF0YS1wbGFjZWhvbGRlcicpKSB7XG4gICAgICAgIHNldHRpbmdzWydwbGFjZWhvbGRlciddID0gJGVsZW0uYXR0cignZGF0YS1wbGFjZWhvbGRlcicpO1xuICAgICAgfVxuICAgICAgJGVsZW0uc2VsZWN0bWVudShzZXR0aW5ncyk7XG5cbiAgICAgICQod2luZG93KS5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRlbGVtLnNlbGVjdG1lbnUoJ2Nsb3NlJyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICB9XG5cblxuICAvKipcbiAgICogQWRkcyBzdHlsZSBmb3IgYWN0aXZhdGVkIG1lbnUgaXRlbVxuICAgKi9cbiAgZnVuY3Rpb24gX2FkZFN0eWxlQWN0aXZhdGVkTWVudUl0ZW0oKSB7XG5cbiAgICAkKCcubWFpbi1tZW51IC5tZW51LWxpc3QgPiB1bCcpLmVhY2goZnVuY3Rpb24gKGksIGVsZW0pIHtcblxuICAgICAgaWYgKCQoZWxlbSkuZmluZCgnbGkuYWN0aXZhdGVkJykubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICQoZWxlbSkuZmluZCgnbGkuYWN0aXZhdGVkLCBsaS5hY3RpdmF0ZWQgPiBhJykuY3NzKHsnYm9yZGVyLWJvdHRvbSc6ICcwcHggc29saWQgdHJhbnNwYXJlbnQnfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBrZXlib2FyZCBhY2Nlc3NpYmlsaXR5IGJ5IGFkZGluZyB0aGUgZW50ZXIga2V5IHRvIHRoZSBiYXNpYyBjbGljayBldmVudC5cbiAgICovXG4gIGZ1bmN0aW9uIF9hZGRLZXlib2FyZEVudGVyS2V5KCkge1xuXG4gICAgJChcImxpW3JvbGU9J3RhYiddXCIpLmtleWRvd24oZnVuY3Rpb24gKGV2KSB7XG5cbiAgICAgIGlmIChldi53aGljaCA9PT0gS2V5Ym9hcmQuRU5URVIpIHtcbiAgICAgICAgJCh0aGlzKS5jbGljaygpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIF9hZGRLZXlib2FyZEFycm93TmF2aWdhdGlvbiBJbXBsZW1lbnRzIGFycm93IGtleSBhY2Nlc3Mgb2YgYSBqUXVlcnkgbGlzdCBlbGVtZW50LlxuICAgKiBBc3N1bWVzIFNsaWNrSlMgY2Fyb3VzZWwgbWFya3VwIGlmICdzbGljay1zbGlkZScgaXMgcHJlc2VudC5cbiAgICogQHBhcmFtIHtPYmplY3R9ICRsaXN0RWxlbWVudCBbZGVzY3JpcHRpb25dXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBpdGVtU2VsZWN0b3IgW2Rlc2NyaXB0aW9uXVxuICAgKiBAcGFyYW0ge1N0cmluZ30gbGlua1NlbGVjdG9yIFtkZXNjcmlwdGlvbl1cbiAgICovXG4gIGZ1bmN0aW9uIF9hZGRLZXlib2FyZEFycm93TmF2aWdhdGlvbigkbGlzdEVsZW1lbnQsIGl0ZW1TZWxlY3RvciwgbGlua1NlbGVjdG9yKSB7XG4gICAgZnVuY3Rpb24gX2hlbHBlckdldE5leHQoJGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiAkZWxlbWVudC5uZXh0KCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2hlbHBlckdldFByZXYoJGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiAkZWxlbWVudC5wcmV2KCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2hlbHBlckdldEZpcnN0KCRlbGVtZW50KSB7XG4gICAgICByZXR1cm4gJGVsZW1lbnQucGFyZW50c1VudGlsKCdzbGljay1zaWRlcicpLmZpbmQoJy5zbGljay1hY3RpdmUnKS5maXJzdCgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9oZWxwZXJHZXRMYXN0KCRlbGVtZW50KSB7XG4gICAgICByZXR1cm4gJGVsZW1lbnQucGFyZW50c1VudGlsKCdzbGljay1zbGlkZXInKS5maW5kKCcuc2xpY2stYWN0aXZlJykubGFzdCgpO1xuICAgIH1cblxuICAgICRsaXN0RWxlbWVudC5rZXlkb3duKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgdmFyICRjdXJyZW50U2VsZWN0aW9uID0gJCh0aGlzKS5maW5kKCcuYWN0aXZlJykubm90KCcuc2xpY2stY2xvbmVkJyk7XG4gICAgICB2YXIgJG5ld1NlbGVjdGlvbkNvbnRhaW5lciA9ICRjdXJyZW50U2VsZWN0aW9uLmNsb3Nlc3QoaXRlbVNlbGVjdG9yKTtcbiAgICAgIHZhciAkYWN0aXZlU2xpZGVDb250YWluZXIgPSAkbmV3U2VsZWN0aW9uQ29udGFpbmVyLmNsb3Nlc3QoJy5zbGljay1hY3RpdmUnKSB8fCBudWxsO1xuICAgICAgdmFyICRnb3RvU2xpZGVDb250YWluZXI7XG4gICAgICB2YXIgJG5ld1NlbGVjdGlvbjtcblxuICAgICAgc3dpdGNoIChldmVudC53aGljaCkge1xuICAgICAgICBjYXNlIEtleWJvYXJkLlJJR0hUOlxuICAgICAgICBjYXNlIEtleWJvYXJkLlVQOlxuICAgICAgICAgIC8vIFNsaWRlSlMgY2Fyb3VzZWwgZGV0ZWN0ZWRcbiAgICAgICAgICBpZiAoJGFjdGl2ZVNsaWRlQ29udGFpbmVyLmxlbmd0aCkge1xuICAgICAgICAgICAgJGdvdG9TbGlkZUNvbnRhaW5lciA9IF9oZWxwZXJHZXROZXh0KCRhY3RpdmVTbGlkZUNvbnRhaW5lcik7XG5cbiAgICAgICAgICAgIC8vIE9ubHkgc2VsZWN0IHRoZSBuZXh0IGFjdGl2ZSB2aXNpYmxlIHNsaWRlIGluIHRoZSBjYXJvdXNlbCwgb3RoZXJ3aXNlIG1vdmUgdG8gdGhlIGZpcnN0IG9uZS5cbiAgICAgICAgICAgIGlmICghJGdvdG9TbGlkZUNvbnRhaW5lci5oYXNDbGFzcygnc2xpY2stYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgJGdvdG9TbGlkZUNvbnRhaW5lciA9IF9oZWxwZXJHZXRGaXJzdCgkbmV3U2VsZWN0aW9uQ29udGFpbmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRuZXdTZWxlY3Rpb24gPSAkZ290b1NsaWRlQ29udGFpbmVyLmZpbmQobGlua1NlbGVjdG9yKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBObyBTbGlkZUpTXG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkbmV3U2VsZWN0aW9uID0gJGN1cnJlbnRTZWxlY3Rpb24uY2xvc2VzdChpdGVtU2VsZWN0b3IpLm5leHQoKS5maW5kKGxpbmtTZWxlY3Rvcik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgS2V5Ym9hcmQuTEVGVDpcbiAgICAgICAgY2FzZSBLZXlib2FyZC5ET1dOOlxuICAgICAgICAgIC8vIFNsaWRlSlMgY2Fyb3VzZWwgZGV0ZWN0ZWRcbiAgICAgICAgICBpZiAoJGFjdGl2ZVNsaWRlQ29udGFpbmVyLmxlbmd0aCkge1xuICAgICAgICAgICAgJGdvdG9TbGlkZUNvbnRhaW5lciA9IF9oZWxwZXJHZXRQcmV2KCRhY3RpdmVTbGlkZUNvbnRhaW5lcik7XG5cbiAgICAgICAgICAgIC8vIE9ubHkgc2VsZWN0IHRoZSBwcmV2aW91cyBhY3RpdmUgdmlzaWJsZSBzbGlkZSBpbiB0aGUgY2Fyb3VzZWwsIG90aGVyd2lzZSBtb3ZlIHRvIHRoZSBsYXN0IG9uZS5cbiAgICAgICAgICAgIGlmICghJGdvdG9TbGlkZUNvbnRhaW5lci5oYXNDbGFzcygnc2xpY2stYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgJGdvdG9TbGlkZUNvbnRhaW5lciA9IF9oZWxwZXJHZXRMYXN0KCRuZXdTZWxlY3Rpb25Db250YWluZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJG5ld1NlbGVjdGlvbiA9ICRnb3RvU2xpZGVDb250YWluZXIuZmluZChsaW5rU2VsZWN0b3IpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIE5vIFNsaWRlSlNcbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICRuZXdTZWxlY3Rpb24gPSAkY3VycmVudFNlbGVjdGlvbi5jbG9zZXN0KGl0ZW1TZWxlY3RvcikucHJldigpLmZpbmQobGlua1NlbGVjdG9yKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSBLZXlib2FyZC5FTlRFUjpcbiAgICAgICAgICAkY3VycmVudFNlbGVjdGlvbi5jbGljaygpO1xuICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICAvLyBXZSBhcmUgYXQgdGhlIGVuZCBvZiB0aGUgbGlzdC5cbiAgICAgIGlmICgoJG5ld1NlbGVjdGlvbiAmJiAkbmV3U2VsZWN0aW9uLmxlbmd0aCA9PT0gMCkgfHwgKCRuZXdTZWxlY3Rpb24gPT09IHVuZGVmaW5lZCkpIHtcbiAgICAgICAgJG5ld1NlbGVjdGlvbiA9ICRjdXJyZW50U2VsZWN0aW9uO1xuICAgICAgfVxuXG4gICAgICAvLyBUb2dnbGUgYWN0aXZlIGNsYXNzZXMuXG4gICAgICAkY3VycmVudFNlbGVjdGlvbi5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAkbmV3U2VsZWN0aW9uLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGtleWJvYXJkIGZ1bmN0aW9uIHRoYXQgcHJlc3NpbmcgYW4gYXJyb3cgbGVmdCBvciBhcnJvdyByaWdodCBmcm9tIHRoZSB0YWJzIHRvZ2dlbCB0aGUgdGFicy5cbiAgICovXG4gIGZ1bmN0aW9uIF9hZGRLZXlib2FyZExlZnRSaWdodFRvZ2dsZSgpIHtcblxuICAgICQoXCJsaVtyb2xlPSd0YWInXVwiKS5rZXlkb3duKGZ1bmN0aW9uIChldikge1xuICAgICAgdmFyIGdvdG87XG5cbiAgICAgIGlmIChldi53aGljaCA9PT0gS2V5Ym9hcmQuTEVGVCkge1xuICAgICAgICBnb3RvID0gJCh0aGlzKS5wcmV2KCk7XG5cbiAgICAgICAgaWYgKGdvdG8ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgZ290byA9ICQoJy5zZWN0aW9uLXN1Yi1uYXYgdWwgPiBsaVtyb2xlPVwidGFiXCJdOmxhc3QnKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoZXYud2hpY2ggPT09IEtleWJvYXJkLlJJR0hUKSB7XG4gICAgICAgIGdvdG8gPSAkKHRoaXMpLm5leHQoKTtcbiAgICAgICAgaWYgKGdvdG8ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgZ290byA9ICQoJy5zZWN0aW9uLXN1Yi1uYXYgdWwgPiBsaVtyb2xlPVwidGFiXCJdOmZpcnN0Jyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGdvdG8gIT09IHVuZGVmaW5lZCAmJiBnb3RvLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZ290by5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCBcInRydWVcIikuZm9jdXMoKTtcbiAgICAgICAgJCh0aGlzKS5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCBcImZhbHNlXCIpO1xuXG4gICAgICAgIHZhciB0YWJwYW5pZCA9ICQoXCJsaVthcmlhLXNlbGVjdGVkPSd0cnVlJ11cIikuYXR0cihcImFyaWEtY29udHJvbHNcIik7XG4gICAgICAgIHZhciB0YWJwYW4gPSAkKFwiI1wiICsgdGFicGFuaWQpO1xuICAgICAgICAkKFwiZGl2W3JvbGU9J3RhYnBhbmVsJ106bm90KHRhYnBhbilcIikuYXR0cihcImFyaWEtaGlkZGVuXCIsIFwidHJ1ZVwiKTtcbiAgICAgICAgJChcImRpdltyb2xlPSd0YWJwYW5lbCddOm5vdCh0YWJwYW4pXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuXG4gICAgICAgIHRhYnBhbi5hdHRyKFwiYXJpYS1oaWRkZW5cIiwgXCJmYWxzZVwiKTtcbiAgICAgICAgdGFicGFuLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgfVxuXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogTGVnYWN5IGFjY2Vzc2libGUgbW9kYWxcbiAgICovXG4gIGZ1bmN0aW9uIF9nZXRBY2Nlc3NpYmxlTW9kYWxCeUlkKCkge1xuICAgIHZhciBlbGVtZW50O1xuICAgIHZhciBtb2RhbE9iaiA9IFtdO1xuICAgIHZhciBtb2RhbElkID0gW107XG4gICAgdmFyIGVsZW1lbnRzID0gJCgnW2RhdGEtbW9kYWwtaWRdJyk7XG4gICAgaWYgKGVsZW1lbnRzLmxlbmd0aCkge1xuICAgICAgZWxlbWVudHMuZWFjaChmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWwpO1xuICAgICAgICBtb2RhbElkW2ldID0gZWxlbWVudC5kYXRhKCdtb2RhbC1pZCcpO1xuICAgICAgICBlbGVtZW50LmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgaWYgKCQodGhpcykuYXR0cignZGlzYWJsZWQnKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIW1vZGFsT2JqW2ldKSB7XG4gICAgICAgICAgICBtb2RhbE9ialtpXSA9IG5ldyBjaXRpU2hhcmUuQWNjZXNzaWJsZU1vZGFsKHtcbiAgICAgICAgICAgICAgbW9kYWw6ICQoJyMnICsgbW9kYWxJZFtpXSksXG4gICAgICAgICAgICAgIHByZXZpb3VzRWxlbWVudDogZS50YXJnZXRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtb2RhbE9ialtpXS5zaG93KCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBfcG9wdWxhdGVQcm9kdWN0TGlzdCAtIFBvcHVsYXRlIHByb2R1Y3QgbGlzdGluZyBmcm9tIGFuIGFqYXggZW5kcG9pbnRcbiAgICogQHBhcmFtICB7T2JqZWN0fSAkdGFyZ2V0Q29udGFpbmVyIFtkZXNjcmlwdGlvbl1cbiAgICogQHBhcmFtICB7c3RyaW5nfSB0ZW1wbGF0ZVNlbGVjdG9yICAgICAgICBbRE9NIHNlbGVjdG9yIGZvciB0ZW1wbGF0ZV1cbiAgICogQHBhcmFtICB7c3RyaW5nfSBwcm9kdWN0RmlsZSAgICAgICAgICAgICBbZmlsZSBuYW1lIGF0IGVuZHBvaW50XVxuICAgKi9cbiAgZnVuY3Rpb24gX3BvcHVsYXRlUHJvZHVjdExpc3QoJHRhcmdldENvbnRhaW5lciwgdGVtcGxhdGVTZWxlY3RvciwgcHJvZHVjdEZpbGUpIHtcbiAgICB2YXIgcHJvZHVjdEVuZFBvaW50ID0gd2luZG93LmNpdGlDb25maWcuZW5kUG9pbnRIb3N0ICsgd2luZG93LmNpdGlDb25maWcucHJvZHVjdExpc3RpbmdFbmRQb2ludFBhdGggKyBwcm9kdWN0RmlsZTtcbiAgICB2YXIgc291cmNlID0gJCh0ZW1wbGF0ZVNlbGVjdG9yKS5odG1sKCk7XG4gICAgdmFyIHRlbXBsYXRlID0gd2luZG93LkhhbmRsZWJhcnMuY29tcGlsZShzb3VyY2UpO1xuXG4gICAgdmFyIHJlcXVlc3QgPSAkLmFqYXgoe1xuICAgICAgdXJsOiBwcm9kdWN0RW5kUG9pbnQsXG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgIH0pO1xuXG4gICAgcmVxdWVzdC5kb25lKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICB2YXIgb3V0cHV0O1xuXG4gICAgICBkYXRhLnByb2R1Y3RzLmZvckVhY2goZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIGVsLnBhZ2VTdGF0ZSA9IHdpbmRvdy5jaXRpQ29uZmlnLnN0YXRlO1xuICAgICAgICBlbC5jb3VudHJ5ID0gd2luZG93LmNpdGlDb25maWcuY291bnRyeTtcbiAgICAgIH0pO1xuICAgICAgb3V0cHV0ID0gdGVtcGxhdGUoZGF0YSk7XG4gICAgICAkdGFyZ2V0Q29udGFpbmVyLmFwcGVuZChvdXRwdXQpO1xuXG4gICAgICAvLyBhZGQgLmhvcml6b250YWwtaW1hZ2UgY2xhc3MgdG8gaW1hZ2VzIGFzIG5lZWRlZFxuICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAkKCcucHJvZHVjdC1saXN0LWltYWdlJykuZWFjaChmdW5jdGlvbiAoaSwgZWxlbSkge1xuICAgICAgICAgIGlmICgkKGVsZW0pLndpZHRoKCkgPiAkKGVsZW0pLmhlaWdodCgpKSB7XG4gICAgICAgICAgICAkKGVsZW0pLmFkZENsYXNzKCdob3Jpem9udGFsLWltYWdlJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0sIDUwMCk7XG5cbiAgICB9KTtcblxuICAgIHJlcXVlc3Quc3VjY2VzcyhmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBBY3RpdmF0ZSBwYWdpbmF0aW9uIGFmdGVyIHByb2R1Y3QgbGlzdCByZXF1ZXN0IGlzIHN1Y2Nlc3NmdWxcbiAgICAgIGNpdGlTaGFyZS5wYWdpbmF0aW9uLmluaXRQYWdpbmF0aW9uKCQoXCIucHJvZHVjdC1saXN0LWl0ZW1cIiksIFwiLnBhZ2luYXRpb25cIiwgNDgpO1xuICAgIH0pO1xuXG4gICAgcmVxdWVzdC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgY29uc29sZS5sb2coJ2FqYXggZXJyb3I6JywgZGF0YSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgYSBxdWljayB2aWV3IHNlY3Rpb24gb24gYSBQTFBcbiAgICogQHBhcmFtICB7T2JqZWN0fSAkdGFyZ2V0Q29udGFpbmVyIFRoZSBET00gZWxlbSB0aGF0IHRoZSB0ZW1wbGF0ZSBpcyBnb2luZyB0byBiZSBpbmplY3RlZCBpbnRvXG4gICAqIEBwYXJhbSAge1N0cmluZ30gdGVtcGxhdGVJZCAgICAgICBUaGUgc2VsZWN0b3JcbiAgICogQHBhcmFtICB7U3RyaW5nfSBwcm9kdWN0RmlsZSAgICAgIFtkZXNjcmlwdGlvbl1cbiAgICogQHBhcmFtICB7TnVtYmVyfSBwcm9kdWN0SWQgICAgICAgIFtkZXNjcmlwdGlvbl1cbiAgICogQHBhcmFtICB7ZnVuY3Rpb259IGNhbGxiYWNrICAgICAgICBGdW5jIHRvIHJ1biBhZnRlciBldmVyeXRoaW5nIGlzIGRvbmVcbiAgICovXG4gIGZ1bmN0aW9uIF9nZXRQcm9kdWN0RGV0YWlsSXRlbSgkdGFyZ2V0Q29udGFpbmVyLCB0ZW1wbGF0ZUlkLCBwcm9kdWN0RmlsZSwgcHJvZHVjdElkLCBjYWxsYmFjaykge1xuICAgIHZhciBwcm9kdWN0RW5kUG9pbnQgPSB3aW5kb3cuY2l0aUNvbmZpZy5lbmRQb2ludEhvc3QgKyB3aW5kb3cuY2l0aUNvbmZpZy5wcm9kdWN0TGlzdGluZ0VuZFBvaW50UGF0aCArIHByb2R1Y3RGaWxlO1xuICAgIHZhciBzb3VyY2UgPSAkKHRlbXBsYXRlSWQpLmh0bWwoKTtcbiAgICB2YXIgdGVtcGxhdGUgPSB3aW5kb3cuSGFuZGxlYmFycy5jb21waWxlKHNvdXJjZSk7XG5cbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiBwcm9kdWN0RW5kUG9pbnQsXG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgIH0pXG4gICAgICAuZG9uZShmdW5jdGlvbiAoZGF0YSkge1xuXG4gICAgICAgICQuZWFjaChkYXRhLnByb2R1Y3RzLCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgIHZhciBvdXRwdXQ7XG4gICAgICAgICAgLy9SZXR1cm4gb25seSB0aGUgcmVxdWVzdGVkIHByb2R1Y3QgYnkgSURcbiAgICAgICAgICBpZiAodmFsdWUucHJvZHVjdElkID09PSBwcm9kdWN0SWQpIHtcbiAgICAgICAgICAgIHZhbHVlLnByb2R1Y3REZXRhaWwucHJvZHVjdC5wYWdlU3RhdGUgPSB3aW5kb3cuY2l0aUNvbmZpZy5zdGF0ZTtcbiAgICAgICAgICAgIHZhbHVlLnByb2R1Y3REZXRhaWwucHJvZHVjdC5jb3VudHJ5ID0gd2luZG93LmNpdGlDb25maWcuY291bnRyeTtcbiAgICAgICAgICAgIG91dHB1dCA9IHRlbXBsYXRlKHZhbHVlLnByb2R1Y3REZXRhaWwpO1xuICAgICAgICAgICAgJHRhcmdldENvbnRhaW5lci5hcHBlbmQob3V0cHV0KTtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG5cbiAgICAgIH0pXG4gICAgICAuZmFpbChmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBjb25zb2xlLmxvZygnYWpheCBlcnJvcjonLCBkYXRhKTtcbiAgICAgIH0pO1xuXG4gIH1cblxuICAvKipcbiAgICogX3BvcHVsYXRlQ2F0ZWdvcnlMaXN0IC0gUG9wdWxhdGUgY2F0ZWdvcnkgbGlzdCBmcm9tIGFuIGFqYXggZW5kcG9pbnQuXG4gICAqIExvYWRzIGFuIGFscGhhYmV0aWNhbCBsaXN0IG9mIGNvbXBhbmllcyBmb3IgdGhlIENhdGVnb3J5IExhbmRpbmcgcGFnZSBhbmQgbmF2aWdhdGVzIHRvIGEgc2VsZWN0ZWQgYWxwaGFiZXRpY2FsIGxpc3QuXG4gICAqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSAkZWxlbWVudCAgICAgIGNvbnRhaW5lciBlbGVtZW50IHRvIGJlIHBvcHVsYXRlZC5cbiAgICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdGVkSW5kZXggcG9wdWxhdGUgYSBzcGVjaWZpYyBhbHBoYWJldGljYWwgbGlzdC5cbiAgICpcbiAgICogdGhlIHNlbGVjdGVkRW5kUG9pbnQgdmFyaWFibGUgc2hvdWxkIHJlc292ZSB0byBhIHN0cmluZyBzaW1pbGFyIHRvICBcIm1vY2stZW5kcG9pbnRzL21vY2stY2F0ZWdvcnktYnJhbmRzL2FscGhhYmV0aWNhbC9iLmpzb25cIlxuICAgKi9cbiAgZnVuY3Rpb24gX3BvcHVsYXRlQ2F0ZWdvcnlMaXN0KCRlbGVtZW50LCBzZWxlY3RlZEluZGV4KSB7XG4gICAgLy8gRGVmYXVsdCB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBhbHBoYWJldGl6ZWQgbGlzdCBpZiBubyBzZWxlY3Rpb24gaXMgcGFzc2VkXG4gICAgdmFyIHNlbGVjdGVkRW5kUG9pbnQgPSB3aW5kb3cuY2l0aUNvbmZpZy5lbmRQb2ludEhvc3QgKyB3aW5kb3cuY2l0aUNvbmZpZy5jYXRlZ29yeUVuZFBvaW50UGF0aCArIHNlbGVjdGVkSW5kZXggKyAnLmpzb24nO1xuICAgICQuZ2V0SlNPTihzZWxlY3RlZEVuZFBvaW50LCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgdmFyIHNlbGVjdGVkQnJhbmRzQXJyYXkgPSBkYXRhLmJyYW5kcztcbiAgICAgIF9jcmVhdGVDYXRlZ29yeUxpc3Qoc2VsZWN0ZWRCcmFuZHNBcnJheSwgJGVsZW1lbnQpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIF9jcmVhdGVDYXRlZ29yeUxpc3QgLSBIZWxwZXIgZnVuY3Rpb24gZm9yIF9wb3B1bGF0ZUNhdGVnb3J5TGlzdFxuICAgKiBSZW5kZXJzIGFycmF5IG9mIGJyYW5kcyBpbiB0aGUgQ2F0ZWdvcnkgTGFuZGluZyBwYWdlLlxuICAgKlxuICAgKiBAcGFyYW0gIHtPYmplY3R9IGJyYW5kc0FycmF5IFtkZXNjcmlwdGlvbl1cbiAgICogQHBhcmFtICB7T2JqZWN0fSAkZWxlbWVudCAgICAgalF1ZXJ5IG9iamVjdCAkZWxlbWVudFxuICAgKi9cbiAgZnVuY3Rpb24gX2NyZWF0ZUNhdGVnb3J5TGlzdChicmFuZHNBcnJheSwgJGVsZW1lbnQpIHtcbiAgICB2YXIgbGlzdFRlbXBsYXRlID0gJzx1bCBjbGFzcz1cImNhdGVnb3J5LWxpc3RcIj4nO1xuXG4gICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGFycmF5IG9mIGJyYW5kcy5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJyYW5kc0FycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBsaXN0VGVtcGxhdGUgKz0gJzxsaSBjbGFzcz1cImNhdGVnb3J5LWl0ZW1cIj4nO1xuICAgICAgbGlzdFRlbXBsYXRlICs9ICc8YSBocmVmPVwiICcgKyBicmFuZHNBcnJheVtpXS51cmwgKyAnIFwiIGNsYXNzPVwiY29weSB0ZXh0LWV4dHJhLWxpZ2h0IG9tbml0dXJlLWNhdGVnb3J5LWxpc3QtaXRlbVwiPicgKyBicmFuZHNBcnJheVtpXS5sYWJlbCArICc8L2E+JztcbiAgICAgIGxpc3RUZW1wbGF0ZSArPSAnPC9saT4nO1xuICAgIH1cblxuICAgIGxpc3RUZW1wbGF0ZSArPSAnPC91bD4nO1xuICAgICRlbGVtZW50Lmh0bWwobGlzdFRlbXBsYXRlKTtcbiAgfVxuXG5cbiAgLyoqXG4gICAqIE51bWJlciBzdGVwcGVyXG4gICAqIEB0eXBlIHt7bnVtZXJpY1N0ZXBwZXJ9fVxuICAgKi9cbiAgZnVuY3Rpb24gX251bWVyaWNTdGVwcGVyU2V0dXAoKSB7XG5cbiAgICB2YXIgJHBhcmVudEVsID0gJChcIi5zdGVwcGVyLWJ1dHRvbnNcIik7XG4gICAgdmFyICRpbnB1dFN0ZXBwZXJFbCA9ICQoXCIubnVtZXJpYy1zdGVwcGVyID4gaW5wdXRcIik7XG4gICAgdmFyIG1heFF1YW50aXR5ID0gcGFyc2VJbnQoJGlucHV0U3RlcHBlckVsLmF0dHIoXCJtYXhcIikpO1xuICAgIHZhciBtaW5RdWFudGl0eSA9IHBhcnNlSW50KCRpbnB1dFN0ZXBwZXJFbC5hdHRyKFwibWluXCIpKTtcbiAgICB2YXIgJGRlY3JlYXNlQnV0dG9uID0gJChcIltkYXRhLXN0ZXBwZXI9ZGVjcmVhc2VdXCIpO1xuICAgIHZhciAkaW5jcmVhc2VCdXR0b24gPSAkKFwiW2RhdGEtc3RlcHBlcj1pbmNyZWFzZV1cIik7XG4gICAgdmFyIGFjY2Vzc2libGVMaXZlUmVnaW9uID0gJCgnLmJ1dHRvbnNldC1hMTF5Jyk7XG5cbiAgICB2YXIgY2hhbmdlVmFsdWUgPSBmdW5jdGlvbiBjaGFuZ2VWYWx1ZShlKSB7XG5cbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHZhciBnZXRDdXJyZW50VmFsdWUgPSBwYXJzZUludCgkaW5wdXRTdGVwcGVyRWwudmFsKCkpO1xuICAgICAgdmFyIHZhbHVlQWRqdXN0bWVudCA9IHBhcnNlSW50KCQodGhpcykuYXR0cihcImRhdGEtcXVhbnRpdHktYWRqdXN0bWVudFwiKSkgfHwgMDsgLy8gMCB3aGVuIGl0cyBjYWxsZWQgZnJvbSBwcmVzc2luZyBlbnRlclxuICAgICAgdmFyIHNldFZhbHVlID0gZ2V0Q3VycmVudFZhbHVlICsgdmFsdWVBZGp1c3RtZW50O1xuXG4gICAgICBpZiAoc2V0VmFsdWUgPD0gbWluUXVhbnRpdHkpIHtcbiAgICAgICAgJGRlY3JlYXNlQnV0dG9uLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICAgICRpbnB1dFN0ZXBwZXJFbC52YWwocGFyc2VJbnQobWluUXVhbnRpdHkpKTtcbiAgICAgICAgYWNjZXNzaWJsZUxpdmVSZWdpb24uYXBwZW5kKCdRdWFudGl0eSAnICsgc2V0VmFsdWUpO1xuICAgICAgICByZXR1cm4gJGluY3JlYXNlQnV0dG9uLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xuICAgICAgfSBlbHNlIGlmICgoc2V0VmFsdWUgPiBtaW5RdWFudGl0eSkgJiYgKHNldFZhbHVlIDwgbWF4UXVhbnRpdHkpKSB7XG4gICAgICAgICRkZWNyZWFzZUJ1dHRvbi5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcbiAgICAgICAgJGlucHV0U3RlcHBlckVsLnZhbChzZXRWYWx1ZSk7XG4gICAgICAgIGFjY2Vzc2libGVMaXZlUmVnaW9uLmFwcGVuZCgnUXVhbnRpdHkgJyArIHNldFZhbHVlKTtcbiAgICAgICAgcmV0dXJuICRpbmNyZWFzZUJ1dHRvbi5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRkZWNyZWFzZUJ1dHRvbi5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcbiAgICAgICAgJGlucHV0U3RlcHBlckVsLnZhbChwYXJzZUludChtYXhRdWFudGl0eSkpO1xuICAgICAgICBhY2Nlc3NpYmxlTGl2ZVJlZ2lvbi5hcHBlbmQoJ1F1YW50aXR5ICcgKyBzZXRWYWx1ZSk7XG4gICAgICAgIHJldHVybiAkaW5jcmVhc2VCdXR0b24ucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgIH1cblxuICAgIH07XG5cbiAgICAvLyBBbGxvdyBudW1iZXJzIG9ubHkgKG5vIGRlY2ltYWwpXG4gICAgJGlucHV0U3RlcHBlckVsLm51bWVyaWMoe1xuICAgICAgZGVjaW1hbDogZmFsc2UsXG4gICAgICBkZWNpbWFsUGxhY2VzOiAtMVxuICAgIH0pO1xuXG4gICAgJGlucHV0U3RlcHBlckVsLm9uKCdmb2N1c291dCBrZXlwcmVzcycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAvLyBvbiBmb2N1c291dCBvciBlbnRlclxuICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMTMgfHwgZS50eXBlID09PSBcImZvY3Vzb3V0XCIpIHtcbiAgICAgICAgY2hhbmdlVmFsdWUoZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAkcGFyZW50RWwub24oXCJjbGlja1wiLCBjaGFuZ2VWYWx1ZSk7XG4gIH1cblxuICAvKipcbiAgICogQWN0aXZhdGUgcHJvZHVjdCB6b29tIGZvciBwcm9kdWN0IGRldGFpbHMgcGFnZSAoUERQKVxuICAgKiBlbGV2YXRlWm9vbSBwbHVnaW5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IHdpZHRoIHdpbmRvdyByZXNpemUgd2lkdGhcbiAgICovXG4gIGZ1bmN0aW9uIF9jcmVhdGVab29tKHdpZHRoKSB7XG5cbiAgICBpZiAoJCgnI3Bob3RvJykubGVuZ3RoID4gMCkge1xuXG4gICAgICB2YXIgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCAkKHdpbmRvdykud2lkdGgoKTtcblxuICAgICAgdmFyIG1hcCA9IEwubWFwKCdwaG90bycsIHtcbiAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxuICAgICAgICBtaW5ab29tOiAwLFxuICAgICAgICBtYXhab29tOiA0LFxuICAgICAgICBzY3JvbGxXaGVlbFpvb206IGZhbHNlLFxuICAgICAgICBjZW50ZXI6IFswLCAwXSxcbiAgICAgICAgem9vbTogd2luZG93V2lkdGggPD0gNzY3ID8gMCA6IDEsXG4gICAgICAgIGNyczogTC5DUlMuU2ltcGxlXG4gICAgICB9KTtcblxuICAgICAgbWFwLnRvdWNoWm9vbS5kaXNhYmxlKCk7XG4gICAgICBtYXAuZG91YmxlQ2xpY2tab29tLmRpc2FibGUoKTtcblxuICAgICAgdmFyIGltYWdlID0gJCgnI3Bob3RvJykuZGF0YSgnaW1hZ2UnKTtcbiAgICAgIHZhciBhbHQgPSAkKCcjcGhvdG8nKS5kYXRhKCdhbHQnKTtcblxuICAgICAgLy8gZGltZW5zaW9ucyBvZiB0aGUgaW1hZ2VcbiAgICAgIHZhciB3ID0gJCgnLnByb2R1Y3Qtem9vbS5zaG93LW9uLW1vYmlsZS1vbmx5JylbMF0ubmF0dXJhbFdpZHRoICogMi4yNSxcbiAgICAgICAgaCA9ICQoJy5wcm9kdWN0LXpvb20uc2hvdy1vbi1tb2JpbGUtb25seScpWzBdLm5hdHVyYWxIZWlnaHQgKiAyLjc1LFxuICAgICAgICB1cmwgPSBpbWFnZTtcblxuICAgICAgaWYgKHdpZHRoIDw9IDc2Nykge1xuICAgICAgICB3ID0gODAwO1xuICAgICAgICBoID0gODAwO1xuICAgICAgfVxuXG4gICAgICAvLyBjYWxjdWxhdGUgdGhlIGVkZ2VzIG9mIHRoZSBpbWFnZSwgaW4gY29vcmRpbmF0ZSBzcGFjZVxuICAgICAgdmFyIHNvdXRoV2VzdCA9IG1hcC51bnByb2plY3QoWzAsIGhdLCBtYXAuZ2V0TWF4Wm9vbSgpIC0gMSk7XG4gICAgICB2YXIgbm9ydGhFYXN0ID0gbWFwLnVucHJvamVjdChbdywgMF0sIG1hcC5nZXRNYXhab29tKCkgLSAxKTtcbiAgICAgIHZhciBib3VuZHMgPSBuZXcgTC5MYXRMbmdCb3VuZHMoc291dGhXZXN0LCBub3J0aEVhc3QpO1xuXG4gICAgICAvLyBhZGQgdGhlIGltYWdlIG92ZXJsYXksXG4gICAgICAvLyBzbyB0aGF0IGl0IGNvdmVycyB0aGUgZW50aXJlIG1hcFxuICAgICAgTC5pbWFnZU92ZXJsYXkodXJsLCBib3VuZHMpLmFkZFRvKG1hcCk7XG5cbiAgICAgIC8vIHRlbGwgbGVhZmxldCB0aGF0IHRoZSBtYXAgaXMgZXhhY3RseSBhcyBiaWcgYXMgdGhlIGltYWdlXG4gICAgICBtYXAuc2V0TWF4Qm91bmRzKGJvdW5kcyk7XG5cbiAgICAgIG1hcC5vbignem9vbWVuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKG1hcC5nZXRab29tKCkgPT09IDQpIHtcbiAgICAgICAgICAkKCcuem9vbS1pbicpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgJCgnLnpvb20tb3V0JykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICAgICAgICAkKCcuem9vbS1vdXQnKS5mb2N1cygpO1xuICAgICAgICB9IGVsc2UgaWYgKG1hcC5nZXRab29tKCkgPT09IDApIHtcbiAgICAgICAgICAkKCcuem9vbS1vdXQnKS5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICAgICAgICQoJy56b29tLWluJykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICAgICAgICAkKCcuem9vbS1pbicpLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAkKCcubGVhZmxldC1pbWFnZS1sYXllcicpLmF0dHIoJ2FsdCcsIGFsdCk7XG5cbiAgICAgIC8vYmluZCBjbGljayBldmVudHMgdG8gdGhlIHpvb20gaW5cbiAgICAgICQoJy56b29tLWluJykuYmluZChcImNsaWNrIGtleXByZXNzXCIsIGZ1bmN0aW9uIChldmVudCkge1xuXG4gICAgICAgIGlmIChldmVudC53aGljaCA9PT0gMTMgfHwgZXZlbnQudHlwZSA9PT0gXCJjbGlja1wiKSB7XG4gICAgICAgICAgbWFwLnpvb21JbigpO1xuICAgICAgICAgICQoJy56b29tLW91dCcpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XG4gICAgICAgIH1cblxuICAgICAgfSk7XG5cbiAgICAgIC8vYmluZCBjbGljayBldmVudHMgdG8gdGhlIHpvb20gb3V0IGZ1bmN0aW9uXG4gICAgICAkKCcuem9vbS1vdXQnKS5iaW5kKFwiY2xpY2sga2V5cHJlc3NcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzIHx8IGV2ZW50LnR5cGUgPT09IFwiY2xpY2tcIikge1xuICAgICAgICAgIG1hcC56b29tT3V0KCk7XG4gICAgICAgICAgJCgnLnpvb20taW4nKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICQod2luZG93KS5vbignb3JpZW50YXRpb25jaGFuZ2UgcGFnZXNob3cgcmVzaXplJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIC8vJChcIiNtYXBcIikuaGVpZ2h0KCQod2luZG93KS5oZWlnaHQoKSk7XG4gICAgICAgICAgdmFyIHdpbmRvd1dpZHRoID0gd2luZG93LmlubmVyV2lkdGggfHwgJCh3aW5kb3cpLndpZHRoKCk7XG5cbiAgICAgICAgICBpZiAod2luZG93V2lkdGggPD0gNzY3KSB7XG4gICAgICAgICAgICBtYXAuc2V0Wm9vbSgwKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbWFwLnNldFpvb20oMSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgICAgfSwgMTAwMCk7XG4gICAgfVxuICB9XG5cblxuICBmdW5jdGlvbiBfY3JlYXRlVGFicygpIHtcbiAgICAvKipcbiAgICAgKiBBY3RpdmF0ZSB0YWJzIG9uIHByb2R1Y3QgZGV0YWlscyBwYWdlIChQRFApXG4gICAgICogSnF1ZXJ5IFVJXG4gICAgICovXG4gICAgJChcIi5wcm9kdWN0LWRldGFpbC10YWJzXCIpLnRhYnMoKTtcblxuICAgIC8qKlxuICAgICAqIEFjdGl2YXRlIHRhYnMgb24gcGFnZXMgd2hpY2ggaGF2ZSBvbmVcbiAgICAgKiBKcXVlcnkgVUlcbiAgICAgKi9cbiAgICAkKFwiLnRhYnMtbW9kdWxlXCIpLnRhYnMoKTtcblxuICAgIC8qKlxuICAgICAqIEFjdGl2YXRlIHNlY29uZCB0YWJcbiAgICAgKi9cbiAgICAkKFwiLnByb2R1Y3QtZGV0YWlsLXNlY29uZC10YWJzXCIpLnRhYnMoe1xuICAgICAgYWN0aXZlOiAxXG4gICAgfSk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIF9jcmVhdGVUb29sdGlwcygpIHtcblxuICB9XG5cbiAgLyoqXG4gICAqIEFjdGl2YXRlIGJ1dHRvbiBzZXRzXG4gICAqL1xuICBmdW5jdGlvbiBfY3JlYXRlQnV0dG9uU2V0cygpIHtcbiAgICB2YXIgX3JhZGlvRGVub21pbmF0aW9uR3JvdXAgPSBudWxsO1xuICAgIHZhciBfcmFkaW9EZWxpdmVyeUdyb3VwID0gbnVsbDtcblxuICAgIC8vdmVyaWZ5IHRoYXQgdGhlIGVsZW1lbnQgZXhpc3RzIG9uIHBhZ2UuXG4gICAgaWYgKCQoJyNidXR0b25zZXQtZGVub21pbmF0aW9uJykubGVuZ3RoID4gMCkge1xuICAgICAgX3JhZGlvRGVsaXZlcnlHcm91cCA9IG5ldyAkQS5SYWRpb0dyb3VwKCdidXR0b25zZXQtZGVub21pbmF0aW9uJywgJ2EuYWNjUmFkaW8nLCAwLCAnJyxcbiAgICAgICAgZnVuY3Rpb24gKHNlbGVjdGVkUmFkaW9Ob2RlLCByYWRpb3NBcnJheSkge1xuICAgICAgICAgICQuZWFjaChyYWRpb3NBcnJheSwgZnVuY3Rpb24gKGksIGVsZW0pIHtcbiAgICAgICAgICAgICQoZWxlbSkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgJChlbGVtKS5yZW1vdmVBdHRyKCdhcmlhLWRlc2NyaWJlZGJ5Jyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgJChzZWxlY3RlZFJhZGlvTm9kZSkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICQoc2VsZWN0ZWRSYWRpb05vZGUpLmF0dHIoJ2FyaWEtZGVzY3JpYmVkYnknLCAnZGVub21pbmF0aW9uLWVycm9ycycpO1xuICAgICAgICAgIF9jcmVhdGVCdXR0b25SdWxlcygpO1xuICAgICAgICB9KTtcblxuICAgICAgX3JhZGlvRGVub21pbmF0aW9uR3JvdXAgPSBuZXcgJEEuUmFkaW9Hcm91cCgnYnV0dG9uc2V0LWRlbGl2ZXJ5JywgJ2EuYWNjUmFkaW8nLCAtMSwgJycsXG4gICAgICAgIGZ1bmN0aW9uIChzZWxlY3RlZFJhZGlvTm9kZSwgcmFkaW9zQXJyYXkpIHtcbiAgICAgICAgICAkLmVhY2gocmFkaW9zQXJyYXksIGZ1bmN0aW9uIChpLCBlbGVtKSB7XG4gICAgICAgICAgICAkKGVsZW0pLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAkKHNlbGVjdGVkUmFkaW9Ob2RlKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgX2NyZWF0ZUJ1dHRvblJ1bGVzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICBpZiAoJCgnI2J1dHRvbnNldC1kZWxpdmVyeSA+IGEnKS5sZW5ndGggPCAyKSB7XG4gICAgICAgICQoJyNidXR0b25zZXQtZGVsaXZlcnkgPiBhJykuZmlyc3QoKS50cmlnZ2VyKCdjbGljaycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCQoJyNidXR0b25zZXQtZGVsaXZlcnkgPiBhJykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICQoJy5hZGQtdG8tY2FydCcpLmFkZENsYXNzKCdub3RBY3RpdmUnKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoJCgnI2J1dHRvbnNldC1kZW5vbWluYXRpb24gPiBhJykubGVuZ3RoID4gNCkge1xuICAgICAgICAkKCcuYnV0dG9uc2V0LXZpZXctbW9yZScpLnNob3coKTtcbiAgICAgICAgJCgnI2J1dHRvbnNldC1kZW5vbWluYXRpb24gPiBhOmd0KDMpJykuaGlkZSgpO1xuICAgICAgfVxuXG5cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfdXBkYXRlUHJvZHVjdERhdGFQRFAoKSB7XG4gICAgJCgnI2J1dHRvbnNldC1kZW5vbWluYXRpb24gPiBhJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgJCgnLnByaWNlJykuaHRtbCgkKHRoaXMpLmZpbmQoJ3NwYW4nKS5odG1sKCkpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIHVwZGF0ZSBwcm9kdWN0IGFuZCBxdWlja3ZpZXcgbmFtZSBhbmQgcHJpY2luZyBkYXRhXG4gICAqL1xuICBmdW5jdGlvbiBfdXBkYXRlUHJvZHVjdERhdGEoKSB7XG4gICAgJCgnYm9keScpLm9uKCdjbGljaycsICcuanMtdXBkYXRlLXByb2R1Y3QtZGF0YScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBmb3JtYXR0ZWRWYWx1ZTtcbiAgICAgIHZhciBkYXRhQ3VycmVuY3lWYWx1ZSA9ICQodGhpcykuYXR0cignZGF0YS1jdXJyZW5jeS12YWx1ZScpO1xuICAgICAgdmFyIHBvaW50c0Zvcm1hdCA9ICQoJy5qcy1wcm9kdWN0LXByaWNlJykubGFzdCgpLnRleHQoKS5yZXBsYWNlKC9bMC05LF0vZywgJycpLnRyaW0oKTtcblxuICAgICAgaWYgKGRhdGFDdXJyZW5jeVZhbHVlKSB7XG4gICAgICAgIGlmICgkKCcuanMtcHJvZHVjdC1wcmljZScpLmxhc3QoKS50ZXh0KCkgIT09IFwiXCIgJiYgJCh0aGlzKS5kYXRhKCdjdXJyZW5jeS12YWx1ZScpICE9PSBcIlwiKSB7XG4gICAgICAgICAgZm9ybWF0dGVkVmFsdWUgPSBjaXRpU2hhcmUuZm9ybVZhbGlkYXRpb24uZm9ybWF0TnVtZXJpY1ZhbHVlcygkKHRoaXMpLmRhdGEoJ2N1cnJlbmN5LXZhbHVlJykpO1xuICAgICAgICAgICQoJy5qcy1wcm9kdWN0LXByaWNlJykubGFzdCgpLnRleHQoZm9ybWF0dGVkVmFsdWUgKyAnICcgKyBwb2ludHNGb3JtYXQpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEFaOjogdGhlIGFib3ZlIGlzIG92ZXJjb21wbGljYXRlZCBzaHJ1Z2guIGp1c3QgcmVwbGFjZSB0aGUgdGV4dCB3aXRoaW4gLnByaWNlIHNwYW5cbiAgICAgICQoJy5qcy1wcm9kdWN0LXRpdGxlJykuZmluZCgnLnByaWNlJykuaHRtbCgkKHRoaXMpLnRleHQoKSk7XG5cbiAgICAgIHZhciBpc0Fub255bW91c1RleHQgPSAkKHRoaXMpLmRhdGEoJ2Fub255bW91cycpO1xuICAgICAgJCgnLmpzLXByb2R1Y3QtcHJpY2UnKS5sYXN0KCkudGV4dCgkKHRoaXMpLmRhdGEoJ2Fub255bW91cycpKTtcblxuICAgICAgaWYgKGlzQW5vbnltb3VzVGV4dCkge1xuICAgICAgICBmb3JtYXR0ZWRWYWx1ZSA9IGNpdGlTaGFyZS5mb3JtVmFsaWRhdGlvbi5mb3JtYXROdW1lcmljVmFsdWVzKCQodGhpcykuZGF0YSgnY3VycmVuY3ktdmFsdWUnKSk7XG4gICAgICB9XG5cbiAgICAgICQoJy5qcy1wcm9kdWN0LXByaWNlJykuZmlyc3QoKS50ZXh0KGZvcm1hdHRlZFZhbHVlICsgJyAnICsgcG9pbnRzRm9ybWF0KS5zaG93KCk7XG4gICAgICAkKCcudGV4dC1zdHJpa2VvdXQnKS5oaWRlKCk7XG4gICAgICAkKCcucGxhY2Vob2xkZXItY29weScpLmhpZGUoKTtcbiAgICAgICQoJy5zYWxlLWljb24nKS5oaWRlKCk7XG4gICAgICAkKCcuc2FsZS1lbmRzJykuaGlkZSgpO1xuXG5cbiAgICAgIHZhciBkYXRhRGVmYXVsdFByaWNlID0gJCh0aGlzKS5hdHRyKCdkYXRhLWRlZmF1bHQtcHJpY2UnKTtcbiAgICAgIGlmIChkYXRhRGVmYXVsdFByaWNlKSB7XG5cbiAgICAgICAgJCgnLmpzLXByb2R1Y3QtcHJpY2UnKS5sYXN0KCkudGV4dChmb3JtYXR0ZWRWYWx1ZSArICcgJyArIHBvaW50c0Zvcm1hdCk7XG4gICAgICAgICQoJy5qcy1wcm9kdWN0LXByaWNlJykuZmlyc3QoKS5oaWRlKCk7XG4gICAgICAgICQoJy50ZXh0LXN0cmlrZW91dCcpLnNob3coKTtcbiAgICAgICAgJCgnLnNhbGUtaWNvbicpLnNob3coKTtcbiAgICAgICAgJCgnLnBsYWNlaG9sZGVyLWNvcHknKS5zaG93KCk7XG4gICAgICAgICQoJy5zYWxlLWVuZHMnKS5zaG93KCk7XG5cbiAgICAgIH1cblxuICAgICAgLy8gVGFyZ2V0IEdSIGxvZ2dlZGluIHN0YXRlIG9ubHlcbiAgICAgIGlmICh3aW5kb3cuY2l0aUNvbmZpZy5zaXRlID09PSBcIkdSXCIpIHtcbiAgICAgICAgJCgnLmpzLXByb2R1Y3QtcHJpY2UnKS5sYXN0KCkudGV4dCgkKHRoaXMpLmRhdGEoJ2xvZ2dlZGluJykpO1xuICAgICAgICAkKCcuanMtcHJvZHVjdC1wcmljZScpLmZpcnN0KCkudGV4dChmb3JtYXR0ZWRWYWx1ZSArICcgJyArIHBvaW50c0Zvcm1hdCkuc2hvdygpO1xuICAgICAgICAkKCcuanMtb3JnaW5hbC1wcmljZScpLmhpZGUoKTsgLy8gR1IgbG9nZ2VkIGluIHN0YXRlIG9ubHkgbG9naWNcbiAgICAgICAgJCgnLnRleHQtc3RyaWtlb3V0JykuaGlkZSgpO1xuICAgICAgICAkKCcucGxhY2Vob2xkZXItY29weScpLmhpZGUoKTtcbiAgICAgICAgJCgnLnNhbGUtaWNvbicpLmhpZGUoKTtcbiAgICAgICAgJCgnLnNhbGUtZW5kcycpLmhpZGUoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHF1YW50aXR5IGluIHRoZSBtb2RhbCB3aGVuIGFkZCB0byBjYXJ0IGluIFBEUFxuICAgKi9cbiAgZnVuY3Rpb24gX3VwZGF0ZU1vZGFsUXR5KCkge1xuICAgICQoXCIuYWRkLXRvLWNhcnRcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgcXR5VmFsdWUgPSAkKFwiLm51bWVyaWMtc3RlcHBlciA+IGlucHV0XCIpLnZhbCgpO1xuICAgICAgJChcIi5qcy1wcm9kdWN0LXF0eVwiKS50ZXh0KHF0eVZhbHVlKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIEJ1dHRvbiBSdWxlcyAoUERQKVxuICAgKiBKcXVlcnkgVUlcbiAgICovXG4gIGZ1bmN0aW9uIF9jcmVhdGVCdXR0b25SdWxlcygpIHtcbiAgICAvL2JvdGggc3Vic2V0cyBvciBncm91cHMgb2YgZGVub21pbmF0aW9uIGFuZCBkZWxpdmVyeSBtdXN0IGJlIHNlbGVjdGVkIGluIG9yZGVyIHRvIGFjdGl2YXRlXG4gICAgLy9hZGQgdG8gY2FydFxuXG4gICAgLy9UT0RPIE1PRElGWVxuICAgIGlmICgkKCcuYnV0dG9uc2V0JykuZmluZCgnYS5hY3RpdmUnKS5sZW5ndGggPT09IDIpIHtcbiAgICAgICQoJy5wcm9kdWN0LWZvcm0gPiBhLmJ0bicpLnJlbW92ZUNsYXNzKCdub3RBY3RpdmUnKS5yZW1vdmVBdHRyKCd0YWJpbmRleCcpO1xuICAgIH0gZWxzZSBpZiAoJCgnLmJ1dHRvbnNldCcpLmZpbmQoJ2EuYWN0aXZlJykubGVuZ3RoID09PSAxICYmICQoXCIjYnV0dG9uc2V0LWRlbGl2ZXJ5XCIpLmZpbmQoJ2EuYWN0aXZlJykubGVuZ3RoID09PSAxKSB7XG4gICAgICAkKCcucHJvZHVjdC1mb3JtID4gYS5idG4nKS5yZW1vdmVDbGFzcygnbm90QWN0aXZlJykucmVtb3ZlQXR0cigndGFiaW5kZXgnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCQoXCIjYnV0dG9uc2V0LWRlbGl2ZXJ5XCIpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgJCgnLnByb2R1Y3QtZm9ybSA+IGEuYnRuJykuYWRkQ2xhc3MoJ25vdEFjdGl2ZScpLmF0dHIoJ3RhYmluZGV4JywgJy0xJyk7XG4gICAgICB9XG4gICAgfVxuXG4gIH1cblxuICAvKipcbiAgICogTW9kYWwgZXZlbnRzIHJlbGF0ZWQgdG8gR0MgYW5kIE1lcmNoYW5kaXNlXG4gICAqL1xuICBmdW5jdGlvbiBfdGltZWRPdmVybGF5TW9kYWxzKCkge1xuICAgIC8qKlxuICAgICAqIERpc3BsYXkgb3ZlcmxheXMgaW4gYW5vbnltb3VzIHN0YXRlIHRvIGVuY291cmFnZSBzaWduIG9uXG4gICAgICovXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAkKCdbZGF0YS1tb2RhbC1pZD1cIm1vZGFsLXNpZ24tb25cIl0nKS50cmlnZ2VyKFwiY2xpY2tcIik7XG4gICAgICAkKCdbZGF0YS1tb2RhbC1pZD1cIm1vZGFsLWltcG9ydGFudC1ub3RpY2VcIl0nKS50cmlnZ2VyKFwiY2xpY2tcIik7XG4gICAgfSwgMTAwMCk7IC8vIG1pbGxpc2Vjb25kc1xuXG4gICAgc2Vzc2lvblRpbWVPdXQoKTtcblxuICAgIC8vIENsb3NlIG1vZGFsIG9uIGNsaWNrIGJ1dHRvblxuICAgICQoXCIuYnRuLWNsb3NlLW1vZGFsXCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgJCgnLm1vZGFsLWNsb3NlLWJ1dHRvbicpLnRyaWdnZXIoXCJjbGlja1wiKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNwbGF5IG92ZXJsYXlzIGluIGNhcnQgZm9yIHNlc3Npb24gdGltZW91dCBhbmQgc2Vzc2lvbiBlbmRlZFxuICAgKiBBZnRlciA2IG1pbnV0ZXNcbiAgICovXG4gIGZ1bmN0aW9uIHNlc3Npb25UaW1lT3V0KCkge1xuICAgIHZhciBzZXRTZXNzaW9uVGltZW91dCA9IDIwMDA7XG4gICAgdmFyIGJ0bnNCb29sZWFuID0gJChcIi5qcy1idG4tYm9vbGVhblwiKTtcblxuICAgIC8vIFNldHMgdGltZW91dCB3aGVuIGluYWN0aXZlIGZvciA2IG1pbnV0ZXNcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICQoJ1tkYXRhLW1vZGFsLWlkPVwibW9kYWwtc2Vzc2lvbi10aW1lb3V0XCJdJykudHJpZ2dlcihcImNsaWNrXCIpO1xuXG4gICAgICAkKFwiLmJ0bi1ib29sZWFuLWdyb3VwXCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBidG5zQm9vbGVhbi5kYXRhKCdzdGF0ZScsICdjbGlja2VkJyk7XG4gICAgICAgICQoJy5tb2RhbC1jbG9zZS1idXR0b24nKS50cmlnZ2VyKFwiY2xpY2tcIik7XG4gICAgICB9KTtcblxuICAgICAgc2Vzc2lvbkVuZGVkKCk7XG4gICAgfSwgc2V0U2Vzc2lvblRpbWVvdXQpO1xuICB9XG5cbiAgLyoqXG4gICAqIERpc3BsYXkgb3ZlcmxheXMgaW4gY2FydCBmb3Igc2Vzc2lvbiB0aW1lb3V0IGFuZCBzZXNzaW9uIGVuZGVkXG4gICAqIEFmdGVyIDYgbWludXRlc1xuICAgKi9cbiAgZnVuY3Rpb24gc2Vzc2lvbkVuZGVkKCkge1xuICAgIC8vIE9wZW4gdGhlIHNlc3Npb24gZW5kZWQgbW9kYWxcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICQoJy5tb2RhbC1jbG9zZS1idXR0b24nKS50cmlnZ2VyKFwiY2xpY2tcIik7XG4gICAgICAkKCdbZGF0YS1tb2RhbC1pZD1cIm1vZGFsLXNlc3Npb24tZW5kZWRcIl0nKS50cmlnZ2VyKFwiY2xpY2tcIik7XG4gICAgfSwgMjAwMCk7XG4gIH1cblxuICBmdW5jdGlvbiBfaW5pdFB1YlN1YigpIHtcbiAgICBwdWJzdWIgPSAkKHt9KTtcblxuICAgICQuZWFjaChbJ29uJywgJ29mZicsICd0cmlnZ2VyJ10sIGZ1bmN0aW9uIChpLCBtZXRob2QpIHtcbiAgICAgICRbbWV0aG9kXSA9ICQucHJveHkocHVic3ViW21ldGhvZF0sIHB1YnN1Yik7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfaW5pdFByaW50Q3RhKCkge1xuICAgICQoJy5wcmludC1idG4nKS5iaW5kKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHdpbmRvdy5wcmludCgpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gX29uKGV2ZW50TmFtZSwgZm4pIHtcbiAgICBwdWJzdWIub24oZXZlbnROYW1lLCBmbik7XG4gIH1cblxuICBmdW5jdGlvbiBfb2ZmKGV2ZW50TmFtZSwgZm4pIHtcbiAgICBwdWJzdWIub2ZmKGV2ZW50TmFtZSwgZm4pO1xuICB9XG5cbiAgZnVuY3Rpb24gX3RyaWdnZXIoZXZlbnROYW1lLCBhcmdzKSB7XG4gICAgcHVic3ViLnRyaWdnZXIoZXZlbnROYW1lLCBhcmdzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgcHJvcGVyIHdpZHRoIGZvciBqcXVlcnkgdWkgc2VsZWN0IGRyb3Bkb3duXG4gICAqIHVuZGVyIDM2MCB3aW5kb3cgd2lkdGguXG4gICAqIFRoZXJlIHdhcyBhIHByb2JsZW0gd2l0aCBqcXVlcnlcbiAgICogdWksIGl0IGRpZG4ndCBjYWxjdWxhdGUgdGhlIHByb3BlciB3aWR0aCBhbmQgY3NzIGNvdWxkbid0XG4gICAqIGRvIHRoZSB0cmlja1xuICAgKi9cbiAgZnVuY3Rpb24gX2luaXRDYWxjdWxhdGVTZWxlY3RPcHRpb25zV2lkdGgoKSB7XG5cbiAgICAkKCcudWktc2VsZWN0bWVudS1idXR0b24nKS5jbGljayhmdW5jdGlvbiAoKSB7XG5cbiAgICAgIGlmICgkKHdpbmRvdykud2lkdGgoKSA8IDM1OSkge1xuXG4gICAgICAgIHZhciAkZHJvcGRvd25PcHRpb25zID0gJCgnLnVpLXNlbGVjdG1lbnUtb3BlbicpLmZpbmQoJy51aS1tZW51Jyk7XG4gICAgICAgIHZhciAkc2VsZWN0V2lkdGggPSAkKHRoaXMpLndpZHRoKCk7XG5cbiAgICAgICAgJGRyb3Bkb3duT3B0aW9ucy53aWR0aCgkc2VsZWN0V2lkdGgpO1xuXG4gICAgICB9XG5cbiAgICB9KTtcblxuICB9XG5cbiAgLypcbiAgICogQWRkIHByb3BlciByb2xlIHRvIGRyb3Bkb3duIGVsZW1lbnRzXG4gICAqL1xuICBmdW5jdGlvbiBfYWRqdXN0RHJvcGRvd24oKSB7XG4gICAgLy8gV2FpdCB0byBtYWtlIHN1cmUgdGhlIGRyb3Bkb3duIGFyZSBpbml0aWxhemVkIGJ5IGpxdWVyeS11aVxuICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgJCgnLmRyb3Bkb3duJykuZmluZCgnLnVpLXNlbGVjdG1lbnUtdGV4dCcpLmF0dHIoJ3JvbGUnLCAndGV4dGJveCcpO1xuICAgIH0sIDUwMCk7XG4gIH1cblxuICBmdW5jdGlvbiBfaW5pdCgpIHtcbiAgICBfaW5pdFB1YlN1YigpO1xuICAgIF9pbml0UHJpbnRDdGEoKTtcbiAgICBfZ2V0QWNjZXNzaWJsZU1vZGFsQnlJZCgpO1xuICAgIF9pbml0aWFsaXplTWVudSgpOyAvLyAgSGVhZGVyIGFuZCBNZW51IEluaXRpYWxpemF0aW9uc1xuICAgIF9zZWxlY3RNZW51Rm9yRWxlbWVudCgpO1xuICAgIF9udW1lcmljU3RlcHBlclNldHVwKCk7XG4gICAgX2NyZWF0ZVRhYnMoKTtcbiAgICBfY3JlYXRlWm9vbSgpO1xuICAgIF9jcmVhdGVUb29sdGlwcygpO1xuICAgIF9jcmVhdGVCdXR0b25TZXRzKCk7XG4gICAgLy9fdGltZWRPdmVybGF5TW9kYWxzKCk7IC8vIGVuYWJsZSB3aGVuIGdvaW5nIGxpdmVcbiAgICBfdXBkYXRlUHJvZHVjdERhdGEoKTtcbiAgICBfdXBkYXRlUHJvZHVjdERhdGFQRFAoKTtcbiAgICBfdXBkYXRlTW9kYWxRdHkoKTtcbiAgICBfaW5pdENhbGN1bGF0ZVNlbGVjdE9wdGlvbnNXaWR0aCgpO1xuICAgIF9hZGp1c3REcm9wZG93bigpO1xuICB9XG5cbiAgX2luaXQoKTtcblxuICByZXR1cm4ge1xuICAgIGFkZEtleWJvYXJkQXJyb3dOYXZpZ2F0aW9uOiBfYWRkS2V5Ym9hcmRBcnJvd05hdmlnYXRpb24sXG4gICAgYWRkS2V5Ym9hcmRFbnRlcktleTogX2FkZEtleWJvYXJkRW50ZXJLZXksXG4gICAgYWRkS2V5Ym9hcmRMZWZ0UmlnaHRUb2dnbGU6IF9hZGRLZXlib2FyZExlZnRSaWdodFRvZ2dsZSxcbiAgICBhZGRTdHlsZUFjdGl2YXRlZE1lbnVJdGVtOiBfYWRkU3R5bGVBY3RpdmF0ZWRNZW51SXRlbSxcbiAgICBjcmVhdGVUYWJzOiBfY3JlYXRlVGFicyxcbiAgICBjcmVhdGVUb29sdGlwczogX2NyZWF0ZVRvb2x0aXBzLFxuICAgIGNsb3NlU2VhcmNoOiBjbG9zZVNlYXJjaCxcbiAgICBjcmVhdGVCdXR0b25TZXRzOiBfY3JlYXRlQnV0dG9uU2V0cyxcbiAgICBjcmVhdGVab29tOiBfY3JlYXRlWm9vbSxcbiAgICBnZXRQYXJhbWV0ZXJCeU5hbWU6IF9nZXRQYXJhbWV0ZXJCeU5hbWUsXG4gICAgZ2V0UHJvZHVjdERldGFpbEl0ZW06IF9nZXRQcm9kdWN0RGV0YWlsSXRlbSxcbiAgICBnZXRVcmxQYXJhbWV0ZXI6IF9nZXRVcmxQYXJhbWV0ZXIsXG4gICAgaW5pdGlhbGl6ZU1lbnU6IF9pbml0aWFsaXplTWVudSxcbiAgICBudW1lcmljU3RlcHBlclNldHVwOiBfbnVtZXJpY1N0ZXBwZXJTZXR1cCxcbiAgICBwb3B1bGF0ZUNhdGVnb3J5TGlzdDogX3BvcHVsYXRlQ2F0ZWdvcnlMaXN0LFxuICAgIHBvcHVsYXRlUHJvZHVjdExpc3Q6IF9wb3B1bGF0ZVByb2R1Y3RMaXN0LFxuICAgIHNlbGVjdE1lbnVGb3JFbGVtZW50OiBfc2VsZWN0TWVudUZvckVsZW1lbnQsXG4gICAgc2V0dXBTZWN0aW9uU3ViTmF2czogX3NldHVwU2VjdGlvblN1Yk5hdnMsXG4gICAgc2V0dXBUcmF2ZWxWYWxpZGF0aW9uOiBfc2V0dXBUcmF2ZWxWYWxpZGF0aW9uLFxuICAgIHNob3dIaWRlU3ViU2VjdGlvbnM6IF9zaG93SGlkZVN1YlNlY3Rpb25zLFxuICAgIHRpbWVkT3ZlcmxheU1vZGFsczogX3RpbWVkT3ZlcmxheU1vZGFscyxcbiAgICB1cGRhdGVNb2RhbFF0eTogX3VwZGF0ZU1vZGFsUXR5LFxuICAgIG9uOiBfb24sXG4gICAgb2ZmOiBfb2ZmLFxuICAgIHRyaWdnZXI6IF90cmlnZ2VyXG4gIH07XG59KSgpO1xuIiwiLy8gQmFzZWQgaW4gcGFydCBvbiB0aGUgY29kZSBmcm9tOiBodHRwczovL2dpdGh1Yi5jb20vZ2RrcmF1cy9hY2Nlc3NpYmxlLW1vZGFsLWRpYWxvZ1xuXG4vKlxuXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiBMaWNlbnNlIGZvciBBcHBsaWNhdGlvblxuID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiBUaGlzIGxpY2Vuc2UgaXMgZ292ZXJuZWQgYnkgVW5pdGVkIFN0YXRlcyBjb3B5cmlnaHQgbGF3LCBhbmQgd2l0aCByZXNwZWN0IHRvIG1hdHRlcnNcbiBvZiB0b3J0LCBjb250cmFjdCwgYW5kIG90aGVyIGNhdXNlcyBvZiBhY3Rpb24gaXQgaXMgZ292ZXJuZWQgYnkgTm9ydGggQ2Fyb2xpbmEgbGF3LFxuIHdpdGhvdXQgcmVnYXJkIHRvIE5vcnRoIENhcm9saW5hIGNob2ljZSBvZiBsYXcgcHJvdmlzaW9ucy4gIFRoZSBmb3J1bSBmb3IgYW55IGRpc3B1dGVcbiByZXNvbHV0aW9uIHNoYWxsIGJlIGluIFdha2UgQ291bnR5LCBOb3J0aCBDYXJvbGluYS5cblxuIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dCBtb2RpZmljYXRpb24sIGFyZVxuIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuXG4gMS4gUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLCB0aGlzIGxpc3RcbiBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuXG5cbiAyLiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXNcbiBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXJcbiBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuXG4gMy4gVGhlIG5hbWUgb2YgdGhlIGF1dGhvciBtYXkgbm90IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzIGRlcml2ZWQgZnJvbVxuIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uXG5cbiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBBVVRIT1IgXCJBUyBJU1wiIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEXG4gV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZXG4gQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFXG4gTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMXG4gREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7XG4gTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWVxuIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElOR1xuIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRlxuIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuXG4gKi9cblxuY2l0aVNoYXJlLnV0aWwgPSAoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG5cbiAgICAvKipcbiAgICAgKiB0cmFwIHRhYiBrZXkgaW50byBwYXNzZWQgZWxlbWVudFxuICAgICAqIEBwYXJhbSAge29iamVjdH0gb2JqIFRoZSBlbGVtZW50IHRoYXQgZm9jdXMgc2hvdWxkIGJlIHRyYXBwZWQgd2l0aGluXG4gICAgICogQHBhcmFtICB7RXZlbnR9IGV2dCBUaGUgZXZlbnRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0cmFwVGFiS2V5KG9iaiwgZXZ0KSB7XG4gICAgICAgIHZhciBmb2N1c2FibGVFbGVtZW50c1N0cmluZyA9IFwiYVtocmVmXSwgYXJlYVtocmVmXSwgaW5wdXQ6bm90KFtkaXNhYmxlZF0pLCBzZWxlY3Q6bm90KFtkaXNhYmxlZF0pLCB0ZXh0YXJlYTpub3QoW2Rpc2FibGVkXSksIGJ1dHRvbjpub3QoW2Rpc2FibGVkXSksIGlmcmFtZSwgb2JqZWN0LCBlbWJlZCwgKlt0YWJpbmRleF0sICpbY29udGVudGVkaXRhYmxlXVwiO1xuXG4gICAgICAgIC8vIGlmIHRhYiBvciBzaGlmdC10YWIgcHJlc3NlZFxuICAgICAgICBpZiAoZXZ0LndoaWNoID09PSA5KSB7XG5cbiAgICAgICAgICAgIC8vIGdldCBsaXN0IG9mIGFsbCBjaGlsZHJlbiBlbGVtZW50cyBpbiBnaXZlbiBvYmplY3RcbiAgICAgICAgICAgIHZhciBvID0gb2JqLmZpbmQoJyonKTtcblxuICAgICAgICAgICAgLy8gZ2V0IGxpc3Qgb2YgZm9jdXNhYmxlIGl0ZW1zXG4gICAgICAgICAgICB2YXIgZm9jdXNhYmxlSXRlbXM7XG4gICAgICAgICAgICBmb2N1c2FibGVJdGVtcyA9IG8uZmlsdGVyKGZvY3VzYWJsZUVsZW1lbnRzU3RyaW5nKS5maWx0ZXIoJzp2aXNpYmxlJyk7XG5cbiAgICAgICAgICAgIC8vIGdldCBjdXJyZW50bHkgZm9jdXNlZCBpdGVtXG4gICAgICAgICAgICB2YXIgZm9jdXNlZEl0ZW07XG4gICAgICAgICAgICBmb2N1c2VkSXRlbSA9IGpRdWVyeSgnOmZvY3VzJyk7XG5cbiAgICAgICAgICAgIC8vIGdldCB0aGUgbnVtYmVyIG9mIGZvY3VzYWJsZSBpdGVtc1xuICAgICAgICAgICAgdmFyIG51bWJlck9mRm9jdXNhYmxlSXRlbXM7XG4gICAgICAgICAgICBudW1iZXJPZkZvY3VzYWJsZUl0ZW1zID0gZm9jdXNhYmxlSXRlbXMubGVuZ3RoO1xuXG4gICAgICAgICAgICAvLyBnZXQgdGhlIGluZGV4IG9mIHRoZSBjdXJyZW50bHkgZm9jdXNlZCBpdGVtXG4gICAgICAgICAgICB2YXIgZm9jdXNlZEl0ZW1JbmRleDtcbiAgICAgICAgICAgIGZvY3VzZWRJdGVtSW5kZXggPSBmb2N1c2FibGVJdGVtcy5pbmRleChmb2N1c2VkSXRlbSk7XG5cbiAgICAgICAgICAgIGlmIChldnQuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgICAgICAvL2JhY2sgdGFiXG4gICAgICAgICAgICAgICAgLy8gaWYgZm9jdXNlZCBvbiBmaXJzdCBpdGVtIGFuZCB1c2VyIHByZXNlcyBiYWNrLXRhYiwgZ28gdG8gdGhlIGxhc3QgZm9jdXNhYmxlIGl0ZW1cbiAgICAgICAgICAgICAgICBpZiAoZm9jdXNlZEl0ZW1JbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBmb2N1c2FibGVJdGVtcy5nZXQobnVtYmVyT2ZGb2N1c2FibGVJdGVtcyAtIDEpLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL2ZvcndhcmQgdGFiXG4gICAgICAgICAgICAgICAgLy8gaWYgZm9jdXNlZCBvbiB0aGUgbGFzdCBpdGVtIGFuZCB1c2VyIHByZXNlcyB0YWIsIGdvIHRvIHRoZSBmaXJzdCBmb2N1c2FibGUgaXRlbVxuICAgICAgICAgICAgICAgIGlmIChmb2N1c2VkSXRlbUluZGV4ID09PSBudW1iZXJPZkZvY3VzYWJsZUl0ZW1zIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICBmb2N1c2FibGVJdGVtcy5nZXQoMCkuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICBmdW5jdGlvbiB0cmFwRXNjYXBlS2V5KG9iaiwgZXZ0KSB7XG4gICAgICAgIC8vIGlmIGVzY2FwZSBwcmVzc2VkXG4gICAgICAgIGlmIChldnQud2hpY2ggPT09IDI3KSB7XG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICQoJy5qcy1wcm9kdWN0LWRldGFpbC1tb2R1bGUgLm1vZGFsLWNsb3NlLWJ1dHRvbicpLmNsaWNrKCk7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGdyYWIgYW5kIHJlZ2lzdGVyIGEgaGFuZGxlYmFycyB0ZW1wbGF0ZVxuICAgICAqIEBwYXJhbSAge3N0cmluZ30gdGVtcGxhdGUgdGhlIG5hbWUgb2YgdGhlIHRlbXBsYXRlIHRvIGdyYWIsIHdpdGhvdXQgdGhlIGZpbGUgZXh0ZW5zaW9uIChnZXRIYW5kbGViYXJQYXJ0aWFscyhcInNvbWV0aGluZ1wiKSB3aWxsIGdyYWIgYW5kIHJlZ2lzdGVyIHRoZSBcInNvbWV0aGluZy5odG1sXCIgdGVtcGxhdGUpXG4gICAgICogQHJldHVybiB7bnVsbH1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRIYW5kbGViYXJQYXJ0aWFscyh0ZW1wbGF0ZSl7XG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IHdpbmRvdy5jaXRpQ29uZmlnLmhhbmRsZWJhclRlbXBsYXRlc0RpciArIHRlbXBsYXRlICsgJy5odG1sJyxcbiAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgICAgICAgYXN5bmM6IGZhbHNlLFxuICAgICAgICAgICAgZGF0YVR5cGU6ICd0ZXh0J1xuICAgICAgICB9KVxuICAgICAgICAuZG9uZShmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICB3aW5kb3cuSGFuZGxlYmFycy5yZWdpc3RlclBhcnRpYWwodGVtcGxhdGUsIGRhdGEpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdGhyb3R0bGUoZm4sIGRlbGF5KSB7XG4gICAgICAgIGRlbGF5ID0gZGVsYXkgPyBkZWxheSA6IDEwMDtcbiAgICAgICAgdmFyIGxhc3QgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICtuZXcgRGF0ZSgpO1xuICAgICAgICB9KSgpLFxuICAgICAgICAgICAgdGltZW91dElkID0gbnVsbDtcblxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgICAgICBpZiAodGltZW91dElkKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICAgICAgICAgICAgdGltZW91dElkID0gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG5vdyA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICtuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgIGlmIChub3cgLSBsYXN0ID4gZGVsYXkpIHtcbiAgICAgICAgICAgICAgICBmbi5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgICAgICAgICBsYXN0ID0gbm93O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZm4uYXBwbHkodGhpcywgYXJncyk7XG4gICAgICAgICAgICAgICAgfSwgZGVsYXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHJlbmRlciBoYW5kbGViYXJzIHRlbXBsYXRlIHdpdGggZGF0YVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzb3VyY2UgVGVtcGxhdGUgaHRtbFxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIFRlbXBsYXRlIGRhdGFcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFJlbmRlcmVkIHRlbXBsYXRlXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmVuZGVySGFuZGxlQmFycyhzb3VyY2UsIGRhdGEpIHtcbiAgICAgICAgdmFyIHRlbXBsYXRlID0gd2luZG93LkhhbmRsZWJhcnMuY29tcGlsZShzb3VyY2UpO1xuICAgICAgICByZXR1cm4gdGVtcGxhdGUoZGF0YSk7XG4gICAgfVxuXG4gICAvKipcbiAgICAqIFdpbGwgdGFrZSBhbiBpbnRlZ2VyIChvciBmbG9hdCkgYW5kIGZvcm1hdCB0aGUgbnVtYmVyIHdpdGhcbiAgICAqIGNvbW1hcy5cbiAgICAqXG4gICAgKiBTb3VyY2U6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjkwMTEwMi9ob3ctdG8tcHJpbnQtYS1udW1iZXItd2l0aC1jb21tYXMtYXMtdGhvdXNhbmRzLXNlcGFyYXRvcnMtaW4tamF2YXNjcmlwdC8yOTAxMjk4IzI5MDEyOThcbiAgICAqL1xuICAgIGZ1bmN0aW9uIGNvbnZlcnRUb0NvbW1hRm9ybWF0KG51bWJlcikge1xuICAgICAgICBpZihudW1iZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdmFyIHBhcnRzID0gbnVtYmVyLnRvU3RyaW5nKCkuc3BsaXQoXCIuXCIpO1xuICAgICAgICAgICAgcGFydHNbMF0gPSBwYXJ0c1swXS5yZXBsYWNlKC9cXEIoPz0oXFxkezN9KSsoPyFcXGQpKS9nLCBcIixcIik7XG5cbiAgICAgICAgICAgIHJldHVybiBwYXJ0cy5qb2luKFwiLlwiKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGNvbnZlcnRUb0NvbW1hRm9ybWF0OiBjb252ZXJ0VG9Db21tYUZvcm1hdCxcbiAgICAgICAgZ2V0SGFuZGxlYmFyUGFydGlhbHM6IGdldEhhbmRsZWJhclBhcnRpYWxzLFxuICAgICAgICB0cmFwVGFiS2V5OiB0cmFwVGFiS2V5LFxuICAgICAgICB0cmFwRXNjYXBlS2V5OiB0cmFwRXNjYXBlS2V5LFxuICAgICAgICB0aHJvdHRsZTogdGhyb3R0bGUsXG4gICAgICAgIHJlbmRlclRlbXBsYXRlOiByZW5kZXJIYW5kbGVCYXJzXG4gICAgfTtcbn0pKCk7XG4iLCIvKipcbiAqIEpTSGludDpcbiAqIFRvIGFsbG93IGJyYWNrZXQgbm90YXRpb24sXG4gKiBGb3IgZXhhbXBsZSwgdGVzdFtcInBsYWNlaG9sZGVyXCJdIHZzIHRlc3QucGxhY2Vob2xkZXJcbiAqL1xuXG4vKmpzaGludCBzdWI6dHJ1ZSovXG5cbmNpdGlTaGFyZS5mb3JtVmFsaWRhdGlvbiA9IChmdW5jdGlvbigpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBcbiAgICB2YXIgZW1haWwgPSAvXig/PVthLXpBLVowLTkuISMkJSZAJyorLz0/Xl9ge3x9fi1dezEsMjU0fSQpW14uXSg/OlthLXpBLVowLTkhIyQlJicqKy89P15fYHt8fX4tXXwoWy5fXSkoPyFcXDEpKXswLDYyfVteLl1AW14uXSg/IS4qXFwuezJ9KShbYS16QS1aMC05LiEjJCUmJyorLz0/Xl9ge3x9fi1dKykoW2EtekEtWjAtOS4hIyQlJicqKy89P15fYHt8fX4tXSspW14uXXxbXi5dKyQvZztcblxuICAgIHZhciBjb21tb25Gb3JtYXRzID0ge1xuICAgICAgICAncmVxdWlyZWQnIDogJy4rJyxcbiAgICAgICAgJ251bWJlcicgOiAnXlxcXFxkKyQnLFxuICAgICAgICAnZW1haWwnIDogZW1haWwsXG4gICAgICAgICd6aXAnIDogJ15cXFxcZHs1fSQnXG4gICAgfTtcbiAgICBcbiAgICAvKipcbiAgICAgKiBWYWxpZGF0ZSBpbnB1dCB2YWx1ZSBhZ2FpbnN0IGEgcmVndWxhciBleHByZXNzaW9uXG4gICAgICogQHBhcmFtICB7alF1ZXJ5fFN0cmluZ30gZWxlbU9yVmFsdWUgV2hhdCBuZWVkIHRvIGJlIHZhbGlkYXRlZFxuICAgICAqIEBwYXJhbSAge3N0cmluZ30gdHlwZSAgIEVpdGhlciBhIHR5cGUgZnJvbSB0aGUgY29tbW9uRm9ybWF0cyBvYmplY3Qgb3IgYSByZWdleHAgc3RyaW5nXG4gICAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB2YWxpZGF0ZUlucHV0KGVsZW1PclZhbHVlLCB0eXBlKSB7XG4gICAgICAgIHZhciByZXQgPSBmYWxzZSxcbiAgICAgICAgICAgIHZhbCA9IHR5cGVvZiBlbGVtT3JWYWx1ZSA9PT0gJ3N0cmluZycgPyBlbGVtT3JWYWx1ZSA6ICQoZWxlbU9yVmFsdWUpLnZhbCgpLFxuICAgICAgICAgICAgdHlwZVRvVXNlID0gY29tbW9uRm9ybWF0cy5oYXNPd25Qcm9wZXJ0eSh0eXBlKSA/IGNvbW1vbkZvcm1hdHNbdHlwZV0gOiB0eXBlO1xuXG4gICAgICAgIC8vIGNoZWNrIGlmIHR5cGUgZXhpc3RzIGluIHR5cGVzIG9iamVjdFxuICAgICAgICAvLyBpZiBub3QsIGFzc3VtZSB0aGF0IGEgcmVndWxhciBleHByZXNzaW9uXG4gICAgICAgIC8vIGlzIGJlaW5nIHBhc3NlZCBpbiBhbmQgdmFsaWRhdGUgYWdhaW5zdCB0aGF0XG5cbiAgICAgICAgaWYodmFsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldCA9IHZhbC5tYXRjaChuZXcgUmVnRXhwKHR5cGVUb1VzZSkpID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEbyB0d28gaW5wdXQgdmFsdWVzIG1hdGNoPyBUaGUgd29ybGQgd2FudHMgdG8ga25vd1xuICAgICAqIEBwYXJhbSAge2pRdWVyeX0gICRpbnB1dDEgRWxlbWVudCBudW1iZXIgb25lXG4gICAgICogQHBhcmFtICB7alF1ZXJ5fSAgJGlucHV0MiBFbGVtZW50IG51bWJlciB0d29cbiAgICAgKiBAcmV0dXJuIHtCb29sZWFufVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzTWF0Y2hpbmdJbnB1dCgkaW5wdXQxLCAkaW5wdXQyKSB7XG4gICAgICAgIHJldHVybiAkKCRpbnB1dDEpLnZhbCgpID09PSAkKCRpbnB1dDIpLnZhbCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZvcm1hdCBzdHJpbmcgb3IgbnVtYmVyIHdpdGggZGVsaW1pdGVyIGFzIHRob3VzYW5kIHNlcGFyYXRvciAoMTIsMzQ1KVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBudW1iZXJTdHIgU3RyaW5nIG9yIGludGVnZXIsIGl0IGRlcGVuZCBvbiB1c2VyIGlucHV0LCBleDogKDEyLDM0NSBpcyBzdHJpbmcpLCAoMTIzNDUgaXMgaW50ZWdlcilcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZGVsaW1pdGVyIFN0cmluZyB0byBpZGVudGlmeSB0aGUgc3BlY3RhdG9yIGJldHdlZW4gbnVtYmVyczsgZGVmYXVsdCBpcyAnLCdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmb3JtYXROdW1lcmljVmFsdWVzKG51bWJlclN0ciwgZGVsaW1pdGVyKSB7XG5cbiAgICAgICAgdmFyIGZvcm1hdHRlZERlbGltaXRlcjtcbiAgICAgICAgdmFyIHZhbHVlVG9TdHJpbmcgPSBudW1iZXJTdHIudG9TdHJpbmcoKTtcbiAgICAgICAgdmFyIHJlZ2V4RXhwID0gLyhcXGQrKShcXGR7M30pLztcblxuICAgICAgICBpZiAoIHR5cGVvZiBkZWxpbWl0ZXIgICE9PSAndW5kZWZpbmVkJyApe1xuICAgICAgICAgICAgZm9ybWF0dGVkRGVsaW1pdGVyID0gZGVsaW1pdGVyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZm9ybWF0dGVkRGVsaW1pdGVyID0gJywnO1xuICAgICAgICB9XG5cbiAgICAgICAgd2hpbGUgKHJlZ2V4RXhwLnRlc3QodmFsdWVUb1N0cmluZykpe1xuICAgICAgICAgICAgdmFsdWVUb1N0cmluZyA9IHZhbHVlVG9TdHJpbmcucmVwbGFjZShyZWdleEV4cCwgJyQxJysgZm9ybWF0dGVkRGVsaW1pdGVyICsnJDInKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWVUb1N0cmluZztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGb3JtYXQgdGhlIHBvaW50cyBpbnB1dCB2YWx1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZvcm1hdFBvaW50c0lucHV0VmFsdWUgKCRpbnB1dCkge1xuXG4gICAgICAgIGZvcm1hdFBvaW50c1RvTnVtYmVyT25seSgkaW5wdXQpOyAvLyBSZXBsYWNlIGFueSBub24gZGlnaXQgd2l0aCBcIiBcIlxuXG4gICAgICAgICRpbnB1dC5ibHVyKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkKHRoaXMpLnZhbChmb3JtYXROdW1lcmljVmFsdWVzKCQodGhpcykudmFsKCksIFwiLFwiKS50b1N0cmluZygpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVwbGFjZSBhbnkgbm9uIGRpZ2l0IHdpdGggXCIgXCJcbiAgICAgKiBJbnB1dCBmaWVsZCBpcyBwcmVzZXJ2ZWQgYXMgdGV4dCBmaWVsZCB0byBhbGxvdyBcIixcIlxuICAgICAqIGluIHRoZSBmb3JtYXRQb2ludHNJbnB1dFZhbHVlIGZ1bmN0aW9uXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmb3JtYXRQb2ludHNUb051bWJlck9ubHkgKCRpbnB1dCkge1xuXG4gICAgICAgICRpbnB1dC5rZXl1cChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQodGhpcykudmFsKGZvcm1hdE51bWJlck9ubHkoJCh0aGlzKS52YWwoKSkudG9TdHJpbmcoKSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZvcm0gaW5wdXQgdmFsaWRhdGlvblxuICAgICAqIEBwYXJhbSAkaW5wdXRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmb3JtSW5wdXRWYWxpZGF0aW9uICgkaW5wdXQpIHtcblxuICAgICAgICAkaW5wdXQuYmx1cihmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgICAgICAvLyBTZXQgdXAgdG9nZ2xlIGNsYXNzIGJhc2VkIG9uIGRhdGEgYXR0ciB2YWxpZGF0aW9uXG4gICAgICAgICAgICB2YXIgZGF0YUF0dHIgPSAkKHRoaXMpLmRhdGEoXCJpbnB1dC1lcnJvclwiKTtcbiAgICAgICAgICAgIHZhciAkZXJyb3JFTCA9ICQoXCIuZXJyb3ItbWVzc2FnZVtkYXRhLWlucHV0LWVycm9yPVwiICsgZGF0YUF0dHIgKyBcIl1cIik7XG5cbiAgICAgICAgICAgIC8vIFRvZ2dsZSBlcnJvciBtZXNzYWdlIGRpc3BsYXkgcHJvcGVydHlcbiAgICAgICAgICAgIGlmICggIW1lbWJlck51bWJlclZhbGlkYXRpb24oJGlucHV0KSApe1xuICAgICAgICAgICAgICAgIHJldHVybiAkZXJyb3JFTC5hZGRDbGFzcyhcImlzLXZpc2libGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJGVycm9yRUwucmVtb3ZlQ2xhc3MoXCJpcy12aXNpYmxlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIHNob3dFcnJvckZvckVsZW1lbnQoJGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9ICRlbGVtZW50LmRhdGEoJ3ZhbGlkYXRpb24tcmVxdWlyZWQnKTtcbiAgICAgICAgaWYgKCEhZXJyb3JNZXNzYWdlKSB7XG4gICAgICAgICAgICBoaWRlRXJyb3JGb3JFbGVtZW50KCRlbGVtZW50KTtcbiAgICAgICAgICAgICRlbGVtZW50LmNoaWxkcmVuKCcjY29udGFjdC1pbnZhbGlkLXBob25lJykuYXBwZW5kKFwiPHAgY2xhc3M9J2Vycm9yLW1lc3NhZ2UgaXMtaW52YWxpZCc+XCIgKyBlcnJvck1lc3NhZ2UgKyBcIjwvcD5cIik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoaWRlRXJyb3JGb3JFbGVtZW50KCRlbGVtZW50KSB7XG4gICAgICAgICRlbGVtZW50LmZpbmQoJy5lcnJvci1tZXNzYWdlJykucmVtb3ZlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRm9ybSBwaG9uZSBzcGxpdCBpbnB1dCB2YWxpZGF0aW9uXG4gICAgICogQHBhcmFtICRpbnB1dEdyb3VwXG4gICAgICovXG4gICAgLy8gVE9ETzo6IG1ha2UgaXQgbmljZVxuICAgIGZ1bmN0aW9uIGZvcm1TcGxpdFBob25lSW5wdXRWYWxpZGF0aW9uKCRpbnB1dEdyb3VwKSB7XG4gICAgICAgICQuZWFjaCgkaW5wdXRHcm91cC5maW5kKCdbZGF0YS12YWxpZGF0ZS10eXBlPVwic3BsaXQtcGhvbmVcIl0nKSwgZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGlmICghIWVsZW1lbnQudmFsdWUpIHtcbiAgICAgICAgICAgICAgICAkaW5wdXRHcm91cC5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAgICAgICAgICAgICBoaWRlRXJyb3JGb3JFbGVtZW50KCRpbnB1dEdyb3VwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJGlucHV0R3JvdXAuYWRkQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgc2hvd0Vycm9yRm9yRWxlbWVudCgkaW5wdXRHcm91cCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1lbWJlciBudW1iZXIgdmFsaWRhdGlvblxuICAgICAqIEBwYXJhbSAkaW5wdXRcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBtZW1iZXJOdW1iZXJWYWxpZGF0aW9uICgkaW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZWdFeHAoJGlucHV0LmF0dHIoJ2RhdGEtdmFsaWRhdGlvbi1yZWdleCcpKS50ZXN0KCRpbnB1dC52YWwoKSk7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBSZXBsYWNlIGFueSBub24gZGlnaXQgY2hhcmFjdGVyIHdpdGggXCJcIlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgZnVuY3Rpb24gZm9ybWF0TnVtYmVyT25seSAoJGlucHV0KSB7XG4gICAgICAgIGlmICggdHlwZW9mICRpbnB1dCAhPT0gXCJudW1iZXJcIiApe1xuICAgICAgICAgICAgcmV0dXJuICRpbnB1dC5yZXBsYWNlKC9bXlxcZFxcLl0rL2csICcnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNob3dzIHJlbWFpbmluZyBjaGFyYWN0ZXJzIGZvciBhbiBpbnB1dCBmaWVsZC4uLmRvZXMgbm90IGFjdHVhbGx5IGxpbWl0IHRoZSBjaGFyYWN0ZXIgaW5wdXRcbiAgICAgKiBAcGFyYW0gIHtqUXVlcnl9ICRpbnB1dCAgICAgdGhlIGlucHV0IGZpZWxkXG4gICAgICogQHBhcmFtICB7alF1ZXJ5fSAkZXJyb3JFbGVtIHRoZSBlbGVtZW50IHRoYXQgd2lsbCBkaXNwbGF5IHRoZSB1cGRhdGVkIGxpbWl0XG4gICAgICogQHBhcmFtICB7TnVtYmVyfSBsaW1pdCAgICAgIHRoZSBudW1iZXIgb2YgY2hhcmFjdGVycyB0aGF0IGFyZSBhbGxvd2VkIGluIHRoZSBmaWVsZFxuICAgICAqIEByZXR1cm4ge251bGx9XG4gICAgICovXG4gICAgZnVuY3Rpb24gbGltaXRJbnB1dGJ5Q2hhcmFjdGVyQ291bnQoJGlucHV0LCAkZXJyb3JFbGVtLCBsaW1pdCl7XG4gICAgICAgIHZhciAgY2hhckxpbWl0ID0gbGltaXQgPyBsaW1pdCA6ICRpbnB1dC5hdHRyKCdtYXhsZW5ndGgnKSA/IE51bWJlciggJGlucHV0LmF0dHIoJ21heGxlbmd0aCcpICkgOiA1MDAgOyAvL3RvZG86IHJlZmFjdG9yIHRoaXMgZm9yIHJlYWRhYmlsaXR5XG4gICAgICAgIGlmICgkaW5wdXQudmFsKCkubGVuZ3RoIDwgY2hhckxpbWl0KSB7XG4gICAgICAgICAgICAkZXJyb3JFbGVtLnRleHQoIGNoYXJMaW1pdCAtICRpbnB1dC52YWwoKS5sZW5ndGggKyAnIGNoYXJhY3RlcihzKSBsZWZ0Jyk7IC8vIHRvZG86IHR1cm4gdGhpcyBlcnJvciBtZXNzYWdlIGludG8gYSBjaXRpQ29uZmlnIHByb3BlcnR5XG4gICAgICAgICAgICAkKCdzcGFuLmNvdW50JykudGV4dChjaGFyTGltaXQgLSAkaW5wdXQudmFsKCkubGVuZ3RoICsgJ2NoYXJhY3RlcihzKSBsZWZ0Jyk7IC8vb25seSBmb3IgYWNjZXNzaWJpbGl0eTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRlcnJvckVsZW0udGV4dCgnMCBjaGFyYWN0ZXJzIGxlZnQnKTtcbiAgICAgICAgICAgICQoJ3NwYW4uY291bnQnKS50ZXh0KGNoYXJMaW1pdCAtICRpbnB1dC52YWwoKS5sZW5ndGggKyAnY2hhcmFjdGVyKHMpIGxlZnQnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkYXRlSW5wdXQ6IHZhbGlkYXRlSW5wdXQsXG4gICAgICAgIGlzTWF0Y2hpbmdJbnB1dDogaXNNYXRjaGluZ0lucHV0LFxuICAgICAgICBmb3JtYXROdW1lcmljVmFsdWVzOiBmb3JtYXROdW1lcmljVmFsdWVzLFxuICAgICAgICBmb3JtYXRQb2ludHNJbnB1dFZhbHVlOiBmb3JtYXRQb2ludHNJbnB1dFZhbHVlLFxuICAgICAgICBmb3JtYXROdW1iZXJPbmx5IDogZm9ybWF0TnVtYmVyT25seSxcbiAgICAgICAgbGltaXRJbnB1dGJ5Q2hhcmFjdGVyQ291bnQ6IGxpbWl0SW5wdXRieUNoYXJhY3RlckNvdW50LFxuICAgICAgICBtZW1iZXJOdW1iZXJWYWxpZGF0aW9uOiBtZW1iZXJOdW1iZXJWYWxpZGF0aW9uLFxuICAgICAgICBmb3JtSW5wdXRWYWxpZGF0aW9uOiBmb3JtSW5wdXRWYWxpZGF0aW9uLFxuICAgICAgICBmb3JtU3BsaXRQaG9uZUlucHV0VmFsaWRhdGlvbjogZm9ybVNwbGl0UGhvbmVJbnB1dFZhbGlkYXRpb25cbiAgICB9O1xuXG59KSgpO1xuXG4iLCIvLyBJbml0aWFsaXplcyBhbiBPQUEgQWNjZXNzaWJpbGl0eSBTbGlkZXJcbi8vXG4vLyBTb3VyY2U6IGh0dHA6Ly9vYWEtYWNjZXNzaWJpbGl0eS5vcmcvZXhhbXBsZS8zMi9cblxuLyoqXG4gKiBKU0hpbnQ6XG4gKiBUbyBhbGxvdyBicmFja2V0IG5vdGF0aW9uLFxuICogRm9yIGV4YW1wbGUsIHRlc3RbXCJwbGFjZWhvbGRlclwiXSB2cyB0ZXN0LnBsYWNlaG9sZGVyXG4gKi9cblxuLypqc2hpbnQgc3ViOnRydWUqL1xuXG5jaXRpU2hhcmUuc2xpZGVyID0gKGZ1bmN0aW9uKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vXG4gICAgLy8gZnVuY3Rpb24gc2xpZGVyKCkgaXMgYSBjbGFzcyB0byBkZWZpbmUgYW4gQVJJQS1lbmFibGVkIHNsaWRlciB3aWRnZXQuIFRoZSBjbGFzc1xuICAgIC8vIHdpbGwgY3JlYXRlIG5lZWRlZCBoYW5kbGVzIGFuZCBkZWZpbmUgQVJJQSBhdHRyaWJ1dGVzIGZvciB0aGUgc2xpZGVyXG4gICAgLy9cbiAgICAvLyBAcGFyYW0oY29udGFpbmVyX2lkIHN0cmluZykgY29udGFpbmVyX2lkIGlzIHRoZSBjb250YWluaW5nIGRpdiBmb3IgdGhlIHNsaWRlclxuICAgIC8vXG4gICAgLy8gQHBhcmFtKHZlcnQgYm9vbGVhbikgdmVydCBpcyB0cnVlIGlmIHRoZSBzbGlkZXIgaXMgdmVydGljYWw7IGZhbHNlIGlmIGhvcml6b250YWxcbiAgICAvL1xuICAgIC8vIEBwYXJhbShpbmMgaW50ZWdlcikgaW5jIGlzIHRoZSBpbmNyZW1lbnQgdmFsdWUgZm9yIHRoZSBzbGlkZXJcbiAgICAvL1xuICAgIC8vIEBwYXJhbShqdW1wIGludGVnZXIpIGp1bXAgaXMgdGhlIGxhcmdlIGluY3JlbWVudCB2YWx1ZSBmb3IgdGhlIHNsaWRlciAocGdVcC9wZ0Rvd24ga2V5cylcbiAgICAvL1xuICAgIC8vIEBwYXJhbShzaG93VmFscyBib29sZWFuKSBzaG93VmFscyBpcyB0cnVlIGlmIHRoZSBzbGlkZXIgc2hvdWxkIGRpc3BsYXkgdGhlIHZhbHVlIG9mIHRoZSBoYW5kbGVzXG4gICAgLy9cbiAgICAvLyBAcGFyYW0ocmFuZ2UgYm9vbGVhbikgcmFuZ2UgaXMgdHJ1ZSBpZiB0aGUgc2xpZGVyIGlzIGEgcmFuZ2Ugc2xpZGVyXG4gICAgLy9cbiAgICAvLyBAcGFyYW0odmFsMSBpbnRlZ2VyKSB2YWwxIHNwZWNpZmllcyB0aGUgaW5pdGlhbCB2YWx1ZSBvZiB0aGUgc2xpZGVyIG9yIG9mIHRoZSBmaXJzdFxuICAgIC8vICAgICAgICAgc2xpZGUgaGFuZGxlIGlmIHRoaXMgaXMgYSByYW5nZSBzbGlkZXIuIE11c3QgYmUgPj0gbWluLlxuICAgIC8vXG4gICAgLy8gQHBhcmFtKHZhbDIgaW50ZWdlcikgdmFsMiBzcGVjaWZpZXMgdGhlIGluaXRpYWwgdmFsdWUgb2YgdGhlIHNlY29uZCBzbGlkZSBoYW5kbGUuXG4gICAgLy8gICAgICAgICBJZ25vcmVkIGlmIHJhbmdlIGlzIGZhbHNlIChpLmUuIG5vdCBhIHJhbmdlIHNsaWRlcikuIE11c3QgYmUgPD0gbWF4LlxuICAgIC8vXG4gICAgLy8gQHJldHVybiBOL0FcbiAgICAvL1xuICAgIGZ1bmN0aW9uIFNsaWRlcihjb250YWluZXJfaWQsIHZlcnQsIG1pbiwgbWF4LCBpbmMsIGp1bXAsIHNob3dWYWxzLCByYW5nZSwgdmFsMSwgdmFsMikge1xuICAgICAgICAvLyBkZWZpbmUgc2xpZGVyIG9iamVjdCBwcm9wZXJ0aWVzXG4gICAgICAgIHRoaXMua2V5cyA9IG5ldyBLZXlDb2RlcygpO1xuXG4gICAgICAgIHRoaXMuaWQgPSBjb250YWluZXJfaWQ7XG4gICAgICAgIHRoaXMuJGNvbnRhaW5lciA9ICQoJyMnICsgY29udGFpbmVyX2lkKTtcbiAgICAgICAgdGhpcy52ZXJ0ID0gdmVydDtcbiAgICAgICAgdGhpcy5yYW5nZSA9IHJhbmdlO1xuICAgICAgICB0aGlzLnNob3dWYWxzID0gc2hvd1ZhbHM7XG4gICAgICAgIHRoaXMuY3VycmVuY3kgPSB0aGlzLiRjb250YWluZXIuZGF0YSgnY3VycmVuY3knKTtcblxuICAgICAgICAvLyBTdG9yZSB0aGUgc2l6ZSBvZiB0aGUgc2xpZGVyXG4gICAgICAgIHRoaXMud2lkdGggPSB0aGlzLiRjb250YWluZXIub3V0ZXJXaWR0aCgpO1xuICAgICAgICB0aGlzLmhlaWdodCA9IHRoaXMuJGNvbnRhaW5lci5vdXRlckhlaWdodCgpO1xuXG4gICAgICAgIC8vIFN0b3JlIHRoZSBwYWdlIHBvc2l0aW9uIG9mIHRoZSBzbGlkZXJcbiAgICAgICAgdGhpcy5sZWZ0ID0gMDtcbiAgICAgICAgdGhpcy50b3AgPSAwO1xuXG4gICAgICAgIC8vIFN0b3JlIHRoZSBtaW5pbXVtIGFuZCBtYXhpbXVtIGFuZCBpbml0aWFsIHZhbHVlc1xuICAgICAgICB0aGlzLm1pbiA9IG1pbjtcbiAgICAgICAgdGhpcy5tYXggPSBtYXg7XG4gICAgICAgIHRoaXMuaW5jID0gaW5jO1xuICAgICAgICB0aGlzLmp1bXAgPSBqdW1wO1xuICAgICAgICB0aGlzLnZhbDEgPSB2YWwxO1xuXG4gICAgICAgIC8vIElmIHJhbmdlIGlzIHRydWUsIHN0b3JlIHRoZSBzZWNvbmQgdmFsdWVcbiAgICAgICAgaWYgKHJhbmdlID09PSB0cnVlKSB7XG4gICAgICAgICAgICB0aGlzLnZhbDIgPSB2YWwyO1xuICAgICAgICB9XG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLyBDcmVhdGUgaGFuZGxlcyAvLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIHRoaXMuJGhhbmRsZTEgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuJGhhbmRsZTIgPSB1bmRlZmluZWQ7XG5cbiAgICAgICAgaWYgKCByYW5nZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgaGFuZGxlXG4gICAgICAgICAgICB0aGlzLiRoYW5kbGUxID0gdGhpcy5jcmVhdGVIYW5kbGUodmFsMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBjcmVhdGUgdGhlIHJhbmdlIGhpZ2hsaWdodCBkaXZcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlUmFuZ2VEaXYoKTtcblxuICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBmaXJzdCBoYW5kbGVcbiAgICAgICAgICAgIHRoaXMuJGhhbmRsZTEgPSB0aGlzLmNyZWF0ZUhhbmRsZSh2YWwxLCAxKTtcblxuICAgICAgICAgICAgLy8gY3JlYXRlIHRoZSBzZWNvbmQgaGFuZGxlXG4gICAgICAgICAgICB0aGlzLiRoYW5kbGUyID0gdGhpcy5jcmVhdGVIYW5kbGUodmFsMiwgMik7XG4gICAgICAgIH1cbiAgICB9IC8vIGVuZCBzbGlkZXIgY29uc3RydWN0b3JcblxuICAgIC8vXG4gICAgLy8gZnVuY3Rpb24ga2V5Q29kZXMoKSBpcyBhbiBvYmplY3QgdG8gY29udGFpbiBrZXkgY29kZSB2YWx1ZXMgZm9yIHRoZSBhcHBsaWNhdGlvblxuICAgIC8vXG4gICAgZnVuY3Rpb24gS2V5Q29kZXMoKSB7XG4gICAgICAgIC8vIERlZmluZSB2YWx1ZXMgZm9yIGtleWNvZGVzXG4gICAgICAgIHRoaXMuYmFja3NwYWNlICA9IDg7XG4gICAgICAgIHRoaXMudGFiICAgICAgICA9IDk7XG4gICAgICAgIHRoaXMuZW50ZXIgICAgICA9IDEzO1xuICAgICAgICB0aGlzLmVzYyAgICAgICAgPSAyNztcblxuICAgICAgICB0aGlzLnNwYWNlICAgICAgPSAzMjtcbiAgICAgICAgdGhpcy5wYWdldXAgICAgID0gMzM7XG4gICAgICAgIHRoaXMucGFnZWRvd24gICA9IDM0O1xuICAgICAgICB0aGlzLmVuZCAgICAgICAgPSAzNTtcbiAgICAgICAgdGhpcy5ob21lICAgICAgID0gMzY7XG5cbiAgICAgICAgdGhpcy5sZWZ0ICAgICAgID0gMzc7XG4gICAgICAgIHRoaXMudXAgICAgICAgICA9IDM4O1xuICAgICAgICB0aGlzLnJpZ2h0ICAgICAgPSAzOTtcbiAgICAgICAgdGhpcy5kb3duICAgICAgID0gNDA7XG4gICAgfSAvLyBlbmQga2V5Q29kZXNcblxuICAgIC8vXG4gICAgLy8gZnVuY3Rpb24gY3JlYXRlSGFuZGxlKCkgY3JlYXRlcyBhIGhhbmRsZSBmb3IgdGhlIHNsaWRlci4gSXQgZGVmaW5lcyBBUklBIGF0dHJpYnV0ZXMgZm9yXG4gICAgLy8gdGhlIGhhbmRsZSBhbmQgcG9zaXRpb25zIGl0IGF0IHRoZSBzcGVjaWZpZWQgdmFsdWUgaW4gdGhlIHNsaWRlciByYW5nZS4gaWYgc2hvd1ZhbHMgaXMgdHJ1ZSxcbiAgICAvLyBjcmVhdGUgYW5kIHBvc2l0aW9uIGRpdnMgdG8gZGlzcGxheSB0aGUgaGFuZGxlIHZhbHVlLlxuICAgIC8vXG4gICAgLy8gQHBhcmFtICh2YWwgaW50ZWdlcikgdmFsIGlzIHRoZSBpbml0aWFsIHZhbHVlIG9mIHRoZSBoYW5kbGVcbiAgICAvL1xuICAgIC8vIEBwYXJhbSAobnVtIGludGVnZXIpIG51bSBpcyB0aGUgaGFuZGxlIG51bWJlci4gKG9wdGlvbmFsKVxuICAgIC8vXG4gICAgLy8gQHJldHVybiAob2JqZWN0KSByZXR1cm5zIHRoZSBvYmplY3QgcG9pbnRlciBvZiB0aGUgbmV3bHkgY3JlYXRlZCBoYW5kbGVcbiAgICAvL1xuICAgIFNsaWRlci5wcm90b3R5cGUuY3JlYXRlSGFuZGxlID0gZnVuY3Rpb24odmFsLCBudW0pIHtcbiAgICAgICAgdmFyIGlkID0gdGhpcy5pZCArICdfaGFuZGxlJyArIChudW0gPT09IHVuZGVmaW5lZCA/ICcnIDogbnVtKTtcbiAgICAgICAgdmFyIGxhYmVsID0gdGhpcy5pZCArICdfbGFiZWwnICsgKG51bSA9PT0gdW5kZWZpbmVkID8gJycgOiBudW0pO1xuICAgICAgICB2YXIgY29udHJvbHMgPSB0aGlzLmlkICsgJ190ZXh0JyArIChudW0gPT09IHVuZGVmaW5lZCA/ICcnIDogbnVtKTtcbiAgICAgICAgdmFyICRoYW5kbGU7XG5cbiAgICAgICAgdmFyIGhhbmRsZUF0dHJpYnV0ZXMgPSB7fTtcblxuICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpKSB7XG4gICAgICAgICAgICBoYW5kbGVBdHRyaWJ1dGVzLmlkID0gaWQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobGFiZWwpKSB7XG4gICAgICAgICAgICBoYW5kbGVBdHRyaWJ1dGVzWydhcmlhLWxhYmVsbGVkYnknXSA9IGxhYmVsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRyb2xzKSkge1xuICAgICAgICAgICAgaGFuZGxlQXR0cmlidXRlc1snYXJpYS1jb250cm9scyddID0gY29udHJvbHM7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaGFuZGxlID0gJzxzcGFuIGlkPVwiJyArIGlkICsgJ1wiIGNsYXNzPVwiJyArICh0aGlzLnZlcnQgPT09IHRydWUgPyAndic6J2gnKSArJ3NsaWRlckhhbmRsZVwiICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAncm9sZT1cInNsaWRlclwiICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnYXJpYS12YWx1ZW1pbj1cIicgKyB0aGlzLm1pbiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICdcIiBhcmlhLXZhbHVlbWF4PVwiJyArIHRoaXMubWF4O1xuXG4gICAgICAgIGZvciAodmFyIGF0dHJpYnV0ZSBpbiBoYW5kbGVBdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICBpZiAoaGFuZGxlQXR0cmlidXRlcy5oYXNPd25Qcm9wZXJ0eShhdHRyaWJ1dGUpKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlICs9IGF0dHJpYnV0ZSArICc9XCInICsgaGFuZGxlQXR0cmlidXRlcyArICdcIic7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBoYW5kbGUgKz0gJ1wiIHRhYmluZGV4PVwiMFwiPjwvc3Bhbj4nO1xuXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgaGFuZGxlXG4gICAgICAgIHRoaXMuJGNvbnRhaW5lci5hcHBlbmQoaGFuZGxlKTtcblxuICAgICAgICAvLyBzdG9yZSB0aGUgaGFuZGxlIG9iamVjdFxuICAgICAgICAkaGFuZGxlID0gJCgnIycgKyBpZCk7XG5cbiAgICAgICAgaWYgKHRoaXMuc2hvd1ZhbHMgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHZhciB2YWxDb250YWluZXIgPSAnPGRpdiBpZD1cIicgKyBpZCArICdfdmFsXCIgY2xhc3M9XCInICsgKHRoaXMudmVydCA9PT0gdHJ1ZSA/ICd2JzonaCcpICsgJ3NsaWRlclZhbHVlXCIgcm9sZT1cInByZXNlbnRhdGlvblwiPjwvZGl2Pic7XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgY29udGFpbmVyLlxuICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLmFwcGVuZCh2YWxDb250YWluZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc3RvcmUgdGhlIHZhbHVlIG9iamVjdFxuICAgICAgICAkaGFuZGxlID0gJCgnIycgKyBpZCk7XG5cbiAgICAgICAgLy8gcG9zaXRpb24gaGFuZGxlXG4gICAgICAgIHRoaXMucG9zaXRpb25IYW5kbGUoJGhhbmRsZSwgdmFsKTtcblxuICAgICAgICAvLyBiaW5kIGhhbmRsZXJzXG4gICAgICAgIHRoaXMuYmluZEhhbmRsZXJzKCRoYW5kbGUpO1xuXG4gICAgICAgIHJldHVybiAkaGFuZGxlO1xuICAgIH07IC8vIGVuZCBjcmVhdGVIYW5kbGUoKVxuXG4gICAgLy9cbiAgICAvLyBmdW5jdGlvbiBjcmVhdGVSYW5nZURpdigpIGNyZWF0ZXMgYSBkaXYgZm9yIHRoZSBoaWdobGlnaHQgb2YgYSByYW5nZSBzbGlkZXIuIEl0IHNldHMgdGhlIGluaXRpYWwgdG9wIG9yIGxlZnQgcG9zaXRpb25cbiAgICAvLyB0byBtYXRjaCB0aGF0IG9mIHRoZSBzbGlkZXIgY29udGFpbmVyLlxuICAgIC8vXG4gICAgLy8gQHJldHVybiBOL0FcbiAgICAvL1xuICAgIFNsaWRlci5wcm90b3R5cGUuY3JlYXRlUmFuZ2VEaXYgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGlkID0gdGhpcy5pZCArICdfcmFuZ2UnO1xuXG4gICAgICAgIHZhciByYW5nZSA9ICc8ZGl2IGlkPVwiJyArIGlkICsgJ1wiIGNsYXNzPVwic2xpZGVyUmFuZ2VcIj48L2Rpdj4nO1xuXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgcmFuZ2UgZGl2XG4gICAgICAgIHRoaXMuJGNvbnRhaW5lci5hcHBlbmQocmFuZ2UpO1xuXG4gICAgICAgIC8vIFN0b3JlIHRoZSBkaXYgb2JqZWN0XG4gICAgICAgIHRoaXMuJHJhbmdlRGl2ID0gJCgnIycgKyBpZCk7XG5cbiAgICAgICAgaWYgKHRoaXMudmVydCA9PT0gZmFsc2UpIHsgLy8gaG9yaXpvbnRhbCBzbGlkZXJcbiAgICAgICAgICAgIHRoaXMuJHJhbmdlRGl2LmNzcygndG9wJywgdGhpcy50b3AgKyAncHgnKTtcbiAgICAgICAgICAgIHRoaXMuJHJhbmdlRGl2LmNzcygnaGVpZ2h0JywgdGhpcy4kY29udGFpbmVyLmhlaWdodCgpICsgJ3B4Jyk7XG4gICAgICAgIH0gZWxzZSB7IC8vIHZlcnRpY2FsIHNsaWRlclxuICAgICAgICAgICAgdGhpcy4kcmFuZ2VEaXYuY3NzKCdsZWZ0JywgdGhpcy5sZWZ0ICsgJ3B4Jyk7XG4gICAgICAgICAgICB0aGlzLiRyYW5nZURpdi5jc3MoJ3dpZHRoJywgdGhpcy4kY29udGFpbmVyLndpZHRoKCkgKyAncHgnKTtcbiAgICAgICAgfVxuICAgIH07IC8vIGVuZCBjcmVhdGVSYW5nZURpdigpXG5cbiAgICAvL1xuICAgIC8vIGZ1bmN0aW9uIHBvc2l0aW9uSGFuZGxlKCkgaXMgYSBtZW1iZXIgZnVuY3Rpb24gdG8gcG9zaXRpb24gYSBoYW5kbGUgYXQgdGhlIHNwZWNpZmllZCB2YWx1ZSBmb3IgdGhlXG4gICAgLy8gc2xpZGVyLiBJZiBzaG93VmFsIGlzIHRydWUsIGl0IGFsc28gcG9zaXRpb25zIGFuZCB1cGRhdGVzIHRoZSBkaXNwbGF5ZWQgdmFsdWUgY29udGFpbmVyLlxuICAgIC8vXG4gICAgLy8gQHBhcmFtKCRoYW5kbGUgb2JqZWN0KSAkaGFuZGxlIGlzIGEgcG9pbnRlciB0byB0aGUgaGFuZGxlIGpRdWVyeSBvYmplY3QgdG8gbWFuaXB1bGF0ZVxuICAgIC8vXG4gICAgLy8gQHBhcmFtICh2YWwgaW50ZWdlcikgdmFsIGlzIHRoZSBuZXcgdmFsdWUgb2YgdGhlIHNsaWRlclxuICAgIC8vXG4gICAgLy8gQHJldHVybiBOL0FcbiAgICAvL1xuICAgIFNsaWRlci5wcm90b3R5cGUucG9zaXRpb25IYW5kbGUgPSBmdW5jdGlvbigkaGFuZGxlLCB2YWwpIHtcbiAgICAgICAgdmFyIGhhbmRsZUhlaWdodCA9ICRoYW5kbGUub3V0ZXJIZWlnaHQoKTsgLy8gdGhlIHRvdGFsIGhlaWdodCBvZiB0aGUgaGFuZGxlXG4gICAgICAgIHZhciBoYW5kbGVXaWR0aCA9ICRoYW5kbGUub3V0ZXJXaWR0aCgpOyAvLyB0aGUgdG90YWwgd2lkdGggb2YgdGhlIGhhbmRsZVxuICAgICAgICAvL3ZhciBoYW5kbGVPZmZzZXQ7IC8vIHRoZSBkaXN0YW5jZSBmcm9tIHRoZSB2YWx1ZSBwb3NpdGlvbiBmb3IgY2VudGVyaW5nIHRoZSBoYW5kbGVcbiAgICAgICAgdmFyIHhQb3M7IC8vIGNhbGN1bGF0ZWQgaG9yaXpvbnRhbCBwb3NpdGlvbiBvZiB0aGUgaGFuZGxlO1xuICAgICAgICB2YXIgeVBvczsgLy8gY2FsY3VsYXRlZCB2ZXJ0aWNhbCBwb3NpdGlvbiBvZiB0aGUgaGFuZGxlO1xuICAgICAgICB2YXIgdmFsUG9zOyAvL2NhbGN1bGF0ZWQgbmV3IHBpeGVsIHBvc2l0aW9uIGZvciB0aGUgdmFsdWU7XG5cbiAgICAgICAgaWYgKHRoaXMudmVydCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIC8vIGhvcml6b250YWwgc2xpZGVyXG5cbiAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgaG9yaXpvbnRhbCBwaXhlbCBwb3NpdGlvbiBvZiB0aGUgc3BlY2lmaWVkIHZhbHVlXG4gICAgICAgICAgICB2YWxQb3MgPSAoKHZhbCAtIHRoaXMubWluKSAvICh0aGlzLm1heCAtIHRoaXMubWluKSkgKiB0aGlzLndpZHRoICsgdGhpcy5sZWZ0O1xuXG4gICAgICAgICAgICB4UG9zID0gTWF0aC5yb3VuZCh2YWxQb3MgLSAoaGFuZGxlV2lkdGggLyAyKSk7XG4gICAgICAgICAgICB5UG9zID0gTWF0aC5yb3VuZCh0aGlzLnRvcCArICh0aGlzLmhlaWdodCAvIDIpIC0gKGhhbmRsZUhlaWdodCAvIDIpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIHZlcnRpY2FsIHNsaWRlclxuXG4gICAgICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIHZlcnRpY2FsIHBpeGVsIHBvc2l0aW9uIG9mIHRoZSBzcGVjaWZpZWQgdmFsdWVcbiAgICAgICAgICAgIHZhbFBvcyA9ICggKHZhbCAtIHRoaXMubWluKSAvICh0aGlzLm1heCAtIHRoaXMubWluKSApICogdGhpcy5oZWlnaHQgKyB0aGlzLnRvcDtcblxuICAgICAgICAgICAgeFBvcyA9IE1hdGgucm91bmQodGhpcy5sZWZ0ICsgKHRoaXMud2lkdGggLyAyKSAtIChoYW5kbGVXaWR0aCAvIDIpKTtcbiAgICAgICAgICAgIHlQb3MgPSBNYXRoLnJvdW5kKHZhbFBvcyAtIChoYW5kbGVIZWlnaHQgLyAyKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZXQgdGhlIHBvc2l0aW9uIG9mIHRoZSBoYW5kbGVcbiAgICAgICAgJGhhbmRsZS5jc3MoJ3RvcCcsIHlQb3MgKyAncHgnKTtcbiAgICAgICAgJGhhbmRsZS5jc3MoJ2xlZnQnLCB4UG9zICsgJ3B4Jyk7XG5cbiAgICAgICAgLy8gU2V0IHRoZSBhcmlhLXZhbHVlbm93IHBvc2l0aW9uIG9mIHRoZSBoYW5kbGVcbiAgICAgICAgJGhhbmRsZS5hdHRyKCdhcmlhLXZhbHVlbm93JywgdmFsKTtcblxuICAgICAgICAvLyBVcGRhdGUgdGhlIHN0b3JlZCBoYW5kbGUgdmFsdWVzXG4gICAgICAgIGlmICgvMSQvLnRlc3QoJGhhbmRsZS5hdHRyKCdpZCcpKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgLy8gZmlyc3QgaGFuZGxlXG4gICAgICAgICAgICB0aGlzLnZhbDEgPSB2YWw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBzZWNvbmQgaGFuZGxlXG4gICAgICAgICAgICB0aGlzLnZhbDIgPSB2YWw7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiByYW5nZSBpcyB0cnVlLCBzZXQgdGhlIHBvc2l0aW9uIG9mIHRoZSByYW5nZSBkaXZcbiAgICAgICAgaWYgKHRoaXMucmFuZ2UgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb25SYW5nZURpdigpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaWYgc2hvd1ZhbCBpcyB0cnVlLCB1cGRhdGUgdGhlIHZhbHVlIGNvbnRhaW5lclxuICAgICAgICBpZiAodGhpcy5zaG93VmFscyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVWYWxCb3goJGhhbmRsZSwgTWF0aC5yb3VuZCh2YWxQb3MpKTtcbiAgICAgICAgfVxuICAgIH07IC8vIGVuZCBwb3NpdGlvbkhhbmRsZSgpXG5cbiAgICAvL1xuICAgIC8vIGZ1bmN0aW9uIHBvc2l0aW9uUmFuZ2VEaXYoKSBpcyBhIG1lbWJlciBmdW5jdGlvbiB0byByZXBvc2l0aW9uIHRoZSByYW5nZSBkaXYgd2hlbiBhIGhhbmRsZSBpcyBtb3ZlZFxuICAgIC8vXG4gICAgLy8gQHJldHVybiBOL0FcbiAgICAvL1xuICAgIFNsaWRlci5wcm90b3R5cGUucG9zaXRpb25SYW5nZURpdiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcG9zOyAvL2NhbGN1bGF0ZWQgbmV3IHJhbmdlIHN0YXJ0IHBvc2l0aW9uO1xuICAgICAgICB2YXIgc2l6ZTsgLy9jYWxjdWxhdGVkIG5ldyByYW5nZSBzaXplO1xuXG4gICAgICAgIGlmICh0aGlzLnZlcnQgPT09IGZhbHNlKSB7IC8vIEhvcml6b250YWwgc2xpZGVyXG5cbiAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgcmFuZ2Ugc3RhcnQgcG9zaXRpb25cbiAgICAgICAgICAgIHBvcyA9IE1hdGgucm91bmQoICgodGhpcy52YWwxIC0gdGhpcy5taW4pIC8gKHRoaXMubWF4IC0gdGhpcy5taW4pKSAqIHRoaXMud2lkdGgpICsgdGhpcy5sZWZ0O1xuXG4gICAgICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIG5ldyByYW5nZSB3aWR0aFxuICAgICAgICAgICAgc2l6ZSA9IE1hdGgucm91bmQoICgodGhpcy52YWwyIC0gdGhpcy5taW4pIC8gKHRoaXMubWF4IC0gdGhpcy5taW4pKSAqIHRoaXMud2lkdGgpICsgdGhpcy5sZWZ0IC0gcG9zO1xuXG4gICAgICAgICAgICAvLyBzZXQgdGhlIG5ldyByYW5nZSBwb3NpdGlvblxuICAgICAgICAgICAgdGhpcy4kcmFuZ2VEaXYuY3NzKCdsZWZ0JywgcG9zICsgJ3B4Jyk7XG5cbiAgICAgICAgICAgIC8vIHNldCB0aGUgbmV3IHJhbmdlIHdpZHRoXG4gICAgICAgICAgICB0aGlzLiRyYW5nZURpdi5jc3MoJ3dpZHRoJywgc2l6ZSArICdweCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gY2FsY3VsYXRlIHRoZSByYW5nZSBzdGFydCBwb3NpdGlvblxuICAgICAgICAgICAgcG9zID0gTWF0aC5yb3VuZCgoICh0aGlzLnZhbDEgLSB0aGlzLm1pbikgLyAodGhpcy5tYXggLSB0aGlzLm1pbikpICogdGhpcy5oZWlnaHQpKyB0aGlzLnRvcDtcblxuICAgICAgICAgICAgLy8gY2FsY3VsYXRlIHRoZSBuZXcgcmFuZ2Ugd2lkdGhcbiAgICAgICAgICAgIHNpemUgPSBNYXRoLnJvdW5kKCggKHRoaXMudmFsMiAtIHRoaXMubWluKSAvICh0aGlzLm1heCAtIHRoaXMubWluKSApICogdGhpcy5oZWlnaHQpICsgdGhpcy50b3AgLSBwb3M7XG5cbiAgICAgICAgICAgIC8vIHNldCB0aGUgbmV3IHJhbmdlIHBvc2l0aW9uXG4gICAgICAgICAgICB0aGlzLiRyYW5nZURpdi5jc3MoJ3RvcCcsIHBvcyArICdweCcpO1xuXG4gICAgICAgICAgICAvLyBzZXQgdGhlIG5ldyByYW5nZSB3aWR0aFxuICAgICAgICAgICAgdGhpcy4kcmFuZ2VEaXYuY3NzKCdoZWlnaHQnLCBzaXplICsgJ3B4Jyk7XG4gICAgICAgIH1cbiAgICB9OyAvLyBlbmQgcG9zaXRpb25SYW5nZURpdigpXG5cbiAgICAvL1xuICAgIC8vIGZ1bmN0aW9uIHVwZGF0ZVZhbEJveCgpIGlzIGEgbWVtYmVyIGZ1bmN0aW9uIHRvIHJlcG9zaXRpb24gYSBoYW5kbGUgdmFsdWUgYm94IGFuZCB1cGRhdGUgaXRzIGNvbnRlbnRzXG4gICAgLy9cbiAgICAvLyBAcGFyYW0gKCRoYW5kbGUgb2JqZWN0KSAkaGFuZGxlIGlzIHRoZSBqUXVlcnkgb2JqZWN0IG9mIHRoZSBoYW5kbGUgdGhhdCB3YXMgbW92ZWRcbiAgICAvL1xuICAgIC8vIEBwYXJhbSAodmFsUG9zIGludGVnZXIpIGlzIHRoZSBwaXhlbCBwb3NpdGlvbiBvZiB0aGUgc2xpZGVyIHZhbHVlXG4gICAgLy9cbiAgICAvLyBAcmV0dXJuIE4vQVxuICAgIC8vXG4gICAgU2xpZGVyLnByb3RvdHlwZS51cGRhdGVWYWxCb3ggPSBmdW5jdGlvbigkaGFuZGxlLCB2YWxQb3MpIHtcbiAgICAgICAgdmFyICR2YWxCb3ggPSAkKCcjJyArICRoYW5kbGUuYXR0cignaWQnKSArICdfdmFsJyk7XG5cbiAgICAgICAgdmFyIHhQb3M7IC8vIGhvcml6b250YWwgcGl4ZWwgcG9zaXRpb24gb2YgdGhlIGJveFxuICAgICAgICB2YXIgeVBvczsgLy8gdmVydGljYWwgcGl4ZWwgcG9zaXRpb24gb2YgdGhlIGJveFxuICAgICAgICB2YXIgY29tbWFWYWx1ZSA9IGNpdGlTaGFyZS51dGlsLmNvbnZlcnRUb0NvbW1hRm9ybWF0KCRoYW5kbGUuYXR0cignYXJpYS12YWx1ZW5vdycpKTtcblxuICAgICAgICAvLyBTZXQgdGhlIHRleHQgaW4gdGhlIGJveCB0byB0aGUgaGFuZGxlIHZhbHVlXG4gICAgICAgICR2YWxCb3gudGV4dChjb21tYVZhbHVlICsgJyAnICsgdGhpcy5jdXJyZW5jeSk7XG5cbiAgICAgICAgLy8gVHJpZ2dlciBjdXN0b20gZXZlbnQgd2l0aCB2YWx1ZSBkYXRhXG4gICAgICAgIHRoaXMuJGNvbnRhaW5lci50cmlnZ2VyKCdzbGlkZXJWYWx1ZScsIFskaGFuZGxlLmF0dHIoJ2FyaWEtdmFsdWVub3cnKV0pO1xuXG4gICAgICAgIC8vIFNldCB0aGUgcG9zaXRpb24gb2YgdGhlIGhhbmRsZVxuICAgICAgICBpZiAodGhpcy52ZXJ0ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgdmFyIGJveFdpZHRoID0gJHZhbEJveC5vdXRlcldpZHRoKCk7XG5cbiAgICAgICAgICAgIHlQb3MgPSAkaGFuZGxlLmNzcygndG9wJyk7XG5cbiAgICAgICAgICAgIC8vIEFkanVzdCB0aGUgaG9yaXpvbnRhbCBwb3NpdGlvbiB0byBjZW50ZXIgdGhlIHZhbHVlIGJveCBvbiB0aGUgdmFsdWUgcG9zaXRpb25cbiAgICAgICAgICAgIHhQb3MgPSBNYXRoLnJvdW5kKHZhbFBvcyAtIChib3hXaWR0aCAvIDIpKSArICdweCc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgYm94SGVpZ2h0ID0gJHZhbEJveC5vdXRlckhlaWdodCgpO1xuXG4gICAgICAgICAgICB4UG9zID0gJGhhbmRsZS5jc3MoJ2xlZnQnKTtcblxuICAgICAgICAgICAgLy8gQWRqdXN0IHRoZSB2ZXJ0aWNhbCBwb3NpdGlvbiB0byBjZW50ZXIgdGhlIHZhbHVlIGJveCBvbiB0aGUgdmFsdWUgcG9zaXRpb25cbiAgICAgICAgICAgIHlQb3MgPSBNYXRoLnJvdW5kKHZhbFBvcyAtIChib3hIZWlnaHQgLyAyKSkgKyAncHgnO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2V0IHRoZSBwb3NpdGlvbiBvZiB0aGUgdmFsdWUgYm94XG4gICAgICAgICR2YWxCb3guY3NzKCd0b3AnLCB5UG9zKTtcbiAgICAgICAgJHZhbEJveC5jc3MoJ2xlZnQnLCB4UG9zKTtcbiAgICB9OyAvLyBlbmQgdXBkYXRlVmFsQm94KClcblxuICAgIC8vXG4gICAgLy8gZnVuY3Rpb24gYmluZEhhbmRsZXJzKCkgaXMgYSBtZW1iZXIgZnVuY3Rpb24gdG8gYmluZCBldmVudCBoYW5kbGVycyB0byBhIHNsaWRlciBoYW5kbGVcbiAgICAvL1xuICAgIC8vIEBwYXJhbSAoJGhhbmRsZSBvYmplY3QpICRoYW5kbGUgaXMgdGhlIG9iamVjdCBwb2ludGVyIG9mIHRoZSBoYW5kbGUgdG8gYmluZCBoYW5kbGVycyB0b1xuICAgIC8vXG4gICAgLy8gQHJldHVybiBOL0FcbiAgICBTbGlkZXIucHJvdG90eXBlLmJpbmRIYW5kbGVycyA9IGZ1bmN0aW9uKCRoYW5kbGUpIHtcbiAgICAgICAgdmFyIHRoaXNPYmogPSB0aGlzOyAvLyBzdG9yZSB0aGUgdGhpcyBwb2ludGVyXG5cbiAgICAgICAgJGhhbmRsZS5rZXlkb3duKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzT2JqLmhhbmRsZUtleURvd24oJGhhbmRsZSwgZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRoYW5kbGUua2V5cHJlc3MoZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNPYmouaGFuZGxlS2V5UHJlc3MoJGhhbmRsZSwgZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRoYW5kbGUuZm9jdXMoZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNPYmouaGFuZGxlRm9jdXMoJGhhbmRsZSwgZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRoYW5kbGUuYmx1cihmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpc09iai5oYW5kbGVCbHVyKCRoYW5kbGUsIGUpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkaGFuZGxlLm9uKCdtb3VzZWRvd24gdG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzT2JqLmhhbmRsZU1vdXNlRG93bigkaGFuZGxlLCBlKTtcbiAgICAgICAgfSk7XG4gICAgfTsgLy8gZW5kIGJpbmRIYW5kbGVycygpXG5cbiAgICAvL1xuICAgIC8vIGZ1bmN0aW9uIGhhbmRsZUtleURvd24oKSBpcyBhIG1lbWJlciBmdW5jdGlvbiB0byBwcm9jZXNzIGtleWRvd24gZXZlbnRzIGZvciBhIHNsaWRlciBoYW5kbGVcbiAgICAvL1xuICAgIC8vIEBwYXJhbSAoJGhhbmRsZSBvYmplY3QpICRoYW5kbGUgaXMgdGhlIG9iamVjdCBhc3NvY2lhdGVkIHdpdGggdGhlIGV2ZW50XG4gICAgLy9cbiAgICAvLyBAcGFyZW0gKGV2dCBvYmplY3QpIGV2dCBpcyB0aGUgZXZlbnQgb2JqZWN0IGFzc29jaWF0ZWQgd2l0dGhlIHRoZSBldmVudFxuICAgIC8vXG4gICAgLy8gQHJldHVybiAoYm9vbGVhbikgdHJ1ZSBpZiBwcm9wYWdhdGluZzsgZmFsc2UgaWYgY29uc3VtaW5nIGV2ZW50XG4gICAgLy9cbiAgICBTbGlkZXIucHJvdG90eXBlLmhhbmRsZUtleURvd24gPSBmdW5jdGlvbigkaGFuZGxlLCBldnQpIHtcbiAgICAgICAgdmFyIG5ld1ZhbCwgc3RvcFZhbDtcblxuICAgICAgICBpZiAoZXZ0LmN0cmxLZXkgfHwgZXZ0LnNoaWZ0S2V5IHx8IGV2dC5hbHRLZXkpIHtcbiAgICAgICAgICAgIC8vIERvIG5vdGhpbmdcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpdGNoIChldnQua2V5Q29kZSkge1xuICAgICAgICAgICAgY2FzZSB0aGlzLmtleXMuaG9tZToge1xuICAgICAgICAgICAgICAgIC8vIG1vdmUgdGhlIGhhbmRsZSB0byB0aGUgc2xpZGVyIG1pbmltdW1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yYW5nZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkhhbmRsZSgkaGFuZGxlLCB0aGlzLm1pbik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKC8xJC8udGVzdCgkaGFuZGxlLmF0dHIoJ2lkJykpID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgMSAtIG1vdmUgdG8gdGhlIG1pbiB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkhhbmRsZSgkaGFuZGxlLCB0aGlzLm1pbik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgMiAtIG1vdmUgdG8gdGhlIHBvc2l0aW9uIG9mIGhhbmRsZSAxXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uSGFuZGxlKCRoYW5kbGUsIHRoaXMudmFsMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIC8vcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSB0aGlzLmtleXMuZW5kOiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmFuZ2UgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIG1vdmUgdGhlIGhhbmRsZSB0byB0aGUgc2xpZGVyIG1heGltdW1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkhhbmRsZSgkaGFuZGxlLCB0aGlzLm1heCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKC8xJC8udGVzdCgkaGFuZGxlLmF0dHIoJ2lkJykpID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgMSAtIG1vdmUgdG8gdGhlIHBvc2l0aW9uIG9mIGhhbmRsZSAyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uSGFuZGxlKCRoYW5kbGUsIHRoaXMudmFsMik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgMiAtIG1vdmUgdG8gdGhlIG1heCB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkhhbmRsZSgkaGFuZGxlLCB0aGlzLm1heCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIC8vcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSB0aGlzLmtleXMucGFnZXVwOiB7XG4gICAgICAgICAgICAgICAgLy8gRGVjcmVhc2UgYnkganVtcCB2YWx1ZVxuXG4gICAgICAgICAgICAgICAgbmV3VmFsID0gJGhhbmRsZS5hdHRyKCdhcmlhLXZhbHVlbm93JykgLSB0aGlzLmp1bXA7XG4gICAgICAgICAgICAgICAgc3RvcFZhbCA9IHRoaXMubWluOyAvLyB3aGVyZSB0byBzdG9wIG1vdmluZ1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJhbmdlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgaGFuZGxlIDIsIHN0b3Agd2hlbiB3ZSByZWFjaCB0aGUgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIGhhbmRsZSAxXG4gICAgICAgICAgICAgICAgICAgIGlmICgvMiQvLnRlc3QoJGhhbmRsZS5hdHRyKCdpZCcpKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcFZhbCA9IHRoaXMudmFsMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIG1vdmUgdGhlIGhhbmRsZSBvbmUganVtcCBpbmNyZW1lbnQgdG93YXJkIHRoZSBzbGlkZXIgbWluaW11bVxuICAgICAgICAgICAgICAgIC8vIElmIHZhbHVlIGlzIGxlc3MgdGhhbiBzdG9wVmFsLCBzZXQgYXQgc3RvcFZhbCBpbnN0ZWFkXG4gICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkhhbmRsZSgkaGFuZGxlLCAobmV3VmFsID4gc3RvcFZhbCA/IG5ld1ZhbCA6IHN0b3BWYWwpKTtcblxuICAgICAgICAgICAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAvL3JldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgdGhpcy5rZXlzLnBhZ2Vkb3duOiB7XG4gICAgICAgICAgICAgICAgLy8gSW5jcmVhc2UgYnkganVtcCB2YWx1ZVxuXG4gICAgICAgICAgICAgICAgbmV3VmFsID0gcGFyc2VJbnQoJGhhbmRsZS5hdHRyKCdhcmlhLXZhbHVlbm93JykpICsgdGhpcy5qdW1wO1xuICAgICAgICAgICAgICAgIHN0b3BWYWwgPSB0aGlzLm1heDsgLy8gd2hlcmUgdG8gc3RvcCBtb3ZpbmdcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJhbmdlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgaGFuZGxlIDEsIHN0b3Agd2hlbiB3ZSByZWFjaCB0aGUgdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIGhhbmRsZSAyXG4gICAgICAgICAgICAgICAgICAgIGlmICgvMSQvLnRlc3QoJGhhbmRsZS5hdHRyKCdpZCcpKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcFZhbCA9IHRoaXMudmFsMjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIG1vdmUgdGhlIGhhbmRsZSBvbmUganVtcCBpbmNyZW1lbnQgdG93YXJkIHRoZSBzbGlkZXIgbWF4aW11bVxuICAgICAgICAgICAgICAgIC8vIElmIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBtYXhpbXVtLCBzZXQgYXQgbWF4aW11bSBpbnN0ZWFkXG4gICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkhhbmRsZSgkaGFuZGxlLCAobmV3VmFsIDwgc3RvcFZhbCA/IG5ld1ZhbCA6IHN0b3BWYWwpKTtcblxuICAgICAgICAgICAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAvL3JldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgdGhpcy5rZXlzLmxlZnQ6XG4gICAgICAgICAgICBjYXNlIHRoaXMua2V5cy51cDogeyAvLyBkZWNyZW1lbnRcbiAgICAgICAgICAgICAgICBuZXdWYWwgPSAkaGFuZGxlLmF0dHIoJ2FyaWEtdmFsdWVub3cnKSAtIHRoaXMuaW5jO1xuICAgICAgICAgICAgICAgIHN0b3BWYWwgPSB0aGlzLm1pbjsgLy8gd2hlcmUgdG8gc3RvcCBtb3ZpbmdcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yYW5nZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGlzIGhhbmRsZSAyLCBzdG9wIHdoZW4gd2UgcmVhY2ggdGhlIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIC8vIGZvciBoYW5kbGUgMVxuICAgICAgICAgICAgICAgICAgICBpZiAoLzIkLy50ZXN0KCRoYW5kbGUuYXR0cignaWQnKSkgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICBzdG9wVmFsID0gdGhpcy52YWwxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gbW92ZSB0aGUgaGFuZGxlIG9uZSBqdW1wIGluY3JlbWVudCB0b3dhcmQgdGhlIHN0b3BWYWxcbiAgICAgICAgICAgICAgICAvLyBJZiB2YWx1ZSBpcyBsZXNzIHRoYW4gc3RvcFZhbCwgc2V0IGF0IHN0b3BWYWwgaW5zdGVhZFxuICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb25IYW5kbGUoJGhhbmRsZSwgKG5ld1ZhbCA+IHN0b3BWYWwgPyBuZXdWYWwgOiBzdG9wVmFsKSk7XG5cbiAgICAgICAgICAgICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIHRoaXMua2V5cy5yaWdodDpcbiAgICAgICAgICAgIGNhc2UgdGhpcy5rZXlzLmRvd246IHsgLy8gaW5jcmVtZW50XG4gICAgICAgICAgICAgICAgbmV3VmFsID0gcGFyc2VJbnQoJGhhbmRsZS5hdHRyKCdhcmlhLXZhbHVlbm93JykpICsgdGhpcy5pbmM7XG4gICAgICAgICAgICAgICAgc3RvcFZhbCA9IHRoaXMubWF4OyAvLyB3aGVyZSB0byBzdG9wIG1vdmluZ1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmFuZ2UgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgaGFuZGxlIDEsIHN0b3Agd2hlbiB3ZSByZWFjaCB0aGUgdmFsdWVcbiAgICAgICAgICAgICAgICAgIC8vIGZvciBoYW5kbGUgMlxuICAgICAgICAgICAgICAgICAgaWYgKC8xJC8udGVzdCgkaGFuZGxlLmF0dHIoJ2lkJykpID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0b3BWYWwgPSB0aGlzLnZhbDI7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gbW92ZSB0aGUgaGFuZGxlIG9uZSBpbmNyZW1lbnQgdG93YXJkIHRoZSBzbGlkZXIgbWF4aW11bVxuICAgICAgICAgICAgICAgIC8vIElmIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBtYXhpbXVtLCBzZXQgYXQgbWF4aW11bSBpbnN0ZWFkXG4gICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkhhbmRsZSgkaGFuZGxlLCAobmV3VmFsIDwgc3RvcFZhbCA/IG5ld1ZhbCA6IHN0b3BWYWwpKTtcblxuICAgICAgICAgICAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAvL3JldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSAvLyBlbmQgc3dpdGNoXG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTsgLy8gZW5kIGhhbmRsZUtleURvd25cblxuICAgIC8vXG4gICAgLy8gZnVuY3Rpb24gaGFuZGxlS2V5UHJlc3MoKSBpcyBhIG1lbWJlciBmdW5jdGlvbiB0byBwcm9jZXNzIGtleXByZXNzIGV2ZW50cyBmb3IgYSBzbGlkZXIgaGFuZGxlLiBOZWVkZWQgZm9yXG4gICAgLy8gYnJvd3NlcnMgdGhhdCBwZXJmb3JtIHdpbmRvdyBzY3JvbGxpbmcgb24ga2V5cHJlc3MgcmF0aGVyIHRoYW4ga2V5ZG93biBldmVudHMuXG4gICAgLy9cbiAgICAvLyBAcGFyYW0gKCRoYW5kbGUgb2JqZWN0KSAkaGFuZGxlIGlzIHRoZSBvYmplY3QgYXNzb2NpYXRlZCB3aXRoIHRoZSBldmVudFxuICAgIC8vXG4gICAgLy8gQHBhcmVtIChldnQgb2JqZWN0KSBldnQgaXMgdGhlIGV2ZW50IG9iamVjdCBhc3NvY2lhdGVkIHdpdHRoZSB0aGUgZXZlbnRcbiAgICAvL1xuICAgIC8vIEByZXR1cm4gKGJvb2xlYW4pIHRydWUgaWYgcHJvcGFnYXRpbmc7IGZhbHNlIGlmIGNvbnN1bWluZyBldmVudFxuICAgIC8vXG4gICAgU2xpZGVyLnByb3RvdHlwZS5oYW5kbGVLZXlQcmVzcyA9IGZ1bmN0aW9uKCRoYW5kbGUsIGV2dCkge1xuICAgICAgICBpZiAoZXZ0LmN0cmxLZXkgfHwgZXZ0LnNoaWZ0S2V5IHx8IGV2dC5hbHRLZXkpIHtcbiAgICAgICAgICAgIC8vIERvIG5vdGhpbmdcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gIFxuICAgICAgICBzd2l0Y2ggKGV2dC5rZXlDb2RlKSB7XG4gICAgICAgICAgICBjYXNlIHRoaXMua2V5cy5ob21lOlxuICAgICAgICAgICAgY2FzZSB0aGlzLmtleXMucGFnZXVwOlxuICAgICAgICAgICAgY2FzZSB0aGlzLmtleXMuZW5kOlxuICAgICAgICAgICAgY2FzZSB0aGlzLmtleXMucGFnZWRvd246XG4gICAgICAgICAgICBjYXNlIHRoaXMua2V5cy5sZWZ0OlxuICAgICAgICAgICAgY2FzZSB0aGlzLmtleXMudXA6XG4gICAgICAgICAgICBjYXNlIHRoaXMua2V5cy5yaWdodDpcbiAgICAgICAgICAgIGNhc2UgdGhpcy5rZXlzLmRvd246IHtcbiAgICAgICAgICAgICAgICAvLyBDb25zdW1lIHRoZSBldmVudFxuICAgICAgICAgICAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAvL3JldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSAvLyBlbmQgc3dpdGNoXG4gIFxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9OyAvLyBlbmQgaGFuZGxlS2V5RG93blxuXG4gICAgLy9cbiAgICAvLyBmdW5jdGlvbiBoYW5kbGVGb2N1cygpIGlzIGEgbWVtYmVyIGZ1bmN0aW9uIHRvIHByb2Nlc3MgZm9jdXMgZXZlbnRzIGZvciBhIHNsaWRlciBoYW5kbGVcbiAgICAvL1xuICAgIC8vIEBwYXJhbSAoJGhhbmRsZSBvYmplY3QpICRoYW5kbGUgaXMgdGhlIG9iamVjdCBhc3NvY2lhdGVkIHdpdGggdGhlIGV2ZW50XG4gICAgLy9cbiAgICAvLyBAcGFyZW0gKGV2dCBvYmplY3QpIGV2dCBpcyB0aGUgZXZlbnQgb2JqZWN0IGFzc29jaWF0ZWQgd2l0dGhlIHRoZSBldmVudFxuICAgIC8vXG4gICAgLy8gQHJldHVybiAoYm9vbGVhbikgdHJ1ZSBpZiBwcm9wYWdhdGluZzsgZmFsc2UgaWYgY29uc3VtaW5nIGV2ZW50XG4gICAgLy9cbiAgICBTbGlkZXIucHJvdG90eXBlLmhhbmRsZUZvY3VzID0gZnVuY3Rpb24oJGhhbmRsZSkge1xuICAgICAgICAkaGFuZGxlLmFkZENsYXNzKCdmb2N1cycpO1xuICAgICAgICAkaGFuZGxlLmNzcygnei1pbmRleCcsICcyMCcpO1xuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH07IC8vIGVuZCBoYW5kbGVGb2N1cygpXG5cbiAgICAvL1xuICAgIC8vIGZ1bmN0aW9uIGhhbmRsZUJsdXIoKSBpcyBhIG1lbWJlciBmdW5jdGlvbiB0byBwcm9jZXNzIGJsdXIgZXZlbnRzIGZvciBhIHNsaWRlciBoYW5kbGVcbiAgICAvL1xuICAgIC8vIEBwYXJhbSAoJGhhbmRsZSBvYmplY3QpICRoYW5kbGUgaXMgdGhlIG9iamVjdCBhc3NvY2lhdGVkIHdpdGggdGhlIGV2ZW50XG4gICAgLy9cbiAgICAvLyBAcGFyZW0gKGV2dCBvYmplY3QpIGV2dCBpcyB0aGUgZXZlbnQgb2JqZWN0IGFzc29jaWF0ZWQgd2l0dGhlIHRoZSBldmVudFxuICAgIC8vXG4gICAgLy8gQHJldHVybiAoYm9vbGVhbikgdHJ1ZSBpZiBwcm9wYWdhdGluZzsgZmFsc2UgaWYgY29uc3VtaW5nIGV2ZW50XG4gICAgLy9cbiAgICBTbGlkZXIucHJvdG90eXBlLmhhbmRsZUJsdXIgPSBmdW5jdGlvbigkaGFuZGxlKSB7XG4gICAgICAgICRoYW5kbGUucmVtb3ZlQ2xhc3MoJ2ZvY3VzJyk7XG4gICAgICAgICRoYW5kbGUuY3NzKCd6LWluZGV4JywgJzEwJyk7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTsgLy8gZW5kIGhhbmRsZUJsdXIoKVxuXG4gICAgLy9cbiAgICAvLyBmdW5jdGlvbiBoYW5kbGVNb3VzZURvd24oKSBpcyBhIG1lbWJlciBmdW5jdGlvbiB0byBwcm9jZXNzIG1vdXNlZG93biBldmVudHMgZm9yIGEgc2xpZGVyIGhhbmRsZS4gVGhlIGZ1bmN0aW9uXG4gICAgLy8gYmluZHMgYSBtb3VzZW1vdmUgaGFuZGxlclxuICAgIC8vXG4gICAgLy8gQHBhcmFtICgkaGFuZGxlIG9iamVjdCkgJGhhbmRsZSBpcyB0aGUgb2JqZWN0IGFzc29jaWF0ZWQgd2l0aCB0aGUgZXZlbnRcbiAgICAvL1xuICAgIC8vIEBwYXJlbSAoZXZ0IG9iamVjdCkgZXZ0IGlzIHRoZSBldmVudCBvYmplY3QgYXNzb2NpYXRlZCB3aXR0aGUgdGhlIGV2ZW50XG4gICAgLy9cbiAgICAvLyBAcmV0dXJuIChib29sZWFuKSB0cnVlIGlmIHByb3BhZ2F0aW5nOyBmYWxzZSBpZiBjb25zdW1pbmcgZXZlbnRcbiAgICAvL1xuICAgIFNsaWRlci5wcm90b3R5cGUuaGFuZGxlTW91c2VEb3duID0gZnVuY3Rpb24oJGhhbmRsZSwgZXZ0KSB7XG5cbiAgICAgICAgdmFyIHRoaXNPYmogPSB0aGlzOyAvLyBzdG9yZSB0aGUgdGhpcyBwb2ludGVyXG5cbiAgICAgICAgLy8gcmVtb3ZlIGZvY3VzIGhpZ2hsaWdodCBmcm9tIGFsbCBvdGhlciBzbGlkZXIgaGFuZGxlcyBvbiB0aGUgcGFnZVxuICAgICAgICAkKCcuaHNsaWRlckhhbmRsZScpLnJlbW92ZUNsYXNzKCdmb2N1cycpLmNzcygnei1pbmRleCcsICcxMCcpO1xuICAgICAgICAkKCcudnNsaWRlckhhbmRsZScpLnJlbW92ZUNsYXNzKCdmb2N1cycpLmNzcygnei1pbmRleCcsICcxMCcpO1xuXG4gICAgICAgIC8vIFNldCBmb2N1cyB0byB0aGUgY2xpY2tlZCBoYW5kbGVcbiAgICAgICAgJGhhbmRsZS5mb2N1cygpO1xuXG4gICAgICAgIC8vIGJpbmQgYSBtb3VzZW1vdmUgZXZlbnQgaGFuZGxlciB0byB0aGUgZG9jdW1lbnQgdG8gY2FwdHVyZSB0aGUgbW91c2VcbiAgICAgICAgJChkb2N1bWVudCkub24oJ21vdXNlbW92ZSB0b3VjaG1vdmUnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgdGhpc09iai5oYW5kbGVNb3VzZU1vdmUoJGhhbmRsZSwgZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vYmluZCBhIG1vdXNldXAgZXZlbnQgaGFuZGxlciB0byB0aGUgZG9jdW1lbnQgdG8gY2FwdHVyZSB0aGUgbW91c2VcbiAgICAgICAgJChkb2N1bWVudCkub24oJ21vdXNldXAgdG91Y2hlbmQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpc09iai5oYW5kbGVNb3VzZVVwKCRoYW5kbGUsIGUpO1xuICAgICAgICB9KTtcblxuICAgICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9OyAvLyBlbmQgaGFuZGxlTW91c2VEb3duKClcblxuICAgIC8vXG4gICAgLy8gZnVuY3Rpb24gaGFuZGxlTW91c2VVcCgpIGlzIGEgbWVtYmVyIGZ1bmN0aW9uIHRvIHByb2Nlc3MgbW91c2V1cCBldmVudHMgZm9yIGEgc2xpZGVyIGhhbmRsZS4gVGhlIGZ1bmN0aW9uXG4gICAgLy8gdW5iaW5kcyB0aGUgbW91c2Vtb3ZlIGhhbmRsZXJcbiAgICAvL1xuICAgIC8vIEBwYXJhbSAoJGhhbmRsZSBvYmplY3QpICRoYW5kbGUgaXMgdGhlIG9iamVjdCBhc3NvY2lhdGVkIHdpdGggdGhlIGV2ZW50XG4gICAgLy9cbiAgICAvLyBAcGFyZW0gKGV2dCBvYmplY3QpIGV2dCBpcyB0aGUgZXZlbnQgb2JqZWN0IGFzc29jaWF0ZWQgd2l0dGhlIHRoZSBldmVudFxuICAgIC8vXG4gICAgLy8gQHJldHVybiAoYm9vbGVhbikgdHJ1ZSBpZiBwcm9wYWdhdGluZzsgZmFsc2UgaWYgY29uc3VtaW5nIGV2ZW50XG4gICAgLy9cbiAgICBTbGlkZXIucHJvdG90eXBlLmhhbmRsZU1vdXNlVXAgPSBmdW5jdGlvbigkaGFuZGxlLCBldnQpIHtcbiAgICAgICAgLy8gdW5iaW5kIHRoZSBldmVudCBsaXN0ZW5lcnMgdG8gcmVsZWFzZSB0aGUgbW91c2VcbiAgICAgICAgJChkb2N1bWVudCkudW5iaW5kKCdtb3VzZW1vdmUgdG91Y2htb3ZlJyk7XG4gICAgICAgICQoZG9jdW1lbnQpLnVuYmluZCgnbW91c2V1cCB0b3VjaGVuZCcpO1xuXG4gICAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07IC8vIGVuZCBoYW5kbGVNb3VzZVVwKClcblxuICAgIC8vXG4gICAgLy8gZnVuY3Rpb24gaGFuZGxlTW91c2VNb3ZlKCkgaXMgYSBtZW1iZXIgZnVuY3Rpb24gdG8gcHJvY2VzcyBtb3VzZW1vdmUgZXZlbnRzIGZvciBhIHNsaWRlciBoYW5kbGUuXG4gICAgLy9cbiAgICAvLyBAcGFyYW0gKCRoYW5kbGUgb2JqZWN0KSAkaGFuZGxlIGlzIHRoZSBvYmplY3QgYXNzb2NpYXRlZCB3aXRoIHRoZSBldmVudFxuICAgIC8vXG4gICAgLy8gQHBhcmVtIChldnQgb2JqZWN0KSBldnQgaXMgdGhlIGV2ZW50IG9iamVjdCBhc3NvY2lhdGVkIHdpdHRoZSB0aGUgZXZlbnRcbiAgICAvL1xuICAgIC8vIEByZXR1cm4gKGJvb2xlYW4pIHRydWUgaWYgcHJvcGFnYXRpbmc7IGZhbHNlIGlmIGNvbnN1bWluZyBldmVudFxuICAgIC8vXG4gICAgU2xpZGVyLnByb3RvdHlwZS5oYW5kbGVNb3VzZU1vdmUgPSBmdW5jdGlvbigkaGFuZGxlLCBldnQpIHtcbiAgICAgICAgLy92YXIgY3VyVmFsID0gcGFyc2VJbnQoJGhhbmRsZS5hdHRyKCdhcmlhLXZhbHVlbm93JykpO1xuICAgICAgICB2YXIgbmV3VmFsO1xuICAgICAgICB2YXIgaGFuZGxlT2Zmc2V0O1xuICAgICAgICB2YXIgc2xpZGVyT2Zmc2V0ID0gJCgnIycgKyB0aGlzLmlkKS5vZmZzZXQoKS5sZWZ0O1xuICAgICAgICB2YXIgc3RhcnRWYWwgPSB0aGlzLm1pbjtcbiAgICAgICAgdmFyIHN0b3BWYWwgPSB0aGlzLm1heDtcblxuICAgICAgICBpZiAodGhpcy5yYW5nZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgLy8gaWYgdGhpcyBpcyBoYW5kbGUgMSwgc2V0IHN0b3BWYWwgdG8gYmUgdGhlIHZhbHVlXG4gICAgICAgICAgICAvLyBmb3IgaGFuZGxlIDJcbiAgICAgICAgICAgIGlmICgvMSQvLnRlc3QoJGhhbmRsZS5hdHRyKCdpZCcpKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHN0b3BWYWwgPSB0aGlzLnZhbDI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgaGFuZGxlIDI6IFNldCBzdGFydFZhbCB0byBiZSB0aGUgdmFsdWVcbiAgICAgICAgICAgICAgICAvLyBmb3IgaGFuZGxlIDFcbiAgICAgICAgICAgICAgICBzdGFydFZhbCA9IHRoaXMudmFsMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnZlcnQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAvLyBob3Jpem9udGFsIHNsaWRlclxuICAgICAgICAgICAgaWYgKGV2dC5wYWdlWCkge1xuICAgICAgICAgICAgICAgIGhhbmRsZU9mZnNldCA9IGV2dC5wYWdlWCAtIHNsaWRlck9mZnNldDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZ0Lm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlT2Zmc2V0ID0gZXZ0Lm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVggLSBzbGlkZXJPZmZzZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIG5ldyBTbGlkZXIgdmFsdWUgYmFzZWQgb24gdGhlIGhvcml6b250YWwgcGl4ZWwgcG9zaXRpb24gb2YgdGhlIG1vdXNlXG4gICAgICAgICAgICBuZXdWYWwgPSBNYXRoLnJvdW5kKChoYW5kbGVPZmZzZXQgLSB0aGlzLmxlZnQpIC8gdGhpcy53aWR0aCAqICh0aGlzLm1heCAtIHRoaXMubWluKSkgKyB0aGlzLm1pbjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIHZlcnRpY2FsIHNsaWRlclxuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIG5ldyBTbGlkZXIgdmFsdWUgYmFzZWQgb24gdGhlIHZlcnRpY2FsIHBpeGVsIHBvc2l0aW9uIG9mIHRoZSBtb3VzZVxuICAgICAgICAgICAgbmV3VmFsID0gTWF0aC5yb3VuZCgoZXZ0LnBhZ2VZIC0gdGhpcy50b3ApIC8gdGhpcy5oZWlnaHQgKiAodGhpcy5tYXggLSB0aGlzLm1pbikpICsgdGhpcy5taW47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobmV3VmFsID49IHN0YXJ0VmFsICYmIG5ld1ZhbCA8PSBzdG9wVmFsKSB7XG4gICAgICAgICAgICAvLyBEbyBub3QgbW92ZSBoYW5kbGUgdW5sZXNzIG5ldyB2YWx1ZSBpcyBhIHNsaWRlciBpbmNyZW1lbnRcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLyogUHJldHR5IHN1cmUgdGhpcyBpcyB3aGF0IHRoZXkgd2FudGVkIHRvIGFjY29tcGxpc2ggLUx1Y2FzKi9cbiAgICAgICAgICAgIHRoaXMucG9zaXRpb25IYW5kbGUoJGhhbmRsZSwgbmV3VmFsIC0gbmV3VmFsJXRoaXMuaW5jKTtcbiAgICAgICAgfSBlbHNlIGlmIChuZXdWYWwgPCBzdGFydFZhbCkge1xuICAgICAgICAgICAgLy8gdmFsdWUgaXMgbGVzcyB0aGFuIG1pbmltdW0gZm9yIHNsaWRlciAtIHNldCBoYW5kbGUgdG8gbWluXG4gICAgICAgICAgICB0aGlzLnBvc2l0aW9uSGFuZGxlKCRoYW5kbGUsIHN0YXJ0VmFsKTtcbiAgICAgICAgfSBlbHNlIGlmIChuZXdWYWwgPiBzdG9wVmFsKSB7XG4gICAgICAgICAgICAvLyB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gbWF4aW11bSBmb3Igc2xpZGVyIC0gc2V0IGhhbmRsZSB0byBtYXhcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb25IYW5kbGUoJGhhbmRsZSwgc3RvcFZhbCk7XG4gICAgICAgIH1cblxuICAgICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9OyAvLyBlbmQgaGFuZGxlTW91c2VNb3ZlXG5cbiAgICBTbGlkZXIucHJvdG90eXBlLnVwZGF0ZVNsaWRlcldpZHRoID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciAkaGFuZGxlID0gJCgnIycgKyB0aGlzLmlkICsgJ19oYW5kbGUnKTtcblxuICAgICAgICB0aGlzLndpZHRoID0gdGhpcy4kY29udGFpbmVyLm91dGVyV2lkdGgoKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbkhhbmRsZSgkaGFuZGxlLCAkaGFuZGxlLmF0dHIoJ2FyaWEtdmFsdWVub3cnKSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGluaXQoY29udGFpbmVySWQsIG1pbiwgbWF4LCBpbml0aWFsVmFsdWUsIGluY3JlbWVudCwgc2hvd01pbkNsYXNzLCBzaG93TWF4Q2xhc3MsIGZvcm1JRCkge1xuICAgICAgICB2YXIgJHNsaWRlclBhcmVudCA9ICQoJyNwb2ludHMtdHJhbnNmZXItc2xpZGVyJykucGFyZW50KCk7XG4gICAgICAgIHZhciBzbGlkZXIgPSBuZXcgU2xpZGVyKGNvbnRhaW5lcklkLCBmYWxzZSwgbWluLCBtYXgsIGluY3JlbWVudCwgNTAwMCwgdHJ1ZSwgZmFsc2UsIGluaXRpYWxWYWx1ZSk7XG5cbiAgICAgICAgJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNpdGlTaGFyZS51dGlsLnRocm90dGxlKHNsaWRlci51cGRhdGVTbGlkZXJXaWR0aCgpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHNob3dNaW5DbGFzcykge1xuICAgICAgICAgICAgJHNsaWRlclBhcmVudC5maW5kKCcuJyArIHNob3dNaW5DbGFzcykudGV4dChjaXRpU2hhcmUudXRpbC5jb252ZXJ0VG9Db21tYUZvcm1hdChtaW4pKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2hvd01heENsYXNzKSB7XG4gICAgICAgICAgICAkc2xpZGVyUGFyZW50LmZpbmQoJy4nICsgc2hvd01heENsYXNzKS50ZXh0KGNpdGlTaGFyZS51dGlsLmNvbnZlcnRUb0NvbW1hRm9ybWF0KG1heCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGZvcm1JRCkge1xuICAgICAgICAgICAgJCgnIycgKyBmb3JtSUQpLm9uKCdzbGlkZXJJbnB1dENoYW5nZScsIGZ1bmN0aW9uKGUsIHNsaWRlclZhbCwgJHNsaWRlckhhbmRsZSkge1xuICAgICAgICAgICAgICAgIHNsaWRlci5wb3NpdGlvbkhhbmRsZSgkc2xpZGVySGFuZGxlLCBzbGlkZXJWYWwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbml0OiBpbml0XG4gICAgfTtcbn0pKCk7XG5cbiIsIlxuLypcbiAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBjYWxjdWxhdGUgYW5kIGhhbmRsZSBtdWx0aWNvbHVtblxuICogYWNjZXNzaWJsZSBsaXN0LlxuICpcbiAqIFBhcmFtZXRlcnNcbiAqICAgbGlzdElkOiBVTCBlbGVtZW50IGlkXG4gKiAgIG5iT2ZDb2x1bW46ICBOdW1iZXIgb2YgY29sdW1uc1xuICpcbiAqL1xuY2l0aVNoYXJlLmFjY2Vzc2libGVNdWx0aUNvbHVtbkxpc3QgPSBmdW5jdGlvbihsaXN0SWQsIG5iT2ZDb2x1bW4pIHtcblxuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgY29uZmlnID0ge1xuICAgICRsaXN0OiAkKGxpc3RJZCksXG4gICAgbmJPZkNvbHVtbjogbmJPZkNvbHVtbixcbiAgICBoZWlnaHRzOiBbXSxcbiAgICB0ZW1wQ29sdW1uSGVpZ2h0OiAwXG4gIH07XG5cbiAgLypcbiAgICogQ2FsY3VsYXRlIGVhY2ggY29sdW1uIHRvdGFsIGhlaWdodC5cbiAgICovXG4gIHZhciBnZXRDb2x1bW5zSGVpZ2h0ID0gZnVuY3Rpb24gZ2V0Q29sdW1uc0hlaWdodCgpIHtcblxuICAgIC8vIGdvIHRocm91Z2ggYWxsIHRoZSBjb2x1bW5zXG4gICAgZm9yKHZhciBpID0gMTsgaSA8PSBjb25maWcubmJPZkNvbHVtbjsgaSsrKSB7XG4gICAgICB2YXIgY29sdW1uRWxlbWVudHMgPSBjb25maWcuJGxpc3QuZmluZCgnLm15LWFjY291bnQtYWNjZXNzaWJsZS1saXN0LWNvbHVtbicraSk7XG5cbiAgICAgIGNvbHVtbkVsZW1lbnRzLmVhY2goX3N1bUNvbHVtbkVsZW1lbnRzSGVpZ2h0KTtcblxuICAgICAgY29uZmlnLmhlaWdodHMucHVzaCh7XG4gICAgICAgIHBvc2l0aW9uOiBpLFxuICAgICAgICBoZWlnaHQ6IGNvbmZpZy50ZW1wQ29sdW1uSGVpZ2h0XG4gICAgICB9KTtcblxuICAgICAgY29uZmlnLnRlbXBDb2x1bW5IZWlnaHQgPSAwO1xuICAgIH1cbiAgfTtcbiAgXG4gIC8qXG4gICAqIFV0aWwgZnVuY3Rpb24gdG8gc3VtIGNvbHVtbnMgaGVpZ2h0XG4gICAqL1xuICB2YXIgX3N1bUNvbHVtbkVsZW1lbnRzSGVpZ2h0ID0gZnVuY3Rpb24gc3VtQ29sdW1uRWxlbWVudHNIZWlnaHQoKSB7XG4gICAgY29uZmlnLnRlbXBDb2x1bW5IZWlnaHQgKz0gJCh0aGlzKS5vdXRlckhlaWdodCh0cnVlKTtcbiAgfTtcblxuICAvKlxuICAgKiBTZXQgdGhlIG1hcmdpbiB0b3Agb24gdGhlIGNvbHVtbiByZXNldCBlbGVtZW50LlxuICAgKi9cbiAgdmFyIHNldE1hcmdpblRvcCA9IGZ1bmN0aW9uIHNldE1hcmdpblRvcCgpIHtcblxuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBjb25maWcuaGVpZ2h0cy5sZW5ndGggLSAxOyBpKyspIHtcbiAgICAgIHZhciBjdXJyZW50Q29sdW1uID0gY29uZmlnLmhlaWdodHNbaV07XG4gICAgICB2YXIgcmVzZXRFbGVtZW50ID0gY29uZmlnLiRsaXN0LmZpbmQoJy5yZXNldCcrY3VycmVudENvbHVtbi5wb3NpdGlvbik7XG5cbiAgICAgIC8vIFNldCBhIG5lZ2F0aXZlIG1hcmdpbiB0b3AgdG90YWxsaW5nIHRoZSBoZWlnaHQgb2YgdGhlIHByZXZpb3VzIGNvbHVtbi5cbiAgICAgIHJlc2V0RWxlbWVudC5jc3MoJ21hcmdpblRvcCcsIE1hdGguYWJzKGN1cnJlbnRDb2x1bW4uaGVpZ2h0KSAqIC0xKTtcbiAgICB9XG4gIH07XG5cbiAgLypcbiAgICogU2V0IHRoZSBoZWlnaHQgb2YgdGhlIGxpc3QuXG4gICAqIFRoaXMgaXMgbmVjZXNzYXJ5IGJlY2F1c2UgdGhlIG5lZ2F0aXZlIG1hcmdpbiBjYXVzZSBzb21lIGhlaWdodCBwcm9ibGVtcy5cbiAgICovXG4gIHZhciBzZXRMaXN0SGVpZ2h0ID0gZnVuY3Rpb24gc2V0TGlzdEhlaWdodCgpIHtcblxuICAgIHZhciBiaWdnZXN0SGVpZ2h0ID0gMDtcblxuICAgIC8vIEdldCB0aGUgYmlnZ2VzdCBoZWlnaHRcbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgY29uZmlnLmhlaWdodHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBjdXJyZW50Q29sdW1uID0gY29uZmlnLmhlaWdodHNbaV07XG4gICAgICBpZihjdXJyZW50Q29sdW1uLmhlaWdodCA+IGJpZ2dlc3RIZWlnaHQpIHtcbiAgICAgICAgYmlnZ2VzdEhlaWdodCA9IGN1cnJlbnRDb2x1bW4uaGVpZ2h0O1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbmZpZy4kbGlzdC5jc3MoJ2hlaWdodCcsIGJpZ2dlc3RIZWlnaHQpO1xuICB9O1xuXG5cbiAgLypcbiAgICogUmVzZXRzIGxpc3QgY3NzLlxuICAgKi9cbiAgdmFyIHJlc2V0TGlzdCA9IGZ1bmN0aW9uIHJlc2V0TGlzdCgpIHtcbiAgICBjb25maWcuJGxpc3QuZmluZCgnbGknKS5jc3MoJ21hcmdpbi10b3AnLCAnJyk7XG4gICAgY29uZmlnLiRsaXN0LmNzcygnaGVpZ2h0JywgJycpO1xuICB9O1xuXG4gIHZhciBwbGFjZUxpc3QgPSBmdW5jdGlvbiBwbGFjZUxpc3QoKSB7XG4gICAgZ2V0Q29sdW1uc0hlaWdodCgpO1xuICAgIHNldE1hcmdpblRvcCgpO1xuICAgIHNldExpc3RIZWlnaHQoKTtcbiAgfTtcblxuICAvKlxuICAgKiBJbml0IHRoZSBjaXRpU2hhcmUuYWNjZXNzaWJsZU11bHRpQ29sdW1uTGlzdCBjb2RlLlxuICAgKi9cbiAgdmFyIGluaXQgPSBmdW5jdGlvbiBpbml0ICgpIHtcbiAgICBcbiAgICB2YXIgcmVzaXplVGltZXI7XG4gICAgdmFyIGdlc3R1cmVUaW1lO1xuXG4gICAgcGxhY2VMaXN0KCk7XG5cbiAgICAkKHdpbmRvdykub24oJ3Jlc2l6ZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICBjbGVhclRpbWVvdXQocmVzaXplVGltZXIpO1xuICAgICAgICAvLyBkZWJvdW5jZSBmdW5jdGlvbmFsaXR5IHRvIHByZXZlbnQgdGhlIGxhZ2dpdHkgbGFnXG4gICAgICAgIHJlc2l6ZVRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmVzZXRMaXN0KCk7XG4gICAgICAgICAgY2l0aVNoYXJlLnNob3dNb3JlLnJlc2V0SGVpZ2h0cygpO1xuICAgICAgICAgIGlmKHdpbmRvdy5pbm5lcldpZHRoID4gNzY3KSB7XG4gICAgICAgICAgICBwbGFjZUxpc3QoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIDEwMCk7XG4gICAgfSk7XG5cbiAgICAvLyBOZWVkZWQgb24gaXBhZC5cbiAgICAkKHdpbmRvdykub24oJ2dlc3R1cmVlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgIGNsZWFyVGltZW91dChyZXNpemVUaW1lcik7XG4gICAgICAvLyBkZWJvdW5jZSBmdW5jdGlvbmFsaXR5IHRvIHByZXZlbnQgdGhlIGxhZ2dpdHkgbGFnXG4gICAgICBnZXN0dXJlVGltZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpc0lwYWQgPSAvaVBhZC8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSAmJiAhd2luZG93Lk1TU3RyZWFtO1xuICAgICAgICBpZihpc0lwYWQpIHtcbiAgICAgICAgICByZXNldExpc3QoKTtcbiAgICAgICAgICBwbGFjZUxpc3QoKTtcbiAgICAgICAgICBjaXRpU2hhcmUuc2hvd01vcmUucmVzZXRIZWlnaHRzKCk7XG4gICAgICAgIH1cbiAgICAgIH0sIDEwMCk7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBpbml0OiBpbml0LFxuICAgIHJlc2V0OiByZXNldExpc3QsXG4gICAgcGxhY2U6IHBsYWNlTGlzdFxuICB9O1xufTtcbiIsImNpdGlTaGFyZS5iYWNrVG9Ub3AgPSAoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBmb290ZXJIZWlnaHQgPSBudWxsO1xuICB2YXIgYmFja1RvVG9wID0gJCgnLmJhY2stdG8tdG9wJyk7XG4gIHZhciAkY2F0ZWdvcnlUaXRsZSA9ICQoJy5jYXRlZ29yeS10aXRsZScpO1xuICB2YXIgYmFja1RvVG9wUGFkZGluZyA9IDA7XG4gIHZhciBtb2RhbFBvaW50c1RyYW5zZmVyRGlzcGxheSA9IG51bGw7XG5cbiAgZnVuY3Rpb24gc2V0QmFja1RvVG9wRGVza3RvcCgpIHtcblxuICAgICQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24gKCkge1xuXG4gICAgICBmb290ZXJIZWlnaHQgPSAkKCcjZm9vdGVyJykub3V0ZXJIZWlnaHQoKTtcbiAgICAgIG1vZGFsUG9pbnRzVHJhbnNmZXJEaXNwbGF5ID0gJCgnI21vZGFsLXBvaW50cy10cmFuc2ZlcicpLmNzcygnZGlzcGxheScpIHx8ICdub25lJztcblxuICAgICAgaWYgKCQodGhpcykuc2Nyb2xsVG9wKCkgJiYgJCh0aGlzKS5zY3JvbGxUb3AoKSA+IDAgJiYgbW9kYWxQb2ludHNUcmFuc2ZlckRpc3BsYXkgPT09ICdub25lJykge1xuICAgICAgICBiYWNrVG9Ub3AuYWRkQ2xhc3MoJ2lzLWFjdGl2ZScpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYmFja1RvVG9wLnJlbW92ZUNsYXNzKCdpcy1hY3RpdmUnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCQod2luZG93KS5zY3JvbGxUb3AoKSArICQod2luZG93KS5oZWlnaHQoKSA+ICQoZG9jdW1lbnQpLmhlaWdodCgpIC0gZm9vdGVySGVpZ2h0KSB7XG4gICAgICAgIGJhY2tUb1RvcC5hZGRDbGFzcygnc3R1Y2snKTtcbiAgICAgICAgYmFja1RvVG9wLmNzcygnYm90dG9tJywgZm9vdGVySGVpZ2h0ICsgYmFja1RvVG9wUGFkZGluZyArICdweCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYmFja1RvVG9wLnJlbW92ZUNsYXNzKCdzdHVjaycpO1xuICAgICAgICBiYWNrVG9Ub3AucmVtb3ZlQXR0cignc3R5bGUnKTtcbiAgICAgIH1cblxuICAgIH0pO1xuXG4gICAgYmFja1RvVG9wLmNsaWNrKGZ1bmN0aW9uIChlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgIHNjcm9sbFRvcDogMFxuICAgICAgfSwgMzAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGJhY2tUb1RvcC5yZW1vdmVDbGFzcygnaXMtYWN0aXZlJyk7XG4gICAgICAgICRjYXRlZ29yeVRpdGxlLmF0dHIoJ3RhYmluZGV4JywgJy0xJyk7XG4gICAgICAgICRjYXRlZ29yeVRpdGxlLmZvY3VzKCk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgfSk7XG4gIH1cblxuICBzZXRCYWNrVG9Ub3BEZXNrdG9wKCk7XG5cbiAgcmV0dXJuIHtcbiAgICBzZXRCYWNrVG9Ub3BEZXNrdG9wOiBzZXRCYWNrVG9Ub3BEZXNrdG9wXG4gIH07XG5cbn0pKCk7XG4iLCJcInVzZSBzdHJpY3RcIjtcblxuLyoqXG4gKiBAbmFtZXNwYWNlIENJVElcbiAqL1xudmFyIENJVEkgPSBDSVRJIHx8IHt9O1xuXG4vKipcbiAqIEBtZW1iZXJvZiBDSVRJXG4gKiBAZnVuY3Rpb25cbiAqIEBuYW1lIGV4ZW1wbGVcbiAqIEBkZXNjcmlwdGlvbiBUaGlzIGlzIG15IGRlc2NyaXB0aW9uIGZ1bmN0aW9uLlxuICpcbiAqIEBwYXJhbSB7YXJyYXl9ICAgICAgICAgICBwX2FycmF5ICAgICBBcnJheSBlbGVtZW50XG4gKiBAcGFyYW0ge29iamVjdHxzdHJpbmd9ICAgcF9lbGVtZW50ICAgRWxlbWVudCB0byB2YWxpZGF0ZVxuICogQHJldHVybnMge2Jvb2xlYW59XG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBleGVtcGxlID0gQ0lUSS5leGVtcGxlKFsnZXhlbXBsZTEnLCAnZXhlbXBsZTInXSwgJ2V4ZW1wbGUxJyk7XG4gKi9cbkNJVEkuZXhlbXBsZSA9IGZ1bmN0aW9uIChwX2FycmF5LCBwX2VsZW1lbnQpIHtcblx0dmFyIGFycmF5XHQ9IHBfYXJyYXk7XG5cdHZhciBlbGVtZW50ID0gcF9lbGVtZW50O1xuXHRyZXR1cm4gKGFycmF5ID09PSBlbGVtZW50KTtcbn07XG4iLCJjaXRpU2hhcmUuY2l0aUNhcm91c2VsID0gKGZ1bmN0aW9uKCRlbGVtLCBzZXR0aW5ncykge1xuICAgIFxuICAgICAgICAndXNlIHN0cmljdCc7XG4gICAgICAgIHZhciBfaGFzSW5pdGVkID0gZmFsc2U7XG4gICAgICAgIHZhciBpc1Jlc2l6aW5nID0gZmFsc2U7XG4gICAgICAgIHZhciBfY2Fyb3VzZWwgPSAkZWxlbTtcbiAgICAgICAgdmFyIF9uZXh0QXJyb3cgPSAnPGJ1dHRvbiBjbGFzcz1cIm5leHQtYXJyb3cgb21uaXR1cmUtc2xpZGVyLW5leHRcIiBhcmlhLWxhYmVsPVwiTmV4dCBJdGVtc1wiPjxsYWJlbD5OZXh0IEl0ZW1zPC9sYWJlbD48aSBjbGFzcz1cImljb24gaWNvbl9uZXh0LWFycm93XCI+PC9idXR0b24+JztcbiAgICAgICAgdmFyIF9wcmV2QXJyb3cgPSAnPGJ1dHRvbiBjbGFzcz1cInByZXYtYXJyb3cgb21uaXR1cmUtc2xpZGVyLW5leHQgb21uaXR1cmUtc2xpZGVyLW5leHRcIiBhcmlhLWxhYmVsPVwiUHJldmlvdXMgSXRlbXNcIj48bGFiZWw+UHJldmlvdXMgSXRlbXM8L2xhYmVsPjxpIGNsYXNzPVwiaWNvbiBpY29uX3ByZXYtYXJyb3dcIj48L2J1dHRvbj4nO1xuICAgICAgICB2YXIgc2xpY2tTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBkb3RzOnRydWUsXG4gICAgICAgICAgICAgICAgY3VzdG9tUGFnaW5nOiBmdW5jdGlvbihzbGlkZXIsIGkpIHsgXG4gICAgICAgICAgICAgICAgICAgIGlmKGkgPT09IDApe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPVwiI1wiIGNsYXNzPVwib21uaXR1cmUtc2xpZGVyLXBhZ2luYXRpb25cIiByb2xlPVwiYnV0dG9uXCI+PHNwYW4+UGFnZSAnK3BhcnNlSW50KGkrMSkrJyBvZiAnK01hdGguY2VpbChzbGlkZXIuc2xpZGVDb3VudC9zbGlkZXIub3B0aW9ucy5zbGlkZXNUb1Nob3cpKycgU2VsZWN0ZWQ8L3NwYW4+PC9hPic7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9XCIjXCIgY2xhc3M9XCJvbW5pdHVyZS1zbGlkZXItcGFnaW5hdGlvblwiIHJvbGU9XCJidXR0b25cIj48c3Bhbj5QYWdlICcrcGFyc2VJbnQoaSsxKSsnIG9mICcrTWF0aC5jZWlsKHNsaWRlci5zbGlkZUNvdW50L3NsaWRlci5vcHRpb25zLnNsaWRlc1RvU2hvdykrJzwvc3Bhbj48L2E+JztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYWRhcHRpdmVIZWlnaHQ6IHRydWUsXG4gICAgICAgICAgICAgICAgYWNjZXNzaWJpbGl0eTogZmFsc2UsXG4gICAgICAgICAgICAgICAgbmV4dEFycm93Ol9uZXh0QXJyb3csXG4gICAgICAgICAgICAgICAgcHJldkFycm93Ol9wcmV2QXJyb3csXG4gICAgICAgICAgICAgICAgcm93czoxLFxuICAgICAgICAgICAgICAgIHN3aXBlOnRydWUsXG4gICAgICAgICAgICAgICAgdG91Y2hNb3ZlOnRydWUsXG4gICAgICAgICAgICAgICAgbW9iaWxlRmlyc3Q6dHJ1ZSxcbiAgICAgICAgICAgICAgICBzbGlkZXNUb1Nob3c6MixcbiAgICAgICAgICAgICAgICBzbGlkZXNUb1Njcm9sbDoyLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNpdmU6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrcG9pbnQ6NzY3LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nczp7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXNUb1Nob3c6NCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlc1RvU2Nyb2xsOjRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIF9zZXR0aW5ncyA9ICQuZXh0ZW5kKHt9LCBzbGlja1NldHRpbmdzLCBzZXR0aW5ncyk7XG5cbiAgICAgICAgZnVuY3Rpb24gX3JlZnJlc2goKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygncmVmcmVzaGluZycpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gX2luaXQoKXtcbiAgICAgICAgICAgIF9jYXJvdXNlbC5vbignYWZ0ZXJDaGFuZ2UnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGlmKGlzUmVzaXppbmcgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfY2Fyb3VzZWwuZmluZCgnLnNsaWNrLXNsaWRlJykuZWFjaChmdW5jdGlvbihpLCBlbGVtKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkKGVsZW0pLmhhc0NsYXNzKCdzbGljay1hY3RpdmUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGVsZW0pLnJlbW92ZUF0dHIoJ3RhYmluZGV4Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoZWxlbSkuZmluZCgnYScpLnJlbW92ZUF0dHIoJ3RhYmluZGV4Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlbGVtKS5hdHRyKCd0YWJpbmRleCcsLTEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGVsZW0pLmZpbmQoJ2EnKS5hdHRyKCd0YWJpbmRleCcsLTEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY2Fyb3VzZWwuZmluZCgnLnNsaWNrLXNsaWRlLnNsaWNrLWFjdGl2ZTp2aXNpYmxlOmZpcnN0LCAuc2xpY2stc2xpZGUuc2xpY2stYWN0aXZlID4gYTp2aXNpYmxlOmZpcnN0JykuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcblxuICAgICAgICAgICAgICAgIF9jYXJvdXNlbC5maW5kKCcuc2xpY2stZG90cyBsaScpLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuJyk7XG5cbiAgICAgICAgICAgICAgICBfY2Fyb3VzZWwuZmluZChcIi5zbGljay1kb3RzIGFcIikuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHdvcmQgPSAkKHRoaXMpLmZpbmQoJ3NwYW4nKS5odG1sKCkucmVwbGFjZSgnU2VsZWN0ZWQnLCcnKTtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKCdzcGFuJykuaHRtbCh3b3JkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIF9jYXJvdXNlbC5maW5kKFwiLnNsaWNrLWRvdHMgbGlcIikuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoJCh0aGlzKS5oYXNDbGFzcygnc2xpY2stYWN0aXZlJykpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdvcmQgPSAkKHRoaXMpLmZpbmQoJ2Egc3BhbjpmaXJzdC1jaGlsZCcpLmh0bWwoKSArIFwiIFNlbGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoJ2Egc3BhbjpmaXJzdC1jaGlsZCcpLmh0bWwod29yZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBfY2Fyb3VzZWwub24oJ2JlZm9yZUNoYW5nZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF9jYXJvdXNlbC5maW5kKCcuc2xpY2stZG90cyBhJykuYmx1cigpO1xuICAgICAgICAgICAgICAgIF9jYXJvdXNlbC5maW5kKCcuc2xpY2stZG90cyBsaScpLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuJyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgX2Nhcm91c2VsLm9uKCdpbml0JywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIF9jYXJvdXNlbC5maW5kKCcuc2xpY2stbGlzdCcpLnJlbW92ZUF0dHIoJ3RhYmluZGV4Jyk7XG4gICAgICAgICAgICAgICAgICAgIF9jYXJvdXNlbC5zbGljaygnc2xpY2tVbmZpbHRlcicpO1xuICAgICAgICAgICAgICAgICAgICBfY2Fyb3VzZWwuZmluZCgnLnNsaWNrLWRvdHMgYScpLmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5zbGljay1kb3RzIGxpJykucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgX2Nhcm91c2VsLmZpbmQoXCIuc2xpY2stZG90cyBhXCIpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdvcmQgPSAkKHRoaXMpLmZpbmQoJ3NwYW4nKS5odG1sKCkucmVwbGFjZSgnU2VsZWN0ZWQnLCcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoJ3NwYW4nKS5odG1sKHdvcmQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3b3JkID0gJCh0aGlzKS5jaGlsZHJlbignc3BhbicpLmh0bWwoKSArIFwiIFNlbGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNoaWxkcmVuKCdzcGFuJykuaHRtbCh3b3JkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgX2Nhcm91c2VsLmZpbmQoJy5zbGljay1kb3RzIGxpJykucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4nKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRwcmV2YnV0dG9uID0gX2Nhcm91c2VsLmZpbmQoJy5wcmV2LWFycm93Jyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciAkbmV4dGJ1dHRvbiA9IF9jYXJvdXNlbC5maW5kKCcubmV4dC1hcnJvdycpO1xuICAgICAgICAgICAgICAgICAgICAkcHJldmJ1dHRvbi5pbnNlcnRBZnRlcigkbmV4dGJ1dHRvbik7XG4gICAgICAgICAgICAgICAgICAgIF9jaGVja0ZvclRhYkluZGV4KCk7XG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBvbiBicmVha3BvaW50IGNoYW5nZXMsIHRoZSBidXR0b25zIHdlcmUgbW92ZWQgYmFjayB0byB0aGVpclxuICAgICAgICAgICAgLy8gb3JpZ2luYWwgcGxhY2VzIGJyZWFraW5nIHRoZSB0YWJiaW5nIG9yZGVyXG4gICAgICAgICAgICBfY2Fyb3VzZWwub24oJ2JyZWFrcG9pbnQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgJHByZXZidXR0b24gPSBfY2Fyb3VzZWwuZmluZCgnLnByZXYtYXJyb3cnKTtcbiAgICAgICAgICAgICAgICB2YXIgJG5leHRidXR0b24gPSBfY2Fyb3VzZWwuZmluZCgnLm5leHQtYXJyb3cnKTtcbiAgICAgICAgICAgICAgICAkcHJldmJ1dHRvbi5pbnNlcnRBZnRlcigkbmV4dGJ1dHRvbik7XG4gICAgICAgICAgICAgICAgX2NoZWNrRm9yVGFiSW5kZXgoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBfY2Fyb3VzZWwgPSBfY2Fyb3VzZWwuc2xpY2soX3NldHRpbmdzKTtcblxuICAgICAgICAgICAgX2Nhcm91c2VsLm9uKCdzZXRQb3NpdGlvbicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzbGlkZXNTaG93biA9IF9jYXJvdXNlbC5zbGljaygnc2xpY2tHZXRPcHRpb24nLCAnc2xpZGVzVG9TaG93Jyk7XG4gICAgICAgICAgICAgICAgdmFyIG51bWJlck9mU2xpZGVzID0gX2Nhcm91c2VsLmZpbmQoJy5zbGljay1zbGlkZScpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAoc2xpZGVzU2hvd24gPj0gbnVtYmVyT2ZTbGlkZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgX2Nhcm91c2VsLmZpbmQoJy5zbGljay10cmFjaycpLmNzcygnbGVmdCcsICcwJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoJy5zbGljay1kb3RzIGxpJykucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4nKTtcbiAgICAgICAgICAgIF9oYXNJbml0ZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBmdW5jdGlvbiBfY2hlY2tGb3JUYWJJbmRleCgpIHtcbiAgICAgICAgICAgIF9jYXJvdXNlbC5maW5kKCcuc2xpY2stc2xpZGUnKS5lYWNoKGZ1bmN0aW9uKGksIGVsZW0pe1xuICAgICAgICAgICAgICAgIGlmKCQoZWxlbSkuaGFzQ2xhc3MoJ3NsaWNrLWFjdGl2ZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICQoZWxlbSkucmVtb3ZlQXR0cigndGFiaW5kZXgnKTtcbiAgICAgICAgICAgICAgICAgICAgJChlbGVtKS5maW5kKCdhJykucmVtb3ZlQXR0cigndGFiaW5kZXgnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKGVsZW0pLmF0dHIoJ3RhYmluZGV4JywtMSk7XG4gICAgICAgICAgICAgICAgICAgICQoZWxlbSkuZmluZCgnYScpLmF0dHIoJ3RhYmluZGV4JywtMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBfZGVzdHJveSgpIHtcbiAgICAgICAgICAgIGlmKF9oYXNJbml0ZWQpIHtcbiAgICAgICAgICAgICAgICBfY2Fyb3VzZWwuc2xpY2soJ3Vuc2xpY2snKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIF9zZXQob3B0aW9uKSB7XG4gICAgICAgICAgICBfY2Fyb3VzZWwuc2xpY2sob3B0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjYXJvdXNlbDogX2Nhcm91c2VsLFxuICAgICAgICAgICAgaW5pdDpfaW5pdCxcbiAgICAgICAgICAgIHNldDpfc2V0LFxuICAgICAgICAgICAgZGVzdHJveTpfZGVzdHJveSxcbiAgICAgICAgICAgIHJlZnJlc2g6X3JlZnJlc2hcbiAgICAgICAgfTtcbn0pO1xuIiwiLyoqXG4gKiBCdXNzaW5lc3MgcnVsZXMgZm9yIHRoZSB2YWxpZGF0aW9uIG9mIGNhcnRcbiAqL1xuXG4vKmpzaGludCB1bnVzZWQ6ZmFsc2UsIHN1Yjp0cnVlKi9cblxuY2l0aVNoYXJlLmVycm9yID0gKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBjb25maWdzID0ge1xuICAgICAgY29udGFjdENvbmZpZzoge1xuICAgICAgICAgIFNFTEVDVE9SOiAnW25hbWU9XCJjYXJ0LWNoZWNrb3V0LWNvbnRhY3RcIl0nLFxuICAgICAgICAgIHBob25lIDoge1xuICAgICAgICAgICAgc2VsZWN0b3I6IFwiI2lucHV0LWNhcnQtaGVhZGVycGhvbmVcIixcbiAgICAgICAgICAgIHZhbGlkYXRlOiBbXCJzcGxpdC1waG9uZS1ncm91cFwiXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZW1haWwgOiB7XG4gICAgICAgICAgICBzZWxlY3RvcjogXCIjaW5wdXQtY2FydC1oZWFkZXItZW1haWxcIixcbiAgICAgICAgICAgIHZhbGlkYXRlOiBbXCJlbWFpbFwiXVxuICAgICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBzdG9yZUNvbmZpZzoge1xuICAgICAgICAgIFNFTEVDVE9SOiAnW25hbWU9XCJjYXJ0LWluc3RvcmUtcGlja3VwLXNlYXJjaFwiXScsXG4gICAgICAgICAgemlwIDoge1xuICAgICAgICAgICAgc2VsZWN0b3I6IFwiI2luc3RvcmUtcGlja3VwLXNlYXJjaC16aXBcIixcbiAgICAgICAgICAgIHZhbGlkYXRlOiBbJ3ppcCddXG4gICAgICAgICAgfSxcbiAgICAgICAgICByYWRpdXMgOiB7XG4gICAgICAgICAgICBzZWxlY3RvcjogXCIjaW5zdG9yZS1waWNrdXAtc2VhcmNoLXJhZGl1cy1idXR0b25cIlxuICAgICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBlZ2lmdENvbmZpZzoge1xuICAgICAgICAgIFNFTEVDVE9SOiAnW25hbWU9XCJjYXJ0LWl0ZW1zLWVnaWZ0LXJlY2lwaWVudFwiXScsXG4gICAgICAgICAgZW1haWwgOiB7XG4gICAgICAgICAgICBzZWxlY3RvcjogXCIjY2FydC1pdGVtcy1lZGl0LWVtYWlsXCIsXG4gICAgICAgICAgICB2YWxpZGF0ZTogW1wiZW1haWxcIl1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGVtYWlsX2NvbmZpcm0gOiB7XG4gICAgICAgICAgICBzZWxlY3RvcjogXCIjY2FydC1pdGVtcy1lZGl0LWNvbmZpcm0tZW1haWxcIixcbiAgICAgICAgICAgIHZhbGlkYXRlOiBbXCJlbWFpbFwiLCBcIm1hdGNoOmNhcnQtaXRlbXMtZWRpdC1lbWFpbFwiXSxcbiAgICAgICAgICAgIGVycm9yczoge1xuICAgICAgICAgICAgICBtYXRjaDpcIiNjYXJ0LWl0ZW1zLXJlY2lwaWVudC1pbnZhbGlkLWVtYWlsLW1hdGNoXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIG5hbWUgOiB7XG4gICAgICAgICAgICBzZWxlY3RvcjogXCIjY2FydC1pdGVtcy1lZGl0LW5hbWVcIlxuICAgICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBzaGlwcGluZ0FkZHJlc3NDb25maWc6IHtcbiAgICAgICAgU0VMRUNUT1I6ICdbbmFtZT1cImNhcnQtaXRlbXMtcmVjaXBpZW50XCJdJyxcbiAgICAgICAgZm5hbWUgOiB7XG4gICAgICAgICAgc2VsZWN0b3I6IFwiI2lucHV0LWNhcnQtZGVsaXZlcnktZmlyc3RuYW1lXCJcbiAgICAgICAgfSxcbiAgICAgICAgbG5hbWUgOiB7XG4gICAgICAgICAgc2VsZWN0b3I6IFwiI2lucHV0LWNhcnQtZGVsaXZlcnktbGFzdG5hbWVcIlxuICAgICAgICB9LFxuXG4gICAgICAgIHJlc2lkZW50aWFsIDoge1xuICAgICAgICAgIHNlbGVjdG9yOiBcIiNyYWRpby1jYXJ0LWRlbGl2ZXJ5LXJlc2lkZW50aWFsXCJcbiAgICAgICAgfSxcbiAgICAgICAgYnVzaW5lc3MgOiB7XG4gICAgICAgICAgc2VsZWN0b3I6IFwiI3JhZGlvLWNhcnQtZGVsaXZlcnktYnVzaW5lc3NcIlxuICAgICAgICB9LFxuICAgICAgICBkZWxpdmVyeVllczoge1xuICAgICAgICAgIHNlbGVjdG9yOiBcIiNyYWRpby1jYXJ0LWRlbGl2ZXJ5LXllc1wiLFxuICAgICAgICAgIHZhbGlkYXRlOiBbJ3JlcXVpcmVkJ11cbiAgICAgICAgfSxcbiAgICAgICAgZGVsaXZlcnlObzoge1xuICAgICAgICAgIHNlbGVjdG9yOiBcIiNyYWRpby1jYXJ0LWRlbGl2ZXJ5LW5vXCIsXG4gICAgICAgICAgdmFsaWRhdGU6IFsncmVxdWlyZWQnXVxuICAgICAgICB9LFxuICAgICAgICBhZGRyZXNzMSA6IHtcbiAgICAgICAgICBzZWxlY3RvcjogXCIjaW5wdXQtY2FydC1kZWxpdmVyeS1hZGRyZXNzMVwiXG4gICAgICAgIH0sXG4gICAgICAgIGFkZHJlc3MyIDoge1xuICAgICAgICAgIHNlbGVjdG9yOiBcIiNpbnB1dC1jYXJ0LWRlbGl2ZXJ5LWFkZHJlc3MyXCIsXG4gICAgICAgICAgbWFudWFsOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIGNpdHkgOiB7XG4gICAgICAgICAgc2VsZWN0b3I6IFwiI2lucHV0LWNhcnQtZGVsaXZlcnktY2l0eVwiXG4gICAgICAgIH0sXG4gICAgICAgIGRpc3RyaWN0IDoge1xuICAgICAgICAgIHNlbGVjdG9yOiBcIiNpbnB1dC1jYXJ0LWRlbGl2ZXJ5LWRpc3RyaWN0XCJcbiAgICAgICAgfSxcbiAgICAgICAgcGhvbmUgOiB7XG4gICAgICAgICAgc2VsZWN0b3I6IFwiI2lucHV0LWNhcnQtZGVsaXZlcnktcGhvbmVcIlxuICAgICAgICB9LFxuICAgICAgICBlbWFpbCA6IHtcbiAgICAgICAgICBzZWxlY3RvcjogXCIjaW5wdXQtY2FydC1kZWxpdmVyeS1lbWFpbFwiXG4gICAgICAgIH0sXG4gICAgICAgIHN0YXRlIDoge1xuICAgICAgICAgIHNlbGVjdG9yOiBcIiNpbnB1dC1jYXJ0LWRlbGl2ZXJ5LXN0YXRlXCJcbiAgICAgICAgfSxcbiAgICAgICAgemlwIDoge1xuICAgICAgICAgIHNlbGVjdG9yOiBcIiNpbnB1dC1jYXJ0LWRlbGl2ZXJ5LXppcFwiLFxuICAgICAgICAgIHZhbGlkYXRlOiBbJ3ppcCddXG4gICAgICAgIH0sXG4gICAgICAgIGNvdW50cnkgOiB7XG4gICAgICAgICAgc2VsZWN0b3I6IFwiI2lucHV0LWNhcnQtZGVsaXZlcnktY291bnRyeVwiXG4gICAgICAgIH1cbiAgICB9LFxuICAgIHBvaW50c1RvQnV5Q29uZmlnOiB7XG4gICAgICAgIHBvaW50cyA6IHtcbiAgICAgICAgICBzZWxlY3RvcjogXCIjY2FydC1wdXJjaGFzZS1wb2ludHMtMVwiXG4gICAgICAgIH0sXG4gICAgICAgIGNhcmRUb0JlQmlsbGVkIDoge1xuICAgICAgICAgIHNlbGVjdG9yOiBcIiNjYy1uYW1lXCJcbiAgICAgICAgfSxcbiAgICAgICAgY3Z2IDoge1xuICAgICAgICAgIHNlbGVjdG9yOiBcIiNjYy1jdnZcIlxuICAgICAgICB9LFxuICAgICAgICBleHBpcmF0aW9uIDoge1xuICAgICAgICAgIHNlbGVjdG9yOiBcIiNjYy1leHBpcmF0aW9uLWRhdGUtbW1cIlxuICAgICAgICB9LFxuICAgICAgICB5ZWFyIDoge1xuICAgICAgICAgIHNlbGVjdG9yOiBcIiNjYy1leHBpcmF0aW9uLWRhdGUteXlcIlxuICAgICAgICB9XG4gICAgfSxcbiAgICBiaWxsaW5nQWRkcmVzc0NvbmZpZzoge1xuICAgICAgICBTRUxFQ1RPUjogJy5jYXJ0LWVkaXQtcG9pbnQtdG8tYnV5LWFkZHJlc3MnLFxuICAgICAgICBmbmFtZSA6IHtcbiAgICAgICAgICBzZWxlY3RvcjogXCIjaW5wdXQtY2FydC1kZWxpdmVyeS1maXJzdG5hbWVcIlxuICAgICAgICB9LFxuICAgICAgICBsbmFtZSA6IHtcbiAgICAgICAgICBzZWxlY3RvcjogXCIjaW5wdXQtY2FydC1kZWxpdmVyeS1sYXN0bmFtZVwiXG4gICAgICAgIH0sXG4gICAgICAgIGFkZHJlc3MxIDoge1xuICAgICAgICAgIHNlbGVjdG9yOiBcIiNpbnB1dC1jYXJ0LWRlbGl2ZXJ5LWFkZHJlc3MxXCJcbiAgICAgICAgfSxcbiAgICAgICAgY2l0eSA6IHtcbiAgICAgICAgICBzZWxlY3RvcjogXCIjaW5wdXQtY2FydC1kZWxpdmVyeS1jaXR5XCJcbiAgICAgICAgfSxcbiAgICAgICAgc3RhdGUgOiB7XG4gICAgICAgICAgc2VsZWN0b3I6IFwiI2lucHV0LWNhcnQtZGVsaXZlcnktc3RhdGVcIlxuICAgICAgICB9LFxuICAgICAgICB6aXAgOiB7XG4gICAgICAgICAgc2VsZWN0b3I6IFwiI2lucHV0LWNhcnQtZGVsaXZlcnktemlwXCIsXG4gICAgICAgICAgdmFsaWRhdGU6IFsnemlwJ11cbiAgICAgICAgfSxcbiAgICAgICAgY291bnRyeSA6IHtcbiAgICAgICAgICBzZWxlY3RvcjogXCIjaW5wdXQtY2FydC1kZWxpdmVyeS1jb3VudHJ5XCJcbiAgICAgICAgfVxuICAgIH1cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gX3N0YW5kYXJkaXplSW5wdXRzKCl7XG4gICAgICAgIC8vc2hvdWxkIG5vdCBiZSBhYmxlIHRvIGVudGVyIG5vbiBudW1lcmljIHZhbHVlc1xuICAgICAgICAkKGNvbmZpZ3Muc3RvcmVDb25maWcuemlwLnNlbGVjdG9yLCBjb25maWdzLnNoaXBwaW5nQWRkcmVzc0NvbmZpZy56aXAuc2VsZWN0b3IsIGNvbmZpZ3MuYmlsbGluZ0FkZHJlc3NDb25maWcuemlwLnNlbGVjdG9yKS5rZXl1cChmdW5jdGlvbigpe1xuICAgICAgICAgICAgJCh0aGlzKS52YWwoY2l0aVNoYXJlLmZvcm1WYWxpZGF0aW9uLmZvcm1hdE51bWJlck9ubHkoJCh0aGlzKS52YWwoKSkudG9TdHJpbmcoKSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF92YWxpZGF0ZVppcENvZGUoKXtcbiAgICAgICAgLy93ZWIgc2VydmljZSBjb2RlIHRvIHZhbGlkYXRlIHppcCBjb2RlXG4gICAgICAgIHZhciAkZWwgPSAkKGNvbmZpZ3Muc3RvcmVDb25maWcuemlwLnNlbGVjdG9yKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogTGVuZ3RoXG4gICAgICAgICAqL1xuICAgICAgICBpZigkZWwudmFsKCkubGVuZ3RoID09PSA1KXtcbiAgICAgICAgICAgICQoJ3BbZGF0YS1lcnJvci10eXBlPVwiaW52YWxpZC16aXBcIl0nKS5yZW1vdmVDbGFzcygnaXMtaW52YWxpZCcpO1xuICAgICAgICAgICAgJGVsLnJlbW92ZUNsYXNzKCdlcnJvcicpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgJCgncFtkYXRhLWVycm9yLXR5cGU9XCJpbnZhbGlkLXppcFwiXScpLmFkZENsYXNzKCdpcy1pbnZhbGlkJyk7XG4gICAgICAgICRlbC5hZGRDbGFzcygnZXJyb3InKTtcbiAgICAgICAgX2ZvY3VzRWxlbSgkZWwpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfc2V0RmllbGRWYWxpZCgkZmllbGQsIGluY2x1ZGVFcnJvciwgdmFsaWRzKSB7IFxuICAgICAgJGZpZWxkID0gJCgkZmllbGQpO1xuICAgICAgaW5jbHVkZUVycm9yID0gdHlwZW9mIGluY2x1ZGVFcnJvciAhPT0gJ3VuZGVmaW5lZCcgPyBpbmNsdWRlRXJyb3IgOiB0cnVlO1xuICAgICAgdmFsaWRzID0gdHlwZW9mIHZhbGlkcyAhPT0gJ3VuZGVmaW5lZCcgPyB2YWxpZHMgOiBbXTtcbiAgICAgIHZhciAkZXJyb3IgPSAkZmllbGQuY2xvc2VzdCgnZmllbGRzZXQnKS5maW5kKCcjJyskZmllbGQuYXR0cignYXJpYS1kZXNjcmliZWRieScpKycgLmVycm9yLW1lc3NhZ2UnKTtcblxuICAgICAgaWYgKCRmaWVsZFswXS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdzZWxlY3QnKSB7XG4gICAgICAgICRmaWVsZC5uZXh0KCcudWktc2VsZWN0bWVudS1idXR0b24nKS5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRmaWVsZC5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGluY2x1ZGVFcnJvcikge1xuICAgICAgICAkZXJyb3IucmVtb3ZlQ2xhc3MoJ2lzLWludmFsaWQnKTtcbiAgICAgICAgdmFsaWRzLmZvckVhY2goZnVuY3Rpb24odmFsaWQpIHtcbiAgICAgICAgICB2YXIgZXJyb3JJZCA9ICRmaWVsZC5hdHRyKCdkYXRhLWNsaWVudC12YWxpZGF0aW9uLWVycm9yLScrdmFsaWQpO1xuICAgICAgICAgIGlmIChlcnJvcklkKSB7XG4gICAgICAgICAgICAkKGVycm9ySWQpLnJlbW92ZUNsYXNzKCdpcy1pbnZhbGlkJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gX3NldEZpZWxkSW52YWxpZCgkZmllbGQsIGluY2x1ZGVFcnJvciwgaW52YWxpZHMpIHtcbiAgICAgICRmaWVsZCA9ICQoJGZpZWxkKTtcbiAgICAgIGludmFsaWRzID0gdHlwZW9mIGludmFsaWRzICE9PSAndW5kZWZpbmVkJyA/IGludmFsaWRzIDogW107XG4gICAgICBpbmNsdWRlRXJyb3IgPSB0eXBlb2YgaW5jbHVkZUVycm9yICE9PSAndW5kZWZpbmVkJyA/IGluY2x1ZGVFcnJvciA6IHRydWU7XG5cbiAgICAgIGlmICgkZmllbGRbMF0udGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnc2VsZWN0Jykge1xuICAgICAgICAkZmllbGQubmV4dCgnLnVpLXNlbGVjdG1lbnUtYnV0dG9uJykuYWRkQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkZmllbGQuYWRkQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICB9XG4gICAgICBpZiAoaW5jbHVkZUVycm9yKSB7XG4gICAgICAgIC8vcmVtb3ZlIGV2ZXJ5dGhpbmcgdG8gc3RhcnRcbiAgICAgICAgJGZpZWxkLmNsb3Nlc3QoJ2ZpZWxkc2V0JykuZmluZCgnIycrJGZpZWxkLmF0dHIoJ2FyaWEtZGVzY3JpYmVkYnknKSsnIC5lcnJvci1tZXNzYWdlJykucmVtb3ZlQ2xhc3MoJ2lzLWludmFsaWQnKTtcbiAgICAgICAgaW52YWxpZHMuZm9yRWFjaChmdW5jdGlvbihpbnZhbGlkKSB7XG4gICAgICAgICAgdmFyIGVycm9ySWQgPSAkZmllbGQuYXR0cignZGF0YS1jbGllbnQtdmFsaWRhdGlvbi1lcnJvci0nK2ludmFsaWQpO1xuICAgICAgICAgIGlmIChlcnJvcklkKSB7XG4gICAgICAgICAgICAkKGVycm9ySWQpLmFkZENsYXNzKCdpcy1pbnZhbGlkJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvL2lmIGl0J3Mgb25seSBhIG1hdGNoIGludmFsaWQsIGRvIG5vdCBnbyBvblxuICAgICAgICBpZiAoaW52YWxpZHMubGVuZ3RoID09PSAxICYmIGludmFsaWRzWzBdID09PSAnbWF0Y2gnKSB7cmV0dXJuO31cblxuICAgICAgICB2YXIgZXJyb3JFbGVtID0gJGZpZWxkLmNsb3Nlc3QoJ2ZpZWxkc2V0JykuZmluZCgnIycrJGZpZWxkLmF0dHIoJ2FyaWEtZGVzY3JpYmVkYnknKSsnIC5lcnJvci1tZXNzYWdlJyk7IFxuICAgICAgICBpZiAoaW52YWxpZHMuaW5kZXhPZignZW1haWwnKSAhPT0gLTEpIHtcbiAgICAgICAgICAgdmFyIGZpbHRlckVsZW0gPSBlcnJvckVsZW0uZmlsdGVyKCdbZGF0YS1lcnJvci10eXBlPVwiaW52YWxpZC1lbWFpbFwiXScpOyBcbiAgICAgICAgICAgaWYgKGZpbHRlckVsZW0ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgIGVycm9yRWxlbSA9IGZpbHRlckVsZW07XG4gICAgICAgICAgIH0gXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZXJyb3JFbGVtID0gZXJyb3JFbGVtLmZpcnN0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBlcnJvckVsZW0uYWRkQ2xhc3MoJ2lzLWludmFsaWQnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfaXNGaWVsZFZhbGlkKCRmaWVsZCkge1xuICAgICAgJGZpZWxkID0gJCgkZmllbGQpO1xuXG4gICAgICB2YXIgdmFsaWRhdGlvbiA9IHtcbiAgICAgICAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgICAgICAgaW52YWxpZHM6W10sXG4gICAgICAgICAgICB2YWxpZHM6IFtdXG4gICAgICAgICAgfSxcbiAgICAgICAgICBpc1JlcXVpcmVkID0gJGZpZWxkLmF0dHIoJ3JlcXVpcmVkJyksXG4gICAgICAgICAgcGF0dGVybiA9ICRmaWVsZC5hdHRyKCdwYXR0ZXJuJyksXG4gICAgICAgICAgY2xpZW50VmFsaWRhdGlvbiA9ICRmaWVsZC5hdHRyKCdkYXRhLWNsaWVudC12YWxpZGF0aW9uJyk7XG5cbiAgICAgIGlmICghY2xpZW50VmFsaWRhdGlvbikge3JldHVybiB2YWxpZGF0aW9uO31cblxuICAgICAgdmFyIHZhbGlkYXRpb25UeXBlcyA9IGNsaWVudFZhbGlkYXRpb24gIT09ICd0cnVlJyA/IGNsaWVudFZhbGlkYXRpb24uc3BsaXQoJywnKSA6IFtdLFxuICAgICAgICAgIHZhbCA9ICcnO1xuXG4gICAgICBpZiAoJGZpZWxkLmF0dHIoJ3R5cGUnKSA9PT0gJ3JhZGlvJykge1xuICAgICAgICB2YXIgbmFtZSA9ICRmaWVsZC5hdHRyKCduYW1lJyk7XG4gICAgICAgIHZhciAkY2hlY2tlZCA9ICRmaWVsZC5jbG9zZXN0KCdmaWVsZHNldCcpLmZpbmQoJ1tuYW1lPVwiJytuYW1lKydcIl06Y2hlY2tlZCcpO1xuICAgICAgICBpZiAoJGNoZWNrZWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHZhbCA9ICRjaGVja2VkLnZhbCgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWwgPSAkZmllbGQudmFsKCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChpc1JlcXVpcmVkKSB7XG4gICAgICAgIHZhbGlkYXRpb25UeXBlcy5wdXNoKCdyZXF1aXJlZCcpOyBcbiAgICAgIH1cblxuICAgICAgaWYgKHBhdHRlcm4pIHtcbiAgICAgICAgdmFsaWRhdGlvblR5cGVzLnB1c2gocGF0dGVybik7XG4gICAgICB9XG5cbiAgICAgIHZhbGlkYXRpb25UeXBlcy5mb3JFYWNoKGZ1bmN0aW9uKHR5cGUpIHtcbiAgICAgICAgaWYgKHR5cGUgIT09ICdzcGxpdC1waG9uZS1ncm91cCcpIHsgXG4gICAgICAgICAgIGlmICh0eXBlLm1hdGNoKCdtYXRjaDonKSkge1xuICAgICAgICAgICAgIHZhciAkdG9NYXRjaCA9ICQoJyMnK3R5cGUuc3BsaXQoJzonKVsxXSk7XG4gICAgICAgICAgICAgaWYgKCR0b01hdGNoLmxlbmd0aCA+IDAgJiYgdmFsICE9PSAkdG9NYXRjaC52YWwoKSkge1xuICAgICAgICAgICAgICB2YWxpZGF0aW9uLnZhbGlkID0gZmFsc2U7IFxuICAgICAgICAgICAgICB2YWxpZGF0aW9uLmludmFsaWRzLnB1c2goJ21hdGNoJyk7XG4gICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgIHZhbGlkYXRpb24udmFsaWRzLnB1c2goJ21hdGNoJyk7XG4gICAgICAgICAgICAgfVxuICAgICAgICAgICB9IGVsc2UgaWYgKCFjaXRpU2hhcmUuZm9ybVZhbGlkYXRpb24udmFsaWRhdGVJbnB1dCh2YWwsIHR5cGUpKSB7XG4gICAgICAgICAgICAgdmFsaWRhdGlvbi52YWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgIHZhbGlkYXRpb24uaW52YWxpZHMucHVzaCh0eXBlKTtcbiAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICB2YWxpZGF0aW9uLnZhbGlkcy5wdXNoKHR5cGUpO1xuICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdmFsaWRhdGlvbjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfdmFsaWRhdGVQaG9uZUdyb3VwKCRwYXJlbnQpIHtcbiAgICAgIHZhciB2YWxpZCA9IHRydWUsXG4gICAgICAgICAgJGlucHV0cyA9ICRwYXJlbnQuZmluZCgnaW5wdXQnKTtcblxuICAgICAgJGlucHV0cy5lYWNoKGZ1bmN0aW9uKGksIGVsZW0pIHtcbiAgICAgICAgdmFyICRlbCA9ICQoZWxlbSksXG4gICAgICAgICAgICB2YWxpZGF0aW9uID0gX2lzRmllbGRWYWxpZCgkZWwpO1xuXG4gICAgICAgIGlmICghdmFsaWRhdGlvbi52YWxpZCkge1xuICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgX3NldEZpZWxkSW52YWxpZCgkZWwsIHRydWUsIHZhbGlkYXRpb24uaW52YWxpZHMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIF9zZXRGaWVsZFZhbGlkKCRlbCwgZmFsc2UsIHZhbGlkYXRpb24udmFsaWRzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgICRpbnB1dHMuZWFjaChmdW5jdGlvbihpLCBlbGVtKSB7XG4gICAgICAgIGlmICh2YWxpZCkge1xuICAgICAgICAgIF9zZXRGaWVsZFZhbGlkKGVsZW0pO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHZhbGlkO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF92YWxpZGF0ZUZpZWxkKCRmaWVsZCkge1xuICAgICAgdmFyIHZhbGlkYXRpb24gPSBfaXNGaWVsZFZhbGlkKCRmaWVsZCk7XG4gICAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgX3NldEZpZWxkSW52YWxpZCgkZmllbGQsIHRydWUsIHZhbGlkYXRpb24uaW52YWxpZHMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX3NldEZpZWxkVmFsaWQoJGZpZWxkLCB0cnVlLCB2YWxpZGF0aW9uLnZhbGlkcyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB2YWxpZGF0aW9uLnZhbGlkO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF92YWxpZGF0ZUZpZWxkc2V0KGZpZWxkc2V0LCBjb25maWcpIHtcbiAgICAgIHZhciB2YWxpZCA9IHRydWUsXG4gICAgICAgICAgJGZpZWxkc2V0ID0gJChmaWVsZHNldCksXG4gICAgICAgICAgJGZpcnN0SW52YWxpZCA9IG51bGw7XG5cbiAgICAgIGZvciAodmFyIGMgaW4gY29uZmlnKSB7XG4gICAgICAgIGlmIChjb25maWcuaGFzT3duUHJvcGVydHkoYykgJiYgdHlwZW9mIGNvbmZpZ1tjXS5zZWxlY3RvciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICB2YXIgJGVsID0gJGZpZWxkc2V0LmZpbmQoY29uZmlnW2NdLnNlbGVjdG9yKTtcbiAgICAgICAgICB2YXIgJGZpcnN0ZWwgPSAkZmllbGRzZXQuZmlyc3QoKS5maW5kKGNvbmZpZ1tjXS5zZWxlY3Rvcik7XG5cbiAgICAgICAgICBpZiAoJGVsLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHZhciB0aGlzVmFsaWQgPSB0cnVlO1xuXG4gICAgICAgICAgICBpZiAoJGVsLmhhc0NsYXNzKCdzcGxpdC1waG9uZS1ncm91cCcpKSB7XG4gICAgICAgICAgICAgIHRoaXNWYWxpZCA9IF92YWxpZGF0ZVBob25lR3JvdXAoJGVsKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXNWYWxpZCA9IF92YWxpZGF0ZUZpZWxkKCRlbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXNWYWxpZCkge1xuICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgIGlmICghJGZpcnN0SW52YWxpZCkge1xuICAgICAgICAgICAgICAgICRmaXJzdEludmFsaWQgPSAkZWw7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCF2YWxpZCkge1xuICAgICAgICBfZm9jdXNFbGVtKCRmaXJzdEludmFsaWQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHZhbGlkO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF92YWxpZGF0ZShmaWVsZHNldEVsZW0pIHtcbiAgICAgIHZhciB2YWxpZCA9IHRydWUsXG4gICAgICAgICAgJGVsID0gJChmaWVsZHNldEVsZW0pO1xuXG4gICAgICBmb3IgKHZhciBjIGluIGNvbmZpZ3MpIHtcbiAgICAgICAgaWYgKGNvbmZpZ3MuaGFzT3duUHJvcGVydHkoYykpIHtcbiAgICAgICAgICB2YXIgdGhpc0NvbmZpZyA9IGNvbmZpZ3NbY107XG5cbiAgICAgICAgICBpZiAodHlwZW9mIHRoaXNDb25maWcuU0VMRUNUT1IgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBpZiAoJGVsLmlzKHRoaXNDb25maWcuU0VMRUNUT1IpKSB7XG4gICAgICAgICAgICAgIHJldHVybiBfdmFsaWRhdGVGaWVsZHNldCgkZWwsIHRoaXNDb25maWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHZhbGlkO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9vbkNsaWNrKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHZhciAkZSA9ICQoZS50YXJnZXQpO1xuICAgICAgdmFyIGZpZWxkc2V0RWxlbSA9ICRlLmNsb3Nlc3QoJ2ZpZWxkc2V0Jyk7XG5cbiAgICAgIGlmIChfdmFsaWRhdGUoZmllbGRzZXRFbGVtKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgLy9DQUxMIEFQSVxuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIF92YWxpZGF0ZUFsbCgpIHtcbiAgICAgIHZhciAkZmllbGRzZXRzID0gJCgnZmllbGRzZXQnKTtcbiAgICAgIHZhciB2YWxpZCA9IHRydWU7XG5cbiAgICAgICRmaWVsZHNldHMuZWFjaChmdW5jdGlvbihpLCBmaWVsZHNldCkge1xuICAgICAgICB2YXIgJGYgPSAkKGZpZWxkc2V0KTtcbiAgICAgICAgaWYgKCRmLmhhc0NsYXNzKCd1c2VyLWlzLWVkaXRpbmcnKSkge1xuICAgICAgICAgIHZhciB0aGlzVmFsaWQgPSBfdmFsaWRhdGUoZmllbGRzZXQpO1xuICAgICAgICAgIGlmICghdGhpc1ZhbGlkKSB7XG4gICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmICghX3ZhbGlkYXRlKCQoY29uZmlncy5jb250YWN0Q29uZmlnLlNFTEVDVE9SKSkpIHtcbiAgICAgICAgdmFsaWQgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHZhbGlkO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9mb2N1c0VsZW0oJGVsKSB7XG4gICAgICB2YXIgJGVsVG9Gb2N1cyA9ICQoJGVsKTtcblxuICAgICAgaWYgKHR5cGVvZiAkZWwgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiAkZWxUb0ZvY3VzWzBdID09PSAndW5kZWZpbmVkJykgeyByZXR1cm47IH1cblxuXG4gICAgICBpZiAoJGVsVG9Gb2N1c1swXS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdzZWxlY3QnKSB7XG4gICAgICAgIHZhciBlbE5leHQgPSAkZWwubmV4dCgnLnVpLXNlbGVjdG1lbnUtYnV0dG9uJyk7XG4gICAgICAgIGlmIChlbE5leHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICRlbFRvRm9jdXMgPSBlbE5leHQ7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgJGVsVG9Gb2N1cy5mb2N1cygpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9vbkNvbnRpbnVlQ2xpY2soZSkge1xuICAgICAgaWYgKCFfdmFsaWRhdGVBbGwoKSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICQoJy5jYXJ0LXN1bW1hcnkgLmVycm9yLW1lc3NhZ2UnKS5hZGRDbGFzcygnaXMtaW52YWxpZCcpO1xuICAgICAgICBfZm9jdXNFbGVtKCQoJ2lucHV0LmVycm9yJykuZmlyc3QoKSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgICQoJy5jYXJ0LXN1bW1hcnkgLmVycm9yLW1lc3NhZ2UnKS5yZW1vdmVDbGFzcygnaXMtaW52YWxpZCcpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX29uU3VibWl0KGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfb25DaGFuZ2UoZSkge1xuICAgICAgJChlLnRhcmdldCkuY2xvc2VzdCgnW2RhdGEtY2xpZW50LXZhbGlkYXRpb24tZmllbGRzZXRdJykuYWRkQ2xhc3MoJ3VzZXItaXMtZWRpdGluZycpO1xuICAgICAgX29uQmx1cihlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfb25CbHVyKGUpIHtcbiAgICAgIHZhciAkZmllbGQgPSAkKGUudGFyZ2V0KTtcbiAgICAgIGlmICgkZmllbGQuYXR0cignZGF0YS1jbGllbnQtdmFsaWRhdGlvbicpLm1hdGNoKCdzcGxpdC1waG9uZS1ncm91cCcpKSB7XG4gICAgICAgIF92YWxpZGF0ZVBob25lR3JvdXAoJGZpZWxkLmNsb3Nlc3QoJy5zcGxpdC1waG9uZS1ncm91cCcpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF92YWxpZGF0ZUZpZWxkKCRmaWVsZCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX29uUXR5Q2hhbmdlKGUpIHtcbiAgICAgIHZhciAkZWwgPSAkKGUudGFyZ2V0KSxcbiAgICAgICAgICBtYXggPSAkZWwuYXR0cignZGF0YS1tYXgnKSxcbiAgICAgICAgICB2YWwgPSAkZWwudmFsKCk7XG5cbiAgICAgIGlmICh2YWwgPT09ICcnIHx8IHBhcnNlSW50KHZhbCwgMTApID09PSAwKSB7XG4gICAgICAgICRlbC52YWwoJGVsLmF0dHIoJ3ZhbHVlJykpO1xuICAgICAgfSBlbHNlIGlmIChtYXggJiYgcGFyc2VJbnQobWF4LCAxMCkgPCBwYXJzZUludCh2YWwsIDEwKSkge1xuICAgICAgICAkZWwudmFsKG1heCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2JpbmQoKSB7XG4gICAgICAkKCdmb3JtJykuc3VibWl0KF9vblN1Ym1pdCk7XG4gICAgICAkKCdib2R5Jykub24oJ2NoYW5nZScsICdbZGF0YS1jbGllbnQtdmFsaWRhdGlvbl0nLCBfb25DaGFuZ2UpO1xuICAgICAgJCgnYm9keScpLm9uKCdibHVyJywgJ1tkYXRhLWNsaWVudC12YWxpZGF0aW9uXScsIF9vbkJsdXIpO1xuICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsICdmb3JtIGJ1dHRvblt0eXBlPVwic3VibWl0XCJdJywgX29uQ2xpY2spO1xuICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsICcuY2FydC1idXR0b25zLWNvbnRpbnVlJywgX29uQ29udGludWVDbGljayk7XG4gICAgICAkKCdib2R5Jykub24oJ2NoYW5nZSBibHVyJywgJ2lucHV0W25hbWU9XCJjYXJ0LWNoZWNrb3V0LWl0ZW0tcXR5XCJdJywgX29uUXR5Q2hhbmdlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfaW5pdFZhbGlkYXRpb24oKSB7XG5cbiAgICAgIHZhciAkZm9ybXMgPSAkKCdmb3JtJyk7XG4gICAgICAkZm9ybXMuYXR0cignbm92YWxpZGF0ZScsICcnKTtcbiAgICBcbiAgICAgIGZvciAodmFyIGNvbmZpZyBpbiBjb25maWdzKSB7XG4gICAgICAgIGlmIChjb25maWdzLmhhc093blByb3BlcnR5KGNvbmZpZykpIHtcbiAgICAgICAgICB2YXIgdGhpc0NvbmZpZyA9IGNvbmZpZ3NbY29uZmlnXTtcbiAgICAgICAgICB2YXIgJHRoaXNGaWVsZHNldCA9ICQodGhpc0NvbmZpZy5TRUxFQ1RPUik7XG4gICAgICAgICAgJHRoaXNGaWVsZHNldC5hdHRyKCdkYXRhLWNsaWVudC12YWxpZGF0aW9uLWZpZWxkc2V0JywgJ3RydWUnKTtcblxuICAgICAgICAgIGZvciAodmFyIGMgaW4gdGhpc0NvbmZpZykge1xuICAgICAgICAgICAgaWYgKHRoaXNDb25maWcuaGFzT3duUHJvcGVydHkoYykgJiYgYyAhPT0gJ1NFTEVDVE9SJykge1xuICAgICAgICAgICAgICB2YXIgdHlwZXMgPSAndHJ1ZSc7XG4gICAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpc0NvbmZpZ1tjXS52YWxpZGF0ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICB0eXBlcyA9IHRoaXNDb25maWdbY10udmFsaWRhdGUuam9pbignLCcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHZhciAkZmllbGRzID0gJHRoaXNGaWVsZHNldC5maW5kKHRoaXNDb25maWdbY10uc2VsZWN0b3IpO1xuXG4gICAgICAgICAgICAgIGlmICgkZmllbGRzLmhhc0NsYXNzKCdzcGxpdC1waG9uZS1ncm91cCcpKSB7XG4gICAgICAgICAgICAgICAgJGZpZWxkcyA9ICRmaWVsZHMuZmluZCgnaW5wdXQnKTtcbiAgICAgICAgICAgICAgfSBcbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzQ29uZmlnW2NdLm1hbnVhbCA9PT0gJ3VuZGVmaW5lZCcgfHwgIXRoaXNDb25maWdbY10ubWFudWFsKSB7XG4gICAgICAgICAgICAgICAgJGZpZWxkcy5hdHRyKCdkYXRhLWNsaWVudC12YWxpZGF0aW9uJywgdHlwZXMpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzQ29uZmlnW2NdLmVycm9ycyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBlIGluIHRoaXNDb25maWdbY10uZXJyb3JzKSB7XG4gICAgICAgICAgICAgICAgICBpZiAodGhpc0NvbmZpZ1tjXS5lcnJvcnMuaGFzT3duUHJvcGVydHkoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdGhpc0NvbmZpZ1tjXS5lcnJvcnNbZV07XG4gICAgICAgICAgICAgICAgICAgICRmaWVsZHMuYXR0cignZGF0YS1jbGllbnQtdmFsaWRhdGlvbi1lcnJvci0nK2UsIGVycm9yKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgX2JpbmQoKTtcbiAgICB9XG5cbiAgICBfc3RhbmRhcmRpemVJbnB1dHMoKTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGluaXRWYWxpZGF0aW9uOiBfaW5pdFZhbGlkYXRpb24sXG4gICAgICAgIHZhbGlkYXRlWmlwQ29kZTogX3ZhbGlkYXRlWmlwQ29kZVxuICAgIH07XG5cbn0pKCk7XG4iLCJjaXRpU2hhcmUuY2FydCA9IChmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgY2FydENvbmZpZyA9IHtcbiAgICAgICAgZXhwaXJhdGlvbiA6ICQoJyNjYy1leHBpcmF0aW9uLWRhdGUtbW0nKSxcbiAgICAgICAgY3Z2IDogJCgnLmNhcnQtaW5wdXRbbmFtZT1cImNhcnQtY3Z2XCJdJyksXG4gICAgICAgIHllYXIgOiAkKCcjY2MtZXhwaXJhdGlvbi1kYXRlLXl5JyksXG4gICAgICAgIHBob25lR3JvdXA6ICQoJy5zcGxpdC1waG9uZS1ncm91cCcpXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIF9lbmFibGVUYWJiYmluZygpIHtcbiAgICAgICAgLy8gRW5hYmxlIHRhYmJpbmcgYW5kIGxpbWl0IHRvIG51bWJlcnMgcGhvbmUgZmllbGRzXG4gICAgICAgIHZhciAkcGhvbmVTcGxpdEdyb3VwID0gJCgnLnNwbGl0LXBob25lLWdyb3VwJykuZmluZCgnW2RhdGEtdmFsaWRhdGUtdHlwZT1cInNwbGl0LXBob25lXCJdJyk7XG4gICAgICAgIGlmKHR5cGVvZiAkcGhvbmVTcGxpdEdyb3VwLmF1dG90YWIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAkcGhvbmVTcGxpdEdyb3VwLmF1dG90YWIoJ251bWJlcicpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX29wZW5BY3RpdmVGb3JtUGFuZWwoJHRhcmdldENvbnRhaW5lcikge1xuICAgICAgICAkdGFyZ2V0Q29udGFpbmVyLmZpbmQoJy5qcy1jYXJ0LWVkaXQnKS5hZGRDbGFzcygnY2FydC1lZGl0LWFjdGl2ZScpO1xuICAgICAgICBcbiAgICAgICAgaWYoJHRhcmdldENvbnRhaW5lci5maW5kKCdbbmFtZT1cImNhcnQtaXRlbXMtcmVjaXBpZW50XCJdJykuaGFzQ2xhc3MoJ2NhcnQtZWRpdC1hY3RpdmUnKSl7XG4gICAgICAgICAgICBpZigkdGFyZ2V0Q29udGFpbmVyLmZpbmQoJy5qcy1jYXJ0LWVkaXQnKS5maW5kKCdwJykuZmlyc3QoKS5oYXNDbGFzcygnZXJyb3ItbWVzc2FnZScpKXtcbiAgICAgICAgICAgICAgICAkdGFyZ2V0Q29udGFpbmVyLmZpbmQoJy5qcy1jYXJ0LWVkaXQnKS5maW5kKCdpbnB1dCcpLmZpcnN0KCkuZm9jdXMoKTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICR0YXJnZXRDb250YWluZXIuZmluZCgnLmpzLWNhcnQtZWRpdCcpLmZpbmQoJ3AnKS5maXJzdCgpLmF0dHIoJ3RhYmluZGV4JywnMCcpLmZvY3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgJHRhcmdldENvbnRhaW5lci5maW5kKCcuanMtY2FydC1lZGl0JykuZmluZCgnaW5wdXQnKS5maXJzdCgpLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgICAgJHRhcmdldENvbnRhaW5lci5maW5kKCcuanMtY2FydC1lZGl0LXRvZ2dsZS1pdGVtJykuYWRkQ2xhc3MoJ2NhcnQtaGlkZGVuJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2Nsb3NlQWN0aXZlRm9ybVBhbmVscygkZm9ybUVsZW1lbnRzKSB7XG4gICAgICAgIHZhciAkYWN0aXZlRWwgPSAkZm9ybUVsZW1lbnRzLmZpbmQoJy5jYXJ0LWVkaXQtYWN0aXZlJyk7XG4gICAgICAgICRhY3RpdmVFbC5yZW1vdmVDbGFzcygnY2FydC1lZGl0LWFjdGl2ZScpLnJlbW92ZUNsYXNzKCd1c2VyLWlzLWVkaXRpbmcnKS5maW5kKCdpbnB1dCcpLnZhbCgnJyk7XG4gICAgICAgICRhY3RpdmVFbC5maW5kKCcuZXJyb3InKS5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAgICAgJGFjdGl2ZUVsLmZpbmQoJy5pcy1pbnZhbGlkJykucmVtb3ZlQ2xhc3MoJ2lzLWludmFsaWQnKTtcbiAgICAgICAgJGZvcm1FbGVtZW50cy5maW5kKCcuanMtY2FydC1lZGl0LXRvZ2dsZS1pdGVtJykucmVtb3ZlQ2xhc3MoJ2NhcnQtaGlkZGVuJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2V4cGlyYXRpb25PbkNoYW5nZSgpe1xuICAgICAgICBjYXJ0Q29uZmlnLmV4cGlyYXRpb24ub24oJ3NlbGVjdG1lbnVjaGFuZ2UnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgX2NhbGN1bGF0ZUVuYWJsZVN1Ym1pdChjYXJ0Q29uZmlnLmN2di52YWwoKSwgY2FydENvbmZpZy5leHBpcmF0aW9uLnZhbCgpLCBjYXJ0Q29uZmlnLnllYXIudmFsKCkpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfY2FydEFjY2Vzc2liaWxpdHkoKXtcbiAgICAgICAgJCh3aW5kb3cpLmJpbmQoJ3Jlc2l6ZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHBhZ2VXaWR0aCA9ICB3aW5kb3cuaW5uZXJXaWR0aCB8fCAkKHdpbmRvdykud2lkdGgoKTtcbiAgICAgICAgICAgIGlmKHBhZ2VXaWR0aCA+IHdpbmRvdy5jaXRpQ29uZmlnLnRhYmxldEJyZWFrcG9pbnQpe1xuICAgICAgICAgICAgICAgICQoJy5jYXJ0LWltYWdlLWNvbnRhaW5lciA+IGltZycpLmF0dHIoJ3JvbGUnLCdwcmVzZW50YXRpb24nKTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICQoJy5jYXJ0LWltYWdlLWNvbnRhaW5lciA+IGltZycpLnJlbW92ZUF0dHIoJ3JvbGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkudHJpZ2dlcigncmVzaXplJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX3llYXJPbkNoYW5nZSgpe1xuICAgICAgICBjYXJ0Q29uZmlnLnllYXIub24oJ3NlbGVjdG1lbnVjaGFuZ2UnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgX2NhbGN1bGF0ZUVuYWJsZVN1Ym1pdChjYXJ0Q29uZmlnLmN2di52YWwoKSwgY2FydENvbmZpZy5leHBpcmF0aW9uLnZhbCgpLCBjYXJ0Q29uZmlnLnllYXIudmFsKCkpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfY3Z2T25DaGFuZ2UoKXtcbiAgICAgICAgY2FydENvbmZpZy5jdnYub24oJ2JsdXInLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgX2NhbGN1bGF0ZUVuYWJsZVN1Ym1pdChjYXJ0Q29uZmlnLmN2di52YWwoKSwgY2FydENvbmZpZy5leHBpcmF0aW9uLnZhbCgpLCBjYXJ0Q29uZmlnLnllYXIudmFsKCkpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfc2hvd1VwZGF0ZUxpbmsoKSB7XG4gICAgICAgICQoJy5jYXJ0LWlucHV0LXF0eScpLm9uKCdpbnB1dCBjaGFuZ2UnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciAkZWwgPSAkKHRoaXMpO1xuICAgICAgICAgICAgdmFyICRlZGl0QnV0dG9uID0gJGVsLm5leHQoJ3AuY2FydC1pdGVtcy1lZGl0Jyk7XG5cbiAgICAgICAgICAgICRlZGl0QnV0dG9uLnJlbW92ZUNsYXNzKCdjYXJ0LWhpZGRlbicpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfY2FsY3VsYXRlRW5hYmxlU3VibWl0KGN2dixleHBpcmF0aW9uLHllYXIpe1xuICAgICAgICBpZigoY3Z2ICE9PSB1bmRlZmluZWQgJiYgY3Z2Lmxlbmd0aCA+IDApICYmIGV4cGlyYXRpb24gIT09IFwiMTAwMFwiICYmIHllYXIgIT09IFwiMTAwMFwiKXtcbiAgICAgICAgICAgICQoJ2J1dHRvbi5jYXJ0LWJ1dHRvbnMtY29udGludWUnKS5yZW1vdmVDbGFzcygnaW5hY3RpdmUnKTtcbiAgICAgICAgICAgICQoJ2J1dHRvbi5jYXJ0LWJ1dHRvbnMtY29udGludWUnKS5yZW1vdmVBdHRyKCdhcmlhLWRpc2FibGVkJyk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgJCgnYnV0dG9uLmNhcnQtYnV0dG9ucy1jb250aW51ZScpLmFkZENsYXNzKCdpbmFjdGl2ZScpO1xuICAgICAgICAgICAgJCgnYnV0dG9uLmNhcnQtYnV0dG9ucy1jb250aW51ZScpLmF0dHIoJ2FyaWEtZGlzYWJsZWQnLCd0cnVlJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfbGFiZWxSZXNwb25zaXZlVGFibGVzKHRhYmxlU2VsZWN0b3IpIHtcbiAgICAgICAgdmFyICR0YWJsZUNvbGxlY3Rpb24gPSAkKHRhYmxlU2VsZWN0b3IpO1xuXG4gICAgICAgICR0YWJsZUNvbGxlY3Rpb24uZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciAkdGFibGVFbCA9ICQodGhpcyk7XG4gICAgICAgICAgICB2YXIgJHRhYmxlSGVhZGluZ3MgPSAkdGFibGVFbC5maW5kKCd0aCcpO1xuICAgICAgICAgICAgdmFyICR0YWJsZVJvd3MgPSAgJHRhYmxlRWwuZmluZCgndHInKTtcblxuICAgICAgICAgICAgJHRhYmxlUm93cy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciAkdGFibGVDZWxscyA9ICQodGhpcykuZmluZCgndGQnKTtcblxuICAgICAgICAgICAgICAgICR0YWJsZUhlYWRpbmdzLmVhY2goZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gJCh0aGlzKS5odG1sKCk7XG4gICAgICAgICAgICAgICAgICAgICR0YWJsZUNlbGxzLmVxKGluZGV4KS5wcmVwZW5kKCc8ZGl2IGNsYXNzPVwiY2FydC1oZWFkZXJzLWl0ZW0gc2hvdy1vbi10YWJsZXQtZG93biBcIj4nKyBsYWJlbCArJzwvZGl2PicpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBmdW5jdGlvbiBfc2hvd0xvY2FsUGlja3VwKCkge1xuICAgICAgJCgnLmNhcnQtc2VsZWN0LWRlbGl2ZXJ5LW9wdGlvbicpLm9uKCdzZWxlY3RtZW51Y2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmKCQoJ29wdGlvbjpzZWxlY3RlZCcsIHRoaXMpLmRhdGEoXCJsb2NhbFwiKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICQodGhpcykucGFyZW50cygpLmZpbmQoJy5jYXJ0LWZvcm0tc2VhcmNoLXdyYXBwZXInKS5zaG93KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJCh0aGlzKS5wYXJlbnRzKCkuZmluZCgnLmNhcnQtZm9ybS1zZWFyY2gtd3JhcHBlcicpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgJCgnLmpzLWNhcnQtZm9ybS1oYW5kbGVyJykub24oJ2NsaWNrJywgJ2EuanMtY2FydC1lZGl0LW9wZW4nLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB2YXIgZXJyb3IgPSBmYWxzZTtcbiAgICAgICAgdmFyICR0YXJnZXQgPSAkKHRoaXMpO1xuICAgICAgICB2YXIgJGZvcm1FbGVtZW50cyA9ICQoJy5qcy1jYXJ0LWZvcm0taGFuZGxlcicpO1xuICAgICAgICBcbiAgICAgICAgaWYoJHRhcmdldC5oYXNDbGFzcygnc3VibWl0LWZpbmQnKSl7XG4gICAgICAgICAgICBlcnJvciA9IGNpdGlTaGFyZS5lcnJvci52YWxpZGF0ZVppcENvZGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgkdGFyZ2V0Lmhhc0NsYXNzKCdqcy1jYXJ0LWVkaXQtb3BlbicpICYmICFlcnJvcikge1xuICAgICAgICAgICAgaWYoJHRhcmdldC5hdHRyKCdhcmlhLWV4cGFuZGVkJykubGVuZ3RoID4gMCl7XG4gICAgICAgICAgICAgICAgJHRhcmdldC5hdHRyKCdhcmlhLWV4cGFuZGVkJywndHJ1ZScpLmFkZENsYXNzKCdpc09wZW4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciAkdGFyZ2V0Q29udGFpbmVyID0gJHRhcmdldC5wYXJlbnRzKCcuanMtY2FydC1lZGl0LWNvbnRhaW5lcicpO1xuXG4gICAgICAgICAgICBfY2xvc2VBY3RpdmVGb3JtUGFuZWxzKCRmb3JtRWxlbWVudHMpO1xuICAgICAgICAgICAgX29wZW5BY3RpdmVGb3JtUGFuZWwoJHRhcmdldENvbnRhaW5lcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBfY2xvc2VBY3RpdmVGb3JtUGFuZWxzKCRmb3JtRWxlbWVudHMpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAkKFwiaW5wdXRbbmFtZT1jYXJ0LXJlc3VsdC1vcHRpb25dXCIpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpe1xuICAgICAgICAkKCcuY2FydC1pdGVtcy12YWx1ZS10YXgnKS5zaG93KCk7XG4gICAgICAgICQoJy5jYXJ0LWl0ZW1zLXBvaW50cy12YWx1ZS10YXgnKS5jc3MoJ2Rpc3BsYXknLCdibG9jaycpO1xuICAgIH0pO1xuXG4gICAgJCgnLmpzLWNhcnQtZm9ybS1oYW5kbGVyJykub24oJ2NsaWNrJywgJ2EuanMtY2FydC1lZGl0LWNsb3NlJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyICRmb3JtRWxlbWVudHMgPSAkKCcuanMtY2FydC1mb3JtLWhhbmRsZXInKTtcblxuICAgICAgICBfY2xvc2VBY3RpdmVGb3JtUGFuZWxzKCRmb3JtRWxlbWVudHMpO1xuICAgICAgICAkZm9ybUVsZW1lbnRzLmZpbmQoJ2EuanMtY2FydC1lZGl0LW9wZW4nKS5hdHRyKCdhcmlhLWV4cGFuZGVkJywnZmFsc2UnKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRmb3JtRWxlbWVudHMuZmluZCgnYS5qcy1jYXJ0LWVkaXQtb3Blbi5pc09wZW4nKS5mb2N1cygpO1xuICAgICAgICAgICAgJGZvcm1FbGVtZW50cy5maW5kKCdhLmpzLWNhcnQtZWRpdC1vcGVuLmlzT3BlbicpLnJlbW92ZUNsYXNzKCdpc09wZW4nKTtcbiAgICAgICAgfSwgMTAwMCk7XG4gICAgfSk7XG5cbiAgICAkKCd0ZXh0YXJlYVtuYW1lPVwiY2FydC1ub3RlXCJdJykub24oJ2tleXVwJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgIC8vIHRvZG86IG1heWJlIHJlZmFjdG9yIHRoaXMgc28gdGhhdCB3ZSdyZSBub3Qgc28gZGVwZW5kZW50XG4gICAgICAgIC8vIG9uIGh0bWwgc3RydWN0dXJlIGZvciB0aGUgZXJyb3IgZmllbGRcbiAgICAgICAgY2l0aVNoYXJlLmZvcm1WYWxpZGF0aW9uLmxpbWl0SW5wdXRieUNoYXJhY3RlckNvdW50KCR0aGlzLCAkdGhpcy5uZXh0KCcuanMtY2FydC1ub3RlLXdhcm5pbmcnKSk7XG4gICAgfSk7XG5cbiAgICAkKCdpbnB1dFt0eXBlPVwicmFkaW9cIl1bbmFtZT1cImNhcnQtdHlwZW9mYWRkcmVzc1wiXScpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgdmFyIHR5cGUgPSAkdGhpcy52YWwoKTtcbiAgICAgICAgdmFyICRidXNpbmVzc1JhZGlvID0gJHRoaXMuY2xvc2VzdCgnZmllbGRzZXQnKS5maW5kKCdpbnB1dFt2YWx1ZT1cImJ1c2luZXNzXCJdJyk7XG4gICAgICAgIHZhciAkYnVzaW5lc3NXcmFwcGVyID0gJHRoaXMuY2xvc2VzdCgnZm9ybScpLmZpbmQoJy5pbnB1dC1jYXJ0LWRlbGl2ZXJ5LWJ1c2luZXNzLXdyYXBwZXInKTtcblxuICAgICAgICBpZiAodHlwZSA9PT0gJ2J1c2luZXNzJykge1xuICAgICAgICAgICAgJGJ1c2luZXNzV3JhcHBlci5yZW1vdmVDbGFzcygnaXMtaGlkZGVuJyk7XG4gICAgICAgICAgICAkYnVzaW5lc3NSYWRpby5hdHRyKCdhcmlhLWV4cGFuZGVkJywndHJ1ZScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJGJ1c2luZXNzV3JhcHBlci5hZGRDbGFzcygnaXMtaGlkZGVuJyk7XG4gICAgICAgICAgICAkYnVzaW5lc3NSYWRpby5hdHRyKCdhcmlhLWV4cGFuZGVkJywnZmFsc2UnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgJCgnaW5wdXRbdHlwZT1cInJhZGlvXCJdW25hbWU9XCJjYXJ0LXR5cGVvZmJ1aWxkaW5nXCJdJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICB2YXIgdHlwZSA9ICR0aGlzLnZhbCgpO1xuICAgICAgICB2YXIgJGFkZHJlc3MyRXJyb3IgPSAkdGhpcy5jbG9zZXN0KCdmb3JtJykuZmluZCgnI2ludmFsaWQtZGVsaXZlcnktYWRkcmVzcy0yIC5lcnJvci1tZXNzYWdlJyk7XG4gICAgICAgIHZhciAkYWRkcmVzczJJbnB1dCA9ICR0aGlzLmNsb3Nlc3QoJ2Zvcm0nKS5maW5kKCcjaW5wdXQtY2FydC1kZWxpdmVyeS1hZGRyZXNzMicpO1xuXG4gICAgICAgIGlmICh0eXBlID09PSAneWVzJykge1xuICAgICAgICAgICAgJGFkZHJlc3MySW5wdXQuYXR0cignYXJpYS1yZXF1aXJlZCcsICd0cnVlJyk7XG4gICAgICAgICAgICAkYWRkcmVzczJJbnB1dC5hdHRyKCdyZXF1aXJlZCcsICd0cnVlJyk7XG4gICAgICAgICAgICAkYWRkcmVzczJJbnB1dC5hdHRyKCdkYXRhLWNsaWVudC12YWxpZGF0aW9uJywgJ3RydWUnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRhZGRyZXNzMkVycm9yLnJlbW92ZUNsYXNzKCdpcy1pbnZhbGlkJyk7XG4gICAgICAgICAgICAkYWRkcmVzczJJbnB1dC5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAgICAgICAgICRhZGRyZXNzMklucHV0LmF0dHIoJ2FyaWEtcmVxdWlyZWQnLCAnZmFsc2UnKTtcbiAgICAgICAgICAgICRhZGRyZXNzMklucHV0LmF0dHIoJ3JlcXVpcmVkJywgJ2ZhbHNlJyk7XG4gICAgICAgICAgICAkYWRkcmVzczJJbnB1dC5hdHRyKCdkYXRhLWNsaWVudC12YWxpZGF0aW9uJywgbnVsbCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgICQoJy5jYXJ0LXN1bW1hcnktdG90YWxzIGxhYmVsW2Zvcj1cInRvY1wiXScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoJChcIi5jYXJ0LXN1bW1hcnktdG90YWxzIGlucHV0XCIpLnByb3AoJ2NoZWNrZWQnKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgJCgnLmNhcnQtc3VtbWFyeSAuY2FydC1idXR0b25zLXN1Ym1pdCcpLmFkZENsYXNzKCdpbmFjdGl2ZScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJCgnLmNhcnQtc3VtbWFyeSAuY2FydC1idXR0b25zLXN1Ym1pdCcpLnJlbW92ZUNsYXNzKCdpbmFjdGl2ZScpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBcIkNoYW5nZSBlbWFpbCByZWNpcGllbnRcIiBiZWhhdmlvclxuICAgICAqIFRvdWdoIGJlY2F1c2UgeW91J3JlIGhpdHRpbmcgXCJTdWJtaXRcIiBvbiBhIGZvcm0gaW5wdXRcbiAgICAgKiB0aGF0IGlzbid0IGFjdHVhbGx5IHN1cHBvc2VkIHRvIHN1aWJtaXQgdGhlIGZvcm1cbiAgICAgKi9cbiAgICB2YXIgJGl0ZW1Gb3JtcyA9ICQoJ2Zvcm1bbmFtZT1cImNhcnQtY2hlY2tvdXQtY2FzaC1jaGFyaXR5XCJdJyk7XG4gICAgJGl0ZW1Gb3Jtcy5vbignY2xpY2snLCAnW25hbWU9XCJjYXJ0LWl0ZW1zLXJlY2lwaWVudFwiXSA6c3VibWl0JywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICB2YXIgJGVsID0gJCh0aGlzKTtcbiAgICAgICAgdmFyICRmaWVsZHNldCA9ICRlbC5wYXJlbnRzKCdmaWVsZHNldFtuYW1lPVwiY2FydC1pdGVtcy1yZWNpcGllbnRcIl0nKTtcbiAgICAgICAgdmFyICRmb3JtID0gJGVsLnBhcmVudHMoJ2Zvcm0nKTtcbiAgICAgICAgdmFyICRmb3JtRE9NRWwgPSAkZm9ybS5nZXQoMCk7XG4gICAgICAgIHZhciBlbWFpbCwgbmFtZSwgbm90ZTtcbiAgICAgICAgdmFyICR0ZDtcbiAgICAgICAgdmFyIGNhcnRIaWRkZW4gPSAnY2FydC1oaWRkZW4nO1xuXG4gICAgICAgIGlmICh0eXBlb2YgJGZvcm1ET01FbC5jaGVja1ZhbGlkaXR5ID09PSAnZnVuY3Rpb24nKSB7XG5cbiAgICAgICAgICAgIGlmICgkZm9ybURPTUVsLmNoZWNrVmFsaWRpdHkoKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICR0ZCA9ICRmaWVsZHNldC5wYXJlbnRzKCd0ZCcpO1xuICAgICAgICAgICAgICAgIGVtYWlsID0gJGZpZWxkc2V0LmZpbmQoJ1tuYW1lPVwiY2FydC1lbWFpbFwiXScpLnZhbCgpO1xuICAgICAgICAgICAgICAgIG5hbWUgPSAkZmllbGRzZXQuZmluZCgnW25hbWU9XCJjYXJ0LWZ1bGwtbmFtZVwiXScpLnZhbCgpO1xuICAgICAgICAgICAgICAgIG5vdGUgPSAkZmllbGRzZXQuZmluZCgnW25hbWU9XCJjYXJ0LW5vdGVcIl0nKS52YWwoKTtcblxuICAgICAgICAgICAgICAgICRmaWVsZHNldC5hZGRDbGFzcyhjYXJ0SGlkZGVuKS5yZW1vdmVDbGFzcygnY2FydC1lZGl0LWFjdGl2ZScpO1xuXG4gICAgICAgICAgICAgICAgJHRkLmZpbmQoJy5jYXJ0LWl0ZW1zLXJlY2lwaWVudC1oZWFkZXInKS50ZXh0KCdTZW5kaW5nIHRvOicpO1xuICAgICAgICAgICAgICAgICR0ZC5maW5kKCcuY2FydC1pdGVtcy1yZWNpcGllbnQtZW1haWwnKS50ZXh0KGVtYWlsKTtcbiAgICAgICAgICAgICAgICAkdGQuZmluZCgnLmNhcnQtaXRlbXMtcmVjaXBpZW50LW5hbWUnKS50ZXh0KG5hbWUpLnJlbW92ZUNsYXNzKGNhcnRIaWRkZW4pO1xuICAgICAgICAgICAgICAgIGlmIChub3RlKSB7XG4gICAgICAgICAgICAgICAgICAgICR0ZC5maW5kKCcuY2FydC1pdGVtcy1yZWNpcGllbnQtbm90ZScpLnRleHQobm90ZSkucmVtb3ZlQ2xhc3MoY2FydEhpZGRlbik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJHRkLmZpbmQoJy5qcy1jYXJ0LWVkaXQtdG9nZ2xlLWl0ZW0nKS5yZW1vdmVDbGFzcyhjYXJ0SGlkZGVuKTtcbiAgICAgICAgICAgICAgICAkdGQuZmluZCgnLmNhcnQtaXRlbXMtZWRpdCcpLmFkZENsYXNzKGNhcnRIaWRkZW4pO1xuICAgICAgICAgICAgICAgICR0ZC5maW5kKCcuY2FydC1pdGVtcy11cGRhdGUnKS5yZW1vdmVDbGFzcyhjYXJ0SGlkZGVuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGVsc2Uge1xuICAgICAgICAgICAgLy8gICAgIC8vIEhhbmRsZSBpbnZhbGlkIGZvcm0gaW5wdXRcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBlbHNlIHtcbiAgICAgICAgLy8gICAgIC8vIEhvdyBhcmUgd2UgdmFsaWRhdGluZz9cbiAgICAgICAgLy8gfVxuXG4gICAgfSk7XG5cbiAgICAkaXRlbUZvcm1zLm9uKCdjbGljaycsICcuanMtY2FydC1lZGl0LXJlbW92ZScsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgdmFyICRlbCA9ICQodGhpcyk7XG4gICAgICAgIHZhciAkdGQgPSAkZWwucGFyZW50cygndGQnKTtcbiAgICAgICAgdmFyICRlbWFpbCA9ICR0ZC5maW5kKCcuY2FydC1pdGVtcy1yZWNpcGllbnQtZW1haWwnKTtcbiAgICAgICAgdmFyICRuYW1lID0gJHRkLmZpbmQoJy5jYXJ0LWl0ZW1zLXJlY2lwaWVudC1uYW1lJyk7XG4gICAgICAgIHZhciAkbm90ZSA9ICR0ZC5maW5kKCcuY2FydC1pdGVtcy1yZWNpcGllbnQtbm90ZScpO1xuICAgICAgICB2YXIgJGhlYWRlciA9ICR0ZC5maW5kKCcuY2FydC1pdGVtcy1yZWNpcGllbnQtaGVhZGVyJyk7XG5cbiAgICAgICAgJGhlYWRlci50ZXh0KCdTZW5kIHRvIGVtYWlsIG9uIGZpbGU6Jyk7XG4gICAgICAgICRlbWFpbC50ZXh0KCdyZWNpcGllbnRAZ21haWwuY29tJyk7XG4gICAgICAgICRuYW1lLnRleHQoJycpLmFkZENsYXNzKCdjYXJ0LWhpZGRlbicpO1xuICAgICAgICAkbm90ZS50ZXh0KCcnKS5hZGRDbGFzcygnY2FydC1oaWRkZW4nKTtcbiAgICAgICAgJHRkLmZpbmQoJy5jYXJ0LWl0ZW1zLWVkaXQnKS5yZW1vdmVDbGFzcygnY2FydC1oaWRkZW4nKTtcbiAgICAgICAgJHRkLmZpbmQoJy5jYXJ0LWl0ZW1zLXVwZGF0ZScpLmFkZENsYXNzKCdjYXJ0LWhpZGRlbicpO1xuICAgIH0pO1xuXG4gICAgLy8gVE9ETzo6IG9uIGZvcm0gc3VibWl0IHRyaWdnZXIgdmFsaWRhdGVDYXJ0Q2hlY2tvdXQoKTtcblxuICAgIF9lbmFibGVUYWJiYmluZygpO1xuICAgIC8vX3Bob25lTnVtYmVyT25DaGFuZ2UoKTtcbiAgICBfZXhwaXJhdGlvbk9uQ2hhbmdlKCk7XG4gICAgX3llYXJPbkNoYW5nZSgpO1xuICAgIF9jdnZPbkNoYW5nZSgpO1xuICAgIF9jYXJ0QWNjZXNzaWJpbGl0eSgpO1xuICAgIF9sYWJlbFJlc3BvbnNpdmVUYWJsZXMoJ3NlY3Rpb24uY2FydC1zZWN0aW9uOm5vdCguY2FydC1zdW1tYXJ5KSB0YWJsZScpO1xuICAgIF9zaG93VXBkYXRlTGluaygpO1xuICAgIGNpdGlTaGFyZS5lcnJvci5pbml0VmFsaWRhdGlvbigpO1xuICAgIF9zaG93TG9jYWxQaWNrdXAoKTtcblxufSkoKTtcbiIsIi8qanNoaW50IHNjcmlwdHVybDp0cnVlKi9cbi8vQmFzZWQgb24gdGhlIERlcXVlIFVuaXZlcnNpdHkgY29kZSwgc3VwcG9ydCBhZGRlZCBmb3IgbXVsdGlwbGUgZGF0ZXBpY2tlcnMgb24gdGhlIHNhbWUgcGFnZS5cbmNpdGlTaGFyZS5kYXRlUGlja2VyID0gKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGZ1bmN0aW9uIHNldHR1cEFjY2Vzc2libGVEYXRlaWNrZXIoKSB7XG4gICAgJCgnLmRhdGVwaWNrZXInKS5kYXRlcGlja2VyKHtcbiAgICAgIHNob3dPbjogJ2J1dHRvbicsXG4gICAgICBidXR0b25JbWFnZTogXCJcIiwgLy8gRmlsZSAoYW5kIGZpbGUgcGF0aCkgZm9yIHRoZSBjYWxlbmRhciBpbWFnZVxuICAgICAgYnV0dG9uSW1hZ2VPbmx5OiBmYWxzZSxcbiAgICAgIGJ1dHRvblRleHQ6ICdDYWxlbmRhciBWaWV3JyxcbiAgICAgIGRheU5hbWVzU2hvcnQ6IFsgXCJTdW5kYXlcIiwgXCJNb25kYXlcIiwgXCJUdWVzZGF5XCIsIFwiV2VkbmVzZGF5XCIsIFwiVGh1cnNkYXlcIiwgXCJGcmlkYXlcIiwgXCJTYXR1cmRheVwiIF0sXG4gICAgICBzaG93QnV0dG9uUGFuZWw6IHRydWUsXG4gICAgICBjbG9zZVRleHQ6ICdDbG9zZScsXG4gICAgICBvbkNsb3NlOiByZW1vdmVBcmlhXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgYXJpYS1kZXNjcmliZWRieSB0byB0aGUgYnV0dG9uIHJlZmVycmluZyB0byB0aGUgbGFiZWxcbiAgICAkKCcudWktZGF0ZXBpY2tlci10cmlnZ2VyJykuYXR0cignYXJpYS1kZXNjcmliZWRieScsICdkYXRlcGlja2VyTGFiZWwnKTtcblxuICAgIGRheVRyaXBwZXIoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRheVRyaXBwZXIoKSB7XG4gICAgJCgnLnVpLWRhdGVwaWNrZXItdHJpZ2dlcicpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICQodGhpcykucHJldigpLmFkZENsYXNzKFwiZGF0ZXBpY2tlck9wZW5lZFwiKTtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG9kYXkgPSAkKCcudWktZGF0ZXBpY2tlci10b2RheSBhJylbMF07XG4gICAgICAgIGlmICghdG9kYXkpIHtcbiAgICAgICAgICB0b2RheSA9ICQoJy51aS1zdGF0ZS1hY3RpdmUnKVswXSB8fFxuICAgICAgICAgICAgJCgnLnVpLXN0YXRlLWRlZmF1bHQnKVswXTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy8gSGlkZSB0aGUgZW50aXJlIHBhZ2UgKGV4Y2VwdCB0aGUgZGF0ZSBwaWNrZXIpXG4gICAgICAgIC8vIGZyb20gc2NyZWVuIHJlYWRlcnMgdG8gcHJldmVudCBkb2N1bWVudCBuYXZpZ2F0aW9uXG4gICAgICAgIC8vIChieSBoZWFkaW5ncywgZXRjLikgd2hpbGUgdGhlIHBvcHVwIGlzIG9wZW5cbiAgICAgICAgJChcIm1haW5cIikuYXR0cignaWQnLCAnZHAtY29udGFpbmVyJyk7XG4gICAgICAgICQoXCIjZHAtY29udGFpbmVyXCIpLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcbiAgICAgICAgJChcIiNza2lwbmF2XCIpLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcblxuICAgICAgICAvLyBIaWRlIHRoZSBcInRvZGF5XCIgYnV0dG9uIGJlY2F1c2UgaXQgZG9lc24ndCBkbyB3aGF0XG4gICAgICAgIC8vIHlvdSB0aGluayBpdCBzdXBwb3NlZCB0byBkb1xuICAgICAgICAkKFwiLnVpLWRhdGVwaWNrZXItY3VycmVudFwiKS5oaWRlKCk7XG5cbiAgICAgICAgdG9kYXkuZm9jdXMoKTtcbiAgICAgICAgZGF0ZVBpY2tIYW5kbGVyKCk7XG4gICAgICB9LCAwKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRhdGVQaWNrSGFuZGxlcigpIHtcbiAgICB2YXIgYWN0aXZlRGF0ZTtcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VpLWRhdGVwaWNrZXItZGl2Jyk7XG4gICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnZGF0ZXBpY2tlck9wZW5lZCcpO1xuXG4gICAgaWYgKCFjb250YWluZXIgfHwgIWlucHV0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgJChjb250YWluZXIpLmZpbmQoJ3RhYmxlJykuZmlyc3QoKS5hdHRyKCdyb2xlJywgJ2dyaWQnKTtcblxuICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYXBwbGljYXRpb24nKTtcbiAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ0NhbGVuZGFyIHZpZXcgZGF0ZS1waWNrZXInKTtcblxuICAgIC8vIHRoZSB0b3AgY29udHJvbHM6XG4gICAgdmFyIHByZXYgPSAkKCcudWktZGF0ZXBpY2tlci1wcmV2JywgY29udGFpbmVyKVswXSxcbiAgICAgIG5leHQgPSAkKCcudWktZGF0ZXBpY2tlci1uZXh0JywgY29udGFpbmVyKVswXTtcblxuXG4vLyBUaGlzIGlzIHRoZSBsaW5lIHRoYXQgbmVlZHMgdG8gYmUgZml4ZWQgZm9yIHVzZSBvbiBwYWdlcyB3aXRoIGJhc2UgVVJMIHNldCBpbiBoZWFkXG4gICAgbmV4dC5ocmVmID0gJ2phdmFzY3JpcHQ6dm9pZCgwKSc7XG4gICAgcHJldi5ocmVmID0gJ2phdmFzY3JpcHQ6dm9pZCgwKSc7XG5cbiAgICBuZXh0LnNldEF0dHJpYnV0ZSgncm9sZScsICdidXR0b24nKTtcbiAgICBuZXh0LnJlbW92ZUF0dHJpYnV0ZSgndGl0bGUnKTtcbiAgICBwcmV2LnNldEF0dHJpYnV0ZSgncm9sZScsICdidXR0b24nKTtcbiAgICBwcmV2LnJlbW92ZUF0dHJpYnV0ZSgndGl0bGUnKTtcblxuICAgIGFwcGVuZE9mZnNjcmVlbk1vbnRoVGV4dChuZXh0KTtcbiAgICBhcHBlbmRPZmZzY3JlZW5Nb250aFRleHQocHJldik7XG5cbiAgICAvLyBkZWxlZ2F0aW9uIHdvbid0IHdvcmsgaGVyZSBmb3Igd2hhdGV2ZXIgcmVhc29uLCBzbyB3ZSBhcmVcbiAgICAvLyBmb3JjZWQgdG8gYXR0YWNoIGluZGl2aWR1YWwgY2xpY2sgbGlzdGVuZXJzIHRvIHRoZSBwcmV2IC9cbiAgICAvLyBuZXh0IG1vbnRoIGJ1dHRvbnMgZWFjaCB0aW1lIHRoZXkgYXJlIGFkZGVkIHRvIHRoZSBET01cbiAgICAkKG5leHQpLm9uKCdjbGljaycsIGhhbmRsZU5leHRDbGlja3MpO1xuICAgICQocHJldikub24oJ2NsaWNrJywgaGFuZGxlUHJldkNsaWNrcyk7XG5cbiAgICBtb250aERheVllYXJUZXh0KCk7XG5cbiAgICAkKGNvbnRhaW5lcikub24oJ2tleWRvd24nLCBmdW5jdGlvbiBjYWxlbmRhcktleWJvYXJkTGlzdGVuZXIoa2V5VmVudCkge1xuICAgICAgdmFyIHdoaWNoID0ga2V5VmVudC53aGljaDtcbiAgICAgIHZhciB0YXJnZXQgPSBrZXlWZW50LnRhcmdldDtcbiAgICAgIHZhciBkYXRlQ3VycmVudCA9IGdldEN1cnJlbnREYXRlKGNvbnRhaW5lcik7XG5cbiAgICAgIGlmICghZGF0ZUN1cnJlbnQpIHtcbiAgICAgICAgZGF0ZUN1cnJlbnQgPSAkKCdhLnVpLXN0YXRlLWRlZmF1bHQnKVswXTtcbiAgICAgICAgc2V0SGlnaGxpZ2h0U3RhdGUoZGF0ZUN1cnJlbnQsIGNvbnRhaW5lcik7XG4gICAgICB9XG5cbiAgICAgIGlmICgyNyA9PT0gd2hpY2gpIHtcbiAgICAgICAga2V5VmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgcmV0dXJuIGNsb3NlQ2FsZW5kYXIoKTtcbiAgICAgIH0gZWxzZSBpZiAod2hpY2ggPT09IDkgJiYga2V5VmVudC5zaGlmdEtleSkgeyAvLyBTSElGVCArIFRBQlxuICAgICAgICBrZXlWZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmICgkKHRhcmdldCkuaGFzQ2xhc3MoJ3VpLWRhdGVwaWNrZXItY2xvc2UnKSkgeyAvLyBjbG9zZSBidXR0b25cbiAgICAgICAgICAkKCcudWktZGF0ZXBpY2tlci1wcmV2JylbMF0uZm9jdXMoKTtcbiAgICAgICAgfSBlbHNlIGlmICgkKHRhcmdldCkuaGFzQ2xhc3MoJ3VpLXN0YXRlLWRlZmF1bHQnKSkgeyAvLyBhIGRhdGUgbGlua1xuICAgICAgICAgICQoJy51aS1kYXRlcGlja2VyLWNsb3NlJylbMF0uZm9jdXMoKTtcbiAgICAgICAgfSBlbHNlIGlmICgkKHRhcmdldCkuaGFzQ2xhc3MoJ3VpLWRhdGVwaWNrZXItcHJldicpKSB7IC8vIHRoZSBwcmV2IGxpbmtcbiAgICAgICAgICAkKCcudWktZGF0ZXBpY2tlci1uZXh0JylbMF0uZm9jdXMoKTtcbiAgICAgICAgfSBlbHNlIGlmICgkKHRhcmdldCkuaGFzQ2xhc3MoJ3VpLWRhdGVwaWNrZXItbmV4dCcpKSB7IC8vIHRoZSBuZXh0IGxpbmtcbiAgICAgICAgICBhY3RpdmVEYXRlID0gJCgnLnVpLXN0YXRlLWhpZ2hsaWdodCcpIHx8XG4gICAgICAgICAgICAkKCcudWktc3RhdGUtYWN0aXZlJylbMF07XG4gICAgICAgICAgaWYgKGFjdGl2ZURhdGUpIHtcbiAgICAgICAgICAgIGFjdGl2ZURhdGUuZm9jdXMoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAod2hpY2ggPT09IDkpIHsgLy8gVEFCXG4gICAgICAgIGtleVZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKCQodGFyZ2V0KS5oYXNDbGFzcygndWktZGF0ZXBpY2tlci1jbG9zZScpKSB7IC8vIGNsb3NlIGJ1dHRvblxuICAgICAgICAgIGFjdGl2ZURhdGUgPSAkKCcudWktc3RhdGUtaGlnaGxpZ2h0JykgfHxcbiAgICAgICAgICAgICQoJy51aS1zdGF0ZS1hY3RpdmUnKVswXTtcbiAgICAgICAgICBpZiAoYWN0aXZlRGF0ZSkge1xuICAgICAgICAgICAgYWN0aXZlRGF0ZS5mb2N1cygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICgkKHRhcmdldCkuaGFzQ2xhc3MoJ3VpLXN0YXRlLWRlZmF1bHQnKSkge1xuICAgICAgICAgICQoJy51aS1kYXRlcGlja2VyLW5leHQnKVswXS5mb2N1cygpO1xuICAgICAgICB9IGVsc2UgaWYgKCQodGFyZ2V0KS5oYXNDbGFzcygndWktZGF0ZXBpY2tlci1uZXh0JykpIHtcbiAgICAgICAgICAkKCcudWktZGF0ZXBpY2tlci1wcmV2JylbMF0uZm9jdXMoKTtcbiAgICAgICAgfSBlbHNlIGlmICgkKHRhcmdldCkuaGFzQ2xhc3MoJ3VpLWRhdGVwaWNrZXItcHJldicpKSB7XG4gICAgICAgICAgJCgnLnVpLWRhdGVwaWNrZXItY2xvc2UnKVswXS5mb2N1cygpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHdoaWNoID09PSAzNykgeyAvLyBMRUZUIGFycm93IGtleVxuICAgICAgICAvLyBpZiB3ZSdyZSBvbiBhIGRhdGUgbGluay4uLlxuICAgICAgICBpZiAoISQodGFyZ2V0KS5oYXNDbGFzcygndWktZGF0ZXBpY2tlci1jbG9zZScpICYmICQodGFyZ2V0KS5oYXNDbGFzcygndWktc3RhdGUtZGVmYXVsdCcpKSB7XG4gICAgICAgICAga2V5VmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIHByZXZpb3VzRGF5KHRhcmdldCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAod2hpY2ggPT09IDM5KSB7IC8vIFJJR0hUIGFycm93IGtleVxuICAgICAgICAvLyBpZiB3ZSdyZSBvbiBhIGRhdGUgbGluay4uLlxuICAgICAgICBpZiAoISQodGFyZ2V0KS5oYXNDbGFzcygndWktZGF0ZXBpY2tlci1jbG9zZScpICYmICQodGFyZ2V0KS5oYXNDbGFzcygndWktc3RhdGUtZGVmYXVsdCcpKSB7XG4gICAgICAgICAga2V5VmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIG5leHREYXkodGFyZ2V0KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh3aGljaCA9PT0gMzgpIHsgLy8gVVAgYXJyb3cga2V5XG4gICAgICAgIGlmICghJCh0YXJnZXQpLmhhc0NsYXNzKCd1aS1kYXRlcGlja2VyLWNsb3NlJykgJiYgJCh0YXJnZXQpLmhhc0NsYXNzKCd1aS1zdGF0ZS1kZWZhdWx0JykpIHtcbiAgICAgICAgICBrZXlWZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgdXBIYW5kbGVyKHRhcmdldCwgY29udGFpbmVyLCBwcmV2KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh3aGljaCA9PT0gNDApIHsgLy8gRE9XTiBhcnJvdyBrZXlcbiAgICAgICAgaWYgKCEkKHRhcmdldCkuaGFzQ2xhc3MoJ3VpLWRhdGVwaWNrZXItY2xvc2UnKSAmJiAkKHRhcmdldCkuaGFzQ2xhc3MoJ3VpLXN0YXRlLWRlZmF1bHQnKSkge1xuICAgICAgICAgIGtleVZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBkb3duSGFuZGxlcih0YXJnZXQsIGNvbnRhaW5lciwgbmV4dCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAod2hpY2ggPT09IDEzKSB7IC8vIEVOVEVSXG4gICAgICAgIGlmICgkKHRhcmdldCkuaGFzQ2xhc3MoJ3VpLXN0YXRlLWRlZmF1bHQnKSkge1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY2xvc2VDYWxlbmRhcigpO1xuICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgIH0gZWxzZSBpZiAoJCh0YXJnZXQpLmhhc0NsYXNzKCd1aS1kYXRlcGlja2VyLXByZXYnKSkge1xuICAgICAgICAgIGhhbmRsZVByZXZDbGlja3MoKTtcbiAgICAgICAgfSBlbHNlIGlmICgkKHRhcmdldCkuaGFzQ2xhc3MoJ3VpLWRhdGVwaWNrZXItbmV4dCcpKSB7XG4gICAgICAgICAgaGFuZGxlTmV4dENsaWNrcygpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKDMyID09PSB3aGljaCkge1xuICAgICAgICBpZiAoJCh0YXJnZXQpLmhhc0NsYXNzKCd1aS1kYXRlcGlja2VyLXByZXYnKSB8fCAkKHRhcmdldCkuaGFzQ2xhc3MoJ3VpLWRhdGVwaWNrZXItbmV4dCcpKSB7XG4gICAgICAgICAgdGFyZ2V0LmNsaWNrKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoMzMgPT09IHdoaWNoKSB7IC8vIFBBR0UgVVBcbiAgICAgICAgbW92ZU9uZU1vbnRoKHRhcmdldCwgJ3ByZXYnKTtcbiAgICAgIH0gZWxzZSBpZiAoMzQgPT09IHdoaWNoKSB7IC8vIFBBR0UgRE9XTlxuICAgICAgICBtb3ZlT25lTW9udGgodGFyZ2V0LCAnbmV4dCcpO1xuICAgICAgfSBlbHNlIGlmICgzNiA9PT0gd2hpY2gpIHsgLy8gSE9NRVxuICAgICAgICB2YXIgZmlyc3RPZk1vbnRoID0gJCh0YXJnZXQpLmNsb3Nlc3QoJ3Rib2R5JykuZmluZCgnLnVpLXN0YXRlLWRlZmF1bHQnKVswXTtcbiAgICAgICAgaWYgKGZpcnN0T2ZNb250aCkge1xuICAgICAgICAgIGZpcnN0T2ZNb250aC5mb2N1cygpO1xuICAgICAgICAgIHNldEhpZ2hsaWdodFN0YXRlKGZpcnN0T2ZNb250aCwgJCgnI3VpLWRhdGVwaWNrZXItZGl2JylbMF0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKDM1ID09PSB3aGljaCkgeyAvLyBFTkRcbiAgICAgICAgdmFyICRkYXlzT2ZNb250aCA9ICQodGFyZ2V0KS5jbG9zZXN0KCd0Ym9keScpLmZpbmQoJy51aS1zdGF0ZS1kZWZhdWx0Jyk7XG4gICAgICAgIHZhciBsYXN0RGF5ID0gJGRheXNPZk1vbnRoWyRkYXlzT2ZNb250aC5sZW5ndGggLSAxXTtcbiAgICAgICAgaWYgKGxhc3REYXkpIHtcbiAgICAgICAgICBsYXN0RGF5LmZvY3VzKCk7XG4gICAgICAgICAgc2V0SGlnaGxpZ2h0U3RhdGUobGFzdERheSwgJCgnI3VpLWRhdGVwaWNrZXItZGl2JylbMF0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAkKFwiLnVpLWRhdGVwaWNrZXItY3VycmVudFwiKS5oaWRlKCk7XG4gICAgfSk7XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIGNsb3NlQ2FsZW5kYXIoKSB7XG4gICAgdmFyIGNvbnRhaW5lciA9ICQoJyN1aS1kYXRlcGlja2VyLWRpdicpO1xuICAgICQoY29udGFpbmVyKS5vZmYoJ2tleWRvd24nKTtcbiAgICB2YXIgaW5wdXQgPSAkKCcuZGF0ZXBpY2tlck9wZW5lZCcpO1xuICAgICQoaW5wdXQpLmRhdGVwaWNrZXIoJ2hpZGUnKTtcbiAgICBpbnB1dC5mb2N1cygpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVtb3ZlQXJpYSgpIHtcbiAgICAvLyBtYWtlIHRoZSByZXN0IG9mIHRoZSBwYWdlIGFjY2Vzc2libGUgYWdhaW46XG4gICAgJChcIiNkcC1jb250YWluZXJcIikucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4nKTtcbiAgICAkKFwiI3NraXBuYXZcIikucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4nKTtcbiAgICAkKFwiLmRhdGVwaWNrZXJPcGVuZWRcIikucmVtb3ZlQ2xhc3MoXCJkYXRlcGlja2VyT3BlbmVkXCIpO1xuICB9XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gLy9cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gLy8gLy9cbi8vIFVUSUxJVFktTElLRSBUSElOR1MgLy8gLy8gLy9cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gLy8gLy9cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gLy9cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICBmdW5jdGlvbiBtb3ZlT25lTW9udGgoY3VycmVudERhdGUsIGRpcikge1xuICAgIHZhciBidXR0b24gPSAoZGlyID09PSAnbmV4dCcpID8gJCgnLnVpLWRhdGVwaWNrZXItbmV4dCcpWzBdIDogJCgnLnVpLWRhdGVwaWNrZXItcHJldicpWzBdO1xuXG4gICAgaWYgKCFidXR0b24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgRU5BQkxFRF9TRUxFQ1RPUiA9ICcjdWktZGF0ZXBpY2tlci1kaXYgdGJvZHkgdGQ6bm90KC51aS1zdGF0ZS1kaXNhYmxlZCknO1xuICAgIHZhciAkY3VycmVudENlbGxzID0gJChFTkFCTEVEX1NFTEVDVE9SKTtcbiAgICB2YXIgY3VycmVudElkeCA9ICQuaW5BcnJheShjdXJyZW50RGF0ZS5wYXJlbnROb2RlLCAkY3VycmVudENlbGxzKTtcblxuICAgIGJ1dHRvbi5jbGljaygpO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgdXBkYXRlSGVhZGVyRWxlbWVudHMoKTtcblxuICAgICAgdmFyICRuZXdDZWxscyA9ICQoRU5BQkxFRF9TRUxFQ1RPUik7XG4gICAgICB2YXIgbmV3VGQgPSAkbmV3Q2VsbHNbY3VycmVudElkeF07XG4gICAgICB2YXIgbmV3QW5jaG9yID0gbmV3VGQgJiYgJChuZXdUZCkuZmluZCgnYScpWzBdO1xuXG4gICAgICB3aGlsZSAoIW5ld0FuY2hvcikge1xuICAgICAgICBjdXJyZW50SWR4LS07XG4gICAgICAgIG5ld1RkID0gJG5ld0NlbGxzW2N1cnJlbnRJZHhdO1xuICAgICAgICBuZXdBbmNob3IgPSBuZXdUZCAmJiAkKG5ld1RkKS5maW5kKCdhJylbMF07XG4gICAgICB9XG5cbiAgICAgIHNldEhpZ2hsaWdodFN0YXRlKG5ld0FuY2hvciwgJCgnI3VpLWRhdGVwaWNrZXItZGl2JylbMF0pO1xuICAgICAgbmV3QW5jaG9yLmZvY3VzKCk7XG5cbiAgICB9LCAwKTtcblxuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlTmV4dENsaWNrcygpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHVwZGF0ZUhlYWRlckVsZW1lbnRzKCk7XG4gICAgICBwcmVwSGlnaGxpZ2h0U3RhdGUoKTtcbiAgICAgICQoJy51aS1kYXRlcGlja2VyLW5leHQnKS5mb2N1cygpO1xuICAgICAgJChcIi51aS1kYXRlcGlja2VyLWN1cnJlbnRcIikuaGlkZSgpO1xuICAgIH0sIDApO1xuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlUHJldkNsaWNrcygpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHVwZGF0ZUhlYWRlckVsZW1lbnRzKCk7XG4gICAgICBwcmVwSGlnaGxpZ2h0U3RhdGUoKTtcbiAgICAgICQoJy51aS1kYXRlcGlja2VyLXByZXYnKS5mb2N1cygpO1xuICAgICAgJChcIi51aS1kYXRlcGlja2VyLWN1cnJlbnRcIikuaGlkZSgpO1xuICAgIH0sIDApO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJldmlvdXNEYXkoZGF0ZUxpbmspIHtcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VpLWRhdGVwaWNrZXItZGl2Jyk7XG4gICAgaWYgKCFkYXRlTGluaykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgdGQgPSAkKGRhdGVMaW5rKS5jbG9zZXN0KCd0ZCcpO1xuICAgIGlmICghdGQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgcHJldlRkID0gJCh0ZCkucHJldigpLFxuICAgICAgcHJldkRhdGVMaW5rID0gJCgnYS51aS1zdGF0ZS1kZWZhdWx0JywgcHJldlRkKVswXTtcblxuICAgIGlmIChwcmV2VGQgJiYgcHJldkRhdGVMaW5rKSB7XG4gICAgICBzZXRIaWdobGlnaHRTdGF0ZShwcmV2RGF0ZUxpbmssIGNvbnRhaW5lcik7XG4gICAgICBwcmV2RGF0ZUxpbmsuZm9jdXMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGFuZGxlUHJldmlvdXMoZGF0ZUxpbmspO1xuICAgIH1cbiAgfVxuXG5cbiAgZnVuY3Rpb24gaGFuZGxlUHJldmlvdXModGFyZ2V0KSB7XG4gICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1aS1kYXRlcGlja2VyLWRpdicpO1xuICAgIGlmICghdGFyZ2V0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBjdXJyZW50Um93ID0gJCh0YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7XG4gICAgaWYgKCFjdXJyZW50Um93KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBwcmV2aW91c1JvdyA9ICQoY3VycmVudFJvdykucHJldigpO1xuXG4gICAgaWYgKCFwcmV2aW91c1JvdyB8fCBwcmV2aW91c1Jvdy5sZW5ndGggPT09IDApIHtcbiAgICAgIC8vIHRoZXJlIGlzIG5vdCBwcmV2aW91cyByb3csIHNvIHdlIGdvIHRvIHByZXZpb3VzIG1vbnRoLi4uXG4gICAgICBwcmV2aW91c01vbnRoKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBwcmV2Um93RGF0ZXMgPSAkKCd0ZCBhLnVpLXN0YXRlLWRlZmF1bHQnLCBwcmV2aW91c1Jvdyk7XG4gICAgICB2YXIgcHJldlJvd0RhdGUgPSBwcmV2Um93RGF0ZXNbcHJldlJvd0RhdGVzLmxlbmd0aCAtIDFdO1xuXG4gICAgICBpZiAocHJldlJvd0RhdGUpIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc2V0SGlnaGxpZ2h0U3RhdGUocHJldlJvd0RhdGUsIGNvbnRhaW5lcik7XG4gICAgICAgICAgcHJldlJvd0RhdGUuZm9jdXMoKTtcbiAgICAgICAgfSwgMCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcHJldmlvdXNNb250aCgpIHtcbiAgICB2YXIgcHJldkxpbmsgPSAkKCcudWktZGF0ZXBpY2tlci1wcmV2JylbMF07XG4gICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1aS1kYXRlcGlja2VyLWRpdicpO1xuICAgIHByZXZMaW5rLmNsaWNrKCk7XG4gICAgLy8gZm9jdXMgbGFzdCBkYXkgb2YgbmV3IG1vbnRoXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgdHJzID0gJCgndHInLCBjb250YWluZXIpLFxuICAgICAgICBsYXN0Um93VGRMaW5rcyA9ICQoJ3RkIGEudWktc3RhdGUtZGVmYXVsdCcsIHRyc1t0cnMubGVuZ3RoIC0gMV0pLFxuICAgICAgICBsYXN0RGF0ZSA9IGxhc3RSb3dUZExpbmtzW2xhc3RSb3dUZExpbmtzLmxlbmd0aCAtIDFdO1xuXG4gICAgICAvLyB1cGRhdGluZyB0aGUgY2FjaGVkIGhlYWRlciBlbGVtZW50c1xuICAgICAgdXBkYXRlSGVhZGVyRWxlbWVudHMoKTtcblxuICAgICAgc2V0SGlnaGxpZ2h0U3RhdGUobGFzdERhdGUsIGNvbnRhaW5lcik7XG4gICAgICBsYXN0RGF0ZS5mb2N1cygpO1xuXG4gICAgfSwgMCk7XG4gIH1cblxuLy8vLy8vLy8vLy8vLy8vLy8gTkVYVCAvLy8vLy8vLy8vLy8vLy8vL1xuICAvKipcbiAgICogSGFuZGxlcyByaWdodCBhcnJvdyBrZXkgbmF2aWdhdGlvblxuICAgKiBAcGFyYW0gIHtIVE1MRWxlbWVudH0gZGF0ZUxpbmsgVGhlIHRhcmdldCBvZiB0aGUga2V5Ym9hcmQgZXZlbnRcbiAgICovXG4gIGZ1bmN0aW9uIG5leHREYXkoZGF0ZUxpbmspIHtcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VpLWRhdGVwaWNrZXItZGl2Jyk7XG4gICAgaWYgKCFkYXRlTGluaykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgdGQgPSAkKGRhdGVMaW5rKS5jbG9zZXN0KCd0ZCcpO1xuICAgIGlmICghdGQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIG5leHRUZCA9ICQodGQpLm5leHQoKSxcbiAgICAgIG5leHREYXRlTGluayA9ICQoJ2EudWktc3RhdGUtZGVmYXVsdCcsIG5leHRUZClbMF07XG5cbiAgICBpZiAobmV4dFRkICYmIG5leHREYXRlTGluaykge1xuICAgICAgc2V0SGlnaGxpZ2h0U3RhdGUobmV4dERhdGVMaW5rLCBjb250YWluZXIpO1xuICAgICAgbmV4dERhdGVMaW5rLmZvY3VzKCk7IC8vIHRoZSBuZXh0IGRheSAoc2FtZSByb3cpXG4gICAgfSBlbHNlIHtcbiAgICAgIGhhbmRsZU5leHQoZGF0ZUxpbmspO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZU5leHQodGFyZ2V0KSB7XG4gICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1aS1kYXRlcGlja2VyLWRpdicpO1xuICAgIGlmICghdGFyZ2V0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBjdXJyZW50Um93ID0gJCh0YXJnZXQpLmNsb3Nlc3QoJ3RyJyksXG4gICAgICBuZXh0Um93ID0gJChjdXJyZW50Um93KS5uZXh0KCk7XG5cbiAgICBpZiAoIW5leHRSb3cgfHwgbmV4dFJvdy5sZW5ndGggPT09IDApIHtcbiAgICAgIG5leHRNb250aCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgbmV4dFJvd0ZpcnN0RGF0ZSA9ICQoJ2EudWktc3RhdGUtZGVmYXVsdCcsIG5leHRSb3cpWzBdO1xuICAgICAgaWYgKG5leHRSb3dGaXJzdERhdGUpIHtcbiAgICAgICAgc2V0SGlnaGxpZ2h0U3RhdGUobmV4dFJvd0ZpcnN0RGF0ZSwgY29udGFpbmVyKTtcbiAgICAgICAgbmV4dFJvd0ZpcnN0RGF0ZS5mb2N1cygpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG5leHRNb250aCgpIHtcbiAgICB2YXIgbmV4dE1vbiA9ICQoJy51aS1kYXRlcGlja2VyLW5leHQnKVswXTtcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VpLWRhdGVwaWNrZXItZGl2Jyk7XG4gICAgbmV4dE1vbi5jbGljaygpO1xuICAgIC8vIGZvY3VzIHRoZSBmaXJzdCBkYXkgb2YgdGhlIG5ldyBtb250aFxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgLy8gdXBkYXRpbmcgdGhlIGNhY2hlZCBoZWFkZXIgZWxlbWVudHNcbiAgICAgIHVwZGF0ZUhlYWRlckVsZW1lbnRzKCk7XG5cbiAgICAgIHZhciBmaXJzdERhdGUgPSAkKCdhLnVpLXN0YXRlLWRlZmF1bHQnLCBjb250YWluZXIpWzBdO1xuICAgICAgc2V0SGlnaGxpZ2h0U3RhdGUoZmlyc3REYXRlLCBjb250YWluZXIpO1xuICAgICAgZmlyc3REYXRlLmZvY3VzKCk7XG4gICAgfSwgMCk7XG4gIH1cblxuLy8vLy8vLy8vLy8gVVAgLy8vLy8vLy8vLy9cbiAgLyoqXG4gICAqIEhhbmRsZSB0aGUgdXAgYXJyb3cgbmF2aWdhdGlvbiB0aHJvdWdoIGRhdGVzXG4gICAqIEBwYXJhbSAge0hUTUxFbGVtZW50fSB0YXJnZXQgICBUaGUgdGFyZ2V0IG9mIHRoZSBrZXlib2FyZCBldmVudCAoZGF5KVxuICAgKiBAcGFyYW0gIHtIVE1MRWxlbWVudH0gY29udCAgICAgVGhlIGNhbGVuZGFyIGNvbnRhaW5lclxuICAgKiBAcGFyYW0gIHtIVE1MRWxlbWVudH0gcHJldkxpbmsgTGluayB0byBuYXZpZ2F0ZSB0byBwcmV2aW91cyBtb250aFxuICAgKi9cbiAgZnVuY3Rpb24gdXBIYW5kbGVyKHRhcmdldCwgY29udCwgcHJldkxpbmspIHtcbiAgICBwcmV2TGluayA9ICQoJy51aS1kYXRlcGlja2VyLXByZXYnKVswXTtcbiAgICB2YXIgcm93Q29udGV4dCA9ICQodGFyZ2V0KS5jbG9zZXN0KCd0cicpO1xuICAgIGlmICghcm93Q29udGV4dCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgcm93VGRzID0gJCgndGQnLCByb3dDb250ZXh0KSxcbiAgICAgIHJvd0xpbmtzID0gJCgnYS51aS1zdGF0ZS1kZWZhdWx0Jywgcm93Q29udGV4dCksXG4gICAgICB0YXJnZXRJbmRleCA9ICQuaW5BcnJheSh0YXJnZXQsIHJvd0xpbmtzKSxcbiAgICAgIHByZXZSb3cgPSAkKHJvd0NvbnRleHQpLnByZXYoKSxcbiAgICAgIHByZXZSb3dUZHMgPSAkKCd0ZCcsIHByZXZSb3cpLFxuICAgICAgcGFyYWxsZWwgPSBwcmV2Um93VGRzW3RhcmdldEluZGV4XSxcbiAgICAgIGxpbmtDaGVjayA9ICQoJ2EudWktc3RhdGUtZGVmYXVsdCcsIHBhcmFsbGVsKVswXTtcblxuICAgIGlmIChwcmV2Um93ICYmIHBhcmFsbGVsICYmIGxpbmtDaGVjaykge1xuICAgICAgLy8gdGhlcmUgaXMgYSBwcmV2aW91cyByb3csIGEgdGQgYXQgdGhlIHNhbWUgaW5kZXhcbiAgICAgIC8vIG9mIHRoZSB0YXJnZXQgQU5EIHRoZXJlcyBhIGxpbmsgaW4gdGhhdCB0ZFxuICAgICAgc2V0SGlnaGxpZ2h0U3RhdGUobGlua0NoZWNrLCBjb250KTtcbiAgICAgIGxpbmtDaGVjay5mb2N1cygpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyB3ZSdyZSBlaXRoZXIgb24gdGhlIGZpcnN0IHJvdyBvZiBhIG1vbnRoLCBvciB3ZSdyZSBvbiB0aGVcbiAgICAgIC8vIHNlY29uZCBhbmQgdGhlcmUgaXMgbm90IGEgZGF0ZSBsaW5rIGRpcmVjdGx5IGFib3ZlIHRoZSB0YXJnZXRcbiAgICAgIHByZXZMaW5rLmNsaWNrKCk7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gdXBkYXRpbmcgdGhlIGNhY2hlZCBoZWFkZXIgZWxlbWVudHNcbiAgICAgICAgdXBkYXRlSGVhZGVyRWxlbWVudHMoKTtcbiAgICAgICAgdmFyIG5ld1Jvd3MgPSAkKCd0cicsIGNvbnQpLFxuICAgICAgICAgIGxhc3RSb3cgPSBuZXdSb3dzW25ld1Jvd3MubGVuZ3RoIC0gMV0sXG4gICAgICAgICAgbGFzdFJvd1RkcyA9ICQoJ3RkJywgbGFzdFJvdyksXG4gICAgICAgICAgdGRQYXJhbGxlbEluZGV4ID0gJC5pbkFycmF5KHRhcmdldC5wYXJlbnROb2RlLCByb3dUZHMpLFxuICAgICAgICAgIG5ld1BhcmFsbGVsID0gbGFzdFJvd1Rkc1t0ZFBhcmFsbGVsSW5kZXhdLFxuICAgICAgICAgIG5ld0NoZWNrID0gJCgnYS51aS1zdGF0ZS1kZWZhdWx0JywgbmV3UGFyYWxsZWwpWzBdO1xuXG4gICAgICAgIGlmIChsYXN0Um93ICYmIG5ld1BhcmFsbGVsICYmIG5ld0NoZWNrKSB7XG4gICAgICAgICAgc2V0SGlnaGxpZ2h0U3RhdGUobmV3Q2hlY2ssIGNvbnQpO1xuICAgICAgICAgIG5ld0NoZWNrLmZvY3VzKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gdGhlcmVzIG5vIGRhdGUgbGluayBvbiB0aGUgbGFzdCB3ZWVrIChyb3cpIG9mIHRoZSBuZXcgbW9udGhcbiAgICAgICAgICAvLyBtZWFuaW5nIGl0cyBhbiBlbXB0eSBjZWxsLCBzbyB3ZSdsbCB0cnkgdGhlIDJuZCB0byBsYXN0IHdlZWtcbiAgICAgICAgICB2YXIgc2Vjb25kTGFzdFJvdyA9IG5ld1Jvd3NbbmV3Um93cy5sZW5ndGggLSAyXSxcbiAgICAgICAgICAgIHNlY29uZFRkcyA9ICQoJ3RkJywgc2Vjb25kTGFzdFJvdyksXG4gICAgICAgICAgICB0YXJnZXRUZCA9IHNlY29uZFRkc1t0ZFBhcmFsbGVsSW5kZXhdLFxuICAgICAgICAgICAgbGlua0NoZWNrID0gJCgnYS51aS1zdGF0ZS1kZWZhdWx0JywgdGFyZ2V0VGQpWzBdO1xuXG4gICAgICAgICAgaWYgKGxpbmtDaGVjaykge1xuICAgICAgICAgICAgc2V0SGlnaGxpZ2h0U3RhdGUobGlua0NoZWNrLCBjb250KTtcbiAgICAgICAgICAgIGxpbmtDaGVjay5mb2N1cygpO1xuICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgICB9LCAwKTtcbiAgICB9XG4gIH1cblxuLy8vLy8vLy8vLy8vLy8vLyBET1dOIC8vLy8vLy8vLy8vLy8vLy9cbiAgLyoqXG4gICAqIEhhbmRsZXMgZG93biBhcnJvdyBuYXZpZ2F0aW9uIHRocm91Z2ggZGF0ZXMgaW4gY2FsZW5kYXJcbiAgICogQHBhcmFtICB7SFRNTEVsZW1lbnR9IHRhcmdldCAgIFRoZSB0YXJnZXQgb2YgdGhlIGtleWJvYXJkIGV2ZW50IChkYXkpXG4gICAqIEBwYXJhbSAge0hUTUxFbGVtZW50fSBjb250ICAgICBUaGUgY2FsZW5kYXIgY29udGFpbmVyXG4gICAqIEBwYXJhbSAge0hUTUxFbGVtZW50fSBuZXh0TGluayBMaW5rIHRvIG5hdmlnYXRlIHRvIG5leHQgbW9udGhcbiAgICovXG4gIGZ1bmN0aW9uIGRvd25IYW5kbGVyKHRhcmdldCwgY29udCwgbmV4dExpbmspIHtcbiAgICBuZXh0TGluayA9ICQoJy51aS1kYXRlcGlja2VyLW5leHQnKVswXTtcbiAgICB2YXIgdGFyZ2V0Um93ID0gJCh0YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7XG4gICAgaWYgKCF0YXJnZXRSb3cpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIHRhcmdldENlbGxzID0gJCgndGQnLCB0YXJnZXRSb3cpLFxuICAgICAgY2VsbEluZGV4ID0gJC5pbkFycmF5KHRhcmdldC5wYXJlbnROb2RlLCB0YXJnZXRDZWxscyksIC8vIHRoZSB0ZCAocGFyZW50IG9mIHRhcmdldCkgaW5kZXhcbiAgICAgIG5leHRSb3cgPSAkKHRhcmdldFJvdykubmV4dCgpLFxuICAgICAgbmV4dFJvd0NlbGxzID0gJCgndGQnLCBuZXh0Um93KSxcbiAgICAgIG5leHRXZWVrVGQgPSBuZXh0Um93Q2VsbHNbY2VsbEluZGV4XSxcbiAgICAgIG5leHRXZWVrQ2hlY2sgPSAkKCdhLnVpLXN0YXRlLWRlZmF1bHQnLCBuZXh0V2Vla1RkKVswXTtcblxuICAgIGlmIChuZXh0Um93ICYmIG5leHRXZWVrVGQgJiYgbmV4dFdlZWtDaGVjaykge1xuICAgICAgLy8gdGhlcmVzIGEgbmV4dCByb3csIGEgVEQgYXQgdGhlIHNhbWUgaW5kZXggb2YgYHRhcmdldGAsXG4gICAgICAvLyBhbmQgdGhlcmVzIGFuIGFuY2hvciB3aXRoaW4gdGhhdCB0ZFxuICAgICAgc2V0SGlnaGxpZ2h0U3RhdGUobmV4dFdlZWtDaGVjaywgY29udCk7XG4gICAgICBuZXh0V2Vla0NoZWNrLmZvY3VzKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5leHRMaW5rLmNsaWNrKCk7XG5cbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyB1cGRhdGluZyB0aGUgY2FjaGVkIGhlYWRlciBlbGVtZW50c1xuICAgICAgICB1cGRhdGVIZWFkZXJFbGVtZW50cygpO1xuXG4gICAgICAgIHZhciBuZXh0TW9udGhUcnMgPSAkKCd0Ym9keSB0cicsIGNvbnQpLFxuICAgICAgICAgIGZpcnN0VGRzID0gJCgndGQnLCBuZXh0TW9udGhUcnNbMF0pLFxuICAgICAgICAgIGZpcnN0UGFyYWxsZWwgPSBmaXJzdFRkc1tjZWxsSW5kZXhdLFxuICAgICAgICAgIGZpcnN0Q2hlY2sgPSAkKCdhLnVpLXN0YXRlLWRlZmF1bHQnLCBmaXJzdFBhcmFsbGVsKVswXTtcblxuICAgICAgICBpZiAoZmlyc3RQYXJhbGxlbCAmJiBmaXJzdENoZWNrKSB7XG4gICAgICAgICAgc2V0SGlnaGxpZ2h0U3RhdGUoZmlyc3RDaGVjaywgY29udCk7XG4gICAgICAgICAgZmlyc3RDaGVjay5mb2N1cygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGxldHMgdHJ5IHRoZSBzZWNvbmQgcm93IGIvYyB3ZSBkaWRudCBmaW5kIGFcbiAgICAgICAgICAvLyBkYXRlIGxpbmsgaW4gdGhlIGZpcnN0IHJvdyBhdCB0aGUgdGFyZ2V0J3MgaW5kZXhcbiAgICAgICAgICB2YXIgc2Vjb25kUm93ID0gbmV4dE1vbnRoVHJzWzFdLFxuICAgICAgICAgICAgc2Vjb25kVGRzID0gJCgndGQnLCBzZWNvbmRSb3cpLFxuICAgICAgICAgICAgc2Vjb25kUm93VGQgPSBzZWNvbmRUZHNbY2VsbEluZGV4XSxcbiAgICAgICAgICAgIHNlY29uZENoZWNrID0gJCgnYS51aS1zdGF0ZS1kZWZhdWx0Jywgc2Vjb25kUm93VGQpWzBdO1xuXG4gICAgICAgICAgaWYgKHNlY29uZFJvdyAmJiBzZWNvbmRDaGVjaykge1xuICAgICAgICAgICAgc2V0SGlnaGxpZ2h0U3RhdGUoc2Vjb25kQ2hlY2ssIGNvbnQpO1xuICAgICAgICAgICAgc2Vjb25kQ2hlY2suZm9jdXMoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sIDApO1xuICAgIH1cbiAgfVxuXG4vLyBhZGQgYW4gYXJpYS1sYWJlbCB0byB0aGUgZGF0ZSBsaW5rIGluZGljYXRpbmcgdGhlIGN1cnJlbnRseSBmb2N1c2VkIGRhdGVcbi8vIChmb3JtYXR0ZWQgaWRlbnRpY2FsbHkgdG8gdGhlIHJlcXVpcmVkIGZvcm1hdDogbW0vZGQveXl5eSlcbiAgZnVuY3Rpb24gbW9udGhEYXlZZWFyVGV4dCgpIHtcbiAgICB2YXIgY2xlYW5VcHMgPSAkKCcuYW1hemUtZGF0ZScpO1xuXG4gICAgJChjbGVhblVwcykuZWFjaChmdW5jdGlvbiAoY2xlYW4pIHtcbiAgICAgIC8vIGVhY2goY2xlYW5VcHMsIGZ1bmN0aW9uIChjbGVhbikge1xuICAgICAgY2xlYW4ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjbGVhbik7XG4gICAgfSk7XG5cbiAgICB2YXIgZGF0ZVBpY2tEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWktZGF0ZXBpY2tlci1kaXYnKTtcbiAgICAvLyBpbiBjYXNlIHdlIGZpbmQgbm8gZGF0ZXBpY2sgZGl2XG4gICAgaWYgKCFkYXRlUGlja0Rpdikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBkYXRlcyA9ICQoJ2EudWktc3RhdGUtZGVmYXVsdCcsIGRhdGVQaWNrRGl2KTtcblxuICAgICQoZGF0ZXMpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBkYXRlKSB7XG4gICAgICB2YXIgY3VycmVudFJvdyA9ICQoZGF0ZSkuY2xvc2VzdCgndHInKSxcbiAgICAgICAgY3VycmVudFRkcyA9ICQoJ3RkJywgY3VycmVudFJvdyksXG4gICAgICAgIGN1cnJlbnRJbmRleCA9ICQuaW5BcnJheShkYXRlLnBhcmVudE5vZGUsIGN1cnJlbnRUZHMpLFxuICAgICAgICBoZWFkVGhzID0gJCgndGhlYWQgdHIgdGgnLCBkYXRlUGlja0RpdiksXG4gICAgICAgIGRheUluZGV4ID0gaGVhZFRoc1tjdXJyZW50SW5kZXhdLFxuICAgICAgICBkYXlTcGFuID0gJCgnc3BhbicsIGRheUluZGV4KVswXSxcbiAgICAgICAgbW9udGhOYW1lID0gJCgnLnVpLWRhdGVwaWNrZXItbW9udGgnLCBkYXRlUGlja0RpdilbMF0uaW5uZXJIVE1MLFxuICAgICAgICB5ZWFyID0gJCgnLnVpLWRhdGVwaWNrZXIteWVhcicsIGRhdGVQaWNrRGl2KVswXS5pbm5lckhUTUwsXG4gICAgICAgIG51bWJlciA9IGRhdGUuaW5uZXJIVE1MO1xuXG4gICAgICBpZiAoIWRheVNwYW4gfHwgIW1vbnRoTmFtZSB8fCAhbnVtYmVyIHx8ICF5ZWFyKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gQVQgUmVhZHM6IHttb250aH0ge2RhdGV9IHt5ZWFyfSB7ZGF5fVxuICAgICAgLy8gXCJEZWNlbWJlciAxOCAyMDE0IFRodXJzZGF5XCJcbiAgICAgIHZhciBkYXRlVGV4dCA9IG1vbnRoTmFtZSArICcgJyArIGRhdGUuaW5uZXJIVE1MICsgJyAnICsgeWVhciArICcgJyArIGRheVNwYW4udGl0bGU7XG4gICAgICAvLyBBVCBSZWFkczoge2RhdGUobnVtYmVyKX0ge25hbWUgb2YgZGF5fSB7bmFtZSBvZiBtb250aH0ge3llYXIobnVtYmVyKX1cbiAgICAgIC8vIHZhciBkYXRlVGV4dCA9IGRhdGUuaW5uZXJIVE1MICsgJyAnICsgZGF5U3Bhbi50aXRsZSArICcgJyArIG1vbnRoTmFtZSArICcgJyArIHllYXI7XG4gICAgICAvLyBhZGQgYW4gYXJpYS1sYWJlbCB0byB0aGUgZGF0ZSBsaW5rIHJlYWRpbmcgb3V0IHRoZSBjdXJyZW50bHkgZm9jdXNlZCBkYXRlXG4gICAgICBkYXRlLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGRhdGVUZXh0KTtcbiAgICB9KTtcbiAgfVxuXG5cbi8vIHVwZGF0ZSB0aGUgY2FjaGVkIGhlYWRlciBlbGVtZW50cyBiZWNhdXNlIHdlJ3JlIGluIGEgbmV3IG1vbnRoIG9yIHllYXJcbiAgZnVuY3Rpb24gdXBkYXRlSGVhZGVyRWxlbWVudHMoKSB7XG4gICAgdmFyIGNvbnRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWktZGF0ZXBpY2tlci1kaXYnKTtcbiAgICBpZiAoIWNvbnRleHQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAkKGNvbnRleHQpLmZpbmQoJ3RhYmxlJykuZmlyc3QoKS5hdHRyKCdyb2xlJywgJ2dyaWQnKTtcblxuICAgIHZhciBwcmV2ID0gJCgnLnVpLWRhdGVwaWNrZXItcHJldicsIGNvbnRleHQpWzBdO1xuICAgIHZhciBuZXh0ID0gJCgnLnVpLWRhdGVwaWNrZXItbmV4dCcsIGNvbnRleHQpWzBdO1xuXG4gICAgLy9tYWtlIHRoZW0gY2xpY2svZm9jdXMgLSBhYmxlXG4gICAgbmV4dC5ocmVmID0gJ2phdmFzY3JpcHQ6dm9pZCgwKSc7XG4gICAgcHJldi5ocmVmID0gJ2phdmFzY3JpcHQ6dm9pZCgwKSc7XG5cbiAgICBuZXh0LnNldEF0dHJpYnV0ZSgncm9sZScsICdidXR0b24nKTtcbiAgICBwcmV2LnNldEF0dHJpYnV0ZSgncm9sZScsICdidXR0b24nKTtcbiAgICBhcHBlbmRPZmZzY3JlZW5Nb250aFRleHQobmV4dCk7XG4gICAgYXBwZW5kT2Zmc2NyZWVuTW9udGhUZXh0KHByZXYpO1xuXG4gICAgJChuZXh0KS5vbignY2xpY2snLCBoYW5kbGVOZXh0Q2xpY2tzKTtcbiAgICAkKHByZXYpLm9uKCdjbGljaycsIGhhbmRsZVByZXZDbGlja3MpO1xuXG4gICAgLy8gYWRkIG1vbnRoIGRheSB5ZWFyIHRleHRcbiAgICBtb250aERheVllYXJUZXh0KCk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIHByZXBIaWdobGlnaHRTdGF0ZSgpIHtcbiAgICB2YXIgaGlnaGxpZ2h0O1xuICAgIHZhciBjYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VpLWRhdGVwaWNrZXItZGl2Jyk7XG4gICAgaGlnaGxpZ2h0ID0gJCgnLnVpLXN0YXRlLWhpZ2hsaWdodCcsIGNhZ2UpWzBdIHx8XG4gICAgICAkKCcudWktc3RhdGUtZGVmYXVsdCcsIGNhZ2UpWzBdO1xuICAgIGlmIChoaWdobGlnaHQgJiYgY2FnZSkge1xuICAgICAgc2V0SGlnaGxpZ2h0U3RhdGUoaGlnaGxpZ2h0LCBjYWdlKTtcbiAgICB9XG4gIH1cblxuLy8gU2V0IHRoZSBoaWdobGlnaHRlZCBjbGFzcyB0byBkYXRlIGVsZW1lbnRzLCB3aGVuIGZvY3VzIGlzIHJlY2lldmVkXG4gIGZ1bmN0aW9uIHNldEhpZ2hsaWdodFN0YXRlKG5ld0hpZ2hsaWdodCwgY29udGFpbmVyKSB7XG4gICAgdmFyIHByZXZIaWdobGlnaHQgPSBnZXRDdXJyZW50RGF0ZShjb250YWluZXIpO1xuICAgIC8vIHJlbW92ZSB0aGUgaGlnaGxpZ2h0IHN0YXRlIGZyb20gcHJldmlvdXNseVxuICAgIC8vIGhpZ2hsaWdodGVkIGRhdGUgYW5kIGFkZCBpdCB0byBvdXIgbmV3bHkgYWN0aXZlIGRhdGVcbiAgICAkKHByZXZIaWdobGlnaHQpLnJlbW92ZUNsYXNzKCd1aS1zdGF0ZS1oaWdobGlnaHQnKTtcbiAgICAkKG5ld0hpZ2hsaWdodCkuYWRkQ2xhc3MoJ3VpLXN0YXRlLWhpZ2hsaWdodCcpO1xuICB9XG5cblxuLy8gZ3JhYnMgdGhlIGN1cnJlbnQgZGF0ZSBiYXNlZCBvbiB0aGUgaGlnaHRsaWdodCBjbGFzc1xuICBmdW5jdGlvbiBnZXRDdXJyZW50RGF0ZShjb250YWluZXIpIHtcbiAgICByZXR1cm4gICQoJy51aS1zdGF0ZS1oaWdobGlnaHQnLCBjb250YWluZXIpWzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIEFwcGVuZHMgbG9naWNhbCBuZXh0L3ByZXYgbW9udGggdGV4dCB0byB0aGUgYnV0dG9uc1xuICAgKiAtIGV4OiBOZXh0IE1vbnRoLCBKYW51YXJ5IDIwMTVcbiAgICogICAgICAgUHJldmlvdXMgTW9udGgsIE5vdmVtYmVyIDIwMTRcbiAgICovXG4gIGZ1bmN0aW9uIGFwcGVuZE9mZnNjcmVlbk1vbnRoVGV4dChidXR0b24pIHtcbiAgICB2YXIgYnV0dG9uVGV4dDtcbiAgICB2YXIgaXNOZXh0ID0gJChidXR0b24pLmhhc0NsYXNzKCd1aS1kYXRlcGlja2VyLW5leHQnKTtcbiAgICB2YXIgbW9udGhzID0gW1xuICAgICAgJ2phbnVhcnknLCAnZmVicnVhcnknLFxuICAgICAgJ21hcmNoJywgJ2FwcmlsJyxcbiAgICAgICdtYXknLCAnanVuZScsICdqdWx5JyxcbiAgICAgICdhdWd1c3QnLCAnc2VwdGVtYmVyJyxcbiAgICAgICdvY3RvYmVyJyxcbiAgICAgICdub3ZlbWJlcicsICdkZWNlbWJlcidcbiAgICBdO1xuXG4gICAgdmFyIGN1cnJlbnRNb250aCA9ICQoJy51aS1kYXRlcGlja2VyLXRpdGxlIC51aS1kYXRlcGlja2VyLW1vbnRoJykudGV4dCgpLnRvTG93ZXJDYXNlKCk7XG4gICAgdmFyIG1vbnRoSW5kZXggPSAkLmluQXJyYXkoY3VycmVudE1vbnRoLnRvTG93ZXJDYXNlKCksIG1vbnRocyk7XG4gICAgdmFyIGN1cnJlbnRZZWFyID0gJCgnLnVpLWRhdGVwaWNrZXItdGl0bGUgLnVpLWRhdGVwaWNrZXIteWVhcicpLnRleHQoKS50b0xvd2VyQ2FzZSgpO1xuICAgIHZhciBhZGphY2VudEluZGV4ID0gKGlzTmV4dCkgPyBtb250aEluZGV4ICsgMSA6IG1vbnRoSW5kZXggLSAxO1xuXG4gICAgaWYgKGlzTmV4dCAmJiBjdXJyZW50TW9udGggPT09ICdkZWNlbWJlcicpIHtcbiAgICAgIGN1cnJlbnRZZWFyID0gcGFyc2VJbnQoY3VycmVudFllYXIsIDEwKSArIDE7XG4gICAgICBhZGphY2VudEluZGV4ID0gMDtcbiAgICB9IGVsc2UgaWYgKCFpc05leHQgJiYgY3VycmVudE1vbnRoID09PSAnamFudWFyeScpIHtcbiAgICAgIGN1cnJlbnRZZWFyID0gcGFyc2VJbnQoY3VycmVudFllYXIsIDEwKSAtIDE7XG4gICAgICBhZGphY2VudEluZGV4ID0gbW9udGhzLmxlbmd0aCAtIDE7XG4gICAgfVxuXG4gICAgYnV0dG9uVGV4dCA9IChpc05leHQpID8gJ05leHQgTW9udGgsICcgKyBmaXJzdFRvQ2FwKG1vbnRoc1thZGphY2VudEluZGV4XSkgKyAnICcgKyBjdXJyZW50WWVhciA6ICdQcmV2aW91cyBNb250aCwgJyArIGZpcnN0VG9DYXAobW9udGhzW2FkamFjZW50SW5kZXhdKSArICcgJyArIGN1cnJlbnRZZWFyO1xuXG4gICAgJChidXR0b24pLmZpbmQoJy51aS1pY29uJykuaHRtbChidXR0b25UZXh0KTtcblxuICB9XG5cbi8vIFJldHVybnMgdGhlIHN0cmluZyB3aXRoIHRoZSBmaXJzdCBsZXR0ZXIgY2FwaXRhbGl6ZWRcbiAgZnVuY3Rpb24gZmlyc3RUb0NhcChzKSB7XG4gICAgcmV0dXJuIHMuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzLnNsaWNlKDEpO1xuICB9XG5cbiAgc2V0dHVwQWNjZXNzaWJsZURhdGVpY2tlcigpO1xufSkoKTsiLCJjaXRpU2hhcmUuZGV0YWlsZWRMaXN0ID0gKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGZ1bmN0aW9uIF90YWJMaXN0S2V5UHJlc3MoZXZlbnQpIHtcbiAgICBpZiAoZXZlbnQud2hpY2ggPT09IDM3IHx8IGV2ZW50LndoaWNoID09PSAzOCB8fFxuICAgICAgKGV2ZW50LndoaWNoID09PSAzMyAmJiBldmVudC5jdHJsS2V5KSkgeyAvL2xlZnQvdXAvY3RybCtwYWdldXBcbiAgICAgIHZhciBwcmV2SXRlbSA9ICQoZXZlbnQuY3VycmVudFRhcmdldCkucHJldihcImxpXCIpO1xuICAgICAgaWYgKHByZXZJdGVtLmxlbmd0aCA+IDApIHtcbiAgICAgICAgX2ZvY3VzVGFiKHByZXZJdGVtKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vZ28gdG8gdGhlIGxhc3Qgb25lXG4gICAgICAgIHZhciBsYXN0SXRlbSA9ICQoZXZlbnQuY3VycmVudFRhcmdldCkuc2libGluZ3MoXCJsaVwiKS5sYXN0KCk7XG4gICAgICAgIF9mb2N1c1RhYihsYXN0SXRlbSk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChldmVudC53aGljaCA9PT0gMzkgfHwgZXZlbnQud2hpY2ggPT09IDQwIHx8XG4gICAgICAoZXZlbnQud2hpY2ggPT09IDM0ICYmIGV2ZW50LmN0cmxLZXkpKSB7IC8vcmlnaHQvZG93bi9jdHJsK3BhZ2Vkb3duXG4gICAgICB2YXIgbmV4dEl0ZW0gPSAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLm5leHQoXCJsaVwiKTtcbiAgICAgIGlmIChuZXh0SXRlbS5sZW5ndGggPiAwKSB7XG4gICAgICAgIF9mb2N1c1RhYihuZXh0SXRlbSk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvL2dvIHRvIHRoZSBmaXJzdCBvbmVcbiAgICAgICAgdmFyIGZpcnN0SXRlbSA9ICQoZXZlbnQuY3VycmVudFRhcmdldCkuc2libGluZ3MoXCJsaVwiKS5maXJzdCgpO1xuICAgICAgICBfZm9jdXNUYWIoZmlyc3RJdGVtKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH1cblxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF90YWJMaXN0Q2xpY2soZXZlbnQpIHtcbiAgICBfZm9jdXNUYWIoJChldmVudC5jdXJyZW50VGFyZ2V0KSk7XG4gIH1cblxuICBmdW5jdGlvbiBfZm9jdXNUYWIobmV3VGFiKSB7XG4gICAgLy8gSWRlbnRpZnkgZXhpc3RpbmcgZm9jdXMgdGFiIGFuZDogMSkgVW5zZXQgYXJpYS1zZWxlY3RlZCwgMikgc2V0IHRhYmluZGV4PS0xLCAzKSByZXBsYWNlXG4gICAgLy8gYWN0aXZlIGNsYXNzIHdpdGggaW5hY3RpdmUgb24gYm90aCB0aGUgdGFiIGFuZCB0aGUgcGFuZWwsIDQpIHNldCBhcmlhLWhpZGRlbiBvbiBwYW5lbFxuICAgIHZhciBhY3RpdmVUYWIgPSAkKCcudGFibGlzdC1wb2ludHMtaGVhZGVyID4gbGkuYWN0aXZlJyk7XG5cbiAgICBhY3RpdmVUYWJcbiAgICAgIC5hZGRDbGFzcyhcImluYWN0aXZlXCIpXG4gICAgICAucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIilcbiAgICAgIC5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCBcImZhbHNlXCIpXG4gICAgICAuYXR0cihcInRhYmluZGV4XCIsIFwiLTFcIik7XG5cbiAgICAkKFwiI1wiICsgYWN0aXZlVGFiLmF0dHIoXCJhcmlhLWNvbnRyb2xzXCIpKVxuICAgICAgLmFkZENsYXNzKFwiaW5hY3RpdmVcIilcbiAgICAgIC5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKVxuICAgICAgLmF0dHIoXCJhcmlhLWhpZGRlblwiLCBcInRydWVcIik7XG5cbiAgICAvLyBGb3IgbmV3bHkgZm9jdXNlZCB0YWI6IDEpIFNldCBhcmlhLXNlbGVjdGVkLCAyKSBzZXQgdGFiaW5kZXg9MCwgMykgcmVwbGFjZSBpbmFjdGl2ZSBjbGFzc1xuICAgIC8vIHdpdGggYWN0aXZlIG9uIGJvdGggdGFiIGFuZCBwYW5lbCwgNCkgdW5zZXQgYXJpYS1oaWRkZW4gb24gcGFuZWxcblxuICAgIG5ld1RhYlxuICAgICAgLmFkZENsYXNzKFwiYWN0aXZlXCIpXG4gICAgICAucmVtb3ZlQ2xhc3MoXCJpbmFjdGl2ZVwiKVxuICAgICAgLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsIFwidHJ1ZVwiKVxuICAgICAgLmF0dHIoXCJ0YWJpbmRleFwiLCBcIjBcIik7XG5cbiAgICAkKFwiI1wiICsgbmV3VGFiLmF0dHIoXCJhcmlhLWNvbnRyb2xzXCIpKVxuICAgICAgLmFkZENsYXNzKFwiYWN0aXZlXCIpXG4gICAgICAucmVtb3ZlQ2xhc3MoXCJpbmFjdGl2ZVwiKVxuICAgICAgLmF0dHIoXCJhcmlhLWhpZGRlblwiLCBcImZhbHNlXCIpO1xuXG4gICAgbmV3VGFiLmZvY3VzKCk7XG4gIH1cblxuICAvKipcbiAgICogT3BlbiBhIGRldGFpbGVkIGxpc3QgYmFzZWQgb24gdGhlIGhyZWYgb2YgdGhlIGxpbmsgc2VsZWN0ZWRcbiAgICogVGhlIGhyZWYgYXR0cmlidXRlIG9mIHRoZSBsaW5rIHNob3VsZCBtYXRjaCB0aGUgaWQgb2YgdGhlIGRldGFpbGVkIGxpc3QgY29udGFpbmVyXG4gICAqL1xuICBmdW5jdGlvbiBfdG9nZ2xlTGlzdCgpIHtcbiAgICAkKFwiLmRldGFpbGVkLWxpc3QtbGluazpub3QoW2RhdGEtYm91bmRlZD0ndHJ1ZSddKVwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBsaXN0TGluayA9ICQodGhpcyksXG4gICAgICAgIGxpc3RzVG9TaG93ID0gJChsaXN0TGluay5kYXRhKFwiYXR0YWNoZWQtbGlzdHNcIikpO1xuICAgICAgbGlzdExpbmsuYXR0cihcImRhdGEtYm91bmRlZFwiLCBcInRydWVcIik7XG5cbiAgICAgICQobGlzdExpbmspLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGlzdHNUb1Nob3cuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKCQodGhpcykuYXR0cihcImFyaWEtaGlkZGVuXCIpID09PSBcInRydWVcIikge1xuICAgICAgICAgICAgbGlzdExpbmsuZm9jdXMoKTtcbiAgICAgICAgICAgICQodGhpcykuc2hvdygpO1xuICAgICAgICAgICAgJChsaXN0TGluaykuZmluZChcInNwYW46Zmlyc3QtY2hpbGRcIikuYWRkQ2xhc3MoXCJ0dXJub3ZlclwiKTtcbiAgICAgICAgICAgICQobGlzdExpbmspLmF0dHIoXCJhcmlhLWV4cGFuZGVkXCIsIFwidHJ1ZVwiKTtcbiAgICAgICAgICAgICQodGhpcykuYXR0cihcImFyaWEtaGlkZGVuXCIsIFwiZmFsc2VcIik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBsaXN0RWxlbWVudCA9ICQodGhpcyksXG4gICAgICAgICAgICAgIGxpc3RFbGVtZW50U3ViTGlzdCA9IGxpc3RFbGVtZW50LmZpbmQoXCIuc3ViLWRldGFpbGVkLWxpc3RcIiksXG4gICAgICAgICAgICAgIGxpc3RFbGVtZW50TWluaSA9IGxpc3RFbGVtZW50LmZpbmQoXCIuZGV0YWlsZWQtbGlzdC1saW5rLW1pbmlcIik7XG5cbiAgICAgICAgICAgIGxpc3RFbGVtZW50LmhpZGUoKTtcbiAgICAgICAgICAgIGxpc3RFbGVtZW50LmF0dHIoXCJhcmlhLWhpZGRlblwiLCBcInRydWVcIik7XG5cbiAgICAgICAgICAgIGxpc3RFbGVtZW50U3ViTGlzdC5oaWRlKCk7XG4gICAgICAgICAgICBsaXN0RWxlbWVudFN1Ykxpc3QuYXR0cihcImFyaWEtaGlkZGVuXCIsIFwidHJ1ZVwiKTtcblxuICAgICAgICAgICAgJChsaXN0TGluaykuZmluZChcInNwYW46Zmlyc3QtY2hpbGRcIikucmVtb3ZlQ2xhc3MoXCJ0dXJub3ZlclwiKTtcbiAgICAgICAgICAgICQobGlzdExpbmspLmF0dHIoXCJhcmlhLWV4cGFuZGVkXCIsIFwiZmFsc2VcIik7XG5cbiAgICAgICAgICAgIGxpc3RFbGVtZW50TWluaS5hdHRyKFwiYXJpYS1leHBhbmRlZFwiLCBcImZhbHNlXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9pbml0VGFiUGFuZWwoKSB7XG4gICAgJCgnLnRhYmxpc3QtcG9pbnRzLWhlYWRlciA+IGxpJylcbiAgICAgIC5rZXlkb3duKF90YWJMaXN0S2V5UHJlc3MpXG4gICAgICAuY2xpY2soX3RhYkxpc3RDbGljayk7XG4gIH1cblxuICBfdG9nZ2xlTGlzdCgpO1xuICBfaW5pdFRhYlBhbmVsKCk7XG5cbiAgcmV0dXJuIHtcbiAgICB0b2dnbGVMaXN0OiBfdG9nZ2xlTGlzdFxuICB9O1xufSkoKTtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIEZBUXNTZWN0aW9uID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICB0aGlzLmZhcUFjY29yZGlvbiA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcignLmZhcXMtYWNjb3JkaW9uLXNlY3Rpb24gLmluZm9ybWF0aW9uLWFjY29yZGlvbicpO1xuXG4gIHRoaXMuX2luaXQoKTtcbn07XG5cbkZBUXNTZWN0aW9uLnByb3RvdHlwZS5faW5pdCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLl9jaGVja0ZvckV4cGFuZGVkQWNjb3JkaW9uKCk7XG59O1xuXG5GQVFzU2VjdGlvbi5wcm90b3R5cGUuX2NoZWNrRm9yRXhwYW5kZWRBY2NvcmRpb24gPSBmdW5jdGlvbigpIHtcbiAgdmFyIGF1dG9PcGVuTWVudTtcblxuICBpZih0aGlzLmZhcUFjY29yZGlvbikge1xuICAgIGF1dG9PcGVuTWVudSA9IHRoaXMuZmFxQWNjb3JkaW9uLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLW9wZW4tb25sb2FkPVwidHJ1ZVwiXScpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmKGF1dG9PcGVuTWVudSl7XG4gICAgdGhpcy5fb3BlbkFjY29yZGlvbk1lbnUoYXV0b09wZW5NZW51KTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLl9vcGVuQWNjb3JkaW9uTWVudSh0aGlzLmZhcUFjY29yZGlvbi5maXJzdEVsZW1lbnRDaGlsZCk7XG4gIH1cbn07XG5cbkZBUXNTZWN0aW9uLnByb3RvdHlwZS5fb3BlbkFjY29yZGlvbk1lbnUgPSBmdW5jdGlvbihwYXJlbnRFbGVtZW50KSB7XG4gIHZhciBmaXJzdEVsZW1lbnRIZWFkZXIgPSBwYXJlbnRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRpb24tdG9nZ2xlLWhlYWRlcicpO1xuICB2YXIgZmlyc3RFbGVtZW50Q29udGVudCA9IHBhcmVudEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmFjY29yZGlvblN1Yk1lbnUnKTtcblxuICBmaXJzdEVsZW1lbnRIZWFkZXIuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ3RydWUnKTtcbiAgZmlyc3RFbGVtZW50Q29udGVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpO1xuXG4gIGZpcnN0RWxlbWVudEhlYWRlci5jbGFzc0xpc3QuYWRkKCdleHBhbmRlZCcpO1xuICBmaXJzdEVsZW1lbnRDb250ZW50LmNsYXNzTGlzdC5hZGQoJ2V4cGFuZGVkJyk7XG5cbiAgZmlyc3RFbGVtZW50SGVhZGVyLmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWhpZGRlbicpO1xuICBmaXJzdEVsZW1lbnRDb250ZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWhpZGRlbicpO1xufTtcblxuRkFRc1NlY3Rpb24uaW5pdCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgZmFxc0VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZmFxcycpO1xuXG4gIGlmIChmYXFzRWxlbWVudCkge1xuICAgIHJldHVybiBuZXcgRkFRc1NlY3Rpb24oZmFxc0VsZW1lbnQpO1xuICB9XG59O1xuXG5jaXRpU2hhcmUuZmFxc1NlY3Rpb24gPSAoZnVuY3Rpb24oKSB7XG4gIEZBUXNTZWN0aW9uLmluaXQoKTtcbn0pKCk7XG4iLCIvKmpzaGludCB1bnVzZWQ6ZmFsc2UsIHN1Yjp0cnVlKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBfdG9BcnJheShhcnJheUxpa2UpIHtcbiAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycmF5TGlrZSk7XG59XG5cbnZhciBGaWx0ZXJUYWJzID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICAvKipcbiAgICogQmFzZSBlbGVtZW50XG4gICAqIEB0eXBlIHtFbGVtZW50fVxuICAgKi9cbiAgdGhpcy5fZWxlbWVudCA9IGVsZW1lbnQ7XG5cbiAgLyoqXG4gICAqIEJhc2UgZWxlbWVudFxuICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgKi9cbiAgdGhpcy4kZWwgPSAkKGVsZW1lbnQpO1xuXG4gIC8qKlxuICAgKiBGaWx0ZXIgdGFic1xuICAgKiBAdHlwZSB7QXJyYXl9XG4gICAqL1xuICB0aGlzLl8kdGFicyA9ICQoJy4nICsgRmlsdGVyVGFicy5DbGFzc05hbWUuVEFCUyk7XG5cbiAgLyoqXG4gICAqIEZpbHRlciB0YWJzXG4gICAqIEB0eXBlIHtBcnJheX1cbiAgICovXG4gIHRoaXMuX3RhYnMgPSBfdG9BcnJheSh0aGlzLl8kdGFicyk7XG5cbiAgLyoqXG4gICAqIEFuY2hvcnMgZWxlbWVudHMgd2l0aGluIHRhYnNcbiAgICogQHR5cGUge0FycmF5fVxuICAgKi9cbiAgdGhpcy5fJGFuY2hvcnMgPSAkKCcuJyArIEZpbHRlclRhYnMuQ2xhc3NOYW1lLkFOQ0hPUik7XG5cbiAgLyoqXG4gICAqIEZpbHRlciBEcm9wZG93bnNcbiAgICogQHR5cGUge0FycmF5fVxuICAgKi9cbiAgdGhpcy5fJGZpbHRlcnMgPSAkKCcuZmlsdGVyLW1lbnUtd3JhcHBlciAnICsgJy4nICsgRmlsdGVyVGFicy5DbGFzc05hbWUuRklMVEVSX0REKTtcblxuICB0aGlzLl9jbGlja0xpc3RlbmVyID0gdGhpcy5faGFuZGxlQ2xpY2tFdmVudC5iaW5kKHRoaXMpO1xuICB0aGlzLl9yZXNpemVMaXN0ZW5lciA9IHRoaXMuX2hhbmRsZVJlc2l6ZS5iaW5kKHRoaXMpO1xuICB0aGlzLl9rZXlkb3duTGlzdGVuZXIgPSB0aGlzLl9oYW5kbGVLZXlQcmVzcy5iaW5kKHRoaXMpO1xuXG4gIHRoaXMuX2lzTW9iaWxlID0gZmFsc2U7XG4gIHRoaXMuX2lzRGVza3RvcCA9IGZhbHNlO1xuICB0aGlzLl9hY3RpdmVUYWIgPSBudWxsO1xuXG4gIHRoaXMuX3dpZHRoQ2xhc3MgPSAnb3B0aW9ucy01JztcblxuICB0aGlzLl9pbml0KCk7XG59O1xuXG4vKipcbiAqIEluaXRpYWxpemVzIHRoZSBmaWx0ZXJUYWJzIGNvbXBvbmVudFxuICovXG5GaWx0ZXJUYWJzLnByb3RvdHlwZS5faW5pdCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLl9wcm9jZXNzVGFicygpO1xuICB0aGlzLl9oYW5kbGVSZXNpemUoKTtcbiAgdGhpcy5fYmluZEV2ZW50cygpO1xuXG4gIC8vaGFyZC1jb2RlZCBmaXJzdCB2YWx1ZVxuICB0aGlzLl9hY3RpdmVUYWIgPSB0aGlzLl8kdGFicy5lcSgwKVswXTtcbiAgJCh0aGlzLl9hY3RpdmVUYWIpLmFkZENsYXNzKCdmaWx0ZXItdGFicy10YWItLWFjdGl2ZScpO1xuICB0aGlzLl9nZXRGaWx0ZXJMaXN0KCk7XG59O1xuXG4vKipcbiAqIEFkZHMgYXJpYSBzdGF0ZXMgZm9yIHNjcmVlbiByZWFkZXJzXG4gKi9cbkZpbHRlclRhYnMucHJvdG90eXBlLl9wcm9jZXNzVGFicyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLiRlbC5hdHRyKCdyb2xlJywgJ3RhYmxpc3QnKTtcblxuICB0aGlzLl8kdGFicy5hdHRyKHtcbiAgICByb2xlOiAndGFiJyxcbiAgICB0YWJJbmRleDogMFxuICB9KTtcblxuICB0aGlzLl8kYW5jaG9ycy5hdHRyKHtcbiAgICB0YWJJbmRleDogLTEsXG4gICAgJ2FyaWEtc2VsZWN0ZWQnOiBmYWxzZVxuICB9KTtcbn07XG5cbi8qKlxuICogQmluZHMgd2luZG93LCBjbGljaywgYW5kIGtleXByZXNzIGV2ZW50cyB0byB0YWJzXG4gKi9cbkZpbHRlclRhYnMucHJvdG90eXBlLl9iaW5kRXZlbnRzID0gZnVuY3Rpb24oKSB7XG4gICQod2luZG93KS5vbigncmVzaXplLmZpbHRlclRhYnMgb3JpZW50YXRpb25jaGFuZ2UuZmlsdGVyVGFicycsIHRoaXMuX3Jlc2l6ZUxpc3RlbmVyKTtcbiAgdGhpcy5fJHRhYnMub24oJ2NsaWNrLmZpbHRlclRhYnMnLCB0aGlzLl9jbGlja0xpc3RlbmVyKTtcbiAgdGhpcy5fJHRhYnMub24oJ2tleWRvd24uZmlsdGVyVGFicycsIHRoaXMuX2tleWRvd25MaXN0ZW5lcik7XG59O1xuXG4vKipcbiAqIFJlZ2lzdGVycyB0aGUgYWN0aXZlIHRhYlxuICogQHBhcmFtIHtFdmVudH0gZSBqUXVlcnkgRXZlbnRcbiAqL1xuRmlsdGVyVGFicy5wcm90b3R5cGUuX2hhbmRsZUNsaWNrRXZlbnQgPSBmdW5jdGlvbihlKSB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcblxuICBpZiAodGhpcy5fYWN0aXZlVGFiICE9PSBlLmN1cnJlbnRUYXJnZXQpIHtcbiAgICBpZiAodGhpcy5fYWN0aXZlVGFiICE9PSBudWxsKSB7XG4gICAgICAkKHRoaXMuX2FjdGl2ZVRhYikucmVtb3ZlQ2xhc3MoJ2ZpbHRlci10YWJzLXRhYi0tYWN0aXZlJyk7XG4gICAgfVxuXG4gICAgY2l0aVNoYXJlLmZpbHRlck1lbnUuY2xlYXJBbGxGaWx0ZXJzKCk7XG5cbiAgICB0aGlzLl9hY3RpdmVUYWIgPSBlLmN1cnJlbnRUYXJnZXQ7XG4gICAgJCh0aGlzLl9hY3RpdmVUYWIpLmFkZENsYXNzKCdmaWx0ZXItdGFicy10YWItLWFjdGl2ZScpO1xuICAgIHRoaXMuX2dldEZpbHRlckxpc3QoKTtcbiAgfVxufTtcblxuLyoqXG4gKiBSZWdpc3RlcnMgdGhlIGFjdGl2ZSB0YWIgb24gYEVOVEVSYCBrZXlwcmVzc1xuICogYW5kIG1vdmUgYmV0d2VlbiB0YWJzIG9uIGBMRUZUYCBvciBgUklHSFRgIGtleXByZXNzXG4gKiBAcGFyYW0ge0V2ZW50fSBlIGpRdWVyeSBFdmVudFxuICovXG5GaWx0ZXJUYWJzLnByb3RvdHlwZS5faGFuZGxlS2V5UHJlc3MgPSBmdW5jdGlvbihlKSB7XG5cbiAgdmFyIGZvY3VzZWRUYWIgPSB0aGlzLl9jbGFtcCh0aGlzLl9nZXRGb2N1c2VkVGFiSW5kZXgoKSk7XG5cbiAgc3dpdGNoKGUud2hpY2gpIHtcbiAgICBjYXNlIEZpbHRlclRhYnMuS2V5cy5FTlRFUjpcbiAgICAgIHRoaXMuX2hhbmRsZUNsaWNrRXZlbnQoZSk7XG4gICAgICBicmVhaztcblxuICAgIGNhc2UgRmlsdGVyVGFicy5LZXlzLkxFRlQ6XG4gICAgICBmb2N1c2VkVGFiLS07XG4gICAgICB0aGlzLl9mb2N1c1RhYihmb2N1c2VkVGFiKTtcbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSBGaWx0ZXJUYWJzLktleXMuUklHSFQ6XG4gICAgICBmb2N1c2VkVGFiKys7XG4gICAgICB0aGlzLl9mb2N1c1RhYihmb2N1c2VkVGFiKTtcbiAgICAgIGJyZWFrO1xuICB9XG59O1xuXG4vKipcbiAqIEZvY3VzIG9uIGEgdGFiLlxuICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IFRhYiBpbmRleCB0byBmb2N1cyBvbi5cbiAqL1xuRmlsdGVyVGFicy5wcm90b3R5cGUuX2ZvY3VzVGFiID0gZnVuY3Rpb24oaW5kZXgpIHtcbiAgdGhpcy5fJHRhYnMuZXEoaW5kZXgpLmZvY3VzKCk7XG59O1xuXG4vKipcbiAqIENsYW1wIGEgdmFsdWUgYmV0d2VlbiB2YWxpZCBpbmRleGVzIG9mIHRoZSB0YWJzLlxuICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IEluZGV4IHRvIGNsYW1wLlxuICogQHJldHVybiB7bnVtYmVyfSBDbGFtcGVkIGluZGV4LlxuICovXG5GaWx0ZXJUYWJzLnByb3RvdHlwZS5fY2xhbXAgPSBmdW5jdGlvbihpbmRleCkge1xuICByZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgoaW5kZXgsIDApLCB0aGlzLl90YWJzLmxlbmd0aCAtIDEpO1xufTtcblxuLyoqXG4gKiBGaW5kIHRoZSBpbmRleCBvZiB0aGUgY3VycmVudGx5IGZvY3VzZWQgdGFiLlxuICogQHJldHVybiB7bnVtYmVyfVxuICovXG5GaWx0ZXJUYWJzLnByb3RvdHlwZS5fZ2V0Rm9jdXNlZFRhYkluZGV4ID0gZnVuY3Rpb24oKSB7XG4gIHZhciAkZm9jdXNlZFRhYiA9ICQoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkuY2xvc2VzdCgnLicgKyBGaWx0ZXJUYWJzLkNsYXNzTmFtZS5UQUJTKTtcbiAgcmV0dXJuIHRoaXMuXyR0YWJzLmluZGV4KCRmb2N1c2VkVGFiKTtcbn07XG5cbi8qKlxuICogR2V0cyB0aGUgbmFtZSBvZiBmaWx0ZXJzIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWN0aXZlIHRhYlxuICovXG5GaWx0ZXJUYWJzLnByb3RvdHlwZS5fZ2V0RmlsdGVyTGlzdCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgZmlsdGVycyA9IHRoaXMuX2FjdGl2ZVRhYi5nZXRBdHRyaWJ1dGUoJ2RhdGEtZmlsdGVycycpO1xuICB0aGlzLl9maWx0ZXJzTGlzdCA9IGZpbHRlcnMuc3BsaXQoJywnKTtcbiAgdGhpcy5fZGV0ZXJtaW5lQWN0aXZlRmlsdGVycygpO1xufTtcblxuLyoqXG4gKiBTaG93cyB0aGUgZmlsdGVycyBhc3NvY2lhdGVkIHdpdGggdGhlIGFjdGl2ZSB0YWIsIGFuZCBoaWRlc1xuICogdGhlIHJlc3RcbiAqL1xuRmlsdGVyVGFicy5wcm90b3R5cGUuX2RldGVybWluZUFjdGl2ZUZpbHRlcnMgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5fJGZpbHRlcnMuZWFjaCh0aGlzLl9oaWRlRmlsdGVycy5iaW5kKHRoaXMpKTtcbiAgdGhpcy5fc2V0V2lkdGhDbGFzcygpO1xuICB0aGlzLl9maWx0ZXJzTGlzdC5mb3JFYWNoKHRoaXMuX3NldEFjdGl2ZUZpbHRlci5iaW5kKHRoaXMpKTtcbn07XG5cbi8qKlxuICogSGlkZXMgZmlsdGVyIGRyb3Bkb3duIGFuZCBidXR0b25cbiAqIEBwYXJhbSB7TnVtYmVyfSBpIEluZGV4IG9mIGZpbHRlciBpbiBhcnJheVxuICogQHBhcmFtIHtFbGVtZW50fSBlbCBGaWx0ZXIgZHJvcGRvd24gRE9NIEVsZW1lbnRcbiAqL1xuRmlsdGVyVGFicy5wcm90b3R5cGUuX2hpZGVGaWx0ZXJzID0gZnVuY3Rpb24oaSwgZWwpIHtcbiAgdmFyICRlbCA9ICQoZWwpO1xuICB2YXIgYnV0dG9uID0gJCgkZWwubmV4dCgnYnV0dG9uJylbMF0pO1xuICBidXR0b24uYWRkQ2xhc3MoJ2lzLWhpZGRlbicpO1xuICBidXR0b24uYXR0cignYXJpYS1oaWRkZW4nLCB0cnVlKTtcbiAgYnV0dG9uLnJlbW92ZUNsYXNzKHRoaXMuX3dpZHRoQ2xhc3MpO1xufTtcblxuLyoqXG4gKiBTZXRzIGFuIGFjdGl2ZSBmaWx0ZXJcbiAqIEBwYXJhbSB7c3RyaW5nfSBmaWx0ZXIgRmlsdGVyIGlkXG4gKi9cbkZpbHRlclRhYnMucHJvdG90eXBlLl9zZXRBY3RpdmVGaWx0ZXIgPSBmdW5jdGlvbihmaWx0ZXIpIHtcbiAgdmFyIGVsID0gX3RvQXJyYXkodGhpcy5fJGZpbHRlcnMpLmZpbHRlcihmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgcmV0dXJuIGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJykgPT09IGZpbHRlcjtcbiAgfSlbMF07XG5cbiAgdmFyIGVsSW5kZXggPSB0aGlzLl8kZmlsdGVycy5pbmRleChlbCk7XG5cbiAgdmFyICRmaWx0ZXJFbCA9IHRoaXMuXyRmaWx0ZXJzLmVxKGVsSW5kZXgpLm5leHQoJ2J1dHRvbicpWzBdO1xuICAkZmlsdGVyRWwgPSAkKCRmaWx0ZXJFbCk7XG4gICRmaWx0ZXJFbC5yZW1vdmVDbGFzcygnaXMtaGlkZGVuJyk7XG4gICRmaWx0ZXJFbC5hdHRyKCdhcmlhLWhpZGRlbicsIGZhbHNlKTtcbiAgJGZpbHRlckVsLmFkZENsYXNzKHRoaXMuX3dpZHRoQ2xhc3MpO1xufTtcblxuLyoqXG4gKiBDcmVhdGVzIHdpZHRoIGNsYXNzIGJhc2VkIG9uIHRoZSBudW1iZXIgb2YgYWN0aXZlIGZpbHRlcnNcbiAqL1xuRmlsdGVyVGFicy5wcm90b3R5cGUuX3NldFdpZHRoQ2xhc3MgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5fd2lkdGhDbGFzcyA9IEZpbHRlclRhYnMuQ2xhc3NOYW1lLldJRFRIX0NMQVNTICsgJy0nICsgdGhpcy5fZmlsdGVyc0xpc3QubGVuZ3RoO1xufTtcblxuLyoqXG4gKiBFbnF1aXJlLWVzcXVlIHJlc2l6ZSBldmVudHNcbiAqL1xuRmlsdGVyVGFicy5wcm90b3R5cGUuX2hhbmRsZVJlc2l6ZSA9IGZ1bmN0aW9uKCkge1xuICB2YXIgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCB3aW5kb3dXaWR0aDtcblxuICAvLyBpZiB0aGlzIGlzIG1vYmlsZVxuICBpZiAod2luZG93V2lkdGggPD0gd2luZG93LmNpdGlDb25maWcudGFibGV0QnJlYWtwb2ludCkge1xuICAgIC8vaWYgd2UgcmVzaXplZCBmcm9tIGRlc2t0b3BcbiAgICBpZiAoIXRoaXMuX2lzTW9iaWxlKSB7XG4gICAgICB0aGlzLl9pc01vYmlsZSA9IHRydWU7XG4gICAgICB0aGlzLl9pc0Rlc2t0b3AgPSBmYWxzZTtcbiAgICAgIHRoaXMuX2NhbGN1bGF0ZU1vYmlsZVdpZHRoKCk7XG4gICAgfVxuICB9XG5cbiAgLy9pZiB0aGlzIGlzIGRlc2t0b3BcbiAgaWYgKHdpbmRvd1dpZHRoID4gd2luZG93LmNpdGlDb25maWcudGFibGV0QnJlYWtwb2ludCkge1xuICAgIC8vaWYgd2UgcmVzaXplZCBmcm9tIG1vYmlsZVxuICAgIGlmICghdGhpcy5faXNEZXNrdG9wKSB7XG4gICAgICB0aGlzLl9pc0Rlc2t0b3AgPSB0cnVlO1xuICAgICAgdGhpcy5faXNNb2JpbGUgPSBmYWxzZTtcbiAgICAgIHRoaXMuX3JlbW92ZU1vYmlsZVdpZHRoKCk7XG4gICAgfVxuXG4gICAgLypcbiAgICAgKiBOb3RlIEBldmFuOiBGb3Igc29tZSByZWFzb24sIHdpbmRvdyByZXNpemVzIGFyZSB0cmlnZ2VyZWQgYnkgRE9NIGVsZW1lbnRzXG4gICAgICogc28gd2UgbmVlZCB0byByZWNvbmZpZ3VyZSB0aGUgRE9NIHRvIGRpc3BsYXkgdGhlIGFjdGl2ZSB0YWIgKyBmaWx0ZXJzXG4gICAgICovXG4gICAgaWYgKHRoaXMuX2FjdGl2ZVRhYiAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5fZ2V0RmlsdGVyTGlzdCgpO1xuICAgIH1cbiAgfVxufTtcblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRhYnMgY29udGFpbmVyIHdpZHRoIG9uIG1vYmlsZVxuICovXG5GaWx0ZXJUYWJzLnByb3RvdHlwZS5fY2FsY3VsYXRlTW9iaWxlV2lkdGggPSBmdW5jdGlvbigpIHtcbiAgdmFyIHRvdGFsV2lkdGggPSAwO1xuICB0aGlzLl90YWJzLmZvckVhY2goZnVuY3Rpb24oZWwpIHtcbiAgICB0b3RhbFdpZHRoICs9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xuICB9KTtcblxuICB0aGlzLl9lbGVtZW50LnN0eWxlLndpZHRoID0gTWF0aC5jZWlsKHRvdGFsV2lkdGgpICsgJ3B4Jztcbn07XG5cbi8qKlxuICogUmVtb3ZlcyB3aWR0aCBzdHlsZSBwcm9wZXJ0eVxuICovXG5GaWx0ZXJUYWJzLnByb3RvdHlwZS5fcmVtb3ZlTW9iaWxlV2lkdGggPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5fZWxlbWVudC5zdHlsZS53aWR0aCA9ICcnO1xufTtcblxuXG5GaWx0ZXJUYWJzLkNsYXNzTmFtZSA9IHtcbiAgQkFTRTogJ2ZpbHRlci10YWJzJyxcbiAgVEFCUzogJ2ZpbHRlci10YWJzLXRhYicsXG4gIEFOQ0hPUjogJ2ZpbHRlci10YWJzLWFuY2hvcicsXG4gIEZJTFRFUl9ERDogJ2Ryb3Bkb3duJyxcbiAgV0lEVEhfQ0xBU1M6ICdvcHRpb25zJ1xufTtcblxuRmlsdGVyVGFicy5FdmVudHMgPSB7XG4gIFJFTkRFUkVEOiAnZmlsdGVyVGFiczo6cmVuZGVyZWQnLFxufTtcblxuRmlsdGVyVGFicy5LZXlzID0ge1xuICBFTlRFUjogMTMsXG4gIExFRlQ6IDM3LFxuICBSSUdIVDogMzksXG59O1xuXG5mdW5jdGlvbiBfY3JlYXRlRmlsdGVyVGFicygpIHtcbiAgX3RvQXJyYXkoJCgnLmZpbHRlci10YWJzJykpLmZvckVhY2goZnVuY3Rpb24oZWwpIHtcbiAgICByZXR1cm4gbmV3IEZpbHRlclRhYnMoZWwpO1xuICB9KTtcbn1cblxuRmlsdGVyVGFicy5pbml0aWFsaXplQWxsID0gZnVuY3Rpb24oKSB7XG4gICQod2luZG93KS5vbihGaWx0ZXJUYWJzLkV2ZW50cy5SRU5ERVJFRCwgZnVuY3Rpb24oKSB7XG4gICAgX2NyZWF0ZUZpbHRlclRhYnMoKTtcbiAgfSk7XG59O1xuXG5cbmNpdGlTaGFyZS5maWx0ZXJUYWJzID0gKGZ1bmN0aW9uKCl7XG5cbiAgRmlsdGVyVGFicy5pbml0aWFsaXplQWxsKCk7XG5cbiAgcmV0dXJuIHtcbiAgICBpbml0QWxsOiBGaWx0ZXJUYWJzLmluaXRpYWxpemVBbGwsXG4gICAgRXZlbnRzOiBGaWx0ZXJUYWJzLkV2ZW50cyxcbiAgICBDbGFzc05hbWU6IEZpbHRlclRhYnMuQ2xhc3NOYW1lXG4gIH07XG5cbn0pKCk7XG4iLCIvKipcbiAqIEpTSGludDpcbiAqIFRvIGFsbG93IGJyYWNrZXQgbm90YXRpb24sXG4gKiBGb3IgZXhhbXBsZSwgdGVzdFtcInBsYWNlaG9sZGVyXCJdIHZzIHRlc3QucGxhY2Vob2xkZXJcbiAqL1xuXG4vKmpzaGludCB1bnVzZWQ6ZmFsc2UsIHN1Yjp0cnVlKi9cblxuY2l0aVNoYXJlLmZpbHRlck1lbnUgPSAoZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgdGFnU3RvcmUgPSBbXTtcbiAgdmFyICRmaWx0ZXJCdXR0b24gPSAkKCcuYnRuLXNob3ctZmlsdGVycycpO1xuICB2YXIgJHNvcnRCdXR0b24gPSAkKCcuYnRuLXNob3ctc29ydCcpO1xuICB2YXIgJG9jQ29udGFpbmVyID0gJCgnLm9jLWNvbnRhaW5lcicpO1xuICB2YXIgaXNTb3J0VmlzaWJsZSA9IGZhbHNlO1xuICB2YXIgaXNGaWx0ZXJzVmlzaWJsZSA9IGZhbHNlO1xuICB2YXIgY291bnRlclNvcnQgPSAwO1xuICB2YXIgc2Nyb2xsUG9pbnQgPSAwO1xuICB2YXIgcHJldmlvdXNTY3JvbGwgPSAwO1xuICB2YXIgd2lkdGhVbmRlclRhYmxldCA9IGZhbHNlO1xuXG4gIGZ1bmN0aW9uIG9wZW5GaWx0ZXJEcm9wZG93bigkZmlsdGVyTWVudSkge1xuICAgIGNsb3NlRmlsdGVyRHJvcGRvd24oKTtcblxuICAgIC8vY2hlY2sgaWYgZmlsdGVyTWVudSBoYXMgY2hlY2tlZFxuICAgIHZhciBjaGVja2VkID0gJGZpbHRlck1lbnUuY2xvc2VzdCgnLm11bHRpc2VsZWN0LWRyb3Bkb3duJylcbiAgICAgIC5hZGRDbGFzcygnaXMtb3BlbicpXG4gICAgICAuZmluZChcIi5qcy1tdWx0aXNlbGVjdC1kcm9wZG93bi1vcHRpb25bYXJpYS1jaGVja2VkJD0ndHJ1ZSddXCIpLmxlbmd0aDtcblxuICAgIGlmIChjaGVja2VkIDw9IDApIHtcbiAgICAgICRmaWx0ZXJNZW51LmNsb3Nlc3QoJy5tdWx0aXNlbGVjdC1kcm9wZG93bicpXG4gICAgICAgIC5hZGRDbGFzcygnaXMtb3BlbicpXG4gICAgICAgIC5maW5kKCcuanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tb3B0aW9ucy13cmFwcGVyIGlucHV0JykuZmlyc3QoKVxuICAgICAgICAuY2xpY2soKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGZpbHRlck1lbnUuY2xvc2VzdCgnLm11bHRpc2VsZWN0LWRyb3Bkb3duJylcbiAgICAgICAgLmFkZENsYXNzKCdpcy1vcGVuJylcbiAgICAgICAgLmZpbmQoXCIuanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tb3B0aW9uW2FyaWEtY2hlY2tlZCQ9J3RydWUnXVwiKVxuICAgICAgICAuZmluZCgnaW5wdXQnKVxuICAgICAgICAuZm9jdXMoKTtcbiAgICB9XG5cbiAgICAkKCcuZmlsdGVyLXdyYXBwZXInKS5hZGRDbGFzcygnbGV2ZWwtdHdvLW1lbnUtb3BlbicpO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xvc2VGaWx0ZXJEcm9wZG93bigkZmlsdGVyTWVudSkge1xuICAgICQoJy5tdWx0aXNlbGVjdC1kcm9wZG93bicpLnJlbW92ZUNsYXNzKCdpcy1vcGVuJyk7XG5cbiAgICBpZiAoJGZpbHRlck1lbnUpIHtcbiAgICAgICRmaWx0ZXJNZW51LmZvY3VzKCk7XG4gICAgfVxuICAgICQoJy5maWx0ZXItd3JhcHBlcicpLnJlbW92ZUNsYXNzKCdsZXZlbC10d28tbWVudS1vcGVuJyk7XG4gIH1cblxuICAvLyBPUEVOIE9WRVJMQVkgRk9SIFNIT1cgRklMVEVSUyAtIFNIT1cgRklMVEVSUyBTRUVNUyBUTyBCRSBUSEUgRFJPUERPV04gV0lUSCBNVUxUSVBMRSBTRUxFQ1RcbiAgLy8gSGlkZSB0aGUgYm9keSAtIHByZXBlbmQgb3ZlcmxheSBvdXRzaWRlIGJvZHkgLSBzaG93IHRoZSBvdmVybGF5XG4gIGZ1bmN0aW9uIG9wZW5Nb2JpbGVGaWx0ZXJNZW51KGV2KSB7XG4gICAgLy9UaGlzIGlzIHRoZSBzZWxlY3QgYnV0dG9uXG4gICAgdmFyICR0aGlzID0gJChldi5nZXQoMCkpO1xuICAgICR0aGlzLmF0dHIoJ2RhdGEtb3ZlcmxheS1pcy12aXNpYmxlJywgJ3RydWUnKTtcbiAgICAvL0dldCB0aGUgZ29vZCBmaWx0ZXIgd3JhcHBlciB0aGUgZGl2IGp1c3QgYWZ0ZXIgdGhlIHRhcmdldCBvZiB0aGUgY2xpY2tcbiAgICB2YXIgdGhpc0ZpbHRlcldyYXBwZXIgPSAkdGhpcy5uZXh0KCcuZmlsdGVyLXdyYXBwZXInKTtcbiAgICAvLyBtb3ZlIG91dCBvZiB0aGUgcGFnZSBmbG93IHNvIHRoYXQgd2UgY2FuIGhpZGUgdGhlIHJlc3Qgb2YgdGhlIHBhZ2VcbiAgICB0aGlzRmlsdGVyV3JhcHBlci5wcmVwZW5kVG8oJ2JvZHknKTtcbiAgICAvL0Rpc3BsYXkgdGhlIG92ZXJsYXlcbiAgICB0aGlzRmlsdGVyV3JhcHBlci5hZGRDbGFzcygnc2hvdy1maWx0ZXJzJyk7XG4gICAgLy9QdXQgdGhlIGZvY3VzIG9uIHRoZSBjbG9zZSBzaWduIGluIHRoZSBvdmVybGF5XG4gICAgdGhpc0ZpbHRlcldyYXBwZXIuZmluZCgnLnN1Yi1uYXYtY2xvc2UnKS5mb2N1cygpO1xuICAgIC8vSGlkZSB0aGUgYm9keSBkaXZcbiAgICAkb2NDb250YWluZXIuYWRkQ2xhc3MoJ2lzLWhpZGRlbicpO1xuICAgIGlzRmlsdGVyc1Zpc2libGUgPSB0cnVlO1xuICB9XG5cbiAgLy8gQ0xPU0UgT1ZFUkxBWSBGT1IgU0hPVyBGSUxURVJTXG4gIGZ1bmN0aW9uIGNsb3NlTW9iaWxlRmlsdGVyTWVudShldikge1xuICAgIC8vJHRoaXMgaXMgdGhlIGNsb3NlIGJ1dHRvblxuICAgIHZhciAkdGhpcyA9ICQoZXYuZ2V0KDApKTtcbiAgICAvL0dldCB0aGUgZmlsdGVyIHdyYXBwZXIgbGlua2VkIHRvIHRoZSBidXR0b24gY2xpY2tlZCwgdGhlIGRpdiBqdXN0IGFmdGVyIHRoZSB0YXJnZXQgb2YgdGhlIGNsaWNrXG4gICAgdmFyIHRoaXNGaWx0ZXJXcmFwcGVyID0gJHRoaXMuY2xvc2VzdCgnLmZpbHRlci13cmFwcGVyJyk7XG4gICAgLy9EaXNwbGF5IG5vbmUgdGhlIG92ZXJsYXlcbiAgICB0aGlzRmlsdGVyV3JhcHBlci5yZW1vdmVDbGFzcygnc2hvdy1maWx0ZXJzJyk7XG4gICAgdmFyIGNsaWNrZWRCdXR0b24gPSAnW2RhdGEtb3ZlcmxheS1pcy12aXNpYmxlPVwidHJ1ZVwiXSc7XG4gICAgLy9SZS1pbnNlcnQgdGhlIGZpbHRlciB3cmFwIHdoZXJlIGl0IGNhbWUgKHVuZGVyIHRoZSBidXR0b24ganMtc2hvdy1zb3J0KVxuICAgIHRoaXNGaWx0ZXJXcmFwcGVyLmluc2VydEFmdGVyKGNsaWNrZWRCdXR0b24pO1xuICAgIC8vSGlkZSB0aGUgYm9keSBkaXZcbiAgICAkb2NDb250YWluZXIucmVtb3ZlQ2xhc3MoJ2lzLWhpZGRlbicpO1xuICAgIC8vRm9jdXMgYmFjayBvbiB0aGUgYnV0dG9uIGNsaWNrZWQgYmVmb3JlIHRoZSBvcGVuaW5nIG9mIHRoZSBvdmVybGF5XG4gICAgY2xvc2VGaWx0ZXJEcm9wZG93bigkKGNsaWNrZWRCdXR0b24pKTtcbiAgICAvL0RhdGEgdGhhdCBzaWduYWwgdGhlIG92ZXJsYXkgaXMgY2xvc2UgZm9yIHRoaXMgYnV0dG9uXG4gICAgJCgnLmpzLXNob3ctc29ydCcpLmF0dHIoJ2RhdGEtb3ZlcmxheS1pcy12aXNpYmxlJywgJ2ZhbHNlJyk7XG4gICAgaXNGaWx0ZXJzVmlzaWJsZSA9IGZhbHNlO1xuICAgIC8vU2Nyb2xsIHRvIHRoZSBwb3NpdGlvbiBiZWZvcmUgdGhlIG92ZXJsYXkgd2FzIG9wZW5cbiAgICAkKHdpbmRvdykuc2Nyb2xsVG9wKHNjcm9sbFBvaW50KTtcbiAgfVxuXG5cbiAgLy8gT1BFTiBPVkVSTEFZIE1PQklMRSAtIEhpZGUgdGhlIGJvZHkgLSBwcmVwZW5kIG92ZXJsYXkgb3V0c2lkZSBib2R5IC0gc2hvdyB0aGUgb3ZlcmxheVxuICBmdW5jdGlvbiBvcGVuTW9iaWxlU29ydE1lbnUoZXYpIHtcbiAgICAvL1RoaXMgaXMgdGhlIHNlbGVjdCBidXR0b25cbiAgICB2YXIgJHRoaXMgPSAkKGV2LmdldCgwKSk7XG4gICAgJHRoaXMuYXR0cignZGF0YS1vdmVybGF5LWlzLXZpc2libGUnLCAndHJ1ZScpO1xuICAgIC8vR2V0IHRoZSBnb29kIGZpbHRlciB3cmFwcGVyIHRoZSBkaXYganVzdCBhZnRlciB0aGUgdGFyZ2V0IG9mIHRoZSBjbGlja1xuICAgIHZhciB0aGlzRmlsdGVyV3JhcHBlciA9ICR0aGlzLm5leHQoJy5maWx0ZXItd3JhcHBlcicpO1xuICAgIC8vIG1vdmUgb3V0IG9mIHRoZSBwYWdlIGZsb3cgc28gdGhhdCB3ZSBjYW4gaGlkZSB0aGUgcmVzdCBvZiB0aGUgcGFnZVxuICAgIHRoaXNGaWx0ZXJXcmFwcGVyLnByZXBlbmRUbygnYm9keScpO1xuICAgIC8vRGlzcGxheSB0aGUgb3ZlcmxheVxuICAgIHRoaXNGaWx0ZXJXcmFwcGVyLmFkZENsYXNzKCdzaG93LXNvcnQnKTtcbiAgICAvL1B1dCB0aGUgZm9jdXMgb24gdGhlIGNsb3NlIHNpZ24gaW4gdGhlIG92ZXJsYXlcbiAgICB0aGlzRmlsdGVyV3JhcHBlci5maW5kKCcuc3ViLW5hdi1jbG9zZScpLmZvY3VzKCk7XG4gICAgdGhpc0ZpbHRlcldyYXBwZXIuZmluZCgnLnNvcnQtbWVudS1pdGVtJykuYWRkQ2xhc3MoJ3NvcnQtaXMtb3BlbicpO1xuICAgIC8vSGlkZSB0aGUgYm9keSBkaXZcbiAgICAkb2NDb250YWluZXIuYWRkQ2xhc3MoJ2lzLWhpZGRlbicpO1xuICAgIGlzU29ydFZpc2libGUgPSB0cnVlO1xuICB9XG5cblxuICAvLyBDTE9TRSBUSEUgTU9CSUxFIE9WRVJMQVkgb24gY2xpY2tcbiAgZnVuY3Rpb24gY2xvc2VNb2JpbGVTb3J0TWVudShldikge1xuICAgIC8vJHRoaXMgaXMgdGhlIGNsb3NlIGJ1dHRvblxuICAgIHZhciAkdGhpcyA9ICQoZXYuZ2V0KDApKTtcbiAgICAvL0dldCB0aGUgZmlsdGVyIHdyYXBwZXIgbGlua2VkIHRvIHRoZSBidXR0b24gY2xpY2tlZCwgdGhlIGRpdiBqdXN0IGFmdGVyIHRoZSB0YXJnZXQgb2YgdGhlIGNsaWNrXG4gICAgdmFyIHRoaXNGaWx0ZXJXcmFwcGVyID0gJHRoaXMuY2xvc2VzdCgnLmZpbHRlci13cmFwcGVyJyk7XG4gICAgLy9EaXNwbGF5IG5vbmUgdGhlIG92ZXJsYXlcbiAgICB0aGlzRmlsdGVyV3JhcHBlci5yZW1vdmVDbGFzcygnc2hvdy1zb3J0Jyk7XG4gICAgdmFyIGNsaWNrZWRCdXR0b24gPSAnW2RhdGEtb3ZlcmxheS1pcy12aXNpYmxlPVwidHJ1ZVwiXSc7XG4gICAgLy9SZS1pbnNlcnQgdGhlIGZpbHRlciB3cmFwIHdoZXJlIGl0IGNhbWUgKHVuZGVyIHRoZSBidXR0b24ganMtc2hvdy1zb3J0KVxuICAgIHRoaXNGaWx0ZXJXcmFwcGVyLmluc2VydEFmdGVyKGNsaWNrZWRCdXR0b24pO1xuICAgIC8vSGlkZSB0aGUgYm9keSBkaXZcbiAgICAkb2NDb250YWluZXIucmVtb3ZlQ2xhc3MoJ2lzLWhpZGRlbicpO1xuICAgIC8vRm9jdXMgYmFjayBvbiB0aGUgYnV0dG9uIGNsaWNrZWQgYmVmb3JlIHRoZSBvcGVuaW5nIG9mIHRoZSBvdmVybGF5XG4gICAgY2xvc2VGaWx0ZXJEcm9wZG93bigkKGNsaWNrZWRCdXR0b24pKTtcbiAgICAvL0RhdGEgdGhhdCBzaWduYWwgdGhlIG92ZXJsYXkgaXMgY2xvc2UgZm9yIHRoaXMgYnV0dG9uXG4gICAgJCgnLmpzLXNob3ctc29ydCcpLmF0dHIoJ2RhdGEtb3ZlcmxheS1pcy12aXNpYmxlJywgJ2ZhbHNlJyk7XG4gICAgaXNTb3J0VmlzaWJsZSA9IGZhbHNlO1xuICAgIC8vU2Nyb2xsIHRvIHRoZSBwb3NpdGlvbiBiZWZvcmUgdGhlIG92ZXJsYXkgd2FzIG9wZW5cbiAgICAkKHdpbmRvdykuc2Nyb2xsVG9wKHNjcm9sbFBvaW50KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsb3NlT25EZXNrdG9wUmVzaXplKCkge1xuICAgIC8vQ2xvc2UgZHJvcGRvd25cbiAgICBjbG9zZUZpbHRlckRyb3Bkb3duKCk7XG4gICAgLy9DbG9zZSB0aGUgdmlzaWJsZSBvdmVybGF5IG1vYmlsZVxuICAgIGlmIChpc1NvcnRWaXNpYmxlIHx8IGlzRmlsdGVyc1Zpc2libGUpIHtcbiAgICAgIC8vUmUgaW5zZXJ0IGZpbHRlciBpbiBkZXNrdG9wIHVuZGVyIHRoZSBidXR0b25cbiAgICAgICQoJy5maWx0ZXItd3JhcHBlci5zaG93LXNvcnQnKS5pbnNlcnRBZnRlcignW2RhdGEtb3ZlcmxheS1pcy12aXNpYmxlPVwidHJ1ZVwiXScpO1xuICAgICAgJCgnLmZpbHRlci13cmFwcGVyLnNob3ctZmlsdGVycycpLmluc2VydEFmdGVyKCdbZGF0YS1vdmVybGF5LWlzLXZpc2libGU9XCJ0cnVlXCJdJyk7XG4gICAgICAvL1JlbW92ZSBvdmVybGF5IHN0eWxlIHRoYXQgc2hvdyBpdCBpbiBtb2JpbGVcbiAgICAgICQoJy5maWx0ZXItd3JhcHBlcicpLnJlbW92ZUNsYXNzKCdzaG93LXNvcnQnKTtcbiAgICAgICQoJy5maWx0ZXItd3JhcHBlcicpLnJlbW92ZUNsYXNzKCdzaG93LWZpbHRlcnMnKTtcbiAgICAgIC8vUmVtb3ZlIG1vYmlsZSBib2R5IGNsYXNzIGhpZGRlbiBvbiBjb250YWluZXJcbiAgICAgICRvY0NvbnRhaW5lci5yZW1vdmVDbGFzcygnaXMtaGlkZGVuJyk7XG4gICAgICAvL0ZsYWcgYnV0dG9uIGFuZCBvdmVybGF5IG9mZlxuICAgICAgJCgnLmpzLXNob3ctc29ydCcpLmF0dHIoJ2RhdGEtb3ZlcmxheS1pcy12aXNpYmxlJywgJ2ZhbHNlJyk7XG4gICAgICBpc1NvcnRWaXNpYmxlID0gZmFsc2U7XG4gICAgICBpc0ZpbHRlcnNWaXNpYmxlID0gZmFsc2U7XG4gICAgfVxuICB9XG5cblxuICBmdW5jdGlvbiBtZW51TmF2aWdhdGlvbigkbWVudUJ1dHRvbiwga2V5LCBldmVudCkge1xuICAgIHZhciBtZW51QnV0dG9uSW5kZXggPSAkKCcuanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tYnV0dG9uJykuaW5kZXgoJG1lbnVCdXR0b24pLFxuICAgICAgbWVudUxlbmd0aCA9ICQoJy5qcy1tdWx0aXNlbGVjdC1kcm9wZG93bi1idXR0b24nKS5sZW5ndGggLSAxO1xuXG4gICAgLy8gd2UgY2FsbCB0aGlzIGZ1bmN0aW9uIG9uIGFsbCBpbnB1dHMgYW5kIGRyb3Bkb3duIGJ1dHRvbnMgYnV0IHdlIG5lZWQgdG9cbiAgICAvLyBkbyBkaWZmZXJlbnQgdGhpbmdzIGRlcGVuZGluZyBvbiB3aGVyZSB3ZSBhcmUgaW4gdGhlIGRvbVxuICAgIGlmICgkbWVudUJ1dHRvbi5oYXNDbGFzcygnanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tYnV0dG9uJykpIHtcbiAgICAgIGlmIChrZXkgPT09ICdsZWZ0Jykge1xuICAgICAgICBpZiAobWVudUJ1dHRvbkluZGV4IDw9IG1lbnVMZW5ndGgpIHtcbiAgICAgICAgICBjbG9zZUZpbHRlckRyb3Bkb3duKCRtZW51QnV0dG9uLmNsb3Nlc3QoJy5tdWx0aXNlbGVjdC1kcm9wZG93bicpKTtcbiAgICAgICAgICAkKCcuanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tYnV0dG9uJykuZXEobWVudUJ1dHRvbkluZGV4IC0gMSkuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdyaWdodCcpIHtcbiAgICAgICAgaWYgKG1lbnVCdXR0b25JbmRleCA8IG1lbnVMZW5ndGgpIHtcbiAgICAgICAgICBjbG9zZUZpbHRlckRyb3Bkb3duKCRtZW51QnV0dG9uLmNsb3Nlc3QoJy5tdWx0aXNlbGVjdC1kcm9wZG93bicpKTtcbiAgICAgICAgICAkKCcuanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tYnV0dG9uJykuZXEobWVudUJ1dHRvbkluZGV4ICsgMSkuZm9jdXMoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkKCcuanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tYnV0dG9uJykuZXEoMCkuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdkb3duJykge1xuICAgICAgICBvcGVuRmlsdGVyRHJvcGRvd24oJG1lbnVCdXR0b24uY2xvc2VzdCgnLm11bHRpc2VsZWN0LWRyb3Bkb3duJykpO1xuICAgICAgICBpZiAoJCgnLmpzLW11bHRpc2VsZWN0LWRyb3Bkb3duLW9wdGlvbnMtd3JhcHBlcjp2aXNpYmxlIGlucHV0OmNoZWNrZWQnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgJCgnLmpzLW11bHRpc2VsZWN0LWRyb3Bkb3duLW9wdGlvbnMtd3JhcHBlcjp2aXNpYmxlIFthcmlhLWNoZWNrZWQ9dHJ1ZV0gaW5wdXQnKS5mb2N1cygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQoJy5qcy1tdWx0aXNlbGVjdC1kcm9wZG93bi1vcHRpb25zLXdyYXBwZXI6dmlzaWJsZSBsaTpmaXJzdC1jaGlsZCBpbnB1dCcpLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCRtZW51QnV0dG9uLmhhc0NsYXNzKCdqcy1tdWx0aXNlbGVjdC1kcm9wZG93bi1vcHRpb24taW5wdXQnKSkge1xuICAgICAgaWYgKGtleSA9PT0gJ2xlZnQnKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNsb3NlRmlsdGVyRHJvcGRvd24oJG1lbnVCdXR0b24uY2xvc2VzdCgnLm11bHRpc2VsZWN0LWRyb3Bkb3duJykpO1xuICAgICAgICBtZW51TmF2aWdhdGlvbigkbWVudUJ1dHRvbi5jbG9zZXN0KCcubXVsdGlzZWxlY3QtZHJvcGRvd24nKS5maW5kKCcuanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tYnV0dG9uJyksICdsZWZ0JywgZXZlbnQpO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdyaWdodCcpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY2xvc2VGaWx0ZXJEcm9wZG93bigkbWVudUJ1dHRvbi5jbG9zZXN0KCcubXVsdGlzZWxlY3QtZHJvcGRvd24nKSk7XG4gICAgICAgIG1lbnVOYXZpZ2F0aW9uKCRtZW51QnV0dG9uLmNsb3Nlc3QoJy5tdWx0aXNlbGVjdC1kcm9wZG93bicpLmZpbmQoJy5qcy1tdWx0aXNlbGVjdC1kcm9wZG93bi1idXR0b24nKSwgJ3JpZ2h0JywgZXZlbnQpO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdlc2MnKSB7XG4gICAgICAgIGNsb3NlRmlsdGVyRHJvcGRvd24oJG1lbnVCdXR0b24uY2xvc2VzdCgnLm11bHRpc2VsZWN0LWRyb3Bkb3duJykuZmluZCgnLmpzLW11bHRpc2VsZWN0LWRyb3Bkb3duLWJ1dHRvbicpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuXG4gICQoJy5qcy1tdWx0aXNlbGVjdC1kcm9wZG93bi1vcHRpb24taW5wdXQnKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgaWYgKCQodGhpcykuY2xvc2VzdCgnLmpzLW11bHRpc2VsZWN0LWRyb3Bkb3duLW9wdGlvbicpLmF0dHIoJ2FyaWEtY2hlY2tlZCcpID09PSAndHJ1ZScpIHtcbiAgICAgICQodGhpcylbMF0uY2hlY2tlZCA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICQodGhpcylbMF0uY2hlY2tlZCA9IGZhbHNlO1xuICAgIH1cbiAgfSk7XG5cbiAgJCgnLmpzLW11bHRpc2VsZWN0LWRyb3Bkb3duLW9wdGlvbi1pbnB1dCcpLm9uKCdmb2N1cycsIGZ1bmN0aW9uKGUpIHtcblxuICAgIHZhciAkZWxlbWVudCA9ICQodGhpcykuc2libGluZ3MoJ2xhYmVsJyk7XG4gICAgdmFyIGVsZW1lbnRSZWN0ID0gJGVsZW1lbnRbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgdmFyICRzY3JvbGxhYmxlRGl2ID0gJGVsZW1lbnQucGFyZW50cygnLm11bHRpc2VsZWN0LWRyb3Bkb3duLW9wdGlvbnMtd3JhcHBlcicpO1xuICAgIHZhciBzY3JvbGxhYmxlRGl2UmVjdCA9ICRzY3JvbGxhYmxlRGl2WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgdmFyIGRvY3VtZW50VG9wICA9IHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgIHZhciBlbGVtZW50UG9zID0ge1xuICAgICAgdG9wOiAgZWxlbWVudFJlY3QudG9wICsgZG9jdW1lbnRUb3AsXG4gICAgICBib3R0b206IGVsZW1lbnRSZWN0LmJvdHRvbSArIGRvY3VtZW50VG9wXG4gICAgfTtcbiAgICB2YXIgc2Nyb2xsYWJsZURpdlBvcyA9IHtcbiAgICAgIHRvcDogc2Nyb2xsYWJsZURpdlJlY3QudG9wICsgZG9jdW1lbnRUb3AsXG4gICAgICBib3R0b206IHNjcm9sbGFibGVEaXZSZWN0LmJvdHRvbSArIGRvY3VtZW50VG9wXG4gICAgfTtcblxuICAgIGlmKGVsZW1lbnRQb3MudG9wIDwgc2Nyb2xsYWJsZURpdlBvcy50b3ApIHtcbiAgICAgIHZhciB0b3BEaWZmZXJlbmNlID0gc2Nyb2xsYWJsZURpdlBvcy50b3AgLSBlbGVtZW50UG9zLnRvcDtcbiAgICAgIHZhciB0b3BDdXJyZW50U2Nyb2xsVG9wID0gJHNjcm9sbGFibGVEaXYuc2Nyb2xsVG9wKCk7XG4gICAgICAkc2Nyb2xsYWJsZURpdi5zY3JvbGxUb3AodG9wQ3VycmVudFNjcm9sbFRvcCAtIHRvcERpZmZlcmVuY2UpO1xuICAgIH1cblxuICAgIGlmKGVsZW1lbnRQb3MuYm90dG9tID4gc2Nyb2xsYWJsZURpdlBvcy5ib3R0b20pIHtcbiAgICAgIHZhciBib3R0b21EaWZmZXJlbmNlID0gZWxlbWVudFBvcy5ib3R0b20gLSBzY3JvbGxhYmxlRGl2UG9zLmJvdHRvbTtcbiAgICAgIHZhciBib3R0b21DdXJyZW50U2Nyb2xsVG9wID0gJHNjcm9sbGFibGVEaXYuc2Nyb2xsVG9wKCk7XG4gICAgICAkc2Nyb2xsYWJsZURpdi5zY3JvbGxUb3AoYm90dG9tQ3VycmVudFNjcm9sbFRvcCArIGJvdHRvbURpZmZlcmVuY2UgKyA1KTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIGFkZFRhZ3MoJGlucHV0KSB7XG4gICAgaWYgKCFfLnNvbWUodGFnU3RvcmUsIHtpbnB1dFZhbDogJGlucHV0LnZhbCgpfSkpIHtcbiAgICAgIHRhZ1N0b3JlLnB1c2goe3RpbWU6IERhdGUubm93KCksIGlucHV0VmFsOiAkaW5wdXQudmFsKCksICRlbGVtOiAkaW5wdXR9KTtcbiAgICB9XG4gICAgc2hvd1RhZ3MoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3dUYWdzKCkge1xuICAgIHRhZ1N0b3JlID0gXy5zb3J0QnkodGFnU3RvcmUsIFsndGltZSddKTtcblxuICAgIC8vU3BlY2lhbCBjYXNlIG1hZGUgZm9yIG15LWFjY291bnQgdG8gbm90IGltcGFjdCB0aGUgbGl2ZSBzaXRlXG4gICAgaWYgKCQoXCJib2R5Om5vdCgnLm15LWFjY291bnQnKVwiKS5sZW5ndGggPiAwKSB7XG4gICAgICAkKCcudGFnLWxpc3QsIC5tdWx0aXNlbGVjdC1kcm9wZG93biAubW9iaWxlLXNlbGVjdGlvbnMtbGlzdCcpLmVtcHR5KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQoJy50YWctbGlzdCcpLmVtcHR5KCk7XG4gICAgfVxuXG4gICAgXy5lYWNoKHRhZ1N0b3JlLCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICBhZGRUYWdzVG9Eb20odmFsLiRlbGVtKTtcbiAgICAgIHJldHVybjtcbiAgICB9KTtcblxuICAgIC8vIG9ubHkgZm9jdXMgb24gdGhlIGZpcnN0IHRhZyBpZiB0aGVyZSdzIG5vIG1lbnUgaXRlbSBvcGVuXG4gICAgaWYgKCQoJy5tdWx0aXNlbGVjdC1kcm9wZG93bi5pcy1vcGVuJykubGVuZ3RoID09PSAwKSB7XG4gICAgICAkKCcudGFnLWxpc3QgYScpLmZpcnN0KCkuZm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBhZGRUYWdzVG9Eb20oJGlucHV0KSB7XG4gICAgaWYgKCRpbnB1dC52YWwoKSAhPT0gJ3NlZS1hbGwnKSB7XG4gICAgICAkKCcudGFnLWNvbnRhaW5lcicpLmFkZENsYXNzKCdpcy12aXNpYmxlJyk7XG4gICAgICAkKCcudGFnLWxpc3QnKS5hcHBlbmQoY3JlYXRlVGFnKCRpbnB1dCkpO1xuICAgICAgLy9TcGVjaWFsIGNhc2UgbWFkZSBmb3IgbXktYWNjb3VudCB0byBub3QgaW1wYWN0IHRoZSBsaXZlIHNpdGVcbiAgICAgIGlmICgkKFwiYm9keTpub3QoJy5teS1hY2NvdW50JylcIikubGVuZ3RoID4gMCkge1xuICAgICAgICAkaW5wdXQuY2xvc2VzdCgnLm11bHRpc2VsZWN0LWRyb3Bkb3duJylcbiAgICAgICAgICAuZmluZCgnLm1vYmlsZS1zZWxlY3Rpb25zLWxpc3QnKVxuICAgICAgICAgIC5hcHBlbmQoY3JlYXRlTW9iaWxlVGFnKCRpbnB1dCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGlucHV0LmNsb3Nlc3QoJy5tdWx0aXNlbGVjdC1kcm9wZG93bicpXG4gICAgICAgICAgLmZpbmQoJy5tb2JpbGUtc2VsZWN0aW9ucy1saXN0JylcbiAgICAgICAgICAuaHRtbChjcmVhdGVNb2JpbGVUYWcoJGlucHV0KSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcmVtb3ZlVGFnKGlucHV0VmFsKSB7XG4gICAgdmFyIHRhZ0luZGV4O1xuICAgIF8uZWFjaCh0YWdTdG9yZSwgZnVuY3Rpb24gKHZhbCwga2V5KSB7XG4gICAgICBpZiAodmFsLmlucHV0VmFsID09PSBTdHJpbmcoaW5wdXRWYWwpKSB7XG4gICAgICAgIHRhZ0luZGV4ID0ga2V5O1xuICAgICAgICB2YWwuJGVsZW1bMF0uY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKHRhZ0luZGV4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRhZ1N0b3JlLnNwbGljZSh0YWdJbmRleCwgMSk7XG4gICAgfVxuXG4gICAgaWYgKHRhZ1N0b3JlLmxlbmd0aCA+IDApIHtcbiAgICAgIHNob3dUYWdzKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQoJy50YWctY29udGFpbmVyJykucmVtb3ZlQ2xhc3MoJ2lzLXZpc2libGUnKTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIGNyZWF0ZVRhZygkaW5wdXQpIHtcbiAgICByZXR1cm4gXCI8bGkgY2xhc3M9J3RhZy1pdGVtIGpzLXJlbW92ZS1maWx0ZXItdGFnJyBkYXRhLW9wdGlvbi1uYW1lPSdcIiArICRpbnB1dC52YWwoKSArIFwiJz5cIiArXG4gICAgICBcIjxzcGFuIGFyaWEtaGlkZGVuPSd0cnVlJyBjbGFzcz0naWNvbi14LWhpZGRlbic+eDwvc3Bhbj5cIiArXG4gICAgICBcIiA8YSBocmVmPSdqYXZhc2NyaXB0OnZvaWQoMCknIHRpdGxlPSdSZW1vdmUgU2VsZWN0aW9uJz5cIiArXG4gICAgICBcIjxzcGFuIGNsYXNzPSd2aXN1YWxseWhpZGRlbic+UmVtb3ZlPC9zcGFuPlwiICsgJGlucHV0LmRhdGEoJ2Rpc3BsYXktbmFtZScpICtcbiAgICAgIFwiPHNwYW4gY2xhc3M9J3Zpc3VhbGx5aGlkZGVuJz5TZWxlY3Rpb248L3NwYW4+PC9hPjwvbGk+XCI7XG4gIH1cblxuICBmdW5jdGlvbiBjcmVhdGVNb2JpbGVUYWcoJGlucHV0KSB7XG4gICAgcmV0dXJuIFwiPHNwYW4gY2xhc3M9J21vYmlsZS1zZWxlY3Rpb24nIGRhdGEtb3B0aW9uLW5hbWU9J1wiICsgJGlucHV0LnZhbCgpICsgXCInPlwiICsgJGlucHV0LmF0dHIoJ2RhdGEtZGlzcGxheS1uYW1lJykgKyBcIjwvc3Bhbj5cIjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNjcm9sbFRvRmlsdGVycygpIHtcbiAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPiB3aW5kb3cuY2l0aUNvbmZpZy50YWJsZXRCcmVha3BvaW50ICYmICQoJy5maWx0ZXItc3RpY2t5LXdyYXBwZXInKS5oYXNDbGFzcygnaXMtc3R1Y2snKSkge1xuICAgICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe1xuICAgICAgICBzY3JvbGxUb3A6IDBcbiAgICAgIH0sIDMwMCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICB2YXIga2V5cyA9IHtcbiAgICAgIDk6ICd0YWInLFxuICAgICAgMTM6ICdlbnRlcicsXG4gICAgICAyNzogJ2VzYycsXG4gICAgICAzMjogJ3NwYWNlJyxcbiAgICAgIDM3OiAnbGVmdCcsXG4gICAgICAzODogJ3VwJyxcbiAgICAgIDM5OiAncmlnaHQnLFxuICAgICAgNDA6ICdkb3duJ1xuICAgIH07XG5cbiAgICAvL09wZW4gYW5kIENsb3NlIHRoZSBkZXNrdG9wIGRyb3Bkb3duXG4gICAgJCgnLmpzLWZpbHRlci1tZW51LXdyYXBwZXInKS5vbignY2xpY2snLCAnLmpzLW11bHRpc2VsZWN0LWRyb3Bkb3duLWJ1dHRvbicsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKCQodGhpcykuY2xvc2VzdCgnLm11bHRpc2VsZWN0LWRyb3Bkb3duJykuaGFzQ2xhc3MoJ2lzLW9wZW4nKSAmJiAkKHdpbmRvdykud2lkdGgoKSA+IHdpbmRvdy5jaXRpQ29uZmlnLnRhYmxldEJyZWFrcG9pbnQpIHtcbiAgICAgICAgY2xvc2VGaWx0ZXJEcm9wZG93bigkKHRoaXMpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9wZW5GaWx0ZXJEcm9wZG93bigkKHRoaXMpKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vQ2xpY2sgdGhhdCBzaG93IHRoZSBvdmVybGF5IHNob3ctZmlsdGVyc1xuICAgICQoJy5qcy1zaG93LWZpbHRlcnMnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAvL1NhdmUgdGhlIHBvc2l0aW9uIGJlZm9yZSB0aGUgb3BlbmluZyBvZiB0aGUgb3ZlcmxheVxuICAgICAgc2Nyb2xsUG9pbnQgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7XG4gICAgICBvcGVuTW9iaWxlRmlsdGVyTWVudSgkKHRoaXMpKTtcbiAgICB9KTtcblxuICAgIC8vQ2xpY2sgdGhhdCBzaG93IHRoZSBvdmVybGF5IHNob3ctc29ydFxuICAgICQoJy5qcy1zaG93LXNvcnQnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAvL1NhdmUgdGhlIHBvc2l0aW9uIGJlZm9yZSB0aGUgb3BlbmluZyBvZiB0aGUgb3ZlcmxheVxuICAgICAgc2Nyb2xsUG9pbnQgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7XG4gICAgICBvcGVuTW9iaWxlU29ydE1lbnUoJCh0aGlzKSk7XG4gICAgfSk7XG5cbiAgICAvL0NsaWNrIHRoYXQgaGlkZSBtb2JpbGUgb3ZlcmxheVxuICAgICQoJy5qcy1oaWRlLWZpbHRlcnMnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoaXNTb3J0VmlzaWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgICBjbG9zZU1vYmlsZVNvcnRNZW51KCQodGhpcykpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2xvc2VNb2JpbGVGaWx0ZXJNZW51KCQodGhpcykpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgJCgnLmpzLWZpbHRlci1tZW51LXdyYXBwZXInKS5vbignY2xpY2snLCAnLmpzLWZpbHRlci1uYXYtYmFjaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNsb3NlRmlsdGVyRHJvcGRvd24oJCh0aGlzKS5jbG9zZXN0KCcuanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tYnV0dG9uJykpO1xuICAgIH0pO1xuXG4gICAgJCgnLmpzLXVwZGF0ZS1wcm9kdWN0cycpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICgkKCcuanMtZmlsdGVyLW5hdi1iYWNrOnZpc2libGUnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICQoJy5qcy1maWx0ZXItbmF2LWJhY2s6dmlzaWJsZScpLmNsaWNrKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkKCcuanMtaGlkZS1maWx0ZXJzOnZpc2libGUnKS5jbGljaygpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgJCgnLmpzLWNsZWFyLWZpbHRlcnMnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgJGlzT3BlbiA9ICQoJy5tdWx0aXNlbGVjdC1kcm9wZG93bi5pcy1vcGVuJykubGVuZ3RoID8gJCgnLm11bHRpc2VsZWN0LWRyb3Bkb3duLmlzLW9wZW4nKSA6ICQoJy5tdWx0aXNlbGVjdC1kcm9wZG93bi5zb3J0LWlzLW9wZW4nKTtcbiAgICAgIC8vU3BlY2lhbCBjYXNlIG1hZGUgZm9yIG15LWFjY291bnQgdG8gbm90IGltcGFjdCB0aGUgbGl2ZSBzaXRlXG4gICAgICBpZiAoJChcImJvZHk6bm90KCcubXktYWNjb3VudCcpXCIpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgJGlzT3Blbi5maW5kKCcubW9iaWxlLXNlbGVjdGlvbnMtbGlzdCcpLmVtcHR5KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgbGlzdCA9ICRpc09wZW4uZmluZCgnLm1vYmlsZS1zZWxlY3Rpb25zLWxpc3QnKSxcbiAgICAgICAgICBzZWxlY3Rpb24gPSAkaXNPcGVuLmZpbmQoJy5tb2JpbGUtc2VsZWN0aW9uJyk7XG4gICAgICAgIHNlbGVjdGlvbi5hdHRyKFwiZGF0YS1vcHRpb24tbmFtZVwiLCBsaXN0LmF0dHIoXCJkYXRhLWRlZmF1bHQtY29kZS12YWx1ZVwiKSk7XG4gICAgICAgIHNlbGVjdGlvbi5odG1sKGxpc3QuYXR0cihcImRhdGEtZGVmYXVsdC12YWx1ZVwiKSk7XG4gICAgICAgIGxpc3QucGFyZW50cyhcImJ1dHRvblwiKS5maW5kKFwiLm11bHRpc2VsZWN0LW92ZXJsYXktdGl0bGVcIikuaHRtbChsaXN0LmF0dHIoXCJkYXRhLWRlZmF1bHQtdmFsdWVcIikpO1xuICAgICAgICBzZWxlY3Rpb24ucGFyZW50cyhcIi5tdWx0aXNlbGVjdC1kcm9wZG93blwiKS5maW5kKFwibGlcIikuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIGxpc3RFbGVtZW50ID0gJCh0aGlzKTtcbiAgICAgICAgICBsaXN0RWxlbWVudC5hdHRyKFwiYXJpYS1jaGVja2VkXCIsIFwiZmFsc2VcIik7XG4gICAgICAgICAgaWYgKGxpc3RFbGVtZW50LmF0dHIoXCJkYXRhLXZhbHVlXCIpID09PSBzZWxlY3Rpb24uYXR0cihcImRhdGEtb3B0aW9uLW5hbWVcIikpIHtcbiAgICAgICAgICAgIGxpc3RFbGVtZW50LmF0dHIoXCJhcmlhLWNoZWNrZWRcIiwgXCJ0cnVlXCIpO1xuICAgICAgICAgICAgbGlzdEVsZW1lbnQuZmluZChcImlucHV0XCIpLnRyaWdnZXIoJ2N1c3RvbUV2ZW50TG9hZEFqYXgnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgJCgnLmpzLWZpbHRlci1tZW51LXdyYXBwZXInKS5vbigna2V5ZG93bicsICcuanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tYnV0dG9uLCAuanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tb3B0aW9uLWlucHV0JywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPCB3aW5kb3cuY2l0aUNvbmZpZy50YWJsZXRCcmVha3BvaW50KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1lbnVOYXZpZ2F0aW9uKCQodGhpcyksIGtleXNbZXZlbnQud2hpY2hdLCBldmVudCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAkKCcuanMtZmlsdGVyLW1lbnUtd3JhcHBlcicpLm9uKCdrZXlkb3duJywgJy5tdWx0aXNlbGVjdC1kcm9wZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKGtleXNbZXZlbnQud2hpY2hdID09PSAndGFiJykge1xuICAgICAgICBjbG9zZUZpbHRlckRyb3Bkb3duKCQodGhpcykpO1xuICAgICAgICB2YXIgY291bnQgPSAkKHRoaXMpLmluZGV4KCkgLSAxO1xuICAgICAgICAkKCcuaGFzLXNlbGVjdGlvbnMnKS5odG1sKCdpdGVtcyBzZWxlY3RlZCAnICsgY291bnQgKyAnIG9mICcgKyAkKCcubXVsdGlzZWxlY3QtZHJvcGRvd24nKS5sZW5ndGgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgJCgnLmpzLWZpbHRlci1tZW51LXdyYXBwZXInKS5vbignY2xpY2snLCAnLmpzLW11bHRpc2VsZWN0LWRyb3Bkb3duLW9wdGlvbi1sYWJlbCcsIGZ1bmN0aW9uICgpIHtcblxuICAgIH0pO1xuXG4gICAgJCgnLmpzLWZpbHRlci1tZW51LXdyYXBwZXInKS5vbignY2xpY2sga2V5ZG93bicsICcuanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tb3B0aW9uJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuXG4gICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPiB3aW5kb3cuY2l0aUNvbmZpZy50YWJsZXRCcmVha3BvaW50KSB7XG4gICAgICAgIHZhciB0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY2hlY2tNZW51SXRlbSgkdGhpcywgZXZlbnQpO1xuICAgICAgICB9LCAxMDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2hlY2tNZW51SXRlbSgkdGhpcywgZXZlbnQpO1xuICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBzZXRTdHVjaygpIHtcblxuICAgICAgdmFyICR3aW5kb3cgPSAkKHdpbmRvdyk7XG4gICAgICB2YXIgJGZpbHRlcldheXBvaW50ID0gJCgnLnN0aWNreS1maWx0ZXItd2F5cG9pbnQnKTtcbiAgICAgIHZhciAkY2F0ZWdvcnlUaXRsZSA9ICQoJy5jYXRlZ29yeS10aXRsZScpO1xuICAgICAgdmFyICRmaWx0ZXJXcmFwcGVyID0gJCgnLmZpbHRlci1zdGlja3ktd3JhcHBlcicpO1xuICAgICAgdmFyICRmaWx0ZXJQYWdpbmF0aW9uID0gJCgnLnN0aWNreS1wYWdpbmF0aW9uLXdyYXBwZXInKTtcblxuICAgICAgaWYgKCRmaWx0ZXJXYXlwb2ludC5sZW5ndGggPiAwKSB7XG4gICAgICAgIGlmICgkd2luZG93LnNjcm9sbFRvcCgpID49ICRmaWx0ZXJXYXlwb2ludC5vZmZzZXQoKS50b3AgKyAkY2F0ZWdvcnlUaXRsZS5oZWlnaHQoKSAmJiAkKCdidXR0b24udWktbXVsdGlzZWxlY3QnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgJGZpbHRlcldyYXBwZXIuYWRkQ2xhc3MoJ2lzLXN0dWNrJyk7XG4gICAgICAgICAgJGZpbHRlcldheXBvaW50LmNzcygnaGVpZ2h0JywgJGZpbHRlcldyYXBwZXIuaGVpZ2h0KCkgKyAkZmlsdGVyUGFnaW5hdGlvbi5oZWlnaHQoKSArICRjYXRlZ29yeVRpdGxlLmhlaWdodCgpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAkZmlsdGVyV3JhcHBlci5yZW1vdmVDbGFzcygnaXMtc3R1Y2snKTtcbiAgICAgICAgICAkZmlsdGVyV2F5cG9pbnQuY3NzKCdoZWlnaHQnLCAnYXV0bycpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHByZXZpb3VzU2Nyb2xsID0gJHdpbmRvdy5zY3JvbGxUb3AoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjaGVja01lbnVJdGVtKCR0aGlzLCBldmVudCkge1xuXG4gICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ2NsaWNrJyB8fCBrZXlzW2V2ZW50LndoaWNoXSA9PT0gJ2VudGVyJyB8fCBrZXlzW2V2ZW50LndoaWNoXSA9PT0gJ3NwYWNlJykge1xuXG4gICAgICAgIHZhciBjdXJyZW50VGFnZ2VkVmFsdWUgPSAkdGhpcy5jbG9zZXN0KCcubXVsdGlzZWxlY3QtZHJvcGRvd24nKVxuICAgICAgICAgIC5maW5kKCdidXR0b24gLm1vYmlsZS1zZWxlY3Rpb25zLWxpc3QgLm1vYmlsZS1zZWxlY3Rpb24nKS5kYXRhKCdvcHRpb24tbmFtZScpO1xuXG4gICAgICAgICR0aGlzLmZpbmQoJ2lucHV0JykuZm9jdXMoKTtcblxuICAgICAgICByZW1vdmVUYWcoY3VycmVudFRhZ2dlZFZhbHVlKTtcblxuICAgICAgICAkdGhpcy5jbG9zZXN0KCcubXVsdGlzZWxlY3QtZHJvcGRvd24nKVxuICAgICAgICAgIC5maW5kKCdsYWJlbCcpXG4gICAgICAgICAgLmF0dHIoJ2FyaWEtbGl2ZScsICdvZmYnKTtcblxuICAgICAgICAkdGhpcy5jbG9zZXN0KCcuanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tb3B0aW9ucy13cmFwcGVyJylcbiAgICAgICAgICAuZmluZCgnLmpzLW11bHRpc2VsZWN0LWRyb3Bkb3duLW9wdGlvbicpXG4gICAgICAgICAgLmF0dHIoJ2FyaWEtY2hlY2tlZCcsICdmYWxzZScpO1xuXG4gICAgICAgICR0aGlzLmZpbmQoJ2xhYmVsJykuYXR0cignYXJpYS1saXZlJywgJ2Fzc2VydGl2ZScpO1xuICAgICAgICAkdGhpcy5hdHRyKCdhcmlhLWNoZWNrZWQnLCAndHJ1ZScpO1xuXG5cbiAgICAgICAgaWYgKCR0aGlzLmNsb3Nlc3QoJy5tdWx0aXNlbGVjdC1kcm9wZG93bicpLmhhc0NsYXNzKCdmaWx0ZXItbWVudS1pdGVtJykgJiYgJHRoaXMuZmluZCgnaW5wdXQnKS52YWwoKSAhPT0gJ3NlZS1hbGwnKSB7XG4gICAgICAgICAgYWRkVGFncygkdGhpcy5maW5kKCdpbnB1dCcpKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy9jaGVjayBpZiBzb3J0XG4gICAgICAgIHZhciBzb3J0Rmlyc3RDaGVja2VkID0gJHRoaXMuZmluZCgnaW5wdXQnKS5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKCdsaScpLmZpcnN0KCkuYXR0cignYXJpYS1jaGVja2VkJyk7XG5cbiAgICAgICAgaWYgKCR0aGlzLmNsb3Nlc3QoJy5tdWx0aXNlbGVjdC1kcm9wZG93bicpLmhhc0NsYXNzKCdzb3J0LW1lbnUtaXRlbScpICYmIHNvcnRGaXJzdENoZWNrZWQgIT09ICd0cnVlJykge1xuICAgICAgICAgICR0aGlzLmNsb3Nlc3QoJy5tdWx0aXNlbGVjdC1kcm9wZG93bicpLmZpbmQoJ2J1dHRvbiA+IHNwYW46Zmlyc3QnKS50ZXh0KCR0aGlzLmZpbmQoJ2xhYmVsIHNwYW46Zmlyc3QnKS50ZXh0KCkpO1xuICAgICAgICAgIGNvdW50ZXJTb3J0Kys7XG4gICAgICAgIH0gZWxzZSBpZiAoJHRoaXMuY2xvc2VzdCgnLm11bHRpc2VsZWN0LWRyb3Bkb3duJykuaGFzQ2xhc3MoJ3NvcnQtbWVudS1pdGVtJykgJiYgc29ydEZpcnN0Q2hlY2tlZCAhPT0gJ2ZhbHNlJykge1xuICAgICAgICAgIC8vZGVmYXVsdCB2YWx1ZVxuICAgICAgICAgIGlmIChjb3VudGVyU29ydCA+IDApIHtcbiAgICAgICAgICAgICR0aGlzLmNsb3Nlc3QoJy5tdWx0aXNlbGVjdC1kcm9wZG93bicpLmZpbmQoJ2J1dHRvbiA+IHNwYW46Zmlyc3QnKS50ZXh0KCR0aGlzLmZpbmQoJ2xhYmVsIHNwYW46Zmlyc3QnKS50ZXh0KCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vRXZlbnQgZm9yIHRoZSBsb2FkIGFqYXggdXNlZCBpbiBteS1hY2NvdW50IHBhZ2VzXG4gICAgICAgICR0aGlzLmZpbmQoJ2lucHV0JykudHJpZ2dlcignY3VzdG9tRXZlbnRMb2FkQWpheCcpO1xuICAgICAgfVxuICAgIH1cblxuICAgICQoJy5qcy1maWx0ZXItbWVudS13cmFwcGVyJykub24oJ2NsaWNrJywgJ2lucHV0JywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9KTtcblxuICAgICQoJy50YWctY29udGFpbmVyJykub24oJ2NsaWNrIGtleXByZXNzJywgJy5qcy1yZW1vdmUtZmlsdGVyLXRhZycsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKGV2ZW50LnR5cGUgPT09ICdjbGljaycgfHwga2V5c1tldmVudC53aGljaF0gPT09ICdlbnRlcicpIHtcbiAgICAgICAgcmVtb3ZlVGFnKCQodGhpcykuY2xvc2VzdCgnLnRhZy1pdGVtJykuZGF0YSgnb3B0aW9uLW5hbWUnKSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAkKCcuZmlsdGVyLXdyYXBwZXInKS5vbignY2xpY2snLCAnLnRhZy1jbGVhci1hbGwsIC5qcy1yZXNldC1zZWxlY3Rpb25zJywgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCQoXCJib2R5Om5vdCgnLm15LWFjY291bnQnKVwiKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICQoJy5qcy1yZW1vdmUtZmlsdGVyLXRhZycpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbCkge1xuICAgICAgICAgIHJlbW92ZVRhZygkKGVsKS5kYXRhKCdvcHRpb24tbmFtZScpKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQoJy5tb2JpbGUtc2VsZWN0aW9ucy1saXN0JykuZW1wdHkoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBsaXN0Q291bnQgPSAkKCcubW9iaWxlLXNlbGVjdGlvbnMtbGlzdCcpLmxlbmd0aDtcbiAgICAgICAgdGFnU3RvcmUgPSBbXTtcbiAgICAgICAgJCgnLnRhZy1saXN0JykuZW1wdHkoKTtcbiAgICAgICAgJCgnLm1vYmlsZS1zZWxlY3Rpb25zLWxpc3QnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICAgIHZhciBzZWxlY3Rpb24gPSAkKHRoaXMpLmZpbmQoJy5tb2JpbGUtc2VsZWN0aW9uJyk7XG4gICAgICAgICAgc2VsZWN0aW9uLmF0dHIoXCJkYXRhLW9wdGlvbi1uYW1lXCIsICQodGhpcykuYXR0cihcImRhdGEtZGVmYXVsdC1jb2RlLXZhbHVlXCIpKTtcbiAgICAgICAgICBzZWxlY3Rpb24uaHRtbCgkKHRoaXMpLmF0dHIoXCJkYXRhLWRlZmF1bHQtdmFsdWVcIikpO1xuICAgICAgICAgIHNlbGVjdGlvbi5wYXJlbnRzKFwiLm11bHRpc2VsZWN0LWRyb3Bkb3duXCIpLmZpbmQoXCJsaVwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBsaXN0RWxlbWVudCA9ICQodGhpcyk7XG4gICAgICAgICAgICBsaXN0RWxlbWVudC5hdHRyKFwiYXJpYS1jaGVja2VkXCIsIFwiZmFsc2VcIik7XG4gICAgICAgICAgICBpZiAobGlzdEVsZW1lbnQuYXR0cihcImRhdGEtdmFsdWVcIikgPT09IHNlbGVjdGlvbi5hdHRyKFwiZGF0YS1vcHRpb24tbmFtZVwiKSkge1xuICAgICAgICAgICAgICB2YXIgc2VhcmNoS2V5ID0gbGlzdEVsZW1lbnQuZGF0YShcInNlYXJjaC1rZXlcIiksXG4gICAgICAgICAgICAgICAgdmFsdWUgPSBsaXN0RWxlbWVudC5kYXRhKFwidmFsdWVcIiksXG4gICAgICAgICAgICAgICAgcGFyZW50ID0gbGlzdEVsZW1lbnQucGFyZW50cyhcIi5tdWx0aXNlbGVjdC1saXN0LWNvbnRhaW5lclwiKTtcbiAgICAgICAgICAgICAgcGFyZW50LmRhdGEoc2VhcmNoS2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICAgIGxpc3RFbGVtZW50LmF0dHIoXCJhcmlhLWNoZWNrZWRcIiwgXCJ0cnVlXCIpO1xuICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IGxpc3RDb3VudCAtIDEpIHtcbiAgICAgICAgICAgICAgICBsaXN0RWxlbWVudC5maW5kKFwiaW5wdXRcIikudHJpZ2dlcignY3VzdG9tRXZlbnRMb2FkQWpheCcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgJCgnLmZpbHRlci13cmFwcGVyJykub24oJ2NsaWNrJywgJy5qcy1hcHBseS1zZWxlY3Rpb25zJywgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGlzU29ydFZpc2libGUgPT09IHRydWUpIHtcbiAgICAgICAgY2xvc2VNb2JpbGVTb3J0TWVudSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2xvc2VNb2JpbGVGaWx0ZXJNZW51KCQodGhpcykpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy9tYWtlcyBzdXJlIHRoYXQgaWYgdXNlciBjbGlja3MgYW55d2hlcmUgb24gdGhlIGRvY3VtZW50IHRoZSBkcm9wZG93bnMgY2xvc2VcbiAgICAkKGRvY3VtZW50KS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmICghJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ2J1dHRvbi5tdWx0aXNlbGVjdC1kcm9wZG93bi1idXR0b24nKS5sZW5ndGgpIHtcbiAgICAgICAgaWYgKCQoJy5tdWx0aXNlbGVjdC1kcm9wZG93bicpLmhhc0NsYXNzKCdpcy1vcGVuJykpIHtcbiAgICAgICAgICAvLyBOZWVkZWQgZm9yIElFLCBjbGljayB3b3VsZCB0cmlnZ2VyIG9uIGtleSBkb3duIGNhdXNpbmcgYWNjZXNzaWJpbGl0eSBpc3N1ZS5cbiAgICAgICAgICBpZihldmVudC5jbGllbnRYID4gMCAmJiBldmVudC5jbGllbnRZID4gMCkge1xuICAgICAgICAgICAgY2xvc2VGaWx0ZXJEcm9wZG93bigpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPiB3aW5kb3cuY2l0aUNvbmZpZy50YWJsZXRCcmVha3BvaW50KSB7XG4gICAgICAgIC8vQ2xvc2UgYWxsIG1vYmlsZSBvdmVybGF5cyBvbiBkZXNrdG9wIHJlc2l6ZVxuICAgICAgICBjbG9zZU9uRGVza3RvcFJlc2l6ZSgpO1xuICAgICAgfVxuXG4gICAgICAvL1JlbW92ZSB0aGUgZGVza3RvcCBzdHVjayBpbiBteS1hY2NvdW50IHBhZ2VzXG4gICAgICBpZiAoJChcIi5teS1hY2NvdW50LWNvbnRhaW5lclwiKS5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgLy9JZiB0aGUgbXVsdGlzZWxlY3QtY29udGFpbmVyIG1heC13aWR0aCA8PSA5NTlweCBzZXQgdGhlIHZhcmlhYmxlIGF0IHRydWUuXG4gICAgICAgIGlmIChwYXJzZUludChqUXVlcnkoXCIubXVsdGlzZWxlY3QtY29udGFpbmVyXCIpLmNzcyhcIm1heC13aWR0aFwiKSwgMTApIDw9IHdpbmRvdy5jaXRpQ29uZmlnLnRhYmxldEJyZWFrcG9pbnQpIHtcbiAgICAgICAgICB3aWR0aFVuZGVyVGFibGV0ID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB3aWR0aFVuZGVyVGFibGV0ID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiggd2lkdGhVbmRlclRhYmxldCA9PSBmYWxzZSApIHtcbiAgICAgICAgICAkKCcuZmlsdGVyLXN0aWNreS13cmFwcGVyJykucmVtb3ZlQ2xhc3MoJ2lzLXN0dWNrJyk7XG4gICAgICAgICAgJCgnLnN0aWNreS1maWx0ZXItd2F5cG9pbnQnKS5jc3MoJ2hlaWdodCcsICdhdXRvJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgICQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCQoXCIubXktYWNjb3VudC1jb250YWluZXJcIikubGVuZ3RoID4gMCkge1xuICAgICAgICBpZiggd2lkdGhVbmRlclRhYmxldCA9PSB0cnVlICkge1xuICAgICAgICAgIHNldFN0dWNrKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNldFN0dWNrKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBpbml0KCk7XG5cbiAgcmV0dXJuIHtcbiAgICBtZW51TmF2aWdhdGlvbjogbWVudU5hdmlnYXRpb25cbiAgfTtcblxufSkoKTsiLCIvLyBodHRwczovL2dpdGh1Yi5jb20vYXNzZW1ibGUvaGFuZGxlYmFycy1oZWxwZXJzXG5cbi8vIENvcHlyaWdodCAoYykgMjAxMyBKb24gU2NobGlua2VydCwgQnJpYW4gV29vZHdhcmRcblxuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb25cbi8vIG9idGFpbmluZyBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uXG4vLyBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXRcbi8vIHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLFxuLy8gY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbi8vIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZVxuLy8gU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmdcbi8vIGNvbmRpdGlvbnM6XG5cbi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlXG4vLyBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCxcbi8vIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFU1xuLy8gT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkRcbi8vIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUXG4vLyBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSxcbi8vIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lOR1xuLy8gRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUlxuLy8gT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuXG4vL21vZHVsZS5leHBvcnRzLnJlZ2lzdGVyID0gZnVuY3Rpb24oSGFuZGxlYmFycykge1xuXG4oZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGNmZykge1xuICAgICAgcmV0dXJuIGZhY3RvcnkocmVxdWlyZSgnaGFuZGxlYmFycycpLCBjZmcpO1xuICAgIH07XG5cbiAgfSBlbHNlIHtcbiAgICBmYWN0b3J5KHdpbmRvdy5IYW5kbGViYXJzLCB3aW5kb3cpO1xuICB9XG59KSh0aGlzLCBmdW5jdGlvbihoYmFycywgY29udGV4dCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBoYmFycy5yZWdpc3RlckhlbHBlcih7XG4gICAgICBjdXJyZW5jeU5hbWVQbHVyYWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gY29udGV4dC5jaXRpQ29uZmlnLmN1cnJlbmN5TmFtZVBsdXJhbDtcbiAgICAgIH0sXG4gICAgICBndDogZnVuY3Rpb24gKHZhbHVlLCB0ZXN0LCBvcHRpb25zKSB7XG4gICAgICAgICAgaWYgKHZhbHVlID4gdGVzdCkge1xuICAgICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5mbih0aGlzKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5pbnZlcnNlKHRoaXMpO1xuICAgICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBoeXBoZW5hdGU6IGZ1bmN0aW9uIChzdHIpIHtcbiAgICAgICAgICBpZihzdHIgJiYgdHlwZW9mIHN0ciA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICByZXR1cm4gc3RyLnNwbGl0KFwiIFwiKS5qb2luKFwiLVwiKTtcbiAgICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaXNudDogZnVuY3Rpb24gKHZhbHVlLCB0ZXN0LCBvcHRpb25zKSB7XG4gICAgICAgICAgaWYgKHZhbHVlICE9PSB0ZXN0KSB7XG4gICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmZuKHRoaXMpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmludmVyc2UodGhpcyk7XG4gICAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGlzOiBmdW5jdGlvbiAodmFsdWUsIHRlc3QsIG9wdGlvbnMpIHtcbiAgICAgICAgICBpZiAodmFsdWUgPT09IHRlc3QpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuZm4odGhpcyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuaW52ZXJzZSh0aGlzKTtcbiAgICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZWl0aGVyOiBmdW5jdGlvbiAodmFsdWUsIHRlc3QsIG9wdGlvbnMpIHtcbiAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHRlc3Quc3BsaXQoXCI7XCIpLFxuICAgICAgICAgICAgICBtYXRjaEZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IG1hdGNoZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgaWYobWF0Y2hlc1tpXSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgIG1hdGNoRm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtYXRjaEZvdW5kKSB7XG4gICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmZuKHRoaXMpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmludmVyc2UodGhpcyk7XG4gICAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGxlbmd0aDogZnVuY3Rpb24gKGFycmF5KSB7XG4gICAgICAgICAgcmV0dXJuICghYXJyYXkpID8gMCA6IGFycmF5Lmxlbmd0aDtcbiAgICAgIH0sXG4gICAgICBsb3dlcmNhc2U6IGZ1bmN0aW9uIChzdHIpIHtcbiAgICAgICAgIGlmKHN0ciAmJiB0eXBlb2Ygc3RyID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgIHJldHVybiBzdHIudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBwYWdlVHlwZTogZnVuY3Rpb24odmFsdWUsIG9wdGlvbnMpIHtcbiAgICAgICAgICBpZiAoY29udGV4dC5wYWdlVHlwZSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuZm4odGhpcyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuaW52ZXJzZSh0aGlzKTtcbiAgICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdG9vbHRpcENsYXNzOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gIFxuICAgICAgICAgIHZhciBrbGFzcz0ndG9vbHRpcC10YXJnZXQgb21uaXR1cmUtdG9vbHRpcCc7XG4gIFxuICAgICAgICAgIGlmIChvcHRpb25zLmNvbG9yKSB7XG4gICAgICAgICAgICAgIGlmIChvcHRpb25zLmNvbG9yID09PSAnZGFyaycpIHtcbiAgICAgICAgICAgICAgICAgIGtsYXNzICs9ICcgdG9vbHRpcC1kYXJrJztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgXG4gICAgICAgICAgaWYgKG9wdGlvbnMuc2l6ZSkge1xuICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zaXplID09PSAneGwnKSB7XG4gICAgICAgICAgICAgICAgICBrbGFzcyArPSAnIHhsJztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgXG4gICAgICAgICAgcmV0dXJuIGtsYXNzO1xuICAgICAgfSxcbiAgICAgIGxvYzogZnVuY3Rpb24odmFsdWUsIGRlZikge1xuXG4gICAgICAgIHZhciB0b1JldHVybiA9IG51bGw7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB2YXIgZXZhbFN0cmluZyA9ICdsb2NhbGl6YXRpb25EaWN0aW9uYXJ5LicrY29udGV4dC5wYXRoLmNvdW50cnkrJy4nK2NvbnRleHQucGF0aC5sYW5nKycuJytjb250ZXh0LnBhdGgudGllcisnLicrdmFsdWUudG9TdHJpbmcoKTtcblxuICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdG9SZXR1cm4gPSBldmFsKFwid2luZG93LlwiK2V2YWxTdHJpbmcpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0b1JldHVybiA9IGV2YWwoXCJjb250ZXh0LlwiK2V2YWxTdHJpbmcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaChlKSB7fVxuXG4gICAgICAgIC8vVVNFIFRISVMgSUYgWU9VIFdBTlQgVE8gU0VFIFdIQVQgSVMgQkVJTkcgTE9DQUxJWkVEXG4gICAgICAgIC8vcmV0dXJuIHRvUmV0dXJuID8gKCckOicgKyB0b1JldHVybikgOiAoZGVmID8gKCclOicrZGVmKSA6ICcnKTsgXG4gICAgICAgIC8vXG4gICAgICAgIHJldHVybiB0b1JldHVybiA/IHRvUmV0dXJuIDogKGRlZiA/IGRlZiA6ICcnKTsgXG5cbiAgICAgIH0sXG4gICAgICBzdHJpbmdpZnk6IGZ1bmN0aW9uKG9iamVjdCkge1xuICAgICAgICByZXR1cm4gbmV3IGhiYXJzLlNhZmVTdHJpbmcoSlNPTi5zdHJpbmdpZnkob2JqZWN0KSk7XG4gICAgICB9LFxuICAgICAgc2hvd05hdkl0ZW06IGZ1bmN0aW9uKHZhbHVlLCBvcHRpb25zKSB7XG4gICAgICAgIHZhciBjaGVja1N0YXRlcyA9IHR5cGVvZiB2YWx1ZS5zdGF0ZXMgIT09ICd1bmRlZmluZWQnLFxuICAgICAgICAgICAgc2hvdyA9IHRydWU7XG5cbiAgICAgICAgaWYgKGNoZWNrU3RhdGVzKSB7XG4gICAgICAgICAgdmFyIG1hcCA9IFtcImFub255bW91c1wiLFwiY29va2llZFwiLFwibG9nZ2VkaW5cIixcIm9ib1wiXSxcbiAgICAgICAgICAgICAgaWR4ID0gbWFwLmluZGV4T2YoY29udGV4dC5wYXRoLnN0YXRlKTtcblxuICAgICAgICAgIGlmICh2YWx1ZS5zdGF0ZXMuaW5kZXhPZihpZHgpID09PSAtMSkge1xuICAgICAgICAgICAgc2hvdyA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICB9XG5cbiAgICAgICBpZiAoc2hvdykge1xuICAgICAgICAgIHJldHVybiBvcHRpb25zLmZuKHRoaXMpO1xuICAgICAgIH0gZWxzZSB7XG4gICAgICAgICByZXR1cm4gb3B0aW9ucy5pbnZlcnNlKHRoaXMpO1xuICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBuYXZOYW1lOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IHZhbHVlIDogdmFsdWUubmFtZTtcbiAgICAgIH1cbiAgfSk7XG59KTtcbiIsIlxuY2l0aVNoYXJlLmhvbWVwYWdlID0gZnVuY3Rpb24oKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHR2YXIgY29uZmlnID0ge1xuXHRcdCRtb2JpbGVUYWJzTGlua3M6ICQoJy5zZWN0aW9uLXN1Yi1uYXYubW9iaWxlIGxpIGEnKVxuXHR9O1xuXG5cdC8vIEFkZHMgYW5kIHJlbW92ZSBjbGFzcyB0byBhbGxvdyBwcm9wZXIgY3NzIHN0eWxpbmdcblx0ZnVuY3Rpb24gX3NldEZvY3VzSGFuZGxlclRhYnNMaW5rcygpIHtcblx0XHRjb25maWcuJG1vYmlsZVRhYnNMaW5rcy5vbignZm9jdXMnLCBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBwYXJlbnQgPSAkKHRoaXMpLnBhcmVudCgpO1xuXHRcdFx0cGFyZW50LmFkZENsYXNzKCdsaW5rLWlzLWZvY3VzZWQnKTtcblx0XHRcdGlmKHBhcmVudC5pbmRleCgpID4gMCkge1xuXHRcdFx0XHRwYXJlbnQucHJldigpLmFkZENsYXNzKCduZXh0LWxpbmstaXMtZm9jdXNlZCcpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdGNvbmZpZy4kbW9iaWxlVGFic0xpbmtzLm9uKCdibHVyJywgZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgcGFyZW50ID0gJCh0aGlzKS5wYXJlbnQoKTtcblx0XHRcdHBhcmVudC5yZW1vdmVDbGFzcygnbGluay1pcy1mb2N1c2VkJyk7XG5cdFx0XHRpZihwYXJlbnQuaW5kZXgoKSA+IDApIHtcblx0XHRcdFx0cGFyZW50LnByZXYoKS5yZW1vdmVDbGFzcygnbmV4dC1saW5rLWlzLWZvY3VzZWQnKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIF9pbml0KCkge1xuXHRcdF9zZXRGb2N1c0hhbmRsZXJUYWJzTGlua3MoKTtcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0aW5pdDogX2luaXQsXG5cdFx0Y29uZmlnOiBjb25maWdcblx0fTtcblxufTtcbiIsImNpdGlTaGFyZS5tZmEgPSAoZnVuY3Rpb24oKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICB2YXIgbWZhQ29uZmlnID0ge1xuICAgICAgICAgICAgcHJldmlvdXNNb2RhbDogJycsXG4gICAgICAgICAgICBjdXJyZW50TW9kYWw6ICcnLFxuICAgICAgICAgICAgY29kZUV4cGlyYXRpb25UaW1lOiA2MDAwMDAsXG4gICAgICAgICAgICAkZXhwaXJlZENvZGVMaW5rOiAkKCcjZXhwaXJlZC1jb2RlLWdldC1uZXctY29kZScpLmZpbmQoJ2EnKSxcbiAgICAgICAgICAgIHBob25lTnVtYmVyRGVmYXVsdDogJ0Nob29zZSBhIHBob25lIG51bWJlcjonLFxuICAgICAgICAgICAgJG1vZGFsOiAkKCcubW9kYWwtb3ZlcmxheScpLFxuICAgICAgICAgICAgJGRyb3Bkb3duTWVudU1lbnU6ICQoJyNkcm9wZG93bi1tZW51LW1lbnUnKSxcbiAgICAgICAgICAgICRkcm9wZG93bldyYXBwZXI6ICQoJyNkcm9wZG93bi13cmFwcGVyJyksXG4gICAgICAgICAgICAkY29uZmlybUlkRm9ybTogJCgnI2NvbmZpcm0taWRlbnRpdHknKSxcbiAgICAgICAgICAgICRjb25maXJtSWRCdXR0b246ICQoJyNjb25maXJtLWlkZW50aXR5LWJ1dHRvbicpLFxuICAgICAgICAgICAgJGVudGVyQ29kZUZvcm06ICQoJyNlbnRlci1jb2RlJyksXG4gICAgICAgICAgICAkZW50ZXJDb2RlQnV0dG9uOiAkKCcjZW50ZXItY29kZS1idXR0b24nKSxcbiAgICAgICAgICAgICRjbG9zZUJ1dHRvbjogJCgnLm1mYS1jbG9zZScpLFxuICAgICAgICAgICAgZW50ZXJDb2RlVGltZXI6IG51bGwsXG4gICAgICAgICAgICBjb25maXJtSWRGb3JtVmFsdWVzOiB7fSxcbiAgICAgICAgICAgICRtc2dBZ3JlZW1lbnRDaGVjazogJCgnI21lc3NhZ2UtYWdyZWVtZW50JyksXG4gICAgICAgICAgICAkbXNnQWdyZWVtZW50Q29udGFpbmVyOiAkKCcubW9kYWwtY29uZmlybS1pZGVudGl0eS1tZXNzYWdlLWFncmVlbWVudC1jb250YWluZXInKSxcbiAgICAgICAgICAgICRyZXRyeUNvZGVCdXR0b246ICQoJy5tZmEtcmV0cnktY29kZScpLFxuICAgICAgICAgICAgJGZhcU1vZGFsOiAkKCcjbW9kYWwtbWZhLWZhcScpLFxuICAgICAgICAgICAgJGZhcUxpbms6ICQoJy5tZmEtZmFxJyksXG4gICAgICAgICAgICAkZmFxQmFjazogJCgnI21vZGFsLW1mYS1mYXEnKS5maW5kKCcubW9kYWwtbWZhLWZhcS1iYWNrJylcbiAgICAgICAgfSxcbiAgICAgICAgbW9kYWxOYW1lID0ge1xuICAgICAgICAgICAgY29uZmlybUlEOiAnY29uZmlybS1pZGVudGl0eScsXG4gICAgICAgICAgICBlbnRlckNvZGU6ICdlbnRlci1jb2RlJyxcbiAgICAgICAgICAgIHRoYW5rWW91OiAnbWZhLXRoYW5reW91JyxcbiAgICAgICAgICAgIGNvZGVFeHBpcmVkOiAnZXhwaXJlZC1jb2RlJyxcbiAgICAgICAgICAgIGZhcTogJ21mYS1mYXEnLFxuICAgICAgICAgICAgY3VzdG9tZXJTZXJ2aWNlOiAnbWZhLWN1c3RvbWVyLXNlcnZpY2UnLFxuICAgICAgICAgICAgYWNjb3VudExvY2tlZDogJ21mYS1hY2NvdW50LWxvY2tlZCdcbiAgICAgICAgfSxcbiAgICAgICAgaGFuZGxlYmFyVGVtcGxhdGVzID0gWydkcm9wZG93bi1jb21wb25lbnQnXTtcblxuICAgIGZ1bmN0aW9uIHRyYW5zaXRpb25Nb2RhbCh0b01vZGFsLCBmcm9tTW9kYWwpIHtcbiAgICAgICAgaWYgKHRvTW9kYWwgPT09IG1vZGFsTmFtZS5lbnRlckNvZGUpIHtcbiAgICAgICAgICAgIG1mYUNvbmZpZy5lbnRlckNvZGVUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cobWZhQ29uZmlnLmN1cnJlbnRNb2RhbCk7XG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbk1vZGFsKG1vZGFsTmFtZS5jb2RlRXhwaXJlZCwgbWZhQ29uZmlnLmN1cnJlbnRNb2RhbCk7XG4gICAgICAgICAgICB9LCBtZmFDb25maWcuY29kZUV4cGlyYXRpb25UaW1lKTtcbiAgICAgICAgfSBlbHNlIGlmIChtZmFDb25maWcuZW50ZXJDb2RlVGltZXIgJiYgdG9Nb2RhbCA9PT0gbW9kYWxOYW1lLnRoYW5rWW91IHx8IHRvTW9kYWwgPT09IG1vZGFsTmFtZS5jb25maXJtSUQgfHwgdG9Nb2RhbCA9PT0gbW9kYWxOYW1lLmFjY291bnRMb2NrZWQpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtZmFDb25maWcuZW50ZXJDb2RlVGltZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgY2l0aVNoYXJlLkFjY2Vzc2libGVNb2RhbCh7IG1vZGFsOiAkKCcjbW9kYWwtJyArIGZyb21Nb2RhbCkgfSkuaGlkZSgpO1xuXG4gICAgICAgIG1mYUNvbmZpZy5jdXJyZW50TW9kYWwgPSB0b01vZGFsO1xuICAgICAgICBjaXRpU2hhcmUuQWNjZXNzaWJsZU1vZGFsKHsgbW9kYWw6ICQoJyNtb2RhbC0nICsgdG9Nb2RhbCkgfSkuc2hvdygpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxvYWRIYW5kbGViYXJUZW1wbGF0ZXMoKSB7XG4gICAgICAgIGhhbmRsZWJhclRlbXBsYXRlcy5mb3JFYWNoKGZ1bmN0aW9uKHRlbXBsYXRlKSB7XG4gICAgICAgICAgICBjaXRpU2hhcmUudXRpbC5nZXRIYW5kbGViYXJQYXJ0aWFscyh0ZW1wbGF0ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxvYWROdW1iZXJEcm9wZG93bigpO1xuICAgIH1cblxuICAgIC8qIC0tLS0tLS0gbG9hZCBkYXRhIGZvciBwaG9uZSBudW1iZXIgZHJvcGRvd24gLS0tLS0tLSAqL1xuICAgIGZ1bmN0aW9uIGxvYWROdW1iZXJEcm9wZG93bigpIHtcbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHVybDogY2l0aUNvbmZpZy5lbmRQb2ludEhvc3QgKyBjaXRpQ29uZmlnLm1mYUVuZFBvaW50UGF0aCArIG1vZGFsTmFtZS5jb25maXJtSUQgKyAnLmpzb24nLFxuICAgICAgICAgICAgdHlwZTogJ2dldCcsXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgIH0pXG4gICAgICAgIC5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGRhdGEuc29ydFswXS5kZWZhdWx0VmFsdWUgPSBtZmFDb25maWcucGhvbmVOdW1iZXJEZWZhdWx0O1xuXG4gICAgICAgICAgICBtZmFDb25maWcuJGRyb3Bkb3duV3JhcHBlclxuICAgICAgICAgICAgICAgIC5hcHBlbmQoXG4gICAgICAgICAgICAgICAgICAgIGNpdGlTaGFyZS51dGlsLnJlbmRlclRlbXBsYXRlKHdpbmRvdy5IYW5kbGViYXJzLnBhcnRpYWxzWydkcm9wZG93bi1jb21wb25lbnQnXSwgZGF0YS5zb3J0WzBdKVxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNpdGlTaGFyZS5zZWxlY3RNZW51Rm9yRWxlbWVudCgpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIHNlbGVjdE1lbnVJdGVtID0gbWZhQ29uZmlnLiRkcm9wZG93bldyYXBwZXIuZmluZCgnc2VsZWN0Jyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8qIC0tLS0tLS0tIHBob25lIG51bWJlciBoaWRkZW4gZHJvcGRvd24gLS0tLS0tLS0gKi9cbiAgICAgICAgICAgICQoJ2RvY3VtZW50LGJvZHknKS5vbignc2VsZWN0bWVudWNoYW5nZScsIHNlbGVjdE1lbnVJdGVtLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJChlLnRhcmdldCksXG4gICAgICAgICAgICAgICAgICAgICRzZWxlY3RMYWJlbCA9ICQoJyNkcm9wZG93bi13cmFwcGVyJykuZmluZCgnbGFiZWxbZm9yPVwiZHJvcGRvd24tbWVudS1idXR0b25cIl0nKTtcblxuICAgICAgICAgICAgICAgIGNoZWNrSW5wdXRWYWx1ZXMoKTtcblxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy52YWwoKS50b1N0cmluZygpLnRyaW0oKSAhPT0gZGF0YS5zb3J0WzBdLmRlZmF1bHRWYWx1ZS50b1N0cmluZygpLnRyaW0oKSkge1xuICAgICAgICAgICAgICAgICAgICAkc2VsZWN0TGFiZWwuYWRkQ2xhc3MoJ3Zpc2libGUnKTtcbiAgICAgICAgICAgICAgICAgICAgJHNlbGVjdExhYmVsLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJHNlbGVjdExhYmVsLnJlbW92ZUNsYXNzKCd2aXNpYmxlJyk7XG4gICAgICAgICAgICAgICAgICAgICRzZWxlY3RMYWJlbC5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5mYWlsKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyb3I6ICcsIGVycm9yLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNoZWNrSW5wdXRWYWx1ZXMoKSB7XG4gICAgICAgIHZhciBmb3JtSW5wdXRWYWx1ZXMgPSB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZVR5cGU6IG1mYUNvbmZpZy4kY29uZmlybUlkRm9ybS5maW5kKCdpbnB1dFt0eXBlPVwicmFkaW9cIl06Y2hlY2tlZCcpLnZhbCgpLFxuICAgICAgICAgICAgICAgIHBob25lTnVtYmVyOiBtZmFDb25maWcuJGNvbmZpcm1JZEZvcm0uZmluZCgnI2Ryb3Bkb3duLW1lbnUnKS52YWwoKSxcbiAgICAgICAgICAgICAgICBhZ3JlZVRvTWVzc2FnZTogbWZhQ29uZmlnLiRtc2dBZ3JlZW1lbnRDaGVjay5wcm9wKCdjaGVja2VkJylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1ZhbGlkRGF0YSA9IHRydWU7XG5cbiAgICAgICAgZm9yICh2YXIgaW5wdXQgaW4gZm9ybUlucHV0VmFsdWVzKSB7XG4gICAgICAgICAgICBpZiAoZm9ybUlucHV0VmFsdWVzLmhhc093blByb3BlcnR5KGlucHV0KSkge1xuICAgICAgICAgICAgICAgIGlmIChmb3JtSW5wdXRWYWx1ZXNbaW5wdXRdKSB7XG4gICAgICAgICAgICAgICAgICAgIG1mYUNvbmZpZy5jb25maXJtSWRGb3JtVmFsdWVzW2lucHV0XSA9IGZvcm1JbnB1dFZhbHVlc1tpbnB1dF07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaXNWYWxpZERhdGEgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaW5wdXQgPT09ICdwaG9uZU51bWJlcicgJiYgZm9ybUlucHV0VmFsdWVzW2lucHV0XSA9PT0gbWZhQ29uZmlnLnBob25lTnVtYmVyRGVmYXVsdCkge1xuICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkRGF0YSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpc1ZhbGlkRGF0YSkge1xuICAgICAgICAgICAgbWZhQ29uZmlnLiRjb25maXJtSWRCdXR0b24ucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSkucmVtb3ZlQ2xhc3MoJ2luYWN0aXZlJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtZmFDb25maWcuJGNvbmZpcm1JZEJ1dHRvbi5wcm9wKCdkaXNhYmxlZCcsIHRydWUpLmFkZENsYXNzKCdpbmFjdGl2ZScpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbWZhQ29uZmlnLiRjb25maXJtSWRGb3JtLmZpbmQoJy5tb2RhbC1jb25maXJtLWlkZW50aXR5LXJhZGlvLWNvbnRhaW5lcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICBjaGVja0lucHV0VmFsdWVzKCk7XG4gICAgfSk7XG5cbiAgICBtZmFDb25maWcuJG1zZ0FncmVlbWVudENoZWNrLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICBjaGVja0lucHV0VmFsdWVzKCk7XG4gICAgfSk7XG5cbiAgICAvKiAtLS0tLS0tLSBjb25maXJtIGlkZW50aXR5IGZvcm0gaGFuZGxlciAtLS0tLS0tLS0gKi9cbiAgICBtZmFDb25maWcuJGNvbmZpcm1JZEJ1dHRvbi5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGZvcm1JbnB1dFZhbHVlcyA9IHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlVHlwZTogbWZhQ29uZmlnLiRjb25maXJtSWRGb3JtLmZpbmQoJ2lucHV0W3R5cGU9XCJyYWRpb1wiXTpjaGVja2VkJykudmFsKCksXG4gICAgICAgICAgICAgICAgcGhvbmVOdW1iZXI6IG1mYUNvbmZpZy4kY29uZmlybUlkRm9ybS5maW5kKCcjZHJvcGRvd24tbWVudScpLnZhbCgpLFxuICAgICAgICAgICAgICAgIGFncmVlVG9NZXNzYWdlOiBtZmFDb25maWcuJG1zZ0FncmVlbWVudENoZWNrLnByb3AoJ2NoZWNrZWQnKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICBmb3IgKHZhciBpbnB1dCBpbiBmb3JtSW5wdXRWYWx1ZXMpIHtcbiAgICAgICAgICAgIGlmIChmb3JtSW5wdXRWYWx1ZXMuaGFzT3duUHJvcGVydHkoaW5wdXQpKSB7XG4gICAgICAgICAgICAgICAgbWZhQ29uZmlnLmNvbmZpcm1JZEZvcm1WYWx1ZXNbaW5wdXRdID0gZm9ybUlucHV0VmFsdWVzW2lucHV0XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy8gY2hlY2sgaWYgdXNlciBhZ3JlZWQgdG8gcmVjZWl2ZSBhIG1lc3NhZ2UgdmlhIHRleHQgb3IgY2FsbFxuICAgICAgICBpZiAoIWlzTmFOKHBhcnNlSW50KGZvcm1JbnB1dFZhbHVlcy5waG9uZU51bWJlci5zbGljZSg4KSkpICYmIGZvcm1JbnB1dFZhbHVlcy5hZ3JlZVRvTWVzc2FnZSkge1xuICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiB1c2UgcG9zdCB1cmxcbiAgICAgICAgICAgICAgICB1cmw6IGNpdGlDb25maWcuZW5kUG9pbnRIb3N0ICsgY2l0aUNvbmZpZy5tZmFFbmRQb2ludFBhdGggKyBtb2RhbE5hbWUuZW50ZXJDb2RlICsgJy5qc29uJyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnZ2V0J1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5kb25lKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRyYW5zaXRpb25Nb2RhbChtb2RhbE5hbWUuZW50ZXJDb2RlLCBtb2RhbE5hbWUuY29uZmlybUlEKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZmFpbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiB3aGF0IGFib3V0IHNlcnZlciBlcnJvcnM/XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChpc05hTihwYXJzZUludChmb3JtSW5wdXRWYWx1ZXMucGhvbmVOdW1iZXIuc2xpY2UoLTQpKSkpIHtcbiAgICAgICAgICAgIHRyYW5zaXRpb25Nb2RhbChtb2RhbE5hbWUuY3VzdG9tZXJTZXJ2aWNlLCBtb2RhbE5hbWUuY29uZmlybUlEKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICghbWZhQ29uZmlnLiRtc2dBZ3JlZW1lbnRDb250YWluZXIuaGFzQ2xhc3MoJ2Vycm9yJykpIHtcbiAgICAgICAgICAgICAgICBtZmFDb25maWcuJG1zZ0FncmVlbWVudENvbnRhaW5lci5hZGRDbGFzcygnZXJyb3InKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgbWZhQ29uZmlnLiRjbG9zZUJ1dHRvbi5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgJCgnI21vZGFsLW92ZXJsYXknKS50cmlnZ2VyKCdjbGljaycpO1xuICAgIH0pO1xuXG4gICAgLyogLS0tLS0tLSBzZW5kIHVzZXIgYmFjayB0byBjb25maXJtLWlkZW50aXR5IG1vZGFsIC0tLS0tLS0gKi9cbiAgICBtZmFDb25maWcuJHJldHJ5Q29kZUJ1dHRvbi5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc29sZS5sb2coJChlLnRhcmdldCkuZGF0YSgnbW9kYWwnKSk7XG4gICAgICAgIHRyYW5zaXRpb25Nb2RhbChtb2RhbE5hbWUuY29uZmlybUlELCAkKGUudGFyZ2V0KS5kYXRhKCdtb2RhbCcpKTtcbiAgICB9KTtcblxuICAgIC8qIC0tLS0tLS0tIHNlbmQgdXNlciBpbnB1dCBmb3IgY29kZSB2ZXJpZmljYXRpb24gLS0tLS0tLS0gKi9cbiAgICBtZmFDb25maWcuJGVudGVyQ29kZUJ1dHRvbi5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIC8vIFRPRE86IHVzZSBwb3N0IHVybFxuICAgICAgICAgICAgdXJsOiBjaXRpQ29uZmlnLmVuZFBvaW50SG9zdCArIGNpdGlDb25maWcubWZhRW5kUG9pbnRQYXRoICsgbW9kYWxOYW1lLmVudGVyQ29kZSArICcuanNvbicsXG4gICAgICAgICAgICB0eXBlOiAnZ2V0JyxcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcbiAgICAgICAgfSlcbiAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgLy8gVE9ETzogcmVtb3ZlIGNvZGUtY2hlY2tpbmcgbG9naWNcblxuICAgICAgICAgICAgLy8gdWx0aW1hdGVseSB0aGUgZm9sbG93aW5nIGxvZ2ljIHdpbGwgYmVcbiAgICAgICAgICAgIC8vIG9uIHRoZSBzZXJ2ZXIgdGhlICdwb3N0JyByZXF1ZXN0IGlzXG4gICAgICAgICAgICAvLyBtYWRlIHRvOyBmb3Igbm93IHdlIGtlZXAgaXQgZm9yIHRlc3RpbmdcbiAgICAgICAgICAgIC8vIHB1cnBvc2VzXG4gICAgICAgICAgICB2YXIgY29kZSA9IGRhdGEuaWRlbnRpdHlDb2RlLFxuICAgICAgICAgICAgICAgIHVzZXJDb2RlSW5wdXQgPSBtZmFDb25maWcuJGVudGVyQ29kZUZvcm0uZmluZCgnLm1vZGFsLWVudGVyLWNvZGUtaW5wdXQnKS52YWwoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICRlbnRlcklkV3JhcHBlciA9ICQoJy5tb2RhbC1lbnRlci1jb2RlLXdyYXBwZXInKTtcblxuICAgICAgICAgICAgaWYgKHVzZXJDb2RlSW5wdXQgPT09IGNvZGUpIHtcbiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uTW9kYWwobW9kYWxOYW1lLnRoYW5rWW91LCBtb2RhbE5hbWUuZW50ZXJDb2RlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKCEkZW50ZXJJZFdyYXBwZXIuaGFzQ2xhc3MoJ2Vycm9yJykpIHtcbiAgICAgICAgICAgICAgICAgICAgJGVudGVySWRXcmFwcGVyLmFkZENsYXNzKCdlcnJvcicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgIC8vIFRPRE86IGlmIHVzZXIgaGFzIHRyaWVkIHRvbyBtYW55IHRpbWVzLCBzZXJ2ZXIgc2hvdWxkIHJldHVybiBlcnJvclxuICAgICAgICAgICAgLy8gYW5kIHRoZW4gd2Ugd2lsbCB0cmFuc2l0aW9uIHRvIGFjY291bnQgbG9ja2VkIG1vZGFsOlxuICAgICAgICAgICAgLy8gdHJhbnNpdGlvbk1vZGFsKG1vZGFsTmFtZS5hY2NvdW50TG9ja2VkLCBtb2RhbE5hbWUuZW50ZXJDb2RlKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcjogJyArIGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBtZmFDb25maWcuJG1vZGFsLm9uKCdjbGljaycsICcuZXJyb3InLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICB9KTtcblxuICAgIG1mYUNvbmZpZy4kZXhwaXJlZENvZGVMaW5rLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0cmFuc2l0aW9uTW9kYWwobW9kYWxOYW1lLmNvbmZpcm1JRCwgbW9kYWxOYW1lLmNvZGVFeHBpcmVkKTtcbiAgICB9KTtcblxuICAgIG1mYUNvbmZpZy4kZmFxTGluay5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgbWZhQ29uZmlnLnByZXZpb3VzTW9kYWwgPSAkKHRoaXMpLmRhdGEoJ21vZGFsJyk7XG4gICAgICAgIHRyYW5zaXRpb25Nb2RhbChtb2RhbE5hbWUuZmFxLCBtZmFDb25maWcucHJldmlvdXNNb2RhbCk7XG4gICAgfSk7XG5cbiAgICBtZmFDb25maWcuJGZhcUJhY2sub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRyYW5zaXRpb25Nb2RhbChtZmFDb25maWcucHJldmlvdXNNb2RhbCwgbW9kYWxOYW1lLmZhcSk7XG4gICAgfSk7XG5cbiAgICAvKiAtLS0tLS0gXCJiYWNrXCIgZm9yIGNsb3NlIGJ1dHRvbiBmb3IgdGhlIEZBUSBtb2RhbCAtLS0tLS0tICovXG4gICAgbWZhQ29uZmlnLiRmYXFNb2RhbC5vbignY2xpY2snLCAnLm1vZGFsLWNsb3NlLWJ1dHRvbicsIGZ1bmN0aW9uKCkge1xuICAgICAgICB0cmFuc2l0aW9uTW9kYWwobWZhQ29uZmlnLnByZXZpb3VzTW9kYWwsIG1vZGFsTmFtZS5mYXEpO1xuICAgIH0pO1xuXG4gICAgLyogLS0tLS0tIHBsdXNlcyBhbmQgbWludXNlcyB0aGUgYW5zd2VyIGNvcHkgZm9yIHRoZSBGQVEgbW9kYWwgLS0tLS0tLSAqL1xuICAgIG1mYUNvbmZpZy4kZmFxTW9kYWwub24oJ2NsaWNrJywgJy5tb2RhbC1tZmEtZmFxLXBsdXMtbWludXMnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIHZhciAkdGFyZ2V0ID0gJChlLnRhcmdldCksXG4gICAgICAgICAgICAkY29udGFpbmVyID0gJHRhcmdldC5wYXJlbnQoKTtcblxuICAgICAgICBpZiAoJGNvbnRhaW5lci5oYXNDbGFzcygnb3BlbicpKSB7XG4gICAgICAgICAgICAkY29udGFpbmVyLnJlbW92ZUNsYXNzKCdvcGVuJyk7XG4gICAgICAgICAgICAkKGUudGFyZ2V0KS5hdHRyKCdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkY29udGFpbmVyLmFkZENsYXNzKCdvcGVuJyk7XG4gICAgICAgICAgICAkKGUudGFyZ2V0KS5hdHRyKCdhcmlhLWV4cGFuZGVkJywgJ3RydWUnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gVE9ETzogdXNlIGEgbW9yZSBzcGVjaWZpYyBob29rIHRvIGxvYWQgZHJvcGRvd24gd2hlbiBuZWNlc3NhcnlcbiAgICBpZihtZmFDb25maWcuJGZhcU1vZGFsLmxlbmd0aCkge1xuICAgICAgICBsb2FkSGFuZGxlYmFyVGVtcGxhdGVzKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuO1xufSkoKTtcbiIsIi8qKlxuICogSlNIaW50OlxuICogVG8gYWxsb3cgYnJhY2tldCBub3RhdGlvbixcbiAqIEZvciBleGFtcGxlLCB0ZXN0W1wicGxhY2Vob2xkZXJcIl0gdnMgdGVzdC5wbGFjZWhvbGRlclxuICovXG5cbi8qanNoaW50IHN1Yjp0cnVlKi9cblxuY2l0aVNoYXJlLm1vY2tFbmRQb2ludCA9IChmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgbW9ja0RhdGEgPSB7XG4gICAgICAgIFwiYWNjb3VudE51bWJlclwiOiBcIjEyMzQ1XCIsXG4gICAgICAgIFwibXVsdGlwbGllclwiIDogMSxcbiAgICAgICAgXCJjdXJyZW5jeVNlcGFyYXRvclwiIDogXCIsXCIsXG4gICAgICAgIFwic3RlcHNcIiA6IDEwMDAsXG4gICAgICAgIFwibWluaW11bUV4Y2hhbmdlXCIgOiAxMDAwLFxuICAgICAgICBcIm1heGltdW1FeGNoYW5nZVwiIDogMjAwMDAsXG4gICAgICAgIFwiaWRlbnRpdHlDb2RlXCI6IFwiMTExMVwiXG4gICAgfTtcblxuICAgIHJldHVybiBtb2NrRGF0YTtcbn0pKCk7XG5cbiIsIi8vIEJhc2VkIG9uIHRoZSBjb2RlIGZyb206IGh0dHBzOi8vZ2l0aHViLmNvbS9nZGtyYXVzL2FjY2Vzc2libGUtbW9kYWwtZGlhbG9nXG5cbi8qXG5cbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuIExpY2Vuc2UgZm9yIEFwcGxpY2F0aW9uXG4gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuIFRoaXMgbGljZW5zZSBpcyBnb3Zlcm5lZCBieSBVbml0ZWQgU3RhdGVzIGNvcHlyaWdodCBsYXcsIGFuZCB3aXRoIHJlc3BlY3QgdG8gbWF0dGVyc1xuIG9mIHRvcnQsIGNvbnRyYWN0LCBhbmQgb3RoZXIgY2F1c2VzIG9mIGFjdGlvbiBpdCBpcyBnb3Zlcm5lZCBieSBOb3J0aCBDYXJvbGluYSBsYXcsXG4gd2l0aG91dCByZWdhcmQgdG8gTm9ydGggQ2Fyb2xpbmEgY2hvaWNlIG9mIGxhdyBwcm92aXNpb25zLiAgVGhlIGZvcnVtIGZvciBhbnkgZGlzcHV0ZVxuIHJlc29sdXRpb24gc2hhbGwgYmUgaW4gV2FrZSBDb3VudHksIE5vcnRoIENhcm9saW5hLlxuXG4gUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0IG1vZGlmaWNhdGlvbiwgYXJlXG4gcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6XG5cbiAxLiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdFxuIG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cblxuIDIuIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpc1xuIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlclxuIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXG5cbiAzLiBUaGUgbmFtZSBvZiB0aGUgYXV0aG9yIG1heSBub3QgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tXG4gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cblxuIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIEFVVEhPUiBcIkFTIElTXCIgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRURcbiBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFlcbiBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkVcbiBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUxcbiBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUztcbiBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZXG4gVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVCAoSU5DTFVESU5HXG4gTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGXG4gQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXG5cbiAqL1xuXG5cbmNpdGlTaGFyZS5BY2Nlc3NpYmxlTW9kYWwgPSBmdW5jdGlvbihzZXR0aW5ncykge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgaWYoIXNldHRpbmdzLm1vZGFsKXtcbiAgICAgICAgY29uc29sZS53YXJuKFwibW9kYWwgcHJvcGVydHkgcmVxdWlyZWQgZm9yIEFjY2Vzc2libGVNb2RhbFwiKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHZhciBfZGVmYXVsdFNldHRpbmdzID0ge1xuICAgICAgICBtYWluUGFnZTogJCgnI29jLWNvbnRhaW5lcicpLFxuICAgICAgICBvdmVybGF5OiAkKCcjbW9kYWwtb3ZlcmxheScpLFxuICAgICAgICBjbG9zZUJ1dHRvbjogc2V0dGluZ3MubW9kYWwuZmluZCgnLm1vZGFsLWNsb3NlLWJ1dHRvbicpLFxuICAgICAgICBvbk9wZW46IHVuZGVmaW5lZCxcbiAgICAgICAgb25DbG9zZTogdW5kZWZpbmVkLFxuICAgICAgICBwcmV2aW91c0VsZW1lbnQ6IHVuZGVmaW5lZCxcbiAgICAgICAgbW9kYWxUeXBlOidjb21wbGV4J1xuICAgIH07XG5cbiAgICB2YXIgX3NldHRpbmdzID0gJC5leHRlbmQoe30sIF9kZWZhdWx0U2V0dGluZ3MsIHNldHRpbmdzKTtcblxuICAgIC8vICQgZm9ybWF0dGVkIHNlbGVjdG9yIHRvIHNlYXJjaCBmb3IgZm9jdXNhYmxlIGl0ZW1zXG4gICAgdmFyIF9mb2N1c2FibGVFbGVtZW50c1N0cmluZyA9IFwiKltkYXRhLW1vZGFsLWhlYWRlcl0sIGFbaHJlZl0sIGFyZWFbaHJlZl0sIC50YWJiYWJsZS1lbGVtZW50LCBpbnB1dDpub3QoW2Rpc2FibGVkXSksIHNlbGVjdDpub3QoW2Rpc2FibGVkXSksIHRleHRhcmVhOm5vdChbZGlzYWJsZWRdKSwgYnV0dG9uOm5vdChbZGlzYWJsZWRdKSwgaWZyYW1lLCBvYmplY3QsIGVtYmVkLCAgKltjb250ZW50ZWRpdGFibGVdLCAqW2RhdGEtbW9kYWwtZm9jdXNhYmxlXVwiO1xuXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIGlmKF9zZXR0aW5ncy5tb2RhbFR5cGUgPT09ICdjb21wbGV4Jykge1xuICAgICAgICBfc2V0dGluZ3Mub3ZlcmxheS5iaW5kKCdjbGljaycsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBfaGlkZU1vZGFsKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIF9zZXR0aW5ncy5jbG9zZUJ1dHRvbi5iaW5kKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgX2hpZGVNb2RhbCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBfc2V0dGluZ3MubW9kYWwuYmluZCgna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIF90cmFwVGFiS2V5KF9zZXR0aW5ncy5tb2RhbCwgZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIF9zZXR0aW5ncy5tb2RhbC5iaW5kKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgX3RyYXBFc2NhcGVLZXkoX3NldHRpbmdzLm1vZGFsLCBlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgX3Nob3dNb2RhbCgpO1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfc2V0dGluZ3Mub3ZlcmxheS5iaW5kKCdjbGljaycsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgX2hpZGVTaW1wbGVNb2RhbCgpO1xuICAgICAgICB9KTtcbiAgXG4gICAgICAgIF9zZXR0aW5ncy5jbG9zZUJ1dHRvbi5iaW5kKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIF9oaWRlU2ltcGxlTW9kYWwoKTtcbiAgICAgICAgfSk7XG4gIFxuICAgICAgICBfc2V0dGluZ3MubW9kYWwuYmluZCgna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICBfdHJhcFRhYktleShfc2V0dGluZ3MubW9kYWwsIGUpO1xuICAgICAgICB9KTtcbiAgXG4gICAgICAgIF9zZXR0aW5ncy5tb2RhbC5iaW5kKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgIF90cmFwRXNjYXBlS2V5KF9zZXR0aW5ncy5tb2RhbCwgZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIF9zaG93U2ltcGxlTW9kYWwoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfdHJhcEVzY2FwZUtleShvYmosIGV2dCkge1xuICAgICAgICAvLyBpZiBlc2NhcGUgcHJlc3NlZFxuICAgICAgICBpZiAoZXZ0LndoaWNoID09PSAyNykge1xuICAgICAgICAgICAgX3NldHRpbmdzLmNsb3NlQnV0dG9uLmNsaWNrKCk7XG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX3RyYXBUYWJLZXkob2JqLCBldnQpIHtcbiAgICAgICAgLy8gaWYgdGFiIG9yIHNoaWZ0LXRhYiBwcmVzc2VkXG4gICAgICAgIGlmIChldnQud2hpY2ggPT09IDkpIHtcblxuICAgICAgICAgICAgLy8gZ2V0IGxpc3Qgb2YgYWxsIGNoaWxkcmVuIGVsZW1lbnRzIGluIGdpdmVuIG9iamVjdFxuICAgICAgICAgICAgdmFyIG8gPSBvYmouZmluZCgnKicpO1xuXG4gICAgICAgICAgICAvLyBnZXQgbGlzdCBvZiBmb2N1c2FibGUgaXRlbXNcbiAgICAgICAgICAgIHZhciBmb2N1c2FibGVJdGVtcztcbiAgICAgICAgICAgIGZvY3VzYWJsZUl0ZW1zID0gby5maWx0ZXIoX2ZvY3VzYWJsZUVsZW1lbnRzU3RyaW5nKS5maWx0ZXIoJzp2aXNpYmxlJyk7XG5cbiAgICAgICAgICAgIC8vIGdldCBjdXJyZW50bHkgZm9jdXNlZCBpdGVtXG4gICAgICAgICAgICB2YXIgZm9jdXNlZEl0ZW07XG4gICAgICAgICAgICBmb2N1c2VkSXRlbSA9ICQoJzpmb2N1cycpO1xuXG4gICAgICAgICAgICAvLyBnZXQgdGhlIG51bWJlciBvZiBmb2N1c2FibGUgaXRlbXNcbiAgICAgICAgICAgIHZhciBudW1iZXJPZkZvY3VzYWJsZUl0ZW1zO1xuICAgICAgICAgICAgbnVtYmVyT2ZGb2N1c2FibGVJdGVtcyA9IGZvY3VzYWJsZUl0ZW1zLmxlbmd0aDtcblxuICAgICAgICAgICAgLy8gZ2V0IHRoZSBpbmRleCBvZiB0aGUgY3VycmVudGx5IGZvY3VzZWQgaXRlbVxuICAgICAgICAgICAgdmFyIGZvY3VzZWRJdGVtSW5kZXg7XG4gICAgICAgICAgICBmb2N1c2VkSXRlbUluZGV4ID0gZm9jdXNhYmxlSXRlbXMuaW5kZXgoZm9jdXNlZEl0ZW0pO1xuXG4gICAgICAgICAgICBpZiAoZXZ0LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgLy9iYWNrIHRhYlxuICAgICAgICAgICAgICAgIC8vIGlmIGZvY3VzZWQgb24gZmlyc3QgaXRlbSBhbmQgdXNlciBwcmVzc2VzIGJhY2stdGFiLCBnbyB0byB0aGUgbGFzdCBmb2N1c2FibGUgaXRlbVxuICAgICAgICAgICAgICAgIGlmIChmb2N1c2VkSXRlbUluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvY3VzYWJsZUl0ZW1zLmdldChudW1iZXJPZkZvY3VzYWJsZUl0ZW1zIC0gMSkuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vZm9yd2FyZCB0YWJcbiAgICAgICAgICAgICAgICAvLyBpZiBmb2N1c2VkIG9uIHRoZSBsYXN0IGl0ZW0gYW5kIHVzZXIgcHJlc3NlcyB0YWIsIGdvIHRvIHRoZSBmaXJzdCBmb2N1c2FibGUgaXRlbVxuICAgICAgICAgICAgICAgIGlmIChmb2N1c2VkSXRlbUluZGV4ID09PSBudW1iZXJPZkZvY3VzYWJsZUl0ZW1zIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICBmb2N1c2FibGVJdGVtcy5nZXQoMCkuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfb25Nb2RhbFJlc2l6ZSgpIHtcblxuICAgICAgICB2YXIgbW9kYWxDb250YWluZXIgPSBfc2V0dGluZ3MubW9kYWwuZmluZCgnLmhhcy1vdmVyZmxvdycpO1xuICAgICAgICBtb2RhbENvbnRhaW5lci5jc3MoJ2hlaWdodCcsICdhdXRvJyk7IC8vIHJlc2V0IHByZXZpb3VzIGlubGluZSBoZWlnaHQgZm9yIHByb3BlciBjYWxjdWxhdGlvblxuXG4gICAgICAgIHZhciBoZWFkZXJIZWlnaHQgPSBfc2V0dGluZ3MubW9kYWwuZmluZCgnLm1vZGFsLWhlYWRlci10aXRsZScpLm91dGVySGVpZ2h0KCk7XG4gICAgICAgIHZhciBjbG9zZUhlaWdodCA9IF9zZXR0aW5ncy5tb2RhbC5maW5kKCcuY2xvc2UtYnRuLWNvbnRhaW5lcicpLm91dGVySGVpZ2h0KCk7XG4gICAgICAgIHZhciBtb2RhbEhlaWdodCA9IF9zZXR0aW5ncy5tb2RhbC5vdXRlckhlaWdodCgpO1xuXG4gICAgICAgIHZhciBjb250ZW50SGVpZ2h0ID0gbW9kYWxIZWlnaHQgLSAoaGVhZGVySGVpZ2h0ICsgY2xvc2VIZWlnaHQpO1xuXG4gICAgICAgIG1vZGFsQ29udGFpbmVyLmNzcygnaGVpZ2h0JywgY29udGVudEhlaWdodCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX3Nob3dNb2RhbChvYmopIHtcbiAgICAgIGlmKCFvYmopIHtcbiAgICAgICAgb2JqID0gX3NldHRpbmdzLm1vZGFsO1xuICAgICAgfVxuICAgICAgX3NldHRpbmdzLm1haW5QYWdlLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTsgLy8gbWFyayB0aGUgbWFpbiBwYWdlIGFzIGhpZGRlblxuICAgICAgX3NldHRpbmdzLm92ZXJsYXkuYWRkQ2xhc3MoJ29wZW5lZCcpOyAvLyBpbnNlcnQgYW4gb3ZlcmxheSB0byBwcmV2ZW50IGNsaWNraW5nIGFuZCBtYWtlIGEgdmlzdWFsIGNoYW5nZSB0byBpbmRpY2F0ZSB0aGUgbWFpbiBhcGdlIGlzIG5vdCBhdmFpbGFibGVcbiAgICAgIF9zZXR0aW5ncy5tb2RhbC5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTsgLy8gbWFrZSB0aGUgbW9kYWwgd2luZG93IHZpc2libGVcbiAgICAgIF9zZXR0aW5ncy5tb2RhbC5hdHRyKCdhcmlhLWhpZGRlbicsICdmYWxzZScpOyAvLyBtYXJrIHRoZSBtb2RhbCB3aW5kb3cgYXMgdmlzaWJsZVxuXG4gICAgICBjaXRpU2hhcmUuY2xvc2VTZWFyY2goKTtcbiAgICAgIHZhciBwYWRkaW5nVG9wID0gMDtcbiAgICAgIHZhciBtb2RhbERlc2t0b3BQYWRkaW5nID0gMTgwO1xuICAgICAgdmFyIHdpbmRvd1dpZHRoID0gd2luZG93LmlubmVyV2lkdGggfHwgJCh3aW5kb3cpLndpZHRoKCk7XG4gICAgICB2YXIgd2luZG93VGFsbEVub3VnaCA9IChfc2V0dGluZ3MubW9kYWwuaGVpZ2h0KCkgKyBtb2RhbERlc2t0b3BQYWRkaW5nIDwgd2luZG93LmlubmVySGVpZ2h0KTtcbiAgICAgIGlmKHdpbmRvd1dpZHRoID4gNzY4ICYmIHdpbmRvd1RhbGxFbm91Z2gpIHtcbiAgICAgICAgcGFkZGluZ1RvcCA9IG1vZGFsRGVza3RvcFBhZGRpbmc7XG4gICAgICB9XG4gICAgICB2YXIgdGhlVG9wID0gKHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wKSAgLSAoIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRUb3AgfHwgMCkgKyBwYWRkaW5nVG9wO1xuICAgICAgX3NldHRpbmdzLm1vZGFsLmNzcyh7XG4gICAgICAgICdwb3NpdGlvbic6J2Fic29sdXRlJyxcbiAgICAgICAgJ3RvcCc6IHRoZVRvcCArICdweCdcbiAgICAgIH0pO1xuXG4gICAgICAvLyBnZXQgbGlzdCBvZiBhbGwgY2hpbGRyZW4gZWxlbWVudHMgaW4gZ2l2ZW4gb2JqZWN0XG4gICAgICB2YXIgbyA9IG9iai5maW5kKCcqJyk7XG5cbiAgICAgIC8vIFNhZmFyaSBhbmQgVm9pY2VPdmVyIHNoaW1cbiAgICAgIC8vIGlmIFZvaWNlT3ZlciBpbiBTYWZhcmkgaXMgdXNlZCwgc2V0IHRoZSBpbml0aWFsIGZvY3VzIHRvIHRoZSBtb2RhbCB3aW5kb3cgaXRzZWxmIGluc3RlYWQgb2YgdGhlIGZpcnN0IGtleWJvYXJkIGZvY3VzYWJsZSBpdGVtLiBUaGlzIGNhdXNlcyBWb2ljZU92ZXIgdG8gYW5ub3VuY2UgdGhlIGFyaWEtbGFiZWxsZWQgYXR0cmlidXRlcy4gT3RoZXJ3aXNlLCBTYWZhcmkgYW5kIFZvaWNlT3ZlciB3aWxsIG5vdCBhbm5vdW5jZSB0aGUgbGFiZWxzIGF0dGFjaGVkIHRvIHRoZSBtb2RhbCB3aW5kb3cuXG5cbiAgICAgIC8vIHNldCB0aGUgZm9jdXMgdG8gdGhlIGZpcnN0IGtleWJvYXJkIGZvY3VzYWJsZSBpdGVtXG4gICAgICBvLmZpbHRlcihfZm9jdXNhYmxlRWxlbWVudHNTdHJpbmcpLmZpbHRlcignOnZpc2libGUnKS5maXJzdCgpLmZvY3VzKCk7XG4gICAgICBpZihfc2V0dGluZ3Mub25PcGVuKSB7XG4gICAgICAgIF9zZXR0aW5ncy5vbk9wZW4uY2FsbCgpO1xuICAgICAgfVxuICAgICAgaWYgKF9zZXR0aW5ncy5tb2RhbC5maW5kKCcuaGFzLW92ZXJmbG93JykubGVuZ3RoID4gMCkge1xuICAgICAgICBfb25Nb2RhbFJlc2l6ZSgpO1xuICAgICAgICAkKHdpbmRvdykucmVzaXplKF9vbk1vZGFsUmVzaXplKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfc2hvd1NpbXBsZU1vZGFsKG9iaikge1xuICAgICAgaWYoIW9iaikge1xuICAgICAgICBvYmogPSBfc2V0dGluZ3MubW9kYWw7XG4gICAgICB9XG4gICAgICBfc2V0dGluZ3MubWFpblBhZ2UuYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpOyAvLyBtYXJrIHRoZSBtYWluIHBhZ2UgYXMgaGlkZGVuXG4gICAgICBfc2V0dGluZ3MubW9kYWwuYXR0cignYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTsgLy8gbWFyayB0aGUgbW9kYWwgd2luZG93IGFzIHZpc2libGVcblxuICAgICAgLy8gZ2V0IGxpc3Qgb2YgYWxsIGNoaWxkcmVuIGVsZW1lbnRzIGluIGdpdmVuIG9iamVjdFxuICAgICAgdmFyIG8gPSBvYmouZmluZCgnKicpO1xuXG4gICAgICAvLyBTYWZhcmkgYW5kIFZvaWNlT3ZlciBzaGltXG4gICAgICAvLyBpZiBWb2ljZU92ZXIgaW4gU2FmYXJpIGlzIHVzZWQsIHNldCB0aGUgaW5pdGlhbCBmb2N1cyB0byB0aGUgbW9kYWwgd2luZG93IGl0c2VsZiBpbnN0ZWFkIG9mIHRoZSBmaXJzdCBrZXlib2FyZCBmb2N1c2FibGUgaXRlbS4gVGhpcyBjYXVzZXMgVm9pY2VPdmVyIHRvIGFubm91bmNlIHRoZSBhcmlhLWxhYmVsbGVkIGF0dHJpYnV0ZXMuIE90aGVyd2lzZSwgU2FmYXJpIGFuZCBWb2ljZU92ZXIgd2lsbCBub3QgYW5ub3VuY2UgdGhlIGxhYmVscyBhdHRhY2hlZCB0byB0aGUgbW9kYWwgd2luZG93LlxuXG4gICAgICAvLyBzZXQgdGhlIGZvY3VzIHRvIHRoZSBmaXJzdCBrZXlib2FyZCBmb2N1c2FibGUgaXRlbVxuICAgICAgby5maWx0ZXIoX2ZvY3VzYWJsZUVsZW1lbnRzU3RyaW5nKS5maWx0ZXIoJzp2aXNpYmxlJykuZmlyc3QoKS5mb2N1cygpO1xuICAgICAgaWYoX3NldHRpbmdzLm9uT3Blbikge1xuICAgICAgICBfc2V0dGluZ3Mub25PcGVuLmNhbGwoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfaGlkZU1vZGFsKCkge1xuICAgICAgICAkKHdpbmRvdykudW5iaW5kKCdyZXNpemUnLCBfb25Nb2RhbFJlc2l6ZSk7XG4gICAgICAgIF9zZXR0aW5ncy5tb2RhbC5maW5kKCcuaGFzLW92ZXJmbG93JykuY3NzKCdoZWlnaHQnLCdhdXRvJyk7XG4gICAgICAgIF9zZXR0aW5ncy5vdmVybGF5LnJlbW92ZUNsYXNzKCdvcGVuZWQnKTsgLy8gcmVtb3ZlIHRoZSBvdmVybGF5IGluIG9yZGVyIHRvIG1ha2UgdGhlIG1haW4gc2NyZWVuIGF2YWlsYWJsZSBhZ2FpblxuICAgICAgICBfc2V0dGluZ3MubW9kYWwuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTsgLy8gaGlkZSB0aGUgbW9kYWwgd2luZG93XG4gICAgICAgIF9zZXR0aW5ncy5tb2RhbC5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7IC8vIG1hcmsgdGhlIG1vZGFsIHdpbmRvdyBhcyBoaWRkZW5cblxuICAgICAgICB2YXIgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCAkKHdpbmRvdykud2lkdGgoKTtcblxuICAgICAgICBpZih3aW5kb3dXaWR0aCA8PSA3Njgpe1xuICAgICAgICAgICAgX3NldHRpbmdzLm1haW5QYWdlLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuJyk7XG4gICAgICAgICAgICBpZihfc2V0dGluZ3MucHJldmlvdXNFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgX3NldHRpbmdzLnByZXZpb3VzRWxlbWVudC5mb2N1cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIF9zZXR0aW5ncy5tYWluUGFnZS5yZW1vdmVBdHRyKCdhcmlhLWhpZGRlbicpO1xuICAgICAgICAgICAgICBpZihfc2V0dGluZ3MucHJldmlvdXNFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIF9zZXR0aW5ncy5wcmV2aW91c0VsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKF9zZXR0aW5ncy5vbkNsb3NlKSB7XG4gICAgICAgICAgICBfc2V0dGluZ3Mub25DbG9zZS5jYWxsKCk7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9oaWRlU2ltcGxlTW9kYWwoKSB7XG4gICAgICBfc2V0dGluZ3MubWFpblBhZ2UuYXR0cignYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTsgLy8gbWFyayB0aGUgbWFpbiBwYWdlIGFzIHZpZXdhYmxlXG4gICAgICBfc2V0dGluZ3MubW9kYWwuYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpOyAvLyBtYXJrIHRoZSBtb2RhbCB3aW5kb3cgYXMgaGlkZGVuXG5cbiAgICAgIGlmKF9zZXR0aW5ncy5vbkNsb3NlKSB7XG4gICAgICAgICAgX3NldHRpbmdzLm9uQ2xvc2UuY2FsbCgpO1xuICAgICAgfVxuXG4gIH1cblxuICAgIGluaXQoKTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHNob3c6X3Nob3dNb2RhbCxcbiAgICAgICAgaGlkZTpfaGlkZU1vZGFsXG4gICAgfTtcbn07XG4iLCJcInVzZSBzdHJpY3RcIjtcblxuY2l0aVNoYXJlLmFqYXhDYWxscyA9IChmdW5jdGlvbiAoKSB7XG5cbiAgdmFyIGFqYXhDb25maWcgPSB7XG4gICAgJGFqYXhTZWxlY3RzOiAkKCcuYWpheC1zZWxlY3QnKSxcbiAgICAkYWpheE11bHRpU2VsZWN0czogJCgnLmFqYXgtbXVsdGktc2VsZWN0JyksXG4gICAgJGFqYXhNdWx0aVNlbGVjdFNvcnQ6ICQoJy5hamF4LW11bHRpLXNlbGVjdC1zb3J0JyksXG4gICAgJGFqYXhHZXRzOiAkKCcuYWpheC1nZXQnKSxcbiAgICAkYWpheE92ZXJsYXlzOiAkKCcuYWpheC1vdmVybGF5JyksXG4gICAgJGFqYXhQb3N0czogJCgnLmFqYXgtcG9zdCcpLFxuICAgICRhamF4RGVsZXRlczogJCgnLmFqYXgtZGVsZXRlJyksXG4gICAgJGFqYXhTb3J0czogJCgnLmFqYXgtc29ydCcpLFxuICAgICRhamF4U2VhcmNoOiAkKCcuYWpheC1zZWFyY2gnKSxcbiAgICAkYWpheFJlaW5zdGF0ZVBvaW50czogJCgnLmFqYXgtcmVpbnN0YXRlJyksXG4gICAgJGRhdGVSYW5nZVNlbGVjdHM6ICQoJy5kYXRlLXJhbmdlLWFqYXgtc2VhcmNoJyksXG4gICAgJHBvaW50c1N1bW1hcnlUYWJzOiAkKCcucG9pbnRzLWRldGFpbHMgLnRhYmxpc3QgbGknKVxuICB9O1xuXG4gIC8vIEFqYXggY2FsbCB0byBnZXQgYW5kIGFwcGVuZCBIVE1MXG4gIC8vIGRlc3RpbmF0aW9uIGlzIHdoZXJlIHRoZSBodG1sIHdpbGwgYmUgaW5qZWN0ZWRcbiAgLy8gdXJsIGlzIHRoZSBmcmFnbWVudCBnZXQgaW4gYWpheFxuICB2YXIgX2FqYXhHZXRBbmRBcHBlbmQgPSBmdW5jdGlvbiBfYWpheEdldEFuZEFwcGVuZChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHZhciBkZXN0ID0gJCh0aGlzKS5kYXRhKFwiZGVzdGluYXRpb25cIik7XG4gICAgdmFyIHVybCA9ICQodGhpcykuZGF0YShcInVybFwiKTtcblxuICAgICQuZ2V0KHVybCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICQoJy4nICsgZGVzdCkuaHRtbChkYXRhKTtcbiAgICAgICQoZG9jdW1lbnQpLnRyaWdnZXIoJ2dldC5zdWNjZXNzJyk7XG4gICAgfSk7XG4gIH07XG5cbiAgLy9DQUxMIEFKQVggT1JERVIgSElTVE9SWVxuICB2YXIgX29yZGVySGlzdG9yeVNvcnQgPSBmdW5jdGlvbiBfb3JkZXJIaXN0b3J5U29ydCgpIHtcblxuICAgIHZhciBkZXN0ID0gJCh0aGlzKS5wYXJlbnRzKFwibGlcIikuZGF0YShcImRlc3RpbmF0aW9uXCIpLFxuICAgICAgICB1cmwgPSAkKHRoaXMpLnBhcmVudHMoXCJsaVwiKS5kYXRhKFwidXJsXCIpLFxuICAgICAgICBzZWFyY2hLZXkgPSAkKHRoaXMpLnBhcmVudHMoXCJsaVwiKS5kYXRhKFwic2VhcmNoLWtleVwiKSxcbiAgICAgICAgdmFsdWUgPSAkKHRoaXMpLnBhcmVudHMoXCJsaVwiKS5kYXRhKFwidmFsdWVcIik7XG5cbiAgICAkKFwiLm11bHRpc2VsZWN0LWxpc3QtY29udGFpbmVyW2RhdGEtXCIgKyBzZWFyY2hLZXkgKyBcIl1cIikuZGF0YShzZWFyY2hLZXksIHZhbHVlKTtcblxuICAgIHZhciB0aW1lZnJhbWVWYWx1ZSA9ICQoXCIubXVsdGlzZWxlY3QtbGlzdC1jb250YWluZXJbZGF0YS10aW1lZnJhbWVdXCIpLmRhdGEoXCJ0aW1lZnJhbWVcIiksXG4gICAgICBzb3J0VmFsdWUgPSAkKFwiLm11bHRpc2VsZWN0LWxpc3QtY29udGFpbmVyW2RhdGEtc29ydF1cIikuZGF0YShcInNvcnRcIik7XG5cbiAgICB1cmwgKz0gXCI/dGltZWZyYW1lPVwiICsgdGltZWZyYW1lVmFsdWUgKyBcIiZzb3J0PVwiICsgc29ydFZhbHVlO1xuXG4gICAgJC5nZXQodXJsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgJCgnLicgKyBkZXN0KS5odG1sKGRhdGEpO1xuICAgICAgJChkb2N1bWVudCkudHJpZ2dlcignZ2V0LnN1Y2Nlc3MnKTtcbiAgICB9KTtcbiAgfTtcblxuICAvLyBBamF4IGNhbGwgdG8gZ2V0IGFuZCBhcHBlbmQgSFRNTCB2aWEgYSBtdWx0aXNlbGVjdCBmaWx0ZXJcbiAgLy8gZGVzdGluYXRpb24gaXMgd2hlcmUgdGhlIGh0bWwgd2lsbCBiZSBpbmplY3RlZFxuICAvLyB1cmwgaXMgdGhlIGZyYWdtZW50IGdldCBpbiBhamF4XG4gIHZhciBfYWpheFNlYXJjaEdldEFuZEFwcGVuZCA9IGZ1bmN0aW9uIF9hamF4U2VhcmNoR2V0QW5kQXBwZW5kKCkge1xuICAgIHZhciBkZXN0ID0gJCh0aGlzKS5wYXJlbnRzKFwibGlcIikuZGF0YShcImRlc3RpbmF0aW9uXCIpLFxuICAgICAgdXJsID0gJCh0aGlzKS5wYXJlbnRzKFwibGlcIikuZGF0YShcInVybFwiKSxcbiAgICAgIHNlYXJjaEtleSA9ICQodGhpcykucGFyZW50cyhcImxpXCIpLmRhdGEoXCJzZWFyY2gta2V5XCIpLFxuICAgICAgdmFsdWUgPSAkKHRoaXMpLnBhcmVudHMoXCJsaVwiKS5kYXRhKFwidmFsdWVcIiksXG4gICAgICBsYWJlbCA9ICQodGhpcykucGFyZW50cyhcImxpXCIpLmZpbmQoXCJsYWJlbCBzcGFuOmZpcnN0LWNoaWxkXCIpLmh0bWwoKTtcblxuICAgIHVybCArPSBcIj9cIiArIHNlYXJjaEtleSArIFwiPVwiICsgdmFsdWU7XG5cbiAgICAkLmdldCh1cmwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAkKCcuJyArIGRlc3QpLmh0bWwoZGF0YSk7XG4gICAgfSk7XG4gICAgJChcInNwYW5bZGF0YS1tZXNzYWdlLXR5cGU9J1wiICsgc2VhcmNoS2V5ICsgXCInXVwiKS5odG1sKGxhYmVsKTtcbiAgfTtcblxuICAvLyBBamF4IGNhbGwgdG8gZ2V0IGFuZCBhcHBlbmQgSFRNTFxuICAvLyBkZXN0aW5hdGlvbiBpcyB3aGVyZSB0aGUgaHRtbCB3aWxsIGJlIGluamVjdGVkLCBpbiB0aGlzIGNhc2UgY2FuIGJlIG11bHRpcGxlIHNlcGVyYXRlZCBieSBjb21tYXNcbiAgLy8gdXJsIGlzIHRoZSBmcmFnbWVudCBnZXQgaW4gYWpheCwgaW4gdGhpcyBjYXNlIGNhbiBiZSBtdWx0aXBsZSBzZXBlcmF0ZWQgYnkgY29tbWFzXG4gIC8vIHNlYXJjaEtleSBpcyBhIGN1c3RvbWl6YWJsZSBrZXkgZm91bmQgb24gdGhlIGVsZW1lbnQgaXRzZWxmXG4gIC8vIHNlYXJjaEdyb3VwIGlzIGEgdmFsaWRhdGlvbiB0byBlbnN1cmUgd2UgcGFzcyBvbmx5IHBhcmFtZXRlcnMgZnJvbSBhIGdyb3VwIG9mIHNlbGVjdHNcbiAgdmFyIF9hamF4R2V0U2VhcmNoQnlEYXRlUmFuZ2UgPSBmdW5jdGlvbiBfYWpheEdldFNlYXJjaEJ5RGF0ZVJhbmdlKCkge1xuICAgIHZhciAkdGhpcyA9ICQodGhpcyksXG4gICAgICB1cmwgPSAkKFwiLmRhdGUtcmFuZ2UtYWN0aXZlXCIpLmRhdGEoXCJ1cmxcIiksXG4gICAgICBkZXN0aW5hdGlvbiA9ICQoXCIuZGF0ZS1yYW5nZS1hY3RpdmUgLmFqYXgtcmVjZWl2ZXJcIiksXG4gICAgICBzZWFyY2hLZXkgPSAkdGhpcy5wYXJlbnRzKFwibGlcIikuZGF0YShcInNlYXJjaC1rZXlcIiksXG4gICAgICB2YWx1ZSA9ICR0aGlzLnBhcmVudHMoXCJsaVwiKS5kYXRhKFwidmFsdWVcIiksXG4gICAgICBwYXJlbnQgPSAkdGhpcy5wYXJlbnRzKFwiLm11bHRpc2VsZWN0LWxpc3QtY29udGFpbmVyXCIpLFxuICAgICAgbW9udGhOYW1lcyA9ICQoXCIuZGF0ZS1yYW5nZVwiKS5kYXRhKFwibW9udGhzXCIpLnNwbGl0KFwiLFwiKSxcbiAgICAgIGxvYWRpbmdBY3Rpb24gPSAkKFwiLmRhdGUtcmFuZ2VcIikuZGF0YShcImxvYWRpbmctYWN0aW9uXCIpLFxuICAgICAgZXJyb3JDbGFzcyA9IFwiXCI7XG5cbiAgICAvL0hpZGUgdGhlIGVycm9yIG1lc3NhZ2VzXG4gICAgJChcIi5kYXRlLXJhbmdlLWVycm9yLW1lc3NhZ2VzIHNwYW5cIikuaGlkZSgpO1xuICAgICQoXCIuZGF0ZS1yYW5nZS1lcnJvci1tZXNzYWdlcyBzcGFuXCIpLmF0dHIoXCJhcmlhLWhpZGRlblwiLCB0cnVlKTtcbiAgICAkKFwiLmRhdGUtcmFuZ2UtZXJyb3Igc3BhblwiKS5yZW1vdmUoKTtcblxuICAgIC8vVXBkYXRlIHRoZSB2YWx1ZSBzZWxlY3RlZCBmb3IgdGhlIHNlYXJjaFxuICAgIHBhcmVudC5kYXRhKHNlYXJjaEtleSwgdmFsdWUpO1xuXG4gICAgdmFyIHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKHBhcmVudC5kYXRhKFwic3RhcnREYXRlWWVhclwiKS50b1N0cmluZygpLCBwYXJlbnQuZGF0YShcInN0YXJ0RGF0ZU1vbnRoXCIpKSxcbiAgICAgIGVuZERhdGUgPSBuZXcgRGF0ZShwYXJlbnQuZGF0YShcImVuZERhdGVZZWFyXCIpLnRvU3RyaW5nKCksIHBhcmVudC5kYXRhKFwiZW5kRGF0ZU1vbnRoXCIpKSxcbiAgICAgIGFnZSA9IGVuZERhdGUuZ2V0RnVsbFllYXIoKSAtIHN0YXJ0RGF0ZS5nZXRGdWxsWWVhcigpO1xuXG4gICAgdmFyIGxhYmVsRW5kTW9udGggPSAkKFwiYnV0dG9uW2FyaWEtZGVzY3JpYmVkYnk9J2xhYmVsLWVuZC1kYXRlLW1vbnRoJ11cIikuZmluZChcIi5tdWx0aXNlbGVjdC1vdmVybGF5LXRpdGxlXCIpLFxuICAgICAgbW9iaWxlTGFiZWxFbmRNb250aCA9ICQoXCJidXR0b25bYXJpYS1kZXNjcmliZWRieT0nbGFiZWwtZW5kLWRhdGUtbW9udGgnXVwiKS5maW5kKFwiLm1vYmlsZS1zZWxlY3Rpb25cIiksXG4gICAgICBsYWJlbEVuZFllYXIgPSAkKFwiYnV0dG9uW2FyaWEtZGVzY3JpYmVkYnk9J2xhYmVsLWVuZC1kYXRlLXllYXInXVwiKS5maW5kKFwiLm11bHRpc2VsZWN0LW92ZXJsYXktdGl0bGVcIiksXG4gICAgICBtb2JpbGVMYWJlbEVuZFllYXIgPSAkKFwiYnV0dG9uW2FyaWEtZGVzY3JpYmVkYnk9J2xhYmVsLWVuZC1kYXRlLXllYXInXVwiKS5maW5kKFwiLm1vYmlsZS1zZWxlY3Rpb25cIik7XG5cbiAgICAvL0ZpcnN0IHZhbGlkYXRlIGlmIHRoZSBkYXRlIHJhbmdlIGlzIHZhbGlkXG4gICAgaWYgKHN0YXJ0RGF0ZSA+IGVuZERhdGUpIHtcbiAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJpZFwiKS5pbmRleE9mKFwic3RhcnQtZGF0ZVwiKSA+PSAwKSB7XG4gICAgICAgIGVycm9yQ2xhc3MgPSBcImRhdGUtcmFuZ2UtZXJyb3ItZW5kLWRhdGVcIjtcbiAgICAgICAgZW5kRGF0ZSA9IG5ldyBEYXRlKHN0YXJ0RGF0ZSk7XG4gICAgICAgIHBhcmVudC5kYXRhKFwic3RhcnREYXRlWWVhclwiLCBzdGFydERhdGUuZ2V0RnVsbFllYXIoKSk7XG4gICAgICAgIHBhcmVudC5kYXRhKFwic3RhcnREYXRlTW9udGhcIiwgc3RhcnREYXRlLmdldE1vbnRoKCkpO1xuXG5cbiAgICAgICAgaWYgKGxhYmVsRW5kTW9udGguaHRtbCgpLmNoYXJBdCgwKSA9PT0gXCJbXCIpIHtcbiAgICAgICAgICBsYWJlbEVuZE1vbnRoLmh0bWwoXCJbXCIgKyBtb250aE5hbWVzW2VuZERhdGUuZ2V0TW9udGgoKV0gKyBcIl1cIik7XG4gICAgICAgICAgbW9iaWxlTGFiZWxFbmRNb250aC5odG1sKFwiW1wiICsgbW9udGhOYW1lc1tlbmREYXRlLmdldE1vbnRoKCldICsgXCJdXCIpO1xuICAgICAgICAgIGxhYmVsRW5kWWVhci5odG1sKFwiW1wiICsgZW5kRGF0ZS5nZXRGdWxsWWVhcigpICsgXCJdXCIpO1xuICAgICAgICAgIG1vYmlsZUxhYmVsRW5kWWVhci5odG1sKFwiW1wiICsgZW5kRGF0ZS5nZXRGdWxsWWVhcigpICsgXCJdXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxhYmVsRW5kTW9udGguaHRtbChtb250aE5hbWVzW2VuZERhdGUuZ2V0TW9udGgoKV0pO1xuICAgICAgICAgIG1vYmlsZUxhYmVsRW5kTW9udGguaHRtbChtb250aE5hbWVzW2VuZERhdGUuZ2V0TW9udGgoKV0pO1xuICAgICAgICAgIGxhYmVsRW5kWWVhci5odG1sKGVuZERhdGUuZ2V0RnVsbFllYXIoKSk7XG4gICAgICAgICAgbW9iaWxlTGFiZWxFbmRZZWFyLmh0bWwoZW5kRGF0ZS5nZXRGdWxsWWVhcigpKTtcbiAgICAgICAgfVxuXG4gICAgICAgICQoXCJ1bC5lbmQtZGF0ZS1tb250aCBsaVwiKS5hdHRyKFwiYXJpYS1jaGVja2VkXCIsIFwiZmFsc2VcIik7XG4gICAgICAgICQoXCJ1bC5lbmQtZGF0ZS1tb250aCBsaVtkYXRhLXZhbHVlPSdcIiArIGVuZERhdGUuZ2V0TW9udGgoKSArIFwiJ11cIikuYXR0cihcImFyaWEtY2hlY2tlZFwiLCBcInRydWVcIik7XG4gICAgICAgICQoXCJ1bC5lbmQtZGF0ZS15ZWFyIGxpXCIpLmF0dHIoXCJhcmlhLWNoZWNrZWRcIiwgXCJmYWxzZVwiKTtcbiAgICAgICAgJChcInVsLmVuZC1kYXRlLXllYXIgbGlbZGF0YS12YWx1ZT0nXCIgKyBlbmREYXRlLmdldEZ1bGxZZWFyKCkgKyBcIiddXCIpLmF0dHIoXCJhcmlhLWNoZWNrZWRcIiwgXCJ0cnVlXCIpO1xuXG4gICAgICAgICQoXCIuZGF0ZS1yYW5nZS1lcnJvci1lbmQtZGF0ZVwiKS5hcHBlbmQoXCI8c3BhbiBzdHlsZT1cXFwiZGlzcGxheTogaW5saW5lXFxcIj5cIiArIG1vbnRoTmFtZXNbc3RhcnREYXRlLmdldE1vbnRoKCldICsgXCIsIFwiICsgc3RhcnREYXRlLmdldEZ1bGxZZWFyKCkgKyBcIi5cIik7XG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVycm9yQ2xhc3MgPSBcImRhdGUtcmFuZ2UtZXJyb3Itc3RhcnQtZGF0ZVwiO1xuICAgICAgICBzdGFydERhdGUgPSBuZXcgRGF0ZShlbmREYXRlKTtcbiAgICAgICAgcGFyZW50LmRhdGEoXCJzdGFydERhdGVZZWFyXCIsIHN0YXJ0RGF0ZS5nZXRGdWxsWWVhcigpKTtcbiAgICAgICAgcGFyZW50LmRhdGEoXCJzdGFydERhdGVNb250aFwiLCBzdGFydERhdGUuZ2V0TW9udGgoKSk7XG5cbiAgICAgICAgdmFyIGxhYmVsU3RhcnRNb250aCA9ICQoXCJidXR0b25bYXJpYS1kZXNjcmliZWRieT0nbGFiZWwtc3RhcnQtZGF0ZS1tb250aCddXCIpLmZpbmQoXCIubXVsdGlzZWxlY3Qtb3ZlcmxheS10aXRsZVwiKSxcbiAgICAgICAgICBtb2JpbGVMYWJlbFN0YXJ0TW9udGggPSAkKFwiYnV0dG9uW2FyaWEtZGVzY3JpYmVkYnk9J2xhYmVsLXN0YXJ0LWRhdGUtbW9udGgnXVwiKS5maW5kKFwiLm1vYmlsZS1zZWxlY3Rpb25cIiksXG4gICAgICAgICAgbGFiZWxTdGFydFllYXIgPSAkKFwiYnV0dG9uW2FyaWEtZGVzY3JpYmVkYnk9J2xhYmVsLXN0YXJ0LWRhdGUteWVhciddXCIpLmZpbmQoXCIubXVsdGlzZWxlY3Qtb3ZlcmxheS10aXRsZVwiKSxcbiAgICAgICAgICBtb2JpbGVMYWJlbFN0YXJ0WWVhciA9ICQoXCJidXR0b25bYXJpYS1kZXNjcmliZWRieT0nbGFiZWwtc3RhcnQtZGF0ZS15ZWFyJ11cIikuZmluZChcIi5tb2JpbGUtc2VsZWN0aW9uXCIpO1xuXG4gICAgICAgIGlmIChsYWJlbFN0YXJ0TW9udGguaHRtbCgpLmNoYXJBdCgwKSA9PT0gXCJbXCIpIHtcbiAgICAgICAgICBsYWJlbFN0YXJ0TW9udGguaHRtbChcIltcIiArIG1vbnRoTmFtZXNbc3RhcnREYXRlLmdldE1vbnRoKCldICsgXCJdXCIpO1xuICAgICAgICAgIG1vYmlsZUxhYmVsU3RhcnRNb250aC5odG1sKFwiW1wiICsgbW9udGhOYW1lc1tzdGFydERhdGUuZ2V0TW9udGgoKV0gKyBcIl1cIik7XG4gICAgICAgICAgbGFiZWxTdGFydFllYXIuaHRtbChcIltcIiArIHN0YXJ0RGF0ZS5nZXRGdWxsWWVhcigpICsgXCJdXCIpO1xuICAgICAgICAgIG1vYmlsZUxhYmVsU3RhcnRZZWFyLmh0bWwoXCJbXCIgKyBzdGFydERhdGUuZ2V0RnVsbFllYXIoKSArIFwiXVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsYWJlbFN0YXJ0TW9udGguaHRtbChtb250aE5hbWVzW3N0YXJ0RGF0ZS5nZXRNb250aCgpXSk7XG4gICAgICAgICAgbW9iaWxlTGFiZWxTdGFydE1vbnRoLmh0bWwobW9udGhOYW1lc1tzdGFydERhdGUuZ2V0TW9udGgoKV0pO1xuICAgICAgICAgIGxhYmVsU3RhcnRZZWFyLmh0bWwoc3RhcnREYXRlLmdldEZ1bGxZZWFyKCkpO1xuICAgICAgICAgIG1vYmlsZUxhYmVsU3RhcnRZZWFyLmh0bWwoc3RhcnREYXRlLmdldEZ1bGxZZWFyKCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgJChcInVsLnN0YXJ0LWRhdGUtbW9udGggbGlcIikuYXR0cihcImFyaWEtY2hlY2tlZFwiLCBcImZhbHNlXCIpO1xuICAgICAgICAkKFwidWwuc3RhcnQtZGF0ZS1tb250aCBsaVtkYXRhLXZhbHVlPSdcIiArIHN0YXJ0RGF0ZS5nZXRNb250aCgpICsgXCInXVwiKS5hdHRyKFwiYXJpYS1jaGVja2VkXCIsIFwidHJ1ZVwiKTtcbiAgICAgICAgJChcInVsLnN0YXJ0LWRhdGUteWVhciBsaVwiKS5hdHRyKFwiYXJpYS1jaGVja2VkXCIsIFwiZmFsc2VcIik7XG4gICAgICAgICQoXCJ1bC5zdGFydC1kYXRlLXllYXIgbGlbZGF0YS12YWx1ZT0nXCIgKyBzdGFydERhdGUuZ2V0RnVsbFllYXIoKSArIFwiJ11cIikuYXR0cihcImFyaWEtY2hlY2tlZFwiLCBcInRydWVcIik7XG5cbiAgICAgICAgJChcIi5kYXRlLXJhbmdlLWVycm9yLXN0YXJ0LWRhdGVcIikuYXBwZW5kKFwiPHNwYW4gc3R5bGU9XFxcImRpc3BsYXk6IGlubGluZVxcXCI+XCIgKyBtb250aE5hbWVzW2VuZERhdGUuZ2V0TW9udGgoKV0gKyBcIiwgXCIgKyBlbmREYXRlLmdldEZ1bGxZZWFyKCkgKyBcIi5cIik7XG4gICAgICB9XG5cbiAgICB9IGVsc2Uge1xuICAgICAgLy9JZiBub3QgY2hlY2sgaWYgdGhlIGRhdGUgcmFuZ2UgaXMgaW5zaWRlIDMgeWVhcnNcbiAgICAgIGlmIChlbmREYXRlLmdldE1vbnRoKCkgPCBzdGFydERhdGUuZ2V0TW9udGgoKSAtIDEpIHtcbiAgICAgICAgYWdlLS07XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGFydERhdGUuZ2V0TW9udGgoKSAtIDEgPT09IGVuZERhdGUuZ2V0TW9udGgoKSAmJiBlbmREYXRlLmdldERheSgpIDwgc3RhcnREYXRlLmdldERheSgpKSB7XG4gICAgICAgIGFnZS0tO1xuICAgICAgfVxuXG4gICAgICBpZiAoYWdlID4gMykge1xuICAgICAgICBlcnJvckNsYXNzID0gXCJkYXRlLXJhbmdlLXRpbWVzcGFuLWVycm9yXCI7XG4gICAgICAgIGVuZERhdGUgPSBuZXcgRGF0ZShzdGFydERhdGUpO1xuICAgICAgICBlbmREYXRlLnNldEZ1bGxZZWFyKGVuZERhdGUuZ2V0RnVsbFllYXIoKSArIDMpO1xuICAgICAgICBwYXJlbnQuZGF0YShcImVuZERhdGVZZWFyXCIsIGVuZERhdGUuZ2V0RnVsbFllYXIoKSk7XG4gICAgICAgIHBhcmVudC5kYXRhKFwiZW5kRGF0ZU1vbnRoXCIsIGVuZERhdGUuZ2V0TW9udGgoKSk7XG5cbiAgICAgICAgaWYgKGxhYmVsRW5kTW9udGguaHRtbCgpLmNoYXJBdCgwKSA9PT0gXCJbXCIpIHtcbiAgICAgICAgICBsYWJlbEVuZE1vbnRoLmh0bWwoXCJbXCIgKyBtb250aE5hbWVzW2VuZERhdGUuZ2V0TW9udGgoKV0gKyBcIl1cIik7XG4gICAgICAgICAgbW9iaWxlTGFiZWxFbmRNb250aC5odG1sKFwiW1wiICsgbW9udGhOYW1lc1tlbmREYXRlLmdldE1vbnRoKCldICsgXCJdXCIpO1xuICAgICAgICAgIGxhYmVsRW5kWWVhci5odG1sKFwiW1wiICsgZW5kRGF0ZS5nZXRGdWxsWWVhcigpICsgXCJdXCIpO1xuICAgICAgICAgIG1vYmlsZUxhYmVsRW5kWWVhci5odG1sKFwiW1wiICsgZW5kRGF0ZS5nZXRGdWxsWWVhcigpICsgXCJdXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxhYmVsRW5kTW9udGguaHRtbChtb250aE5hbWVzW2VuZERhdGUuZ2V0TW9udGgoKV0pO1xuICAgICAgICAgIG1vYmlsZUxhYmVsRW5kTW9udGguaHRtbChtb250aE5hbWVzW2VuZERhdGUuZ2V0TW9udGgoKV0pO1xuICAgICAgICAgIGxhYmVsRW5kWWVhci5odG1sKGVuZERhdGUuZ2V0RnVsbFllYXIoKSk7XG4gICAgICAgICAgbW9iaWxlTGFiZWxFbmRZZWFyLmh0bWwoZW5kRGF0ZS5nZXRGdWxsWWVhcigpKTtcbiAgICAgICAgfVxuXG4gICAgICAgICQoXCJ1bC5lbmQtZGF0ZS1tb250aCBsaVwiKS5hdHRyKFwiYXJpYS1jaGVja2VkXCIsIFwiZmFsc2VcIik7XG4gICAgICAgICQoXCJ1bC5lbmQtZGF0ZS1tb250aCBsaVtkYXRhLXZhbHVlPSdcIiArIGVuZERhdGUuZ2V0TW9udGgoKSArIFwiJ11cIikuYXR0cihcImFyaWEtY2hlY2tlZFwiLCBcInRydWVcIik7XG4gICAgICAgICQoXCJ1bC5lbmQtZGF0ZS15ZWFyIGxpXCIpLmF0dHIoXCJhcmlhLWNoZWNrZWRcIiwgXCJmYWxzZVwiKTtcbiAgICAgICAgJChcInVsLmVuZC1kYXRlLXllYXIgbGlbZGF0YS12YWx1ZT0nXCIgKyBlbmREYXRlLmdldEZ1bGxZZWFyKCkgKyBcIiddXCIpLmF0dHIoXCJhcmlhLWNoZWNrZWRcIiwgXCJ0cnVlXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHVybCArPSBcIj9cIjtcbiAgICAkLmVhY2gocGFyZW50LmRhdGEoKSwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgIHVybCArPSBrZXkgKyBcIj1cIiArIHZhbHVlICsgXCImXCI7XG4gICAgfSk7XG5cbiAgICAkLmdldCh1cmwuc2xpY2UoMCwgLTEpLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgJChkZXN0aW5hdGlvbikuaHRtbChkYXRhKTtcbiAgICAgICQoJy5kYXRlLXJhbmdlLW1vYmlsZS11cGRhdGUgLnN0YXJ0LW1vbnRoJykuaHRtbChtb250aE5hbWVzW3N0YXJ0RGF0ZS5nZXRNb250aCgpXSk7XG4gICAgICAkKCcuZGF0ZS1yYW5nZS1tb2JpbGUtdXBkYXRlIC5zdGFydC15ZWFyJykuaHRtbChzdGFydERhdGUuZ2V0RnVsbFllYXIoKSk7XG4gICAgICAkKCcuZGF0ZS1yYW5nZS1tb2JpbGUtdXBkYXRlIC5lbmQtbW9udGgnKS5odG1sKG1vbnRoTmFtZXNbZW5kRGF0ZS5nZXRNb250aCgpXSk7XG4gICAgICAkKCcuZGF0ZS1yYW5nZS1tb2JpbGUtdXBkYXRlIC5lbmQteWVhcicpLmh0bWwoZW5kRGF0ZS5nZXRGdWxsWWVhcigpKTtcbiAgICAgIHVwZGF0ZUFyaWFMaXZlTWVzc2FnZShsb2FkaW5nQWN0aW9uICsgXCIgXCIgKyBtb250aE5hbWVzW3N0YXJ0RGF0ZS5nZXRNb250aCgpXSArIFwiIFwiICsgc3RhcnREYXRlLmdldEZ1bGxZZWFyKCkgKyBcIiAtIFwiICsgbW9udGhOYW1lc1tlbmREYXRlLmdldE1vbnRoKCldICsgXCIgXCIgKyBlbmREYXRlLmdldEZ1bGxZZWFyKCkpO1xuICAgICAgY2l0aVNoYXJlLmRldGFpbGVkTGlzdC50b2dnbGVMaXN0KCk7XG4gICAgfSk7XG5cbiAgICBpZiAoZXJyb3JDbGFzcyAhPT0gXCJcIikge1xuICAgICAgJChcIi5kYXRlLXJhbmdlLWVycm9yLW1lc3NhZ2VzIC5cIiArIGVycm9yQ2xhc3MpLnNob3coKTtcbiAgICAgICQoXCIuZGF0ZS1yYW5nZS1lcnJvci1tZXNzYWdlcyAuXCIgKyBlcnJvckNsYXNzKS5hdHRyKFwiYXJpYS1oaWRkZW5cIiwgZmFsc2UpO1xuICAgICAgJChcIi5kYXRlLXJhbmdlLWVycm9yLW1lc3NhZ2VzIC5cIiArIGVycm9yQ2xhc3MpLmZvY3VzKCk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBfYWpheEdldFNlYXJjaEJ5RGF0ZVJhbmdlU2ltcGxpZmllZCA9IGZ1bmN0aW9uIF9hamF4R2V0U2VhcmNoQnlEYXRlUmFuZ2VTaW1wbGlmaWVkKCkge1xuICAgIHZhciAkdGhpcyA9ICQodGhpcykuZmluZChcImFcIik7XG4gICAgaWYgKCEkKCR0aGlzLmF0dHIoXCJocmVmXCIpKS5oYXNDbGFzcyhcImRhdGUtcmFuZ2UtYWN0aXZlXCIpKSB7XG4gICAgICB2YXIgdXJsID0gJCgkdGhpcy5hdHRyKFwiaHJlZlwiKSkuZGF0YShcInVybFwiKSxcbiAgICAgICAgZGVzdGluYXRpb24gPSAkKCR0aGlzLmF0dHIoXCJocmVmXCIpKS5kYXRhKFwiZGVzdGluYXRpb25cIiksXG4gICAgICAgIHBhcmVudCA9ICQoXCIuZGF0ZS1yYW5nZSAubXVsdGlzZWxlY3QtbGlzdC1jb250YWluZXJcIiksXG4gICAgICAgIG1vbnRoTmFtZXMgPSAkKFwiLmRhdGUtcmFuZ2VcIikuZGF0YShcIm1vbnRoc1wiKS5zcGxpdChcIixcIiksXG4gICAgICAgIGxvYWRpbmdBY3Rpb24gPSAkKFwiLmRhdGUtcmFuZ2VcIikuZGF0YShcImxvYWRpbmctYWN0aW9uXCIpLFxuICAgICAgICBzdGFydERhdGUgPSBuZXcgRGF0ZShwYXJlbnQuZGF0YShcInN0YXJ0RGF0ZVllYXJcIikudG9TdHJpbmcoKSwgcGFyZW50LmRhdGEoXCJzdGFydERhdGVNb250aFwiKSksXG4gICAgICAgIGVuZERhdGUgPSBuZXcgRGF0ZShwYXJlbnQuZGF0YShcImVuZERhdGVZZWFyXCIpLnRvU3RyaW5nKCksIHBhcmVudC5kYXRhKFwiZW5kRGF0ZU1vbnRoXCIpKTtcblxuICAgICAgdXJsICs9IFwiP1wiO1xuICAgICAgJC5lYWNoKHBhcmVudC5kYXRhKCksIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgIHVybCArPSBrZXkgKyBcIj1cIiArIHZhbHVlICsgXCImXCI7XG4gICAgICB9KTtcblxuICAgICAgJC5nZXQodXJsLnNsaWNlKDAsIC0xKSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgJChcIi5cIiArIGRlc3RpbmF0aW9uKS5odG1sKGRhdGEpO1xuICAgICAgICAkKCcuZGF0ZS1yYW5nZS1tb2JpbGUtdXBkYXRlIC5zdGFydC1tb250aCcpLmh0bWwobW9udGhOYW1lc1tzdGFydERhdGUuZ2V0TW9udGgoKV0pO1xuICAgICAgICAkKCcuZGF0ZS1yYW5nZS1tb2JpbGUtdXBkYXRlIC5zdGFydC15ZWFyJykuaHRtbChzdGFydERhdGUuZ2V0RnVsbFllYXIoKSk7XG4gICAgICAgICQoJy5kYXRlLXJhbmdlLW1vYmlsZS11cGRhdGUgLmVuZC1tb250aCcpLmh0bWwobW9udGhOYW1lc1tlbmREYXRlLmdldE1vbnRoKCldKTtcbiAgICAgICAgJCgnLmRhdGUtcmFuZ2UtbW9iaWxlLXVwZGF0ZSAuZW5kLXllYXInKS5odG1sKGVuZERhdGUuZ2V0RnVsbFllYXIoKSk7XG4gICAgICAgIHVwZGF0ZUFyaWFMaXZlTWVzc2FnZShsb2FkaW5nQWN0aW9uICsgXCIgXCIgKyBtb250aE5hbWVzW3N0YXJ0RGF0ZS5nZXRNb250aCgpXSArIFwiIFwiICsgc3RhcnREYXRlLmdldEZ1bGxZZWFyKCkgKyBcIiAtIFwiICsgbW9udGhOYW1lc1tlbmREYXRlLmdldE1vbnRoKCldICsgXCIgXCIgKyBlbmREYXRlLmdldEZ1bGxZZWFyKCkpO1xuICAgICAgICBjaXRpU2hhcmUuZGV0YWlsZWRMaXN0LnRvZ2dsZUxpc3QoKTtcbiAgICAgIH0pO1xuICAgICAgJChcIi5kYXRlLXJhbmdlLWFjdGl2ZVwiKS5yZW1vdmVDbGFzcyhcImRhdGUtcmFuZ2UtYWN0aXZlXCIpO1xuICAgICAgJCgkdGhpcy5hdHRyKFwiaHJlZlwiKSkuYWRkQ2xhc3MoXCJkYXRlLXJhbmdlLWFjdGl2ZVwiKTtcbiAgICB9XG4gIH07XG5cbiAgLyogUG9zdCBkYXRhIHRvIHByb3ZpZGVkIHVybCB2aWEgQUpBWCBhbmQgaGFuZGxlcyBKU09OIGFuZCBIVE1MIHJlc3BvbnNlLlxuICAgKiBBY2NlcHRzIGEgY2FsbGJhY2sgYXMgYSBwYXJhbWV0ZXIuXG4gICAqIERlcGVuZHMgb25cbiAgICogICAtIGZvcm0gXCJhY3Rpb25cIiBhdHRyaWJ1dGUgKHRoZSB1cmwgdG8gbWFrZSB0aGUgcG9zdCByZXF1ZXN0IHRvIGRlbGV0ZSlcbiAgICogICAtIGRhdGEtaWQgYXR0cmlidXRlICh0aGUgaWQgb2YgdGhlIGVsZW1lbnQgdG8gZGVsZXRlKVxuICAgKiAgIC0gZGF0YS11cmwgYXR0cmlidXRlICh0aGUgdXJsIHRvIGdldCB0aGUgdXBkYXRlZCBodG1sIGZyYWdtZW50KVxuICAgKiAgIC0gZGF0YS1kZXN0aW5hdGlvbiBhdHRyaWJ1dGUgKHdoZXJlIHRvIGFwcGVuZCB0aGUgbmV3IGh0bWwgZnJhZ21lbnQpXG4gICAqL1xuICB2YXIgX2FqYXhQb3N0ID0gZnVuY3Rpb24gX2FqYXhQb3N0KGUsIGRvbmUpIHtcblxuICAgIHZhciAkZm9ybSA9ICQodGhpcyk7XG4gICAgdmFyIHNlcmlhbGl6ZWREYXRhID0gJGZvcm0uc2VyaWFsaXplQXJyYXkoKTtcbiAgICB2YXIgcG9zdFVybCA9ICRmb3JtLmF0dHIoJ2FjdGlvbicpO1xuICAgIHZhciBnZXRIdG1sVXJsID0gJGZvcm0uZGF0YSgndXJsJyk7XG4gICAgdmFyIGh0bWxGcmFnbWVudERlc3QgPSAkZm9ybS5kYXRhKCdkZXN0aW5hdGlvbicpO1xuICAgIHZhciBpc0R5bmFtaWMgPSAkZm9ybS5kYXRhKCdkeW5hbWljJykgfHwgZmFsc2U7XG5cbiAgICAkLmVhY2goc2VyaWFsaXplZERhdGEsIGZ1bmN0aW9uKGksIG9iaikge1xuICAgICAgdmFyICRyZWxhdGVkSW5wdXQgPSAkKCcjJyArIG9iai5uYW1lKTtcbiAgICAgIG9iai52YWx1ZSA9ICRyZWxhdGVkSW5wdXQuZGF0YSgndmFsdWUnKSB8fCAkcmVsYXRlZElucHV0LnZhbCgpO1xuICAgIH0pO1xuXG4gICAgdmFyIHBvc3RBamF4ID0gJC5wb3N0KHBvc3RVcmwsIHNlcmlhbGl6ZWREYXRhKTtcblxuICAgIC8vIFBvc3QgdGhlIGRhdGFcbiAgICBwb3N0QWpheC5kb25lKGZ1bmN0aW9uIChqc29uUmVzKSB7XG5cbiAgICAgIC8vIENoZWNrIGlmIHJlc3BvbnNlIGlzIGFuIG9iamVjdFxuICAgICAgaWYgKHR5cGVvZiBqc29uUmVzICE9PSAnb2JqZWN0Jykge1xuICAgICAgICByZXR1cm4gZG9uZSgnZXJyb3InLCB7bWVzc2FnZTogXCJSZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIgaXNuJ3QgYSBqc29uIG9iamVjdC5cIn0pO1xuICAgICAgfVxuXG4gICAgICAvLyBIYW5kbGUgc3VjY2Vzcy9lcnJvciBkZXBlbmRpbmcgb24ganNvbiByZXNwb25zZS5cbiAgICAgIC8vIFRPRE86IEF0IHRoZSBzYW1lIHRpbWUgZG8gdGhlIGVycm9yIG1lc3NhZ2VzIGZvciBMZWdhbCBOb3RpY2VzIGFuZCBFbWFpbCBTZXR0aW5ncy5cbiAgICAgIGlmIChqc29uUmVzLmhhc093blByb3BlcnR5KCdzdWNjZXNzJykgJiYganNvblJlcy5zdWNjZXNzICE9PSAnJykge1xuICAgICAgICB2YXIgaHRtbEFqYXggPSAkLmdldChnZXRIdG1sVXJsKTtcblxuICAgICAgICAvLyBIYW5kbGUgc3VjY2Vzc1xuICAgICAgICBodG1sQWpheC5kb25lKGZ1bmN0aW9uIChodG1sUmVzKSB7XG4gICAgICAgICAgJChodG1sRnJhZ21lbnREZXN0KS5lbXB0eSgpO1xuICAgICAgICAgICQoaHRtbEZyYWdtZW50RGVzdCkuYXBwZW5kKGh0bWxSZXMpO1xuXG4gICAgICAgICAgdmFyICRhamF4RGVsZXRlID0gJCgnLmFqYXgtZGVsZXRlJyk7XG4gICAgICAgICAgaWYoJGFqYXhEZWxldGUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgJGFqYXhEZWxldGUub2ZmKCdmb3JtOmRlbGV0ZScsICcqKicpO1xuICAgICAgICAgICAgJGFqYXhEZWxldGUub24oJ2Zvcm06ZGVsZXRlJywgX2FqYXhEZWxldGUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBkb25lKCdzdWNjZXNzJywganNvblJlcywgaXNEeW5hbWljKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSGFuZGxlIGVycm9yXG4gICAgICAgIGh0bWxBamF4LmZhaWwoZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiUHJvYmxlbSBnZXR0aW5nIHRoZSBodG1sIGFmdGVyIGEgcG9zdCByZXF1ZXN0LlwiLCBlcnIpO1xuICAgICAgICAgIHJldHVybiBkb25lKCdlcnJvcicsIGVyciwgaXNEeW5hbWljKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChqc29uUmVzLmhhc093blByb3BlcnR5KCdlcnJvcicpICYmIGpzb25SZXMuZXJyb3IgIT09ICcnKSB7XG4gICAgICAgIHJldHVybiBkb25lKCdlcnJvcicsIGpzb25SZXMsIGlzRHluYW1pYyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBUZXN0IHRoaXNcbiAgICBwb3N0QWpheC5mYWlsKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXG4gICAgICB2YXIganNvblJlcyA9IHt9O1xuXG4gICAgICBpZiAocmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ2Vycm9yJykpIHtcbiAgICAgICAganNvblJlcy5lcnJvciA9IHJlc3BvbnNlLmVycm9yO1xuICAgICAgfVxuXG4gICAgICBpZiAocmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3Jlc3BvbnNlSlNPTicpKSB7XG4gICAgICAgIGpzb25SZXMgPSByZXNwb25zZS5yZXNwb25zZUpTT047XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBkb25lKCdlcnJvcicsIGpzb25SZXMsIGlzRHluYW1pYyk7XG4gICAgfSk7XG4gIH07XG5cbiAgLypcbiAgICogQmluZCBjbGljayBldmVudCBvbiBhbGwgLmFqYXgtZGVsZXRlIGVsZW1lbnRzXG4gICAqIFRoaXMgbWFrZXMgYSBQT1NUIHJlcXVlc3Qgd2l0aCB0aGUgSUQgb2YgdGhlIGVsZW1lbnQgdG8gZGVsZXRlLlxuICAgKiBEZXBlbmRzIG9uXG4gICAqICAgLSBkYXRhLWFjdGlvbiBhdHRyaWJ1dGUgKHRoZSB1cmwgdG8gbWFrZSB0aGUgcG9zdCByZXF1ZXN0IHRvIGRlbGV0ZSlcbiAgICogICAtIGRhdGEtaWQgYXR0cmlidXRlICh0aGUgaWQgb2YgdGhlIGVsZW1lbnQgdG8gZGVsZXRlKVxuICAgKiAgIC0gZGF0YS11cmwgYXR0cmlidXRlICh0aGUgdXJsIHRvIGdldCB0aGUgdXBkYXRlZCBodG1sIGZyYWdtZW50KVxuICAgKiAgIC0gZGF0YS1kZXN0aW5hdGlvbiBhdHRyaWJ1dGUgKHdoZXJlIHRvIGFwcGVuZCB0aGUgbmV3IGh0bWwgZnJhZ21lbnQpXG4gICAqL1xuICB2YXIgX2FqYXhEZWxldGUgPSBmdW5jdGlvbiBfYWpheERlbGV0ZShlLCBkb25lKSB7XG5cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICB2YXIgJGxpbmsgPSAkKGUuY3VycmVudFRhcmdldCk7XG4gICAgdmFyICRmb3JtID0gJGxpbmsucGFyZW50cygnZm9ybScpO1xuXG4gICAgdmFyIHBvc3RVcmwgPSAkbGluay5kYXRhKCdhY3Rpb24nKTtcbiAgICB2YXIgZ2V0SHRtbFVybCA9ICRsaW5rLmRhdGEoJ3VybCcpO1xuICAgIHZhciBodG1sRnJhZ21lbnREZXN0ID0gJGxpbmsuZGF0YSgnZGVzdGluYXRpb24nKTtcbiAgICB2YXIgaXNEeW5hbWljID0gJGZvcm0uZGF0YSgnZHluYW1pYycpIHx8IGZhbHNlO1xuXG4gICAgdmFyIGRhdGEgPSB7XG4gICAgICBcImlkXCI6ICRsaW5rLmRhdGEoJ2lkJylcbiAgICB9O1xuXG4gICAgdmFyIHBvc3RBamF4ID0gJC5wb3N0KHBvc3RVcmwsIGRhdGEpO1xuXG4gICAgLy8gUG9zdCB0aGUgZGF0YVxuICAgIHBvc3RBamF4LmRvbmUoZnVuY3Rpb24gKGpzb25SZXMpIHtcblxuICAgICAgLy8gQ2hlY2sgaWYgcmVzcG9uc2UgaXMgYW4gb2JqZWN0XG4gICAgICBpZiAodHlwZW9mIGpzb25SZXMgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdSZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIgaXMgbm90IGFuZCBvYmplY3QuJyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIGh0bWxBamF4ID0gJC5nZXQoZ2V0SHRtbFVybCk7XG5cbiAgICAgIC8vIEhhbmRsZSBzdWNjZXNzXG4gICAgICBodG1sQWpheC5kb25lKGZ1bmN0aW9uIChodG1sUmVzKSB7XG4gICAgICAgICQoaHRtbEZyYWdtZW50RGVzdCkuZW1wdHkoKTtcbiAgICAgICAgJChodG1sRnJhZ21lbnREZXN0KS5hcHBlbmQoaHRtbFJlcyk7XG5cbiAgICAgICAgdmFyICRhamF4RGVsZXRlID0gJCgnLmFqYXgtZGVsZXRlJyk7XG4gICAgICAgICRhamF4RGVsZXRlLm9mZignZm9ybTpkZWxldGUnLCAnKionKTtcbiAgICAgICAgJGFqYXhEZWxldGUub24oJ2Zvcm06ZGVsZXRlJywgX2FqYXhEZWxldGUpO1xuXG4gICAgICAgIGlmKGRvbmUpIHtcbiAgICAgICAgICByZXR1cm4gZG9uZSgnc3VjY2VzcycsIGpzb25SZXMsIGlzRHluYW1pYyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBIYW5kbGUgZXJyb3JcbiAgICAgIGh0bWxBamF4LmZhaWwoZnVuY3Rpb24gKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlByb2JsZW0gZ2V0dGluZyB0aGUgaHRtbCBhZnRlciB0aGUgcG9zdCByZXF1ZXN0IHRvIGRlbGV0ZSB0aGUgaXRlbS5cIiwgZXJyKTtcbiAgICAgICAgaWYoZG9uZSkge1xuICAgICAgICAgIHJldHVybiBkb25lKCdlcnJvcicsIGpzb25SZXMsIGlzRHluYW1pYyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcG9zdEFqYXguZmFpbChmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiUHJvYmxlbSBtYWtpbmcgdGhlIHBvc3QgcmVxdWVzdCB0byBkZWxldGUgdGhlIGl0ZW0uXCIsIHJlc3BvbnNlKTtcblxuICAgICAgaWYoZG9uZSkge1xuXG4gICAgICAgIHZhciBqc29uUmVzID0ge307XG5cbiAgICAgICAgaWYgKHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdlcnJvcicpKSB7XG4gICAgICAgICAganNvblJlcy5lcnJvciA9IHJlc3BvbnNlLmVycm9yO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdyZXNwb25zZUpTT04nKSkge1xuICAgICAgICAgIGpzb25SZXMgPSByZXNwb25zZS5yZXNwb25zZUpTT047XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZG9uZSgnZXJyb3InLCBqc29uUmVzLCBpc0R5bmFtaWMpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4vLyBBamF4IGNhbGwgdG8gZ2V0LCBzb3J0IGFuZCBhcHBlbmQgSFRNTFxuLy8gZGVzdGluYXRpb24gaXMgd2hlcmUgdGhlIGh0bWwgd2lsbCBiZSBpbmplY3RlZFxuLy8gdXJsIGlzIHRoZSBmcmFnbWVudCBnZXQgaW4gYWpheFxuLy8gZGlyZWN0aW9uIGlzIGEgdG9nZ2xlXG4vLyBtZXNzYWdlIGlzIGEgdHJlYXRlZCBtZXNzYWdlIHRvIGJlIHBhc3NlZCB0byBhbiBlbGVtZW50IHdpdGggYXJpYS1saXZlXG4gIHZhciBfYWpheEdldFNvcnRBbmRBcHBlbmQgPSBmdW5jdGlvbiBfYWpheEdldFNvcnRBbmRBcHBlbmQoKSB7XG4gICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAkKFwiLm11bHRpc2VsZWN0LXNvcnQtbWVzc2FnZVwiKS5oaWRlKCk7XG4gICAgJChcIi5tdWx0aXNlbGVjdC1zb3J0LW1lc3NhZ2VcIikuYXR0cihcImFyaWEtaGlkZGVuXCIsIFwidHJ1ZVwiKTtcbiAgICAvL1dlaXJkIHRyaWNrIHRvIHJldXNlIHRoZSBmdW5jdGlvbiBmb3IgbXVsdGlzZWxlY3RzXG4gICAgaWYgKCR0aGlzLmlzKFwiaW5wdXRcIikpIHtcbiAgICAgICR0aGlzID0gJHRoaXMucGFyZW50cyhcImxpXCIpO1xuICAgIH1cbiAgICB2YXIgc29ydFR5cGUgPSAkdGhpcy5kYXRhKFwic29ydC10eXBlXCIpIHx8IFwic29ydC1sZXNzXCIsXG4gICAgICBwYWdlTnVtYmVyID0gJHRoaXMuZGF0YShcInBhZ2UtbnVtYmVyXCIpIHx8IFwiMVwiLFxuICAgICAgc29ydGFibGVPcHRpb25zID0gJChcImJvZHlcIiksXG4gICAgICBjdXJyZW50RGlyZWN0aW9uID0gXCJhc2NlbmRpbmdcIixcbiAgICAgIGFqYXhVcmwgPSAkdGhpcy5kYXRhKFwidXJsXCIpO1xuXG4gICAgaWYgKChzb3J0VHlwZSAhPT0gXCJzb3J0LWxlc3NcIikpIHtcbiAgICAgIC8vQSBzb3J0IG9wdGlvbiB3YXMgY2hvc2VuXG4gICAgICBhamF4VXJsICs9IFwiP3NvcnRieT1cIiArIHNvcnRUeXBlO1xuICAgICAgaWYgKCR0aGlzLmRhdGEoXCJzb3J0LWRpcmVjdGlvblwiKSkge1xuICAgICAgICAvL0ZpcnN0IGxldHMgc2VlIGlmIGEgZGlyZWN0aW9uIHdhcyBnaXZlblxuICAgICAgICBjdXJyZW50RGlyZWN0aW9uID0gJHRoaXMuZGF0YShcInNvcnQtZGlyZWN0aW9uXCIpO1xuICAgICAgICBzb3J0YWJsZU9wdGlvbnMuZGF0YShcImxhc3QtZGlyZWN0aW9uLXNvcnRlZFwiLCBjdXJyZW50RGlyZWN0aW9uKTtcbiAgICAgICAgYWpheFVybCArPSBcIiZkaXJlY3Rpb249XCIgKyBjdXJyZW50RGlyZWN0aW9uICsgXCImcGFnZT1cIiArIHBhZ2VOdW1iZXI7XG4gICAgICB9IGVsc2UgaWYgKCR0aGlzLmRhdGEoXCJwYWdlLW51bWJlclwiKSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIC8vRWxzZSwgbGV0cyBjaGVjayBpZiB0aGUgbGluayBoYWQgYSBwYWdlIG51bWJlclxuICAgICAgICAvL2NoZWNrIGZpcnN0IGlmIHRoZSBzb3J0IG11c3QgYmUgcmV2ZXJzZWRcbiAgICAgICAgaWYgKHNvcnRUeXBlID09PSBzb3J0YWJsZU9wdGlvbnMuZGF0YShcImxhc3Qtc29ydC1kb25lXCIpKSB7XG4gICAgICAgICAgLy9JZiB0aGUgc2FtZSBzb3J0IHdhcyByZXF1ZXN0ZWQgdHdpY2UsIHJldmVyc2UgaXRcbiAgICAgICAgICAvL3RoZW4gcmVtb3ZlIGl0IHNpbmNlIGFsbCBvdGhlcnMgd2lsbCBiZSBhc2NlbmRpbmdcbiAgICAgICAgICBjdXJyZW50RGlyZWN0aW9uID0gXCJkZXNjZW5kaW5nXCI7XG4gICAgICAgICAgc29ydGFibGVPcHRpb25zLnJlbW92ZURhdGEoXCJsYXN0LXNvcnQtZG9uZVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvL2Vsc2Ugc29ydCBhc2VuZGluZyBhbmQgcmVtZW1iZXIgdGhlIHR5cGVcbiAgICAgICAgICBzb3J0YWJsZU9wdGlvbnMuZGF0YShcImxhc3Qtc29ydC1kb25lXCIsIHNvcnRUeXBlKTtcbiAgICAgICAgfVxuICAgICAgICAvL1JlbWVtYmVyIHRoZSBkaXJlY3Rpb24gZm9yIHRoZSBwYWdpbmF0aW9uXG4gICAgICAgIHNvcnRhYmxlT3B0aW9ucy5kYXRhKFwibGFzdC1kaXJlY3Rpb24tc29ydGVkXCIsIGN1cnJlbnREaXJlY3Rpb24pO1xuICAgICAgICBhamF4VXJsICs9IFwiJmRpcmVjdGlvbj1cIiArIGN1cnJlbnREaXJlY3Rpb24gKyBcIiZwYWdlPVwiICsgcGFnZU51bWJlcjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vSWYgYSBwYWdlIG51bWJlciB3YXMgcmVxdWVzdGVkIGFuZCBhIHNvcnQgb3B0aW9uIHdhcyBjaG9zZW4gcHJldmlvdXNseVxuICAgICAgICAvL2NoZWNrIGZpcnN0IGlmIGEgZGlyZWN0aW9uIHdhcyBzYXZlZFxuICAgICAgICBjdXJyZW50RGlyZWN0aW9uID0gc29ydGFibGVPcHRpb25zLmRhdGEoXCJsYXN0LWRpcmVjdGlvbi1zb3J0ZWRcIik7XG4gICAgICAgIGFqYXhVcmwgKz0gXCImZGlyZWN0aW9uPVwiICsgY3VycmVudERpcmVjdGlvbiArIFwiJnBhZ2U9XCIgKyBwYWdlTnVtYmVyO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvL05vIHNvcnQgd2VyZSBjaG9zZW4sIGhlbmNlIHdlIGp1c3QgYXNrIGZvciBhIHBhZ2UgbnVtYmVyXG4gICAgICBhamF4VXJsICs9IFwiP3BhZ2U9XCIgKyBwYWdlTnVtYmVyO1xuICAgIH1cblxuICAgICQuZ2V0KGFqYXhVcmwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAkKCcuJyArICR0aGlzLmRhdGEoXCJkZXN0aW5hdGlvblwiKSkuaHRtbChkYXRhKTtcbiAgICB9KS5kb25lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGxpbmsgPSBzb3J0YWJsZU9wdGlvbnMuZmluZChcInRhYmxlIFtkYXRhLXNvcnQtdHlwZT0nXCIgKyBzb3J0VHlwZSArIFwiJ11cIiksXG4gICAgICAgICAgYWN0aW9ucyA9ICQoXCIuYWNjZXNzaWJpbGl0eS1hY3Rpb25zXCIpLFxuICAgICAgICAgIG1lc3NhZ2UgPSBcIlwiO1xuICAgICAgICBsaW5rLmFkZENsYXNzKFwic29ydGVkLVwiICsgY3VycmVudERpcmVjdGlvbik7XG5cbiAgICAgICAgaWYgKHNvcnRUeXBlICE9PSBcInNvcnQtbGVzc1wiKSB7XG4gICAgICAgICAgJChcIi5teS1hY2NvdW50LXBhZ2luYXRpb24gYVwiKS5kYXRhKFwic29ydC10eXBlXCIsIHNvcnRUeXBlKTtcbiAgICAgICAgICAkKFwiLm11bHRpc2VsZWN0LXNvcnQtbWVzc2FnZVtkYXRhLXNvcnQtdHlwZT0nXCIgKyBzb3J0VHlwZSArIFwiJ11cIikuc2hvdygpO1xuICAgICAgICAgICQoXCIubXVsdGlzZWxlY3Qtc29ydC1tZXNzYWdlW2RhdGEtc29ydC10eXBlPSdcIiArIHNvcnRUeXBlICsgXCInXVwiKS5hdHRyKFwiYXJpYS1oaWRkZW5cIiwgXCJmYWxzZVwiKTtcbiAgICAgICAgICBtZXNzYWdlICs9IGFjdGlvbnMuZGF0YShcIm1lc3NhZ2Utc29ydFwiKSArIFwiIFwiICsgc29ydFR5cGUgKyBcIiwgXCI7XG4gICAgICAgICAgaWYgKGN1cnJlbnREaXJlY3Rpb24gPT09IFwiYXNjZW5kaW5nXCIpIHtcbiAgICAgICAgICAgIG1lc3NhZ2UgKz0gYWN0aW9ucy5kYXRhKFwibWVzc2FnZS1hc2NlbmRpbmdcIikgKyBcIiwgXCI7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1lc3NhZ2UgKz0gYWN0aW9ucy5kYXRhKFwibWVzc2FnZS1kZXNjZW5kaW5nXCIpICsgXCIsIFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBtZXNzYWdlICs9IGFjdGlvbnMuZGF0YShcIm1lc3NhZ2UtcGFnZVwiKSArIFwiIFwiICsgcGFnZU51bWJlcjtcbiAgICAgICAgdXBkYXRlQXJpYUxpdmVNZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICAkKCcjJyArICR0aGlzLmdldCgwKS5pZCkuZm9jdXMoKTtcbiAgICAgIH1cbiAgICApO1xuICB9O1xuXG4gIHZhciBfYWpheFJlaW5zdGF0ZVBvaW50cyA9IGZ1bmN0aW9uIF9hamF4UmVpbnN0YXRlUG9pbnRzKGV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgc2VyaWFsaXplZERhdGEgPSAkdGhpcy5zZXJpYWxpemVBcnJheSgpLFxuICAgICAgZm9ybVVybCA9ICR0aGlzLmRhdGEoJ2Zvcm0tdXJsJyksXG4gICAgICBmb3JtRGVzdGluYXRpb24gPSAkdGhpcy5kYXRhKCdmb3JtLWRlc3RpbmF0aW9uJyksXG4gICAgICBwb2ludHNVcmwgPSAkdGhpcy5kYXRhKCdwb2ludHMtdG90YWwtdXJsJyksXG4gICAgICBwb2ludHNEZXN0aW5hdGlvbiA9ICR0aGlzLmRhdGEoJ3BvaW50cy10b3RhbC1kZXN0aW5hdGlvbicpLFxuICAgICAgY29uZmlybWF0aW9uID0gJChcIi5yZWluc3RhdGUtcG9pbnRzLWNvbmZpcm1hdGlvblwiKTtcblxuICAgIGNvbmZpcm1hdGlvbi5oaWRlKCk7XG4gICAgY29uZmlybWF0aW9uLmF0dHIoXCJhcmlhLWhpZGRlblwiLCBcInRydWVcIik7XG5cbiAgICB2YXIgcG9zdEFqYXggPSAkLnBvc3QoJHRoaXMuYXR0cihcImFjdGlvblwiKSwgc2VyaWFsaXplZERhdGEpO1xuICAgIC8vIFBvc3QgdGhlIGRhdGFcbiAgICBwb3N0QWpheC5kb25lKGZ1bmN0aW9uICgpIHtcbiAgICAgICQuZ2V0KGZvcm1VcmwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICQoJy4nICsgZm9ybURlc3RpbmF0aW9uKS5odG1sKGRhdGEpO1xuICAgICAgfSkuZG9uZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICQuZ2V0KHBvaW50c1VybCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAkKCcuJyArIHBvaW50c0Rlc3RpbmF0aW9uKS5odG1sKGRhdGEpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgY29uZmlybWF0aW9uLnNob3coKTtcbiAgICAgIGNvbmZpcm1hdGlvbi5hdHRyKFwiYXJpYS1oaWRkZW5cIiwgXCJmYWxzZVwiKTtcbiAgICAgIGNvbmZpcm1hdGlvbi5mb2N1cygpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuICB9O1xuXG4vLyBCaW5kIHRoZSBfYWpheEdldEFuZEFwcGVuZCBvbiB0aGUgc2VsZWN0bWVudWNoYW5nZSBldmVudCBvZiBqcXVlcnkgdWkgc2VsZWN0cy5cbiAgaWYgKGFqYXhDb25maWcuJGFqYXhTZWxlY3RzLmxlbmd0aCA+IDApIHtcbiAgICBhamF4Q29uZmlnLiRhamF4U2VsZWN0cy5vbignc2VsZWN0bWVudWNoYW5nZScsIF9hamF4R2V0QW5kQXBwZW5kKTtcbiAgfVxuXG4gIC8vIEJpbmQgdGhlIF9hamF4R2V0QW5kQXBwZW5kIG9uIHRoZSBjbGljayBldmVudHMgb2Ygc2VsZWN0IGxpIGVsZW1lbnRzXG4gIC8vIEN1c3RvbSBldmVudCBmcm9tIGZpbHRlcnMuanNcbiAgaWYgKGFqYXhDb25maWcuJGFqYXhNdWx0aVNlbGVjdHMubGVuZ3RoID4gMCkge1xuICAgIGFqYXhDb25maWcuJGFqYXhNdWx0aVNlbGVjdHMuZmluZChcIi5qcy1tdWx0aXNlbGVjdC1kcm9wZG93bi1vcHRpb24taW5wdXRcIikub24oJ2N1c3RvbUV2ZW50TG9hZEFqYXgnLCBfb3JkZXJIaXN0b3J5U29ydCk7XG4gIH1cblxuICAvLyBCaW5kIHRoZSBfYWpheEdldFNlYXJjaEJ5RGF0ZVJhbmdlIG9uIHRoZSBzZWxlY3RtZW51Y2hhbmdlIGV2ZW50IG9mIGpxdWVyeSB1aSBzZWxlY3RzLlxuICAvLyBDdXN0b20gZXZlbnQgZnJvbSBmaWx0ZXJzLmpzXG4gIGlmIChhamF4Q29uZmlnLiRkYXRlUmFuZ2VTZWxlY3RzLmxlbmd0aCA+IDApIHtcbiAgICBhamF4Q29uZmlnLiRkYXRlUmFuZ2VTZWxlY3RzLmZpbmQoXCIuanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tb3B0aW9uLWlucHV0XCIpLm9uKCdjdXN0b21FdmVudExvYWRBamF4JywgX2FqYXhHZXRTZWFyY2hCeURhdGVSYW5nZSk7XG4gIH1cblxuICAvLyBCaW5kIHRoZSBfYWpheEdldEFuZEFwcGVuZCBvbiB0aGUgY2xpY2sgZXZlbnRcbiAgaWYgKGFqYXhDb25maWcuJGFqYXhHZXRzLmxlbmd0aCA+IDApIHtcbiAgICAvL05vdGUgdGhhdCAuc2VsZWN0b3IgaXMgZGVwcmVjYXRlZCBpbiBqUXVlcnksIGl0J3MgdGhlIG9ubHkgd2F5IHRoYXQgSSBrbm93IHRvIGRvIHRoaXMgYW5kIHN0aWxsIHN1cHBvcnQgb3VyIGN1cnJlbnQgc3ludGF4LlxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsIGFqYXhDb25maWcuJGFqYXhHZXRzLnNlbGVjdG9yLCBfYWpheEdldEFuZEFwcGVuZCk7XG4gIH1cblxuICAvLyBCaW5kIHRoZSBfYWpheEdldEFuZEFwcGVuZCBvbiB0aGUgaW5wdXRzIG9mIHRoZSBtdWx0aXNlbGVjdHMuXG4gIGlmIChhamF4Q29uZmlnLiRhamF4U2VhcmNoLmxlbmd0aCA+IDApIHtcbiAgICBhamF4Q29uZmlnLiRhamF4U2VhcmNoLmZpbmQoXCIuanMtbXVsdGlzZWxlY3QtZHJvcGRvd24tb3B0aW9uLWlucHV0XCIpLm9uKCdjdXN0b21FdmVudExvYWRBamF4JywgX2FqYXhTZWFyY2hHZXRBbmRBcHBlbmQpO1xuICB9XG5cbiAgLy8gU3BlY2lhbCB0cmVhdG1lbnQgbXVzdCBiZSBtYWRlIHRvIGFubm91bmNlIHRoZSBhY3Rpb24gbWFkZSBieSB0aGUgc29ydCBmb3Igc2NyZWVuLXJlYWRlcnNcbiAgLy9Ob3RlIHRoYXQgLnNlbGVjdG9yIGlzIGRlcHJlY2F0ZWQgaW4galF1ZXJ5LCBpdCdzIHRoZSBvbmx5IHdheSB0aGF0IEkga25vdyB0byBkbyB0aGlzIGFuZCBzdGlsbCBzdXBwb3J0IG91ciBjdXJyZW50IHN5bnRheC5cbiAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgYWpheENvbmZpZy4kYWpheFNvcnRzLnNlbGVjdG9yLCBfYWpheEdldFNvcnRBbmRBcHBlbmQpO1xuXG4vLyBTcGVjaWFsIHRyZWF0bWVudCBtdXN0IGJlIG1hZGUgdG8gYW5ub3VuY2UgdGhlIGFjdGlvbiBtYWRlIGJ5IHRoZSBzb3J0IGZvciBzY3JlZW4tcmVhZGVyc1xuICBpZiAoYWpheENvbmZpZy4kYWpheE11bHRpU2VsZWN0U29ydC5sZW5ndGggPiAwKSB7XG4gICAgYWpheENvbmZpZy4kYWpheE11bHRpU2VsZWN0U29ydC5maW5kKFwiLmpzLW11bHRpc2VsZWN0LWRyb3Bkb3duLW9wdGlvbi1pbnB1dFwiKS5vbignY3VzdG9tRXZlbnRMb2FkQWpheCcsIF9hamF4R2V0U29ydEFuZEFwcGVuZCk7XG4gIH1cblxuLy8gU3BlY2lhbCB0cmVhdG1lbnQgbXVzdCBiZSBtYWRlIHRvIGFubm91bmNlIHRoZSBhY3Rpb24gbWFkZSBieSB0aGUgc29ydCBmb3Igc2NyZWVuLXJlYWRlcnNcbiAgaWYgKGFqYXhDb25maWcuJGFqYXhSZWluc3RhdGVQb2ludHMubGVuZ3RoID4gMCkge1xuICAgICQoZG9jdW1lbnQpLm9uKCdmb3JtOnJlaW5zdGF0ZScsIGFqYXhDb25maWcuJGFqYXhSZWluc3RhdGVQb2ludHMuc2VsZWN0b3IsIF9hamF4UmVpbnN0YXRlUG9pbnRzKTtcbiAgfVxuXG4gIC8vIExhdW5jaCBhIHNlYXJjaCBieSBkYXRlIHJhZ2UgZm9yIGEgY29udGVudCBvZiBibG9ja1xuICBpZiAoYWpheENvbmZpZy4kcG9pbnRzU3VtbWFyeVRhYnMubGVuZ3RoID4gMCkge1xuICAgIGFqYXhDb25maWcuJHBvaW50c1N1bW1hcnlUYWJzLm9uKCdmb2N1cycsIF9hamF4R2V0U2VhcmNoQnlEYXRlUmFuZ2VTaW1wbGlmaWVkKTtcbiAgICBhamF4Q29uZmlnLiRwb2ludHNTdW1tYXJ5VGFicy5vbignY2xpY2snLCBfYWpheEdldFNlYXJjaEJ5RGF0ZVJhbmdlU2ltcGxpZmllZCk7XG4gIH1cblxuICAvL0Rpc3BsYXkgZXJyb3IgbWVzc2FnZSBmcm9tIGFuIGFqYXggY2FsbCA0MDQgQ1RBXG4gIGZ1bmN0aW9uIGRpc3BsYXlDdGFFcnJvck1lc3NhZ2UocHJldmlvdXNFbGVtZW50KSB7XG4gICAgdmFyIHRoZUVsZW1lbnRUb1Nob3cgPSAkKHByZXZpb3VzRWxlbWVudCkuY2xvc2VzdChcIi5vcmRlci1pdGVtLWJvdHRvbVwiKS5maW5kKFwiLm1hbGZ1bmN0aW9uLWVycm9yLWN0YS1tZXNzYWdlXCIpO1xuXG4gICAgLy9BY2Nlc3NpYmlsaXR5IHRoYXQgcHJldmVudCB0aGUgdXNlcnMuXG4gICAgdGhlRWxlbWVudFRvU2hvdy5hdHRyKFwicm9sZVwiLCBcImFsZXJ0XCIpO1xuICAgIHRoZUVsZW1lbnRUb1Nob3cuYXR0cihcImFyaWEtbGl2ZVwiLCBcImFzc2VydGl2ZVwiKTtcblxuICAgIHRoZUVsZW1lbnRUb1Nob3cuc2hvdygpO1xuICB9XG5cbi8vIEJpbmQgdGhlIGNsaWNrIGV2ZW50IHRvIGFsbCB0aGUgLmFqYXgtcG9zdCBlbGVtZW50cy5cbi8vIE9uIGNsaWNrIGdldCB0aGUgdXJsIG9mIHRoZSBtb2RhbCBmcmFnbWVudCB2aWEgYWpheFxuLy8gdGhlbiBzaG93IGl0IGluIHRoZSBwYWdlLlxuICBpZiAoYWpheENvbmZpZy4kYWpheE92ZXJsYXlzLmxlbmd0aCA+IDApIHtcblxuICAgIGFqYXhDb25maWcuJGFqYXhPdmVybGF5cy5vbihcImNsaWNrLmFqYXhDYWxsXCIsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgdmFyIHVybCA9ICQodGhpcykuZGF0YShcInVybFwiKTtcbiAgICAgIHZhciBwcmV2aW91c0VsZW1lbnQgPSBudWxsO1xuXG4gICAgICBpZiggJCh0aGlzKS5oYXNDbGFzcyhcImNhbmNlbC1vcmRlci1idG5cIikgKSB7XG4gICAgICAgIHByZXZpb3VzRWxlbWVudCA9ICQodGhpcykuY2xvc2VzdChcIi5vcmRlci1pdGVtLWJvdHRvbSAuY3RhLWNvbnRhaW5lclwiKS5maW5kKFwiYTpmaXJzdFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHByZXZpb3VzRWxlbWVudCA9ICQodGhpcykuZ2V0KDApO1xuICAgICAgfVxuXG4gICAgICAkLmFqYXgoe1xuICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgIC8vIEFwcGVuZCB0aGUgZGFyayBiYWNrZ3JvdW5kIGJlaGluZCB0aGUgb3ZlcmxheVxuICAgICAgICAgICQoJyNtb2RhbC1vdmVybGF5JykucmVtb3ZlKCk7XG4gICAgICAgICAgJCgnYm9keScpLmFwcGVuZCgnPGRpdiBpZD1cIm1vZGFsLW92ZXJsYXlcIj48L2Rpdj4nKTtcblxuICAgICAgICAgIC8vIFJlbW92ZSB0aGUgZXhpc3RhbnQgb3ZlcmxheXNcbiAgICAgICAgICAkKCcuYWpheC1tb2RhbC1jb250YWluZXInKS5yZW1vdmUoKTtcblxuICAgICAgICAgICQoXCJib2R5XCIpLmFwcGVuZCgnPGRpdiBjbGFzcz1cImFqYXgtbW9kYWwtY29udGFpbmVyXCI+JyArIGRhdGEgKyAnPC9kaXY+Jyk7XG4gICAgICAgICAgdmFyICRtb2RhbCA9ICQoJy5hamF4LW1vZGFsLWNvbnRhaW5lciAubW9kYWwnKTtcbiAgICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9IGNpdGlTaGFyZS5BY2Nlc3NpYmxlTW9kYWwoe21vZGFsOiAkbW9kYWwsIHByZXZpb3VzRWxlbWVudDogcHJldmlvdXNFbGVtZW50fSk7XG4gICAgICAgICAgbW9kYWxJbnN0YW5jZS5zaG93KCk7XG4gICAgICAgICAgLy9DYWxsIHRoZSBmdW5jdGlvbiB0aGF0IGJpbmQgYnV0dG9ucyAoQ2xvc2UgYnV0dG9uKVxuICAgICAgICAgIGJpbmRPdmVybGF5KCk7XG4gICAgICAgIH0sXG4gICAgICAgIHN0YXR1c0NvZGU6IHtcbiAgICAgICAgICAyMDI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZGlzcGxheUN0YUVycm9yTWVzc2FnZShwcmV2aW91c0VsZW1lbnQpO1xuICAgICAgICAgIH0sXG5cbiAgICAgICAgICA0MDQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZGlzcGxheUN0YUVycm9yTWVzc2FnZShwcmV2aW91c0VsZW1lbnQpO1xuICAgICAgICAgIH0sXG5cbiAgICAgICAgICA1MDA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZGlzcGxheUN0YUVycm9yTWVzc2FnZShwcmV2aW91c0VsZW1lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKlxuICAgKiBCaW5kIHRoZSBmb3JtOnBvc3QgZXZlbnQgdG8gYWxsIHRoZSAuYWpheC1vdmVybGF5IGVsZW1lbnRzLlxuICAgKi9cbiAgaWYgKGFqYXhDb25maWcuJGFqYXhQb3N0cy5sZW5ndGggPiAwKSB7XG4gICAgYWpheENvbmZpZy4kYWpheFBvc3RzLm9uKCdmb3JtOnBvc3QnLCBfYWpheFBvc3QpO1xuICB9XG5cbi8vIEJpbmQgdGhlIHByb3BlciBldmVudCBmb3IgYWpheC1kZWxldGUgZWxlbWVudHMuXG4gIGlmIChhamF4Q29uZmlnLiRhamF4RGVsZXRlcy5sZW5ndGggPiAwKSB7XG4gICAgYWpheENvbmZpZy4kYWpheERlbGV0ZXMub24oJ2Zvcm06ZGVsZXRlJywgX2FqYXhEZWxldGUpO1xuICB9XG5cbi8vQWpheFJlcGxhY2UgdXNlZCBmb3IgcmVwbGFjZSB0aGUgYmxvY2tzIGluIHRoZSBtb2RhbCBhbHJlYWR5IGV4aXN0aW5nXG4gIHZhciBfYWpheEdldEFuZFJlcGxhY2UgPSBmdW5jdGlvbiBfYWpheEdldEFuZFJlcGxhY2UoKSB7XG5cbiAgICB2YXIgZGVzdCA9ICQodGhpcykuZGF0YShcImRlc3RpbmF0aW9uXCIpO1xuICAgIHZhciB1cmwgPSAkKHRoaXMpLmRhdGEoXCJ1cmxcIik7XG5cbiAgICAkLmdldCh1cmwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAkKCcuJyArIGRlc3QpLmh0bWwoZGF0YSk7XG4gICAgICB2YXIgbW9kYWwgPSAkKCcuYWpheC1tb2RhbC1jb250YWluZXIgLm1vZGFsJyk7XG4gICAgICBjaXRpU2hhcmUuQWNjZXNzaWJsZU1vZGFsKHttb2RhbDogbW9kYWx9KTtcbiAgICAgIGJpbmRPdmVybGF5KCk7XG4gICAgfSk7XG5cbiAgfTtcblxuLy9CaW5kIHRoZSBjbG9zZSBidXR0b24gb24gdGhlIG92ZXJsYXlzXG4vL1RyaWdnZXIgYSBjbGljayBvbiB0aGUgbW9kYWwtb3ZlcmxheSB0aGF0IGNsb3NlIHRoZSBtb2RhbFxuICBmdW5jdGlvbiBiaW5kT3ZlcmxheSgpIHtcblxuICAgIHZhciBhY2NvdW50T3ZlcmxheSA9IHtcbiAgICAgICRjbG9zZVNlbGVjdG9yOiAkKCcudHJpZ2dlckNsb3NlTW9kYWxCdG4nKSxcbiAgICAgICRjbG9zZVRhcmdldFNlbGVjdG9yOiAkKCcjbW9kYWwtb3ZlcmxheScpLFxuICAgICAgJGNvbmZpcm1lZFNlbGVjdG9yOiAkKCcudHJpZ2dlckNvbmZpcm1lZCcpXG4gICAgfTtcblxuICAgIGFjY291bnRPdmVybGF5LiRjbG9zZVNlbGVjdG9yLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgaWYoICQodGhpcykuaGFzQ2xhc3MoXCJyZWxvYWRMaXN0XCIpICkge1xuICAgICAgICAkKFwiLm11bHRpc2VsZWN0LWNvbnRhaW5lcjpmaXJzdCBsaTpmaXJzdC1jaGlsZFwiKS5maW5kKCdpbnB1dCcpLnRyaWdnZXIoJ2N1c3RvbUV2ZW50TG9hZEFqYXgnKTtcbiAgICAgIH1cbiAgICAgIGFjY291bnRPdmVybGF5LiRjbG9zZVRhcmdldFNlbGVjdG9yLmNsaWNrKCk7XG4gICAgfSk7XG4gIH1cblxuLy8gQ3JlYXRlcyBhIHNwYW4gd2hpY2ggd2lsbCBiZSByZWFkIGJ5IHNjcmVlbiByZWFkZXJzIGFuZCBhZGQgYSBtZXNzYWdlIHRvIGl0LlxuLy8gSWYgaXQgYWxyZWFkeSBleGlzdHMsIHNpbXBseSByZXBsYWNlIHRoZSBodG1sIHdpdGggdGhlIG1lc3NhZ2UuXG4gIGZ1bmN0aW9uIHVwZGF0ZUFyaWFMaXZlTWVzc2FnZShtZXNzYWdlKSB7XG4gICAgdmFyICRtZXNzYWdlQ29udGFpbmVyID0gJCgnLm1lc3NhZ2UtdXBkYXRlJyk7XG4gICAgaWYgKCRtZXNzYWdlQ29udGFpbmVyLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdmFyIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKSxcbiAgICAgICAgdGV4dG5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShtZXNzYWdlKTtcbiAgICAgIG5vZGUuYXBwZW5kQ2hpbGQodGV4dG5vZGUpO1xuICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIm1lc3NhZ2UtdXBkYXRlIHZpc3VhbGx5aGlkZGVuXCIpO1xuICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxpdmVcIiwgXCJhc3NlcnRpdmVcIik7XG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG5vZGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkbWVzc2FnZUNvbnRhaW5lci5odG1sKG1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gICQoZG9jdW1lbnQuYm9keSkub24oJ2NsaWNrJywgJy5hamF4LXJlcGxhY2UnLCBfYWpheEdldEFuZFJlcGxhY2UpO1xuXG4gIHJldHVybiB7XG4gICAgYWpheERlbGV0ZTogX2FqYXhEZWxldGVcbiAgfTtcblxufSlcbigpO1xuIiwiLyoqXG4gKiBOdW1iZXIgc3RlcHBlclxuICogQHR5cGUge3tudW1lcmljU3RlcHBlcn19XG4gKi9cblxuY2l0aVNoYXJlLm51bWVyaWNTdGVwcGVyID0gKGZ1bmN0aW9uKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLyoqXG4gICAgICogSW5pdCBzdGVwcGVyXG4gICAgICovXG4gICAgZnVuY3Rpb24gbnVtZXJpY1N0ZXBwZXJTZXR1cCgpe1xuXG4gICAgICAgIHZhciAkcGFyZW50RWwgPSAgJChcIi5zdGVwcGVyLWJ1dHRvbnNcIik7XG4gICAgICAgIHZhciAkaW5wdXRTdGVwcGVyRWwgPSAkKFwiLm51bWVyaWMtc3RlcHBlciA+IGlucHV0XCIpO1xuICAgICAgICB2YXIgbWF4UXVhbnRpdHkgPSBwYXJzZUludCgkaW5wdXRTdGVwcGVyRWwuYXR0cihcIm1heFwiKSk7XG4gICAgICAgIHZhciBtaW5RdWFudGl0eSA9IHBhcnNlSW50KCRpbnB1dFN0ZXBwZXJFbC5hdHRyKFwibWluXCIpKTtcbiAgICAgICAgdmFyICRkZWNyZWFzZUJ1dHRvbiA9ICAkKFwiW2RhdGEtc3RlcHBlcj1kZWNyZWFzZV1cIik7XG4gICAgICAgIHZhciAkaW5jcmVhc2VCdXR0b24gPSAgJChcIltkYXRhLXN0ZXBwZXI9aW5jcmVhc2VdXCIpO1xuXG4gICAgICAgIC8vIEFsbG93IG51bWJlcnMgb25seSAobm8gZGVjaW1hbClcbiAgICAgICAgJGlucHV0U3RlcHBlckVsLm51bWVyaWMoe1xuICAgICAgICAgICAgZGVjaW1hbDogZmFsc2UsXG4gICAgICAgICAgICBkZWNpbWFsUGxhY2VzIDogLTFcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHBhcmVudEVsLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oZSl7XG5cbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHZhciBnZXRDdXJyZW50VmFsdWUgPSBwYXJzZUludCgkaW5wdXRTdGVwcGVyRWwudmFsKCkpO1xuICAgICAgICAgICAgdmFyIHZhbHVlQWRqdXN0bWVudCA9IHBhcnNlSW50KCQodGhpcykuYXR0cihcImRhdGEtcXVhbnRpdHktYWRqdXN0bWVudFwiKSk7XG4gICAgICAgICAgICB2YXIgc2V0VmFsdWUgPSBnZXRDdXJyZW50VmFsdWUgKyB2YWx1ZUFkanVzdG1lbnQ7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldEluY3JlYXNlQnV0dG9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoIHNldFZhbHVlIDw9IG1heFF1YW50aXR5ICkge1xuICAgICAgICAgICAgICAgICAgICAkaW5wdXRTdGVwcGVyRWwudmFsKHNldFZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRpbmNyZWFzZUJ1dHRvbi5wcm9wKFwiZGlzYWJsZWRcIiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRpbmNyZWFzZUJ1dHRvbi5wcm9wKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXREZWNyZWFzZUJ1dHRvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKCBzZXRWYWx1ZSA8IG1pblF1YW50aXR5ICl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkZGVjcmVhc2VCdXR0b24ucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJGlucHV0U3RlcHBlckVsLnZhbChzZXRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkZGVjcmVhc2VCdXR0b24ucHJvcChcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggZ2V0Q3VycmVudFZhbHVlID4gbWluUXVhbnRpdHkgKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2V0SW5jcmVhc2VCdXR0b24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBzZXREZWNyZWFzZUJ1dHRvbigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIG51bWVyaWNTdGVwcGVyU2V0dXA6IG51bWVyaWNTdGVwcGVyU2V0dXBcbiAgICB9O1xuXG59KSgpO1xuXG4iLCIvKlxuICpcbiAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBpbml0aWFsaXplIGFuZCBoYW5kbGUgZXZlcnl0aGluZyByZWxhdGVkXG4gKiB0byB0aGUgb3JkZXIgaGlzdG9yeSBwYWdlXG4gKlxuICogRGVwZW5kcyBvblxuICogIC0gSGF2aW5nIGEgRElWIHdpdGggYSBjbGFzcyBvZiBgb3JkZXItaGlzdG9yeWBcbiAqICAtIGpRdWVyeVxuICpcbiAqL1xuY2l0aVNoYXJlLm9yZGVySGlzdG9yeSA9IChmdW5jdGlvbiAoKSB7XG5cbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgLypcbiAgICogSW5pdCB0aGUgYWNjZXNzaWJsZSBsaXN0XG4gICAqL1xuICB2YXIgaW5pdExpc3RzID0gZnVuY3Rpb24gaW5pdExpc3RzKCkge1xuICAgIC8vT3JkZXIgZGV0YWlscyAtPiBPcmRlciBzdW1tYXJ5IGxpc3RcbiAgICBjaXRpU2hhcmUuYWNjZXNzaWJsZU11bHRpQ29sdW1uTGlzdCgnLm9yZGVyLWRldGFpbHMtc3VtbWFyeS1saXN0JywgMykuaW5pdCgpO1xuXG4gICAgJCgnLm9yZGVyLWl0ZW0taW5mb3JtYXRpb24tbGlzdC1jb250YWluZXIudGhyZWUtY29sdW1uJykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAvL09yZGVyIGhpc3RvcnkgLT4gT3JkZXIgaXRlbXMgbGlzdCBmb3IgdGhyZWUgY29sdW1uXG4gICAgICBjaXRpU2hhcmUuYWNjZXNzaWJsZU11bHRpQ29sdW1uTGlzdCh0aGlzLCAzKS5pbml0KCk7XG4gICAgfSk7XG5cbiAgICAkKCcub3JkZXItaXRlbS1pbmZvcm1hdGlvbi1saXN0LWNvbnRhaW5lci50d28tY29sdW1uJykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAvL09yZGVyIGhpc3RvcnkgLT4gT3JkZXIgaXRlbXMgbGlzdCBmb3IgdHdvIGNvbHVtblxuICAgICAgY2l0aVNoYXJlLmFjY2Vzc2libGVNdWx0aUNvbHVtbkxpc3QodGhpcywgMikuaW5pdCgpO1xuICAgIH0pO1xuXG5cbiAgICAkKCcub3JkZXItaXRlbS1pbnRlcm5hdGlvbmFsLWxpc3QtY29udGFpbmVyJykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAvL09yZGVyIGhpc3RvcnkgLT4gT3JkZXIgaXRlbXMgbGlzdCBmb3IgdHdvIGNvbHVtblxuICAgICAgY2l0aVNoYXJlLmFjY2Vzc2libGVNdWx0aUNvbHVtbkxpc3QodGhpcywgMykuaW5pdCgpO1xuICAgIH0pO1xuXG4gIH07XG5cbiAgLypcbiAgICogSW5pdCB0aGUgY2l0aVNoYXJlLm9yZGVyLWhpc3RvcnkgY29kZS5cbiAgICogQmFzaWNhbGx5IGJpbmQgYWxsIG5lY2Vzc2FyeSBldmVudHMuXG4gICAqL1xuICB2YXIgaW5pdCA9IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgaW5pdExpc3RzKCk7XG4gIH07XG5cbiAgaWYgKCQoJy5vcmRlci1oaXN0b3J5JykubGVuZ3RoID4gMCB8fCAkKCcub3JkZXItZGV0YWlscycpLmxlbmd0aCA+IDApIHtcbiAgICBpbml0KCk7XG4gIH1cblxufSkoKTtcbiIsIi8qKlxuICogc2ltcGxlUGFnaW5hdGlvbi5qcyBQbHVnaW4gRG9jdW1lbnRhdGlvbiA6XG4gKiBodHRwOi8vZmxhdml1c21hdGlzLmdpdGh1Yi5pby9zaW1wbGVQYWdpbmF0aW9uLmpzL1xuICovXG5cblwidXNlIHN0cmljdFwiO1xuXG5jaXRpU2hhcmUucGFnaW5hdGlvbiA9IChmdW5jdGlvbigpIHtcblxuICAgIC8qKlxuICAgICAqIEluaXQgdGhlIHBhZ2luYXRpb24gcGx1Z2luIG9uIFBMUFxuICAgICAqXG4gICAgICogQHBhcmFtIHtqUXVlcnl9ICRzZWxlY3RvciBUYXJnZXRlZCBsaXN0IGl0ZW1zXG4gICAgICogQHBhcmFtIHtqUXVlcnl9IHBhZ2luYXRpb25DbGFzcyBQYWdpbmF0aW9uIHJvdyBjb250YWluZXJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gaXRlbXNQZXJQYWdlIE51bWJlciBvZiBpdGVtcyBwZXIgcGFnZSB0byBkaXNwbGF5XG4gICAgICovXG4gICAgZnVuY3Rpb24gaW5pdFBhZ2luYXRpb24oJHNlbGVjdG9yLCBwYWdpbmF0aW9uQ2xhc3MsIGl0ZW1zUGVyUGFnZSkge1xuXG4gICAgICAgIHZhciB0b3RhbEl0ZW1zID0gJHNlbGVjdG9yLmxlbmd0aDtcbiAgICAgICAgdmFyIG1heEl0ZW1zID0gNDg7XG4gICAgICAgICRzZWxlY3Rvci5zbGljZShpdGVtc1BlclBhZ2UpLmhpZGUoKTtcbiAgICAgICAgXG4gICAgICAgIGlmKHR5cGVvZiAkKHBhZ2luYXRpb25DbGFzcykucGFnaW5hdGlvbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICQocGFnaW5hdGlvbkNsYXNzKS5wYWdpbmF0aW9uKHtcbiAgICAgICAgICAgICAgaXRlbXM6IHRvdGFsSXRlbXMsXG4gICAgICAgICAgICAgIGl0ZW1zT25QYWdlOiBpdGVtc1BlclBhZ2UsXG4gICAgICAgICAgICAgIG9uSW5pdDogZnVuY3Rpb24oKSB7XG4gIFxuICAgICAgICAgICAgICAgICAgLy8gT25lIHBhZ2VcbiAgICAgICAgICAgICAgICAgIGlmICggaXRlbXNQZXJQYWdlID49IHRvdGFsSXRlbXMgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgaXRlbXNQZXJQYWdlID0gdG90YWxJdGVtcztcbiAgICAgICAgICAgICAgICAgICAgICAkKFwiLnBhZ2luYXRpb25cIikuYWRkQ2xhc3MoXCJpcy1oaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgJCgnLnBhZ2luYXRpb24tbmV4dCcpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAkKCcucGFnaW5hdGlvbi1wcmV2JykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICQoJy5wYWdpbmF0aW9uLXN1bW1hcnkudG9wJykuYWRkQ2xhc3MoJ3RvcC1wYWRkaW5nJyk7XG4gICAgICAgICAgICAgICAgICB9XG4gIFxuICAgICAgICAgICAgICAgICAgJCgnLnBhZ2luYXRpb24tbmV4dCA+IGEnKS5hdHRyKFwiaHJlZlwiLFwiI1wiICsgKDIpKTtcbiAgICAgICAgICAgICAgICAgICQoJy5wYWdpbmF0aW9uLXByZXYgPiBhJykuaGlkZSgpO1xuICBcbiAgICAgICAgICAgICAgICAgICQoJy5uZXh0JykucGFyZW50KCkuYWRkQ2xhc3MoJ2JvcmRlcicpO1xuICAgICAgICAgICAgICAgICAgJCgnLnByZXYnKS5wYXJlbnQoKS5hZGRDbGFzcygnYm9yZGVyJyk7XG4gIFxuICAgICAgICAgICAgICAgICAgJChcIi5jdXJyZW50LXBhZ2VcIikuaHRtbChcIjFcIik7XG4gICAgICAgICAgICAgICAgICAkKFwiLnNob3ctdG8tcGFnZVwiKS5odG1sKGl0ZW1zUGVyUGFnZSk7XG4gIFxuICAgICAgICAgICAgICAgICAgaWYodG90YWxJdGVtcyA+IG1heEl0ZW1zICl7XG4gICAgICAgICAgICAgICAgICAgICAgJChcIi50b3RhbC1wYWdlc1wiKS5odG1sKHRvdGFsSXRlbXMgKyBcIjxzcGFuIGNsYXNzPSdwaXBlJz4gfCA8L3NwYW4+XCIpO1xuICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgJChcIi50b3RhbC1wYWdlc1wiKS5odG1sKHRvdGFsSXRlbXMpO1xuICAgICAgICAgICAgICAgICAgfVxuICBcbiAgICAgICAgICAgICAgICAgIHNldHVwQWNjZXNzaWJpbGl0eSgpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBvblBhZ2VDbGljazogZnVuY3Rpb24ocGFnZU51bWJlcikge1xuICBcbiAgICAgICAgICAgICAgICAgIHZhciBzaG93RnJvbSA9IGl0ZW1zUGVyUGFnZSAqIChwYWdlTnVtYmVyIC0gMSk7XG4gICAgICAgICAgICAgICAgICB2YXIgc2hvd1RvID0gc2hvd0Zyb20gKyBpdGVtc1BlclBhZ2U7XG4gICAgICAgICAgICAgICAgICB2YXIgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCAkKHdpbmRvdykud2lkdGgoKTtcbiAgXG4gICAgICAgICAgICAgICAgICBpZih3aW5kb3dXaWR0aCA8PSA5NjApe1xuICAgICAgICAgICAgICAgICAgICAgICQoJy5wcmV2JykucGFyZW50KCkuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICQoJy5uZXh0JykucGFyZW50KCkuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgLy8gU2V0IG1heFxuICAgICAgICAgICAgICAgICAgaWYgKCBzaG93VG8gPj0gdG90YWxJdGVtcyApIHtcbiAgICAgICAgICAgICAgICAgICAgICBzaG93VG8gPSB0b3RhbEl0ZW1zO1xuICAgICAgICAgICAgICAgICAgfVxuICBcbiAgICAgICAgICAgICAgICAgIC8vIFNldCBtaW5cbiAgICAgICAgICAgICAgICAgIGlmICggc2hvd0Zyb20gPD0gMSApe1xuICAgICAgICAgICAgICAgICAgICAgIHNob3dGcm9tID0gMDtcbiAgICAgICAgICAgICAgICAgIH1cbiAgXG4gICAgICAgICAgICAgICAgICAvL2Nsb3NlIG1vZGFsc1xuICAgICAgICAgICAgICAgICAgJCgnLm1vZGFsLWNsb3NlLWJ1dHRvbicpLnRyaWdnZXIoJ2NsaWNrJyk7XG4gIFxuICAgICAgICAgICAgICAgICAgdmFyIHRvdGFsID0gJChwYWdpbmF0aW9uQ2xhc3MpLnBhZ2luYXRpb24oJ2dldFBhZ2VzQ291bnQnKTtcbiAgXG4gICAgICAgICAgICAgICAgICBpZihwYWdlTnVtYmVyIDw9IDEpe1xuICAgICAgICAgICAgICAgICAgICAgICQoJy5wYWdpbmF0aW9uLXByZXYgPiBhJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICQoJy5wYWdpbmF0aW9uLW5leHQgPiBhJykuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgfWVsc2UgaWYocGFnZU51bWJlciA+IDEgJiYgcGFnZU51bWJlciA8IHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgJCgnLnBhZ2luYXRpb24tcHJldiA+IGEnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgJCgnLnBhZ2luYXRpb24tbmV4dCA+IGEnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAkKCcucGFnaW5hdGlvbi1uZXh0ID4gYScpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAkKCcucGFnaW5hdGlvbi1wcmV2ID4gYScpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgXG4gICAgICAgICAgICAgICAgICAkKFwiLmN1cnJlbnQtcGFnZVwiKS5odG1sKHNob3dGcm9tID09PSAwID8gMSA6IHNob3dGcm9tKTtcbiAgICAgICAgICAgICAgICAgICQoXCIuc2hvdy10by1wYWdlXCIpLmh0bWwoc2hvd1RvKTtcbiAgICAgICAgICAgICAgICAgICQoXCIudG90YWwtcGFnZXNcIikuaHRtbCh0b3RhbEl0ZW1zKTtcbiAgXG4gIFxuICBcbiAgICAgICAgICAgICAgICAgIHZhciBuZXh0ID0gJCgnLm5leHQnKS5wYXJlbnQoKS5hZGRDbGFzcygnYm9yZGVyJyk7XG4gICAgICAgICAgICAgICAgICB2YXIgcHJldiA9ICQoJy5wcmV2JykucGFyZW50KCkuZmlyc3QoKS5hZGRDbGFzcygnYm9yZGVyJyk7XG4gIFxuICAgICAgICAgICAgICAgICAgcHJldi5pbnNlcnRCZWZvcmUobmV4dCk7XG4gIFxuICAgICAgICAgICAgICAgICAgJCgnLnByZXYnKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgaWYoISQodGhpcykucGFyZW50KCkuaGFzQ2xhc3MoJ2JvcmRlcicpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgXG4gICAgICAgICAgICAgICAgICBzZXR1cEFjY2Vzc2liaWxpdHkoKTtcbiAgXG4gICAgICAgICAgICAgICAgICBpZihpdGVtc1BlclBhZ2UgPj0gbWF4SXRlbXMgKXtcbiAgICAgICAgICAgICAgICAgICAgICAkKFwiLnRvdGFsLXBhZ2VzXCIpLmh0bWwodG90YWxJdGVtcyArIFwiPHNwYW4gY2xhc3M9J3BpcGUnPiB8IDwvc3Bhbj5cIik7XG4gICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAkKFwiLnRvdGFsLXBhZ2VzXCIpLmh0bWwodG90YWxJdGVtcyk7XG4gICAgICAgICAgICAgICAgICB9XG4gIFxuICAgICAgICAgICAgICAgICAgJHNlbGVjdG9yLmhpZGUoKS5zbGljZShzaG93RnJvbSwgc2hvd1RvKS5zaG93KCk7XG4gIFxuICBcbiAgICAgICAgICAgICAgICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHsgc2Nyb2xsVG9wOiAwIH0sICdzbG93Jyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG5cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXR1cEFjY2Vzc2liaWxpdHkoKXtcbiAgICAgICAgJCgnLnBhZ2UtbGluaycpLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmKCEkKHRoaXMpLnBhcmVudCgpLmhhc0NsYXNzKCdib3JkZXInKSl7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5wcmVwZW5kKCc8c3BhbiBjbGFzcz1cInZpc3VhbGx5aGlkZGVuXCI+UGFnZSA8L3NwYW4+Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoISQodGhpcykuaGFzQ2xhc3MoJ2JvcmRlcicpKSB7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnb21uaXR1cmUtcGFnaW5hdGlvbi1wYWdlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgcHJldkh0bWwgPSAkKCcucHJldicpLmZpcnN0KCkuaHRtbCgpO1xuICAgICAgICB2YXIgbmV4dEh0bWwgPSAkKCcubmV4dCcpLmZpcnN0KCkuaHRtbCgpO1xuICAgICAgICAkKCcuY3VycmVudCcpLnByZXBlbmQoJzxzcGFuIGNsYXNzPVwidmlzdWFsbHloaWRkZW5cIj5QYWdlPC9zcGFuPicpO1xuXG4gICAgICAgICQoJy5wcmV2JykuaHRtbChwcmV2SHRtbCArICc8c3BhbiBjbGFzcz1cInZpc3VhbGx5aGlkZGVuXCI+UGFnZTwvc3Bhbj4nKS5hZGRDbGFzcygnb21uaXR1cmUtcGFnaW5hdGlvbi1wcmV2aW91cycpO1xuICAgICAgICAkKCcubmV4dCcpLmh0bWwobmV4dEh0bWwgKyAnPHNwYW4gY2xhc3M9XCJ2aXN1YWxseWhpZGRlblwiPlBhZ2U8L3NwYW4+JykuYWRkQ2xhc3MoJ29tbml0dXJlLXBhZ2luYXRpb24tbmV4dCcpO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogRGVza3RvcCB2aWV3IHBhZ2luYXRpb24gYnV0dG9uIGRpc3BsYXkgbG9naWNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzZXREZXNrdG9wUGFnaW5hdGlvbkJ1dHRvbnMgKCkge1xuXG4gICAgICAgIHZhciBwYXJlbnRDb250YWluZXIgPSAkKFwiLnBhZ2luYXRpb24gPiB1bCA+IGxpXCIpO1xuXG4gICAgICAgIHBhcmVudENvbnRhaW5lci5jc3Moe1xuICAgICAgICAgICAgXCJ3aWR0aFwiOiBcImF1dG9cIlxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNb2JpbGUgdmlldyBwYWdpbmF0aW9uIGJ1dHRvbiBkaXNwbGF5IGxvZ2ljXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2V0TW9iaWxlUGFnaW5hdGlvbkJ1dHRvbnMgKCkge1xuXG4gICAgICAgICQoJy5keW4tbmV4dCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgJCgnbGkuYm9yZGVyID4gYS5uZXh0JykudHJpZ2dlcignY2xpY2snKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnLmR5bi1wcmV2Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAkKCdsaS5ib3JkZXIgPiBhLnByZXYnKS50cmlnZ2VyKCdjbGljaycpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZigkKCcucGFnaW5hdGlvbi1zdW1tYXJ5JykucHJldigpLmhhc0NsYXNzKCd0YWctY29udGFpbmVyJykpe1xuICAgICAgICAgICAgJCgnLnRhZy1jb250YWluZXInKS5uZXh0KCkuYWRkQ2xhc3MoJ3RvcCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoJCgnLnBhZ2luYXRpb24tc3VtbWFyeScpLnByZXYoKS5oYXNDbGFzcygncHJvZHVjdC1saXN0Jykpe1xuICAgICAgICAgICAgJCgnLnByb2R1Y3QtbGlzdCcpLm5leHQoKS5hZGRDbGFzcygnYm90dG9tJyk7XG4gICAgICAgIH1cblxuICAgICAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCAkKHdpbmRvdykud2lkdGgoKTtcblxuICAgICAgICAgICAgLy8gIFRvIG1hdGNoIGluY2x1ZGVfbWVkaWEgOTU5cHggdGFibGV0IGJyZWFrcG9pbnRcbiAgICAgICAgICAgIGlmKHdpbmRvd1dpZHRoIDwgOTU5KXtcbiAgICAgICAgICAgICAgICAkKCcucGFnaW5hdGlvbi1zdW1tYXJ5LnRvcCcpLnNpYmxpbmdzKCcucGFnaW5hdGlvbi1wcmV2JykuYWRkQ2xhc3MoJ3RvcCcpO1xuICAgICAgICAgICAgICAgICQoJy5wYWdpbmF0aW9uLXN1bW1hcnkudG9wJykuc2libGluZ3MoJy5wYWdpbmF0aW9uLW5leHQnKS5hZGRDbGFzcygndG9wJyk7XG4gICAgICAgICAgICAgICAgJCgnLnByZXYnKS5wYXJlbnQoKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgJCgnLm5leHQnKS5wYXJlbnQoKS5oaWRlKCk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAkKCcucHJldicpLnBhcmVudCgpLnNob3coKTtcbiAgICAgICAgICAgICAgICAkKCcubmV4dCcpLnBhcmVudCgpLnNob3coKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkudHJpZ2dlcigncmVzaXplJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdCgpe1xuICAgICAgICBzZXRNb2JpbGVQYWdpbmF0aW9uQnV0dG9ucygpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGluaXQ6IGluaXQsXG4gICAgICAgIGluaXRQYWdpbmF0aW9uOiBpbml0UGFnaW5hdGlvbixcbiAgICAgICAgc2V0RGVza3RvcFBhZ2luYXRpb25CdXR0b25zOiBzZXREZXNrdG9wUGFnaW5hdGlvbkJ1dHRvbnMsXG4gICAgICAgIHNldE1vYmlsZVBhZ2luYXRpb25CdXR0b25zOiBzZXRNb2JpbGVQYWdpbmF0aW9uQnV0dG9uc1xuICAgIH07XG5cbn0pKCk7XG4iLCIvKmpzaGludCB1bnVzZWQ6ZmFsc2UsIHN1Yjp0cnVlKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBfdG9BcnJheShhcnJheUxpa2UpIHtcbiAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycmF5TGlrZSk7XG59XG5cbnZhciBQb2ludHNUcmFuc2ZlckZpbHRlcnMgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gIC8qKlxuICAgKiBCYXNlIGpRdWVyeSBlbGVtZW50XG4gICAqXG4gICAqIEB0eXBlIHtqUXVlcnl9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICB0aGlzLl8kZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgLyoqXG4gICAqIE1haW4gYXBwbGljYXRpb24gd3JhcHBlci5cbiAgICpcbiAgICogQHR5cGUge2pRdWVyeX1cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHRoaXMuXyRtYWluV3JhcHBlciA9IG51bGw7XG5cbiAgLyoqXG4gICAqIHdpbmRvdyBlbGVtZW50LlxuICAgKlxuICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdGhpcy5faHRtbCA9ICQoJ2h0bWwnKTtcblxuICAvKipcbiAgICogd2luZG93IGVsZW1lbnQuXG4gICAqXG4gICAqIEB0eXBlIHtqUXVlcnl9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICB0aGlzLl8kd2luZG93ID0gJCh3aW5kb3cpO1xuXG4gIC8qKlxuICAgKiBSZXdhcmQgZWxlbWVudHMgd2hpY2ggd2lsbCBiZSBmaWx0ZXJlZC5cbiAgICpcbiAgICogQHR5cGUge2pRdWVyeX1cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHRoaXMuXyRyZXdhcmRFbGVtZW50cyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFJld2FyZCBlbGVtZW50cyBzaWxvZCBpbnRvIHRoZWlyIHNwZWNpZmljIGNhdGVnb3JpZXMuXG4gICAqXG4gICAqIEB0eXBlIHtPYmplY3R9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICB0aGlzLl9yZXdhcmRzID0ge307XG5cbiAgLyoqXG4gICAqIFdpbmRvdyB3aWR0aCBvciBpbm5lciB3aWR0aFxuICAgKlxuICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdGhpcy5fd2luZG93V2lkdGggPSBudWxsO1xuXG4gIC8qKlxuICAgKiBNb2RhbCBvcGVuIENUQSBmb3IgbW9iaWxlLlxuICAgKlxuICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdGhpcy5fJG1vZGFsTGF1bmNoQ1RBID0gbnVsbDtcblxuICAvKipcbiAgICogVGhlIGlubmVyIGNvbnRlbnQgb2YgdGhlIG1vZGFsIHdyYXAuXG4gICAqXG4gICAqIEB0eXBlIHtqUXVlcnl9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICB0aGlzLl9maWx0ZXJJbm5lckNvbnRlbnQgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgbW9iaWxlIHRpdGxlIGZvciB0aGUgaGVhZGVyLiBHZXRzIHJlbW92ZWRcbiAgICogZnJvbSB0aGUgRE9NIGFuZCBjYWNoZWQgaW50byB0aGlzIGluc3RhbmNlXG4gICAqIHZhcmlhYmxlLlxuICAgKlxuICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdGhpcy5fbW9iaWxlVGl0bGUgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBIYXMgdGhlIG1vZGFsIGJlZW4gZGVzdHJveWVkIGJ5IHRoZSBzd2l0Y2ggaW4gdGhlIHZpZXdwb3J0XG4gICAqIG9yaWVudGF0aW9uLlxuICAgKlxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHRoaXMuX21vZGFsRGVzdHJveWVkQnlWaWV3cG9ydFN3aXRjaCA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBCb29sZWFuIHRvIGNoZWNrIGlmIG1vZGFsIGlzIG9wZW4gb3Igbm90LlxuICAgKlxuICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHRoaXMuX21vZGFsT3BlbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBGaWx0ZXIgRHJvcGRvd25zXG4gICAqXG4gICAqIEB0eXBlIHtqUXVlcnl9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICB0aGlzLl8kZmlsdGVycyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEJvb2xlYW4gdG8gZGV0ZXJtaW5lIGlmIG9uIG1vYmlsZS5cbiAgICpcbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICB0aGlzLl9pc01vYmlsZSA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBCb29sZWFuIHRvIGRldGVybWluZSBpZiBvbiBkZXNrdG9wXG4gICAqXG4gICAqIEB0eXBlIHtCb29sZWFufVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdGhpcy5faXNEZXNrdG9wID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEFycmF5IG9mIHRoZSBjdXJyZW50IGFjdGl2ZSBmaWx0ZXJzLlxuICAgKlxuICAgKiBAdHlwZSB7QXJyYXl9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICB0aGlzLl9hY3RpdmVGaWx0ZXJzID0gW107XG5cblxuICB0aGlzLl9pbml0KCk7XG59O1xuXG5cblxuLyoqXG4gKiBJbml0aWFsaXplcyB0aGUgZmlsdGVyVGFicyBjb21wb25lbnRcbiAqL1xuUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLnByb3RvdHlwZS5faW5pdCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLl8kbWFpbldyYXBwZXIgPSB0aGlzLl8kZWxlbWVudC5jbG9zZXN0KCcuJyArIFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuTUFJTik7XG5cbiAgdGhpcy5fJGZpbHRlcnMgPSB0aGlzLl8kZWxlbWVudC5maW5kKCcuJyArIFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuRklMVEVSKTtcblxuICB0aGlzLl9tb2JpbGVUaXRsZSA9IHRoaXMuXyRlbGVtZW50LmZpbmQoJy4nICsgUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLkNsYXNzTmFtZS5NT0JJTEVfVElUTEUpO1xuXG4gIHRoaXMuXyRtb2RhbExhdW5jaENUQSA9IHRoaXMuXyRtYWluV3JhcHBlci5maW5kKCcuJyArIFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuTU9EQUxfTEFVTkNIKTtcblxuICB0aGlzLl8kcmV3YXJkRWxlbWVudHMgPSB0aGlzLl8kbWFpbldyYXBwZXIuZmluZCgnLicgKyBQb2ludHNUcmFuc2ZlckZpbHRlcnMuQ2xhc3NOYW1lLlJFV0FSRFMpO1xuXG4gIHRoaXMuX2ZpbHRlcklubmVyQ29udGVudCA9IHRoaXMuXyRlbGVtZW50Lmh0bWwoKTtcblxuICB0aGlzLl9yZXdhcmRzID0gdGhpcy5fZ2V0UmV3YXJkcygpO1xuXG4gIHRoaXMuX2luaXRpYWxpemVCaW5kaW5ncygpO1xufTtcblxuXG4vKipcbiAqIF9pbml0aWFsaXplRmlsdGVyc1xuICogV2lsbCBpbml0aWFsaXplIHRoZSBmaWx0ZXJzLlxuICovXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMucHJvdG90eXBlLl9pbml0aWFsaXplRmlsdGVycyA9IGZ1bmN0aW9uKCkge1xuXG59O1xuXG4vKipcbiAqIF9pbml0aWFsaXplQmluZGluZ3NcbiAqIFdpbGwgaW5pdGlhbGl6ZSB0aGUgYmluZGluZ3MgYW5kIGV2ZW50IGxpc3RlbmVycyBmb3IgdGhlIGZvcm0gaW5wdXRzXG4gKiBvbiB0aGUgcGFnZS5cbiAqXG4gKiBAcHJpdmF0ZVxuICovXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMucHJvdG90eXBlLl9pbml0aWFsaXplQmluZGluZ3MgPSBmdW5jdGlvbigpIHtcbiAgLy8gaGFuZGxlIHJlc2l6ZSBldmVudHNcbiAgdGhpcy5fJHdpbmRvdy5vbigncmVzaXplIG9yaWVudGF0aW9uY2hhbmdlJywgJC5kZWJvdW5jZSgyNTAsICQucHJveHkodGhpcy5faGFuZGxlUmVzaXplLCB0aGlzKSkpO1xuXG4gIHRoaXMuXyRtb2RhbExhdW5jaENUQS5vbignY2xpY2snLCB0aGlzLl9oYW5kbGVNb2RhbExhdW5jaC5iaW5kKHRoaXMpKTtcblxuICB0aGlzLl9pbml0aWFsaXplRmlsdGVyQmluZGluZ3MoKTtcbn07XG5cbi8qKlxuICogX2luaXRpYWxpemVGaWx0ZXJCaW5kaW5nc1xuICogV2lsbCBpbmlzdGFsaXplIGV2ZW50IGRlbGVnYXRpb24gZm9yIHRoZSBmaWx0ZXJzLlxuICovXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMucHJvdG90eXBlLl9pbml0aWFsaXplRmlsdGVyQmluZGluZ3MgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5fJGZpbHRlcnMgPSB0aGlzLl8kZWxlbWVudC5maW5kKFxuICAgICcuJyArIFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuRklMVEVSKTtcblxuICAvLyBoYW5kbGUga2V5cHJlc3NlcyBvbiBjaGVja2JveGVzLlxuICB0aGlzLl8kZmlsdGVycy5vbihcbiAgICAna2V5cHJlc3MnLFxuICAgIHRoaXMuX2hhbmRsZUNoZWNrYm94S2V5cHJlc3MuYmluZCh0aGlzKSk7XG5cbiAgLy8gaGFuZGxlIGNsaWNrIGhhbmRsZXMgb24gY2hlY2tib3hlcy5cbiAgdGhpcy5fJGZpbHRlcnMub24oXG4gICAgJ2NsaWNrJyxcbiAgICB0aGlzLl9oYW5kbGVDaGVja2JveFRvZ2dsZS5iaW5kKHRoaXMpKTtcbn07XG5cbi8qKlxuICogX3JlbW92ZUZpbHRlckJpbmRpbmdzXG4gKiBSZW1vdmUgZXZlbnQgbGlzdGVuZXJzIG9uIHRoZSBmaWxlcnMuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLnByb3RvdHlwZS5fcmVtb3ZlRmlsdGVyQmluZGluZ3MgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5fJGZpbHRlcnMub2ZmKCdrZXlwcmVzcycpO1xuICB0aGlzLl8kZmlsdGVycy5vZmYoJ2NsaWNrJyk7XG59O1xuXG4vKipcbiAqIF9oYW5kbGVSZXNpemVcbiAqIFdpbGwgaGFuZGxlIHdpbmRvdyByZXNpemUgYW5kIG9yIG9yaWVudGF0aW9uIGNoYW5nZXNcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gZXZ0XG4gKiBAcHJpdmF0ZVxuICovXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMucHJvdG90eXBlLl9oYW5kbGVSZXNpemUgPSBmdW5jdGlvbihldnQpIHtcbiAgdGhpcy5fd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCB0aGlzLl93aW5kb3dXaWR0aDtcblxuICAvLyBIYW5kbGUgaWYgbW9iaWxlXG4gIGlmICh0aGlzLl93aW5kb3dXaWR0aCA8PSB3aW5kb3cuY2l0aUNvbmZpZy50YWJsZXRCcmVha3BvaW50KSB7XG4gICAgaWYgKCF0aGlzLl9pc01vYmlsZSkge1xuICAgICAgdGhpcy5faXNNb2JpbGUgPSB0cnVlO1xuICAgICAgdGhpcy5faXNEZXNrdG9wID0gZmFsc2U7XG4gICAgICB0aGlzLl90b2dnbGVBbGxGaWx0ZXJzKGZhbHNlKTtcbiAgICAgIHRoaXMuX2luaXRpYWx6aWVNb2JpbGVMYXlvdXQoKTtcbiAgICB9XG4gIH1cblxuICAvLyBIYW5kbGUgaWYgZGVza3RvcFxuICBpZiAodGhpcy5fd2luZG93V2lkdGggPiB3aW5kb3cuY2l0aUNvbmZpZy50YWJsZXRCcmVha3BvaW50KSB7XG4gICAgaWYgKCF0aGlzLl9pc0Rlc2t0b3ApIHtcbiAgICAgIHRoaXMuX2lzRGVza3RvcCA9IHRydWU7XG4gICAgICB0aGlzLl9pc01vYmlsZSA9IGZhbHNlO1xuICAgICAgdGhpcy5fY2xvc2VNb2RhbCh0cnVlKTtcbiAgICAgIHRoaXMuX2Rlc3Ryb3lNb2JpbGVMYXlvdXQoKTtcbiAgICB9XG4gIH1cbn07XG5cbi8qKlxuICogX2hhbmRsZUNoZWNrYm94S2V5cHJlc3NcbiAqIFdpbGwgaGFuZGxlIGV2ZW50cyBmb3Igd2hlbiB0aGVyZSBpcyBhIGtleXByZXNzLlxuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBldnRcbiAqIEBwcml2YXRlXG4gKi9cblBvaW50c1RyYW5zZmVyRmlsdGVycy5wcm90b3R5cGUuX2hhbmRsZUNoZWNrYm94S2V5cHJlc3MgPSBmdW5jdGlvbihldnQpIHtcbiAgaWYgKGV2dC5jaGFyQ29kZSA9PT0gUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLktleXMuU1BBQ0UgfHxcbiAgICAgIGV2dC5jaGFyQ29kZSA9PT0gUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLktleXMuRU5URVIpIHtcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICB0aGlzLl9oYW5kbGVDaGVja2JveFRvZ2dsZShldnQpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChldnQud2hpY2ggPT09IFBvaW50c1RyYW5zZmVyRmlsdGVycy5LZXlzLlVQIHx8XG4gICAgICBldnQud2hpY2ggPT09IFBvaW50c1RyYW5zZmVyRmlsdGVycy5LZXlzLkRPV04pIHtcbiAgICB0aGlzLl9oYW5kbGVDaGVja2JveEtleU5hdmlnYXRlKGV2dC53aGljaCk7XG4gIH1cbn07XG5cbi8qKlxuICogX2hhbmRsZU1vZGFsTGF1bmNoXG4gKiBXaWxsIGhhbmRsZSB3aGVuIHRoZSBtb2RhbCBDVEEgaXMgY2xpY2tlZC5cbiAqIE5PVEU6IHRoaXMgZG9lc24ndCBpbnN0YW50aWF0ZSB0aGUgbW9kYWwuIFRoYXQgaXMgZG9uZVxuICogdmlhIGEgQ0lUSSBwbHVnaW4uXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGV2dFxuICogQHByaXZhdGVcbiAqL1xuUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLnByb3RvdHlwZS5faGFuZGxlTW9kYWxMYXVuY2ggPSBmdW5jdGlvbihldnQpIHtcbiAgJCgnLm9jLWNvbnRhaW5lcicpLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuJyk7IC8vdGhpcyByZW1vdmVzIGZyb20gb3V0ZXIgbWFpbiBwYXJlbnQgYXJpYS1oaWRkZW5cbiAgXG4gIC8vbG9vcCB0aHJvdWdoIGFsbCBzZWN0aW9ucyBpbiBkb20gYW5kIGFwcGx5IGFyaWEtaGlkZGVuIGV4Y2VwdCBmb3IgZmlsdGVyIGNvbnRhaW5lclxuICAkKCdzZWN0aW9uLCBoZWFkZXIsIGZvb3RlciwgI2hlYWRlci1kZXNrdG9wJykuYXR0cignYXJpYS1oaWRkZW4nLCd0cnVlJyk7XG4gICQoJy5wb2ludHMtdHJhbnNmZXItbGFuZGluZy1ib2R5LWZpbHRlcnMtY29udGFpbmVyJykuYXR0cignYXJpYS1oaWRkZW4nLCdmYWxzZScpO1xuICBcbiAgdmFyICRtb2RhbCA9IHRoaXMuXyRlbGVtZW50LmZpbmQoJyMnICsgUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLkNsYXNzTmFtZS5NT0RBTF9JRCk7XG4gIHZhciBpc0hpZGRlbiA9ICRtb2RhbC5hdHRyKCdhcmlhLWhpZGRlbicpO1xuXG4gIGlmICh0aGlzLl9tb2RhbERlc3Ryb3llZEJ5Vmlld3BvcnRTd2l0Y2gpIHtcbiAgICBuZXcgY2l0aVNoYXJlLkFjY2Vzc2libGVNb2RhbCh7XG4gICAgICBtb2RhbDogJG1vZGFsLFxuICAgICAgcHJldmlvdXNFbGVtZW50OiBldnQudGFyZ2V0XG4gICAgfSk7XG4gIH1cblxuICAvLyBUT0RPOjogQ0lUSS0yMjA1IFdJUCwgY2xlYW4gaXQgdXBcbiAgJCgnLnBvaW50cy10cmFuc2Zlci1sYW5kaW5nLWJvZHktZmlsdGVycy1tb2JpbGUtd3JhcCcpLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcblxuICBpZiAoaXNIaWRkZW4gPT09ICdmYWxzZScpIHtcbiAgICB0aGlzLl9tb2RhbE9wZW4gPSB0cnVlO1xuICB9IGVsc2Uge1xuICAgIHRoaXMuX21vZGFsT3BlbiA9IGZhbHNlO1xuICB9XG4gIFxuICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgIHZhciBjbG9zZUJ1dHRvbiA9ICRtb2RhbC5maW5kKCcubW9kYWwtY2xvc2UtYnV0dG9uJyk7XG4gICAgY2xvc2VCdXR0b24uYXR0cigndGFiaW5kZXgnLCAnLTEnKTtcbiAgICBjbG9zZUJ1dHRvbi5mb2N1cygpO1xuICB9LCAxMDAwKTtcblxuICAkKHdpbmRvdykuc2Nyb2xsVG9wKDApO1xuICB0aGlzLl8kZWxlbWVudC5maW5kKCcjbW9kYWwtcG9pbnRzLXRyYW5zZmVyJykuYXR0cignc3R5bGUnLCAnZGlzcGxheTpibG9jaycpO1xuICB0aGlzLl9odG1sLmFkZENsYXNzKFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuTk9fU0NST0xMKTtcbn07XG5cbi8qKlxuICogX3VuU2VsZWN0Q2hlY2tib3hcbiAqIFdpbGwgdG9nZ2xlIGEgY2hla2Nib3ggYmFzZWQgb24gdGhlIHZhbHVlIHByb3ZpZGVkLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nIH0gdmFsXG4gKiBAcHJpdmF0ZVxuICovXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMucHJvdG90eXBlLl91blNlbGVjdENoZWNrYm94ID0gZnVuY3Rpb24odmFsKSB7XG4gIHZhciBmaWx0ZXIgPSB0aGlzLl8kZmlsdGVycy5maWx0ZXIoXCJbZm9yPSdcIiArIHZhbCArIFwiJ11cIik7XG4gIHZhciBjaGVja2JveCA9IGZpbHRlci5maW5kKFxuICAgICcuJyArIFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuQ0hFQ0tCT1gpO1xuXG4gIGlmIChmaWx0ZXIuYXR0cignYXJpYS1jaGVja2VkJykpIHtcbiAgICBmaWx0ZXIuYXR0cignYXJpYS1jaGVja2VkJywgJ2ZhbHNlJyk7XG4gICAgY2hlY2tib3gucmVtb3ZlQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcbiAgfVxufTtcblxuLyoqXG4gKiBfaGFuZGxlQ2hlY2tib3hUb2dnbGVcbiAqIFdpbGwgaGFuZGxlIHRoZSBjaGVja2JveCB0b2dnbGluZyBhbmQgc2V0IGFyaWEgcHJvcGVydGllcy5cbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gZXZ0XG4gKiBAcHJpdmF0ZVxuICovXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMucHJvdG90eXBlLl9oYW5kbGVDaGVja2JveFRvZ2dsZSA9IGZ1bmN0aW9uKGV2dCkge1xuICB2YXIgZWwgPSAkKGV2dC50YXJnZXQpO1xuICB2YXIgZmlsdGVyID0gZWwuY2xvc2VzdChcbiAgICAnLicgKyBQb2ludHNUcmFuc2ZlckZpbHRlcnMuQ2xhc3NOYW1lLkZJTFRFUik7XG4gIHZhciBjaGVja2JveCA9IGZpbHRlci5maW5kKFxuICAgICcuJyArIFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuQ0hFQ0tCT1gpO1xuICB2YXIgdmFsdWUgPSBjaGVja2JveC5kYXRhKCd2YWx1ZScpLnRvTG93ZXJDYXNlKCk7XG5cbiAgaWYgKHZhbHVlID09PSAnYWxsJykge1xuICAgIC8vIGRldGVybWluZSBpZiBvbiBvciBvZlxuICAgIHZhciB2YWwgPSAoZmlsdGVyLmF0dHIoJ2FyaWEtY2hlY2tlZCcpID09PSAnZmFsc2UnKSA/IHRydWUgOiBmYWxzZTtcblxuICAgIGZpbHRlci5hdHRyKCdhcmlhLWNoZWNrZWQnLCB2YWwpO1xuXG4gICAgaWYgKHZhbCkge1xuICAgICAgICB0aGlzLl90b2dnbGVBbGxGaWx0ZXJzKGZhbHNlKTtcbiAgICAgICAgY2hlY2tib3guYWRkQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjaGVja2JveC5yZW1vdmVDbGFzcygnaXMtY2hlY2tlZCcpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl9oYW5kbGVDaGVja2JveFRyaWdnZXIodmFsLCBmaWx0ZXIpO1xuICB9XG5cbiAgaWYgKGZpbHRlci5hdHRyKCdhcmlhLWNoZWNrZWQnKSA9PT0gJ2ZhbHNlJykge1xuICAgIGZpbHRlci5hdHRyKCdhcmlhLWNoZWNrZWQnLCAndHJ1ZScpO1xuICAgIGNoZWNrYm94LmFkZENsYXNzKCdpcy1jaGVja2VkJyk7XG4gICAgdGhpcy5faGFuZGxlQ2hlY2tib3hUcmlnZ2VyKCd0cnVlJywgZmlsdGVyKTtcbiAgfSBlbHNlIHtcbiAgICBmaWx0ZXIuYXR0cignYXJpYS1jaGVja2VkJywgJ2ZhbHNlJyk7XG4gICAgY2hlY2tib3gucmVtb3ZlQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcbiAgICB0aGlzLl9oYW5kbGVDaGVja2JveFRyaWdnZXIoJ2ZhbHNlJywgZmlsdGVyKTtcbiAgfVxufTtcblxuLyoqXG4gKiBfaGFuZGxlQ2xlYXJGaWx0ZXJzXG4gKiBXaWxsIGhhbmRsZSB3aGVuIHRoZSB1c2VyIHdhbnRzIHRvIGNsZWFyIHRoZSBjaGVja2JveGVzLlxuICogQnkgbG9vcGluZyB0aHJvdWdoIGVhY2ggY2hlY2tib3ggYW5kIHRyaWdnZXJpbmcgYSBjbGljayBldmVudFxuICogaWYgdGhlIGNoZWNrYm94IGlzIGVuYWJsZWQuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGV2dFxuICogQHByaXZhdGVcbiAqL1xuUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLnByb3RvdHlwZS5faGFuZGxlQ2xlYXJGaWx0ZXJzID0gZnVuY3Rpb24oZXZ0KSB7XG4gIHZhciBmaWx0ZXIgPSB0aGlzLl8kZWxlbWVudC5maW5kKFxuICAgICcuJyArIFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuRklMVEVSKTtcbiAgdmFyIGkgPSAwO1xuXG4gIGlmIChldnQudHlwZSA9PT0gJ2NsaWNrJyB8fFxuICAgICAgZXZ0LmtleUNvZGUgPT09IFBvaW50c1RyYW5zZmVyRmlsdGVycy5LZXlzLlNQQUNFIHx8XG4gICAgICBldnQua2V5Q29kZSA9PT0gUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLktleXMuRU5URVIpIHtcblxuICAgIHRoaXMuX3RvZ2dsZUFsbEZpbHRlcnMoZmFsc2UpO1xuICB9XG59O1xuXG4vKipcbiAqIF90b2dnbGVBbGxGaWx0ZXJzXG4gKiBXaWxsIGNsZWFyIHRoZSBmaWx0ZXJzLlxuICpcbiAqIEBwYXJhbSB7Qm9vbGVhbn0gYXBwbHlcbiAqIEBwcml2YXRlXG4gKi9cblBvaW50c1RyYW5zZmVyRmlsdGVycy5wcm90b3R5cGUuX3RvZ2dsZUFsbEZpbHRlcnMgPSBmdW5jdGlvbihhcHBseSkge1xuICB2YXIgZmlsdGVyID0gdGhpcy5fJGVsZW1lbnQuZmluZChcbiAgICAnLicgKyBQb2ludHNUcmFuc2ZlckZpbHRlcnMuQ2xhc3NOYW1lLkZJTFRFUik7XG4gIHZhciBpID0gMTtcbiAgdmFyIGFwcGx5RmlsdGVycyA9IChhcHBseSkgPyAndHJ1ZScgOiAnZmFsc2UnO1xuXG4gIGZvcig7IGkgPCBmaWx0ZXIubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgY3VyckZpbHRlciA9IGZpbHRlci5lcShpKTtcbiAgICB2YXIgY2hlY2tib3ggPSBmaWx0ZXIuZmluZChcbiAgICAgICcuJyArIFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuQ0hFQ0tCT1gpO1xuICAgIGNoZWNrYm94LnRvZ2dsZUNsYXNzKCdpcy1jaGVja2VkJywgYXBwbHkpO1xuXG4gICAgY3VyckZpbHRlci5hdHRyKCdhcmlhLWNoZWNrZWQnLCBhcHBseUZpbHRlcnMpO1xuICAgIGN1cnJGaWx0ZXIudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgdGhpcy5faGFuZGxlQ2hlY2tib3hUcmlnZ2VyKGFwcGx5RmlsdGVycywgY3VyckZpbHRlcik7XG4gIH1cbn07XG5cbi8qKlxuICogX2hhbmRsZUNoZWNrYm94VHJpZ2dlclxuICogV2lsbCBoYW5kbGUgZXZlbnRzIGZvciB3aGVuIHRoZSBjaGVja2JveCB2YWx1ZSBjaGFuZ2VzIGFuZCBuZWVkc1xuICogdG8gdHJpZ2dlciBhbiBldmVudC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdmFsXG4gKiBAcGFyYW0ge2pRdWVyeX0gZWxcbiAqXG4gKiBAcHJpdmF0ZVxuICovXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMucHJvdG90eXBlLl9oYW5kbGVDaGVja2JveFRyaWdnZXIgPSBmdW5jdGlvbih2YWwsIGVsKSB7XG4gIHZhciBkYXRhID0ge1xuICAgICd2YWx1ZSc6IHZhbCxcbiAgICAncmV3YXJkJzogZWwuYXR0cignZm9yJykudG9Mb3dlckNhc2UoKSxcbiAgICAnZWxlbWVudCc6IGVsXG4gIH07XG5cbiAgdGhpcy5fJG1haW5XcmFwcGVyLnRyaWdnZXIoJ0NpdGk6RmlsdGVyc1RyaWdnZXJlZCcsIGRhdGEpO1xuICB0aGlzLl9hcHBseUZpbHRlcnMoZGF0YSk7XG59O1xuXG4vKipcbiAqIF9pbml0aWFsaXplTW9iaWxlTGlzdGVuZXJzXG4gKlxuICogQHBhcmFtIHtqUXVlcnl9IGVsXG4gKiBAcHJpdmF0ZVxuICovXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMucHJvdG90eXBlLl9pbml0aWFsaXplTW9iaWxlTGlzdGVuZXJzID0gZnVuY3Rpb24oZWwpIHtcbiAgdmFyICRjbG9zZUJ0biA9IGVsLmZpbmQoXG4gICAgJy4nICsgUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLkNsYXNzTmFtZS5DTE9TRV9CVE4pO1xuICB2YXIgJGNsZWFyQnRuID0gZWwuZmluZChcbiAgICAnLicgKyBQb2ludHNUcmFuc2ZlckZpbHRlcnMuQ2xhc3NOYW1lLk1PREFMX0JVVFRPTl9DTEVBUik7XG4gIHZhciAkYWNjZXB0QnRuID0gZWwuZmluZChcbiAgICAnLicgKyBQb2ludHNUcmFuc2ZlckZpbHRlcnMuQ2xhc3NOYW1lLk1PREFMX0JVVFRPTl9BQ0NFUFQpO1xuXG4gICRjbG9zZUJ0bi5vbihcbiAgICAnY2xpY2snLFxuICAgIHRoaXMuX2Nsb3NlTW9kYWwuYmluZCh0aGlzLCBmYWxzZSkpO1xuXG4gICRjbGVhckJ0bi5vbihcbiAgICAna2V5cHJlc3MnLFxuICAgIHRoaXMuX2hhbmRsZUNsZWFyRmlsdGVycy5iaW5kKHRoaXMpKTtcblxuICAkYWNjZXB0QnRuLm9uKFxuICAgICdrZXlwcmVzcycsXG4gICAgdGhpcy5faGFuZGxlQWNjZXB0RmlsdGVycy5iaW5kKHRoaXMpKTtcblxuICAkY2xlYXJCdG4ub24oXG4gICAgJ2NsaWNrJyxcbiAgICB0aGlzLl9oYW5kbGVDbGVhckZpbHRlcnMuYmluZCh0aGlzKSk7XG5cbiAgJGFjY2VwdEJ0bi5vbihcbiAgICAnY2xpY2snLFxuICAgIHRoaXMuX2hhbmRsZUFjY2VwdEZpbHRlcnMuYmluZCh0aGlzKSk7XG59O1xuXG4vKipcbiAqIF9pbml0aWFsemllTW9iaWxlTGF5b3V0XG4gKiBXaWxsIGJ1aWxkIHRoZSBtb2JpbGUgbGF5b3V0IGFuZCBpbml0aWFsaXplIHRoZSBtb2JpbGUgYmluZGluZ3MuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLnByb3RvdHlwZS5faW5pdGlhbHppZU1vYmlsZUxheW91dCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLl8kbW9kYWxFbGVtZW50ID0gdGhpcy5fYnVpbGRNb2RhbEVsZW1lbnRzKCk7XG5cbiAgdGhpcy5fcmVtb3ZlRmlsdGVyQmluZGluZ3MoKTtcblxuICAvLyBlbXB0eSB0aGUgY3VycmVudCBET00gZnJvbSB0aGUgbW9kYWxcbiAgdGhpcy5fJGVsZW1lbnQuZW1wdHkoKTtcbiAgdGhpcy5fJGVsZW1lbnQuYWRkQ2xhc3MoJ3Nob3cnKTtcblxuICB0aGlzLl8kZWxlbWVudC5hcHBlbmQodGhpcy5fJG1vZGFsRWxlbWVudCk7XG5cbiAgdGhpcy5faW5pdGlhbGl6ZU1vYmlsZUxpc3RlbmVycyh0aGlzLl8kZWxlbWVudCk7XG4gIHRoaXMuX2luaXRpYWxpemVGaWx0ZXJCaW5kaW5ncygpO1xufTtcblxuLyoqXG4gKiBfYnVpbGRNb2RhbEVsZW1lbnRzXG4gKiBXaWxsIGJ1aWxkIERPTSBhbmQgcG9wdWxhdGUgdGhlIERPTSBiYXNlZCBmb3IgdGhlIG1vZGFsLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcmV0dXJuIHtqUXVlcnl8RWxlbWVudH1cbiAqL1xuUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLnByb3RvdHlwZS5fYnVpbGRNb2RhbEVsZW1lbnRzID0gZnVuY3Rpb24oKSB7XG4gIHZhciAkbW9kYWxXcmFwID0gJCgnPGRpdj4nKTtcbiAgdmFyICR0aXRsZUVsZW1lbnRPZmZzY3JlZW4gPSAkKCc8ZGl2PicpO1xuICB2YXIgJHRpdGxlRWxlbWVudCA9ICQoJzxoMj4nKTtcbiAgdmFyIG1vZGFsQ29udGVudCA9IHRoaXMuX2ZpbHRlcklubmVyQ29udGVudDtcbiAgdmFyICRtb2RhbENvbnRlbnQgPSAkKG1vZGFsQ29udGVudCkuY2xvbmUoKTtcbiAgdmFyIGNvbnRlbnQgPSB0aGlzLl8kZWxlbWVudC5kYXRhKCdjb250ZW50Jyk7XG4gIHZhciAkY2xvc2VCdXR0b24gPSAkKCc8YnV0dG9uPicpO1xuICB2YXIgJGNsb3NlaWNvbiA9ICQoJzxpPicpO1xuICB2YXIgJGZpbHRlckxpc3QgPSAkbW9kYWxDb250ZW50LmZpbmQoJy4nICsgUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLkNsYXNzTmFtZS5GSUxURVJfTElTVCk7XG5cbiAgLy8gYnVpbGQgbW9kYWwgd3JhcCBhdHRyaWJ1dGVzXG4gICRtb2RhbFdyYXAuYXR0cignYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcbiAgJG1vZGFsV3JhcC5hdHRyKCdpZCcsIFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuTU9EQUxfSUQpO1xuICAkbW9kYWxXcmFwLmF0dHIoJ2FyaWEtbGFiZWxsZWRieScsIFBvaW50c1RyYW5zZmVyRmlsdGVycy5BUklBLk1PREFMX0xBQkVMKTtcbiAgJG1vZGFsV3JhcC5hdHRyKCdhcmlhLWRlc2NyaWJlZGJ5JywgUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLkFSSUEuTU9EQUxfREVTQ1JJQkUpO1xuICAkbW9kYWxXcmFwLmF0dHIoJ3JvbGUnLCAnZGlhbG9nJyk7XG4gICRtb2RhbFdyYXAuYWRkQ2xhc3MoUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLkNsYXNzTmFtZS5NT0RBTF9DTEFTUyk7XG5cbiAgLy8gYnVpbGQgdGl0bGUgb2Zmc2NyZWVuIGVsZW1lbnQgYXR0cmlidXRlc1xuICAkdGl0bGVFbGVtZW50T2Zmc2NyZWVuLmF0dHIoJ2lkJywgUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLkFSSUEuTU9EQUxfREVTQ1JJQkUpO1xuICAkdGl0bGVFbGVtZW50T2Zmc2NyZWVuLmFkZENsYXNzKFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuT0ZGU0NSRUVOKTtcbiAgJHRpdGxlRWxlbWVudE9mZnNjcmVlbi50ZXh0KGNvbnRlbnQudGl0bGUpO1xuXG4gIC8vIGJ1aWxkIHRpdGxlIGVsZW1lbnQgYXR0cmlidXRlc1xuICAkdGl0bGVFbGVtZW50LmFkZENsYXNzKFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuTU9EQUxfSEVBREVSKTtcbiAgJHRpdGxlRWxlbWVudC50ZXh0KGNvbnRlbnQudGl0bGUpO1xuXG4gIC8vIENsb3NlIFVJXG4gICRjbG9zZUJ1dHRvbi5hZGRDbGFzcygnbW9kYWwtY2xvc2UtYnV0dG9uJyk7XG4gICRjbG9zZUJ1dHRvbi5hdHRyKCdhcmlhLWxhYmVsJywgJ0Nsb3NlIE1vZGFsIFdpbmRvdycpO1xuICAkY2xvc2VpY29uLmFkZENsYXNzKCdpY29uIGljb25feCcpO1xuXG4gIHZhciAkb3B0aW9uT3V0ZXJXcmFwID0gdGhpcy5fYnVpbGRNb2RhbEJ1dHRvbnMoY29udGVudCk7XG5cbiAgLy8gYXBwZW5kIHRoZSBjbG9zZSBidXR0b25cbiAgJGNsb3NlQnV0dG9uLmFwcGVuZCgkY2xvc2VpY29uKTtcblxuICAvLyBhcHBlbmQgdGhlIGVsZW1lbnQgdG9nZXRoZXJcbiAgJG1vZGFsV3JhcC5hcHBlbmQoJGNsb3NlQnV0dG9uKTtcbiAgJG1vZGFsV3JhcC5hcHBlbmQoJHRpdGxlRWxlbWVudCk7XG4gICRtb2RhbFdyYXAuYXBwZW5kKCRtb2RhbENvbnRlbnQpO1xuICAkbW9kYWxXcmFwLmFwcGVuZCgkb3B0aW9uT3V0ZXJXcmFwKTtcblxuICByZXR1cm4gJG1vZGFsV3JhcDtcbn07XG5cblxuLyoqXG4gKiBfYnVpbGRNb2RhbEJ1dHRvbnNcbiAqIFdpbGwgYnVpbGQgdGhlIG1vZGFsIHUvZmlsdGkgZm9yIHRoZSBmaWx0ZXIgbW9kYWwuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGNvbnRlbnRcbiAqIEByZXR1cm4ge2pRdWVyeX0gRWxlbWVudHNcbiAqXG4gKiBAcHJpdmF0ZVxuICovXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMucHJvdG90eXBlLl9idWlsZE1vZGFsQnV0dG9ucyA9IGZ1bmN0aW9uKGNvbnRlbnQpIHtcbiAgdmFyICR1aTtcblxuICAvLyBVSSBmb3IgYWNjZXB0IC8gY2xlYXJcbiAgdmFyICRvcHRpb25PdXRlcldyYXAgPSAkKCc8ZGl2PicpO1xuXG4gIHZhciAkbGVmdEJ1dHRvbldyYXAgPSAkKCc8ZGl2PicpO1xuICB2YXIgJHJpZ2h0QnV0dG9uV3JhcCA9ICQoJzxkaXY+Jyk7XG5cbiAgdmFyICRhY2NlcHRNb2RhbEJ1dHRvbiA9ICQoJzxidXR0b24+Jyk7XG4gIHZhciAkY2xlYXJNb2RhbEJ1dHRvbiA9ICQoJzxidXR0b24+Jyk7XG5cbiAgJGxlZnRCdXR0b25XcmFwLmFkZENsYXNzKFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuTU9EQUxfQlVUVE9OX1dSQVApO1xuICAkb3B0aW9uT3V0ZXJXcmFwLmFkZENsYXNzKFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuTU9EQUxfT1BUSU9OU19XUkFQKTtcblxuICAkYWNjZXB0TW9kYWxCdXR0b24udGV4dChjb250ZW50LmFjY2VwdCk7XG4gICRjbGVhck1vZGFsQnV0dG9uLnRleHQoY29udGVudC5jbGVhcik7XG5cbiAgJGFjY2VwdE1vZGFsQnV0dG9uLmF0dHIoJ3RhYmluZGV4JywgMCk7XG4gICRjbGVhck1vZGFsQnV0dG9uLmF0dHIoJ3RhYmluZGV4JywgMCk7XG5cbiAgJGFjY2VwdE1vZGFsQnV0dG9uLmFkZENsYXNzKCdidG4nICsgJyAnICsgUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLkNsYXNzTmFtZS5NT0RBTF9CVVRUT05fQUNDRVBUKTtcbiAgJGNsZWFyTW9kYWxCdXR0b24uYWRkQ2xhc3MoJ2J0bicgKyAnICcgKyBQb2ludHNUcmFuc2ZlckZpbHRlcnMuQ2xhc3NOYW1lLk1PREFMX0JVVFRPTl9DTEVBUik7XG5cbiAgJGxlZnRCdXR0b25XcmFwLmFwcGVuZCgkY2xlYXJNb2RhbEJ1dHRvbik7XG4gICRyaWdodEJ1dHRvbldyYXAuYXBwZW5kKCRhY2NlcHRNb2RhbEJ1dHRvbik7XG5cbiAgJG9wdGlvbk91dGVyV3JhcC5hcHBlbmQoJHJpZ2h0QnV0dG9uV3JhcCk7XG5cbiAgJHVpID0gJG9wdGlvbk91dGVyV3JhcDtcblxuICByZXR1cm4gJHVpO1xufTtcblxuLyoqXG4gKiBfaGFuZGxlQWNjZXB0RmlsdGVyc1xuICogV2lsbCBoYW5kbGUgdGhlIHVzZXIgc2VsZWN0aW5nIHRoZSBhY2NlcHQgYnV0dG9uLlxuICogVGhpcyBlc3NlbnRpYWxseSBzaW1wbHkganVzdCBjbG9zZXMgdGhlIG1vZGFsLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBldnRcbiAqIEBwcml2YXRlXG4gKi9cblBvaW50c1RyYW5zZmVyRmlsdGVycy5wcm90b3R5cGUuX2hhbmRsZUFjY2VwdEZpbHRlcnMgPSBmdW5jdGlvbihldnQpIHtcbiAgaWYgKGV2dC5rZXlDb2RlID09PSBQb2ludHNUcmFuc2ZlckZpbHRlcnMuS2V5cy5TUEFDRSB8fFxuICAgICAgZXZ0LmtleUNvZGUgPT09IFBvaW50c1RyYW5zZmVyRmlsdGVycy5LZXlzLkVOVEVSKSB7XG4gICAgdGhpcy5fY2xvc2VNb2RhbCh0cnVlKTtcbiAgICByZXR1cm47XG4gIH1cblxuICB0aGlzLl9jbG9zZU1vZGFsKHRydWUpO1xufTtcblxuLyoqXG4gKiBfZ2V0UmV3YXJkc1xuICogV2lsbCBzaWxvIHRoZSByZXdhcmQgZWxlbWVudHMgaW50byB0aGVpciBzcGVjaWZpYyB0ZWlycyBzbyB0aGV5IGNhbiBiZVxuICogcXVpY2tseSBzaG93biBhbmQgaGlkZGVuIGJhc2VkIG9uIGZpbHRlcnMuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLnByb3RvdHlwZS5fZ2V0UmV3YXJkcyA9IGZ1bmN0aW9uKCkge1xuICB2YXIgb2JqID0ge307XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl8kcmV3YXJkRWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgY3VyclJld2FyZCA9IHRoaXMuXyRyZXdhcmRFbGVtZW50cy5lcShpKTtcbiAgICB2YXIgY3VyclJld2FyZFR5cGUgPSBjdXJyUmV3YXJkLmRhdGEoJ3Jld2FyZC10eXBlJykudG9Mb3dlckNhc2UoKTtcblxuICAgIGlmIChvYmpbY3VyclJld2FyZFR5cGVdKSB7XG4gICAgICBvYmpbY3VyclJld2FyZFR5cGVdLnB1c2goY3VyclJld2FyZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9ialtjdXJyUmV3YXJkVHlwZV0gPSBbXTtcbiAgICAgIG9ialtjdXJyUmV3YXJkVHlwZV0ucHVzaChjdXJyUmV3YXJkKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gb2JqO1xufTtcblxuLyoqXG4gKiBfYXBwbHlGaWx0ZXJzXG4gKiBXaWxsIGFwcGx5IGZpbHRlcnMgYW5kIGhpZGUgb3Igc2hvdyBmaWx0ZXJzIGJhc2VkIG9uIHdoaWNoIGFyZSBhcHBsaWVkXG4gKiBhbmQgbm90LlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gKiBAcHJpdmF0ZVxuICovXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMucHJvdG90eXBlLl9hcHBseUZpbHRlcnMgPSBmdW5jdGlvbihkYXRhKSB7XG4gIHZhciBoaWRkZW5SZXdhcmRzID0gW107XG4gIHZhciBhY3RpdmVSZXdhcmRzID0gW107XG5cbiAgLy8gYXJlIHdlIGFkZGluZyBvciByZW1vdmluZyB0aGUgZmlsdGVyP1xuICB0aGlzLl9hY3RpdmVGaWx0ZXJzID0gKGRhdGEudmFsdWUgPT09ICd0cnVlJykgP1xuICAgIHRoaXMuX2FkZEZpbHRlcnMoZGF0YSkgOlxuICAgIHRoaXMuX3JlbW92ZUZpbHRlcnMoZGF0YSk7XG5cbiAgLy8gaWYgdGhlcmUgYXJlbid0IGFueSBmaWx0ZXJzIGRvbid0IGRvIGFueSBsb2dpYy5cbiAgaWYgKHRoaXMuX2FjdGl2ZUZpbHRlcnMubGVuZ3RoKSB7XG4gICAgdGhpcy5fc2hvd1Jld2FyZHMoKTtcbiAgICB0aGlzLl91blNlbGVjdENoZWNrYm94KCdBbGwnKTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLl9zaG93QWxsUmV3YXJkcygpO1xuICAgICQoJy4nICsgUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLkNsYXNzTmFtZS5GSUxURVIgKyAnW2Zvcj1cIkFsbFwiXScpLmF0dHIoJ2FyaWEtY2hlY2tlZCcsICd0cnVlJyk7XG4gICAgJCgnLicgKyBQb2ludHNUcmFuc2ZlckZpbHRlcnMuQ2xhc3NOYW1lLkZJTFRFUiArICdbZm9yPVwiQWxsXCJdIC4nICsgUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLkNsYXNzTmFtZS5DSEVDS0JPWCkuYWRkQ2xhc3MoJ2lzLWNoZWNrZWQnKTtcbiAgfVxuXG59O1xuXG4vKipcbiAqIF9hZGRGaWx0ZXJzXG4gKiBXaWxsIGFkZCB0aGUgZmlsdGVycyBmcm9tIHRoZSBtYWluIGFjdGl2ZSBmaWx0ZXJzXG4gKiBpbnN0YW5jZSB2YXJpYWJsZS5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICogQHJldHVybiB7QXJyYXl9XG4gKi9cblBvaW50c1RyYW5zZmVyRmlsdGVycy5wcm90b3R5cGUuX2FkZEZpbHRlcnMgPSBmdW5jdGlvbihkYXRhKSB7XG4gIHZhciBhcnIgPSB0aGlzLl9hY3RpdmVGaWx0ZXJzLnNsaWNlKDApO1xuICB2YXIgaW5kZXggPSBhcnIuaW5kZXhPZihkYXRhLnJld2FyZCk7XG5cbiAgaWYgKGluZGV4IDwgMCkge1xuICAgIGFyci5wdXNoKGRhdGEucmV3YXJkKTtcbiAgfVxuXG4gIHJldHVybiBhcnI7XG59O1xuXG4vKipcbiAqIF9yZW1vdmVGaWx0ZXJzXG4gKiBXaWxsIHJlbW92ZSB0aGUgZmlsdGVycyBmcm9tIHRoZSBtYWluIGFjdGl2ZSBmaWx0ZXJzXG4gKiBpbnN0YW5jZSB2YXJpYWJsZS5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICogQHJldHVybiB7QXJyYXl9XG4gKi9cblBvaW50c1RyYW5zZmVyRmlsdGVycy5wcm90b3R5cGUuX3JlbW92ZUZpbHRlcnMgPSBmdW5jdGlvbihkYXRhKSB7XG4gIHZhciBhcnIgPSB0aGlzLl9hY3RpdmVGaWx0ZXJzLnNsaWNlKDApO1xuICB2YXIgaW5kZXggPSBhcnIuaW5kZXhPZihkYXRhLnJld2FyZCk7XG5cbiAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICBhcnIuc3BsaWNlKGluZGV4LCAxKTtcbiAgfVxuXG4gIHJldHVybiBhcnI7XG59O1xuXG4vKipcbiAqIF9zaG93QWxsUmV3YXJkc1xuICogV2lsbCBkaXNwbGF5IGFsbCByZXdhcmRzIGJ5IHJlbW92aW5nIGFsbCBjbGFzc2VzIGFuIGFkZGluZ1xuICogYWN0aXZlIGNsYXNzZXMgdG8gdGhlbS5cbiAqL1xuUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLnByb3RvdHlwZS5fc2hvd0FsbFJld2FyZHMgPSBmdW5jdGlvbigpIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl8kcmV3YXJkRWxlbWVudHMubGVuZ3RoOyBpKysgKSB7XG4gICAgdmFyIGN1cnJSZXdhcmRFbGVtZW50ID0gdGhpcy5fJHJld2FyZEVsZW1lbnRzLmVxKGkpO1xuXG4gICAgdGhpcy5fc2hvd1Jld2FyZChjdXJyUmV3YXJkRWxlbWVudCk7XG4gIH1cbn07XG5cbi8qKlxuICogX3Nob3dSZXdhcmRzXG4gKiBXaWxsIHNob3cgZmlsdGVyIGVsZW1lbnRzIGZyb20gdGhlIHVzZXIncyBzZWxlY3RlZCBvcHRpb25zLlxuICpcbiAqIEBwcml2YXRlXG4gKi9cblBvaW50c1RyYW5zZmVyRmlsdGVycy5wcm90b3R5cGUuX3Nob3dSZXdhcmRzID0gZnVuY3Rpb24oKSB7XG4gIC8vIGxvb3AgdGhyb3VnaCB0aGUgYWN0aXZlIGZpbHRlcnNcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9hY3RpdmVGaWx0ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGFjdGl2ZUZpbHRlciA9IHRoaXMuX2FjdGl2ZUZpbHRlcnNbaV07XG4gICAgdmFyIGZpbHRlckVsZW1lbnRzID0gdGhpcy5fcmV3YXJkc1thY3RpdmVGaWx0ZXJdO1xuXG4gICAgaWYgKGZpbHRlckVsZW1lbnRzKSB7XG4gICAgICAvLyBsb29wIHRocm91Z2ggZWFjaCBpdGVtIGluIHRoZSBzaWxvJ2QgZmlsdGVycyBvYmpcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZmlsdGVyRWxlbWVudHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgdmFyIGN1cnJGaWx0ZXJFbGVtZW50ID0gZmlsdGVyRWxlbWVudHNbal07XG4gICAgICAgIHRoaXMuX3Nob3dSZXdhcmQoY3VyckZpbHRlckVsZW1lbnQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHRoaXMuX2hpZGVJbmFjdGl2ZUZpbHRlcnMoKTtcbn07XG5cbi8qKlxuICogX2hpZGVJbmFjdGl2ZUZpbHRlcnNcbiAqIFdpbGwgbG9vcCBhbmQgZ2F0aGVyIGFsbCB0aGUgY3VycmVudCBmaWx0ZXJzIHRoZW4gcnVuIGEgbG9vcFxuICogYWdhaW5zdCBhY3RpdmUgZmlsdGVycyBhbmQgaGlkZSBhbGwgZWxlbWVudHMgdGhhdCByZW1haW5cbiAqIGluIHRoZSBmaWx0ZXJzIGxpc3QuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLnByb3RvdHlwZS5faGlkZUluYWN0aXZlRmlsdGVycyA9IGZ1bmN0aW9uKCkge1xuICBpZiAoIXRoaXMuX2FjdGl2ZUZpbHRlcnMubGVuZ3RoKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGluYWN0aXZlRmlsdGVycyA9IFtdO1xuICB2YXIgZmlsdGVycyA9IHRoaXMuX2FjdGl2ZUZpbHRlcnM7XG4gIHZhciBhbGxpbmRleCA9IGZpbHRlcnMuaW5kZXhPZignYWxsJyk7XG5cbiAgLy8gcG9wdWxhdGUgdGhlIGZpbHRlcnMgYXJyYXkgd2l0aCBhbGwgcG9zc2libGUgZmlsdGVycy5cbiAgZm9yKHZhciBrZXlzIGluIHRoaXMuX3Jld2FyZHMpIHtcbiAgICBpZiAoa2V5cykge1xuICAgICAgaW5hY3RpdmVGaWx0ZXJzLnB1c2goa2V5cyk7XG4gICAgfVxuICB9XG5cbiAgLy8gd2UgbmVlZCB0byBhbHNvIHNwbGljZSBvdXQgJ2FsbCcgaWYgaXQncyBhIHBvc3NpYmlsaXR5XG4gIC8vIHNpbmNlIGl0cyBtZXNzaW5nIHdpdGggdGhlIGFycmF5IGxlbmd0aC5cbiAgaWYgKGFsbGluZGV4ID49IDAgJiYgZmlsdGVycy5sZW5ndGggPiAxKSB7XG4gICAgZmlsdGVycy5zcGxpY2UoYWxsaW5kZXgsIDEpO1xuICB9XG5cbiAgLy8gc3BsaWNlIG91dCB0aGUgYWN0aXZlIGZpbHRlcnMuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fYWN0aXZlRmlsdGVycy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBmaWx0ZXIgPSB0aGlzLl9hY3RpdmVGaWx0ZXJzW2ldO1xuICAgIHZhciBpbmRleCA9IGluYWN0aXZlRmlsdGVycy5pbmRleE9mKGZpbHRlcik7XG5cbiAgICBpbmFjdGl2ZUZpbHRlcnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgfVxuXG4gIGZvciAodmFyIGogPSAwOyBqIDwgaW5hY3RpdmVGaWx0ZXJzLmxlbmd0aDsgaisrKSB7XG4gICAgdmFyIGFjdGl2ZUZpbHRlciA9IGluYWN0aXZlRmlsdGVyc1tqXTtcbiAgICB2YXIgZmlsdGVyRWxlbWVudHMgPSB0aGlzLl9yZXdhcmRzW2FjdGl2ZUZpbHRlcl07XG5cbiAgICAvLyBpZiB0aGVyZSBpc250IGFuIGFjdGl2ZSBmaWx0ZXIgZG9uJ3QgYnJlYWsgdGhlIGFwcGxpY2F0aW9uLlxuICAgIGlmICghYWN0aXZlRmlsdGVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIGxvb3AgdGhyb3VnaCBlYWNoIGl0ZW0gaW4gdGhlIHNpbG8nZCBmaWx0ZXJzIG9ialxuICAgIGZvciAodmFyIGsgPSAwOyBrIDwgZmlsdGVyRWxlbWVudHMubGVuZ3RoOyBrKyspIHtcbiAgICAgIHZhciBjdXJyRmlsdGVyRWxlbWVudCA9IGZpbHRlckVsZW1lbnRzW2tdO1xuICAgICAgdGhpcy5faGlkZVJld2FyZChjdXJyRmlsdGVyRWxlbWVudCk7XG4gICAgfVxuICB9XG59O1xuXG4vKipcbiAqIF9zaG93UmV3YXJkXG4gKiBXaWxsIGRpc3BsYXkgcmV3YXJkIGVsZW1lbnQgYW5kIGFwcGx5IHByb3BlciBBUklBIGF0dHJpYnV0ZXMuXG4gKlxuICogQHBhcmFtIHtqUXVlcnl9IGVsXG4gKiBAcHJpdmF0ZVxuICovXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMucHJvdG90eXBlLl9zaG93UmV3YXJkID0gZnVuY3Rpb24oZWwpIHtcbiAgZWwucmVtb3ZlQ2xhc3MoXG4gICAgUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLkNsYXNzTmFtZS5ISURERU4pO1xuICBlbC5hZGRDbGFzcyhcbiAgICBQb2ludHNUcmFuc2ZlckZpbHRlcnMuQ2xhc3NOYW1lLkFDVElWRSk7XG5cbiAgZWwucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4nKTtcbn07XG5cbi8qKlxuICogX2hpZGVSZXdhcmRcbiAqIFdpbGwgaGlkZSByZXdhcmQgZWxlbWVudCBhbmQgYXBwbHkgcHJvcGVyIEFSSUEgYXR0cmlidXRlcy5cbiAqXG4gKiBAcGFyYW0ge2pRdWVyeX0gZWxcbiAqIEBwcml2YXRlXG4gKi9cblBvaW50c1RyYW5zZmVyRmlsdGVycy5wcm90b3R5cGUuX2hpZGVSZXdhcmQgPSBmdW5jdGlvbihlbCkge1xuICBlbC5yZW1vdmVDbGFzcyhcbiAgICBQb2ludHNUcmFuc2ZlckZpbHRlcnMuQ2xhc3NOYW1lLkFDVElWRSk7XG4gIGVsLmFkZENsYXNzKFxuICAgIFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuSElEREVOKTtcblxuICBlbC5hdHRyKCdhcmlhLWhpZGRlbicsIHRydWUpO1xufTtcblxuLyoqXG4gKiBfY2xvc2VNb2RhbFxuICogV2lsbCBjbG9zZSB0aGUgbW9kYWwgaWYgaXQncyBvcGVuLlxuICpcbiAqIEBwYXJhbSB7Qm9vbGVhbn0gdHJpZ2dlckNsaWNrXG4gKi9cblBvaW50c1RyYW5zZmVyRmlsdGVycy5wcm90b3R5cGUuX2Nsb3NlTW9kYWwgPSBmdW5jdGlvbih0cmlnZ2VyQ2xpY2spIHtcbiAgXG4gICQoJ3NlY3Rpb24sIGhlYWRlciwgZm9vdGVyLCAjaGVhZGVyLWRlc2t0b3AnKS5yZW1vdmVBdHRyKCdhcmlhLWhpZGRlbicpO1xuICAkKCcucG9pbnRzLXRyYW5zZmVyLWxhbmRpbmctYm9keS1maWx0ZXJzLW1vYmlsZS13cmFwJykuYXR0cignYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcbiAgJCgnI21vZGFsLW92ZXJsYXknKS5yZW1vdmVDbGFzcygnb3BlbmVkJyk7ICBcblxuICBpZiAodGhpcy5fbW9kYWxPcGVuKSB7XG4gICAgdGhpcy5faHRtbC5yZW1vdmVDbGFzcyhQb2ludHNUcmFuc2ZlckZpbHRlcnMuQ2xhc3NOYW1lLk5PX1NDUk9MTCk7XG4gICAgdGhpcy5fJGVsZW1lbnQuZmluZCgnI21vZGFsLXBvaW50cy10cmFuc2ZlcicpLmF0dHIoJ3N0eWxlJywgJ2Rpc3BsYXk6bm9uZTsnKTtcbiAgICB0aGlzLl9tb2RhbE9wZW4gPSBmYWxzZTtcbiAgfVxuXG4gIGlmICh0cmlnZ2VyQ2xpY2spIHtcbiAgICB2YXIgJGNsb3NlQnRuID0gdGhpcy5fJGVsZW1lbnQuZmluZCgnLicgKyBQb2ludHNUcmFuc2ZlckZpbHRlcnMuQ2xhc3NOYW1lLkNMT1NFX0JUTik7XG4gICAgJGNsb3NlQnRuLnRyaWdnZXIoJ2NsaWNrJyk7XG4gIH1cblxuICAkKCcubW9kYWwtcG9pbnRzLXRyYW5zZmVyLWxhdW5jaCcpLmZvY3VzKCk7XG5cbn07XG5cbi8qKlxuICogX2Rlc3Ryb3lNb2JpbGVMYXlvdXRcbiAqIFdpbGwgZGVzdHJveSB0aGVcbiAqXG4gKiBAcHJpdmF0ZVxuICovXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMucHJvdG90eXBlLl9kZXN0cm95TW9iaWxlTGF5b3V0ID0gZnVuY3Rpb24oKSB7XG4gIGlmICh0aGlzLl9tb2RhbE9wZW4pIHtcbiAgICB0aGlzLl9jbG9zZU1vZGFsKHRydWUpO1xuICAgIHRoaXMuX21vZGFsRGVzdHJveWVkQnlWaWV3cG9ydFN3aXRjaCA9IHRydWU7XG4gIH1cblxuICB0aGlzLl8kZWxlbWVudC5lbXB0eSgpO1xuICB0aGlzLl8kZWxlbWVudC5yZW1vdmVDbGFzcygnc2hvdycpO1xuICB0aGlzLl8kZWxlbWVudC5hcHBlbmQodGhpcy5fZmlsdGVySW5uZXJDb250ZW50KTtcbiAgdGhpcy5faW5pdGlhbGl6ZUZpbHRlckJpbmRpbmdzKCk7XG59O1xuXG5cblxuXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMuQ2xhc3NOYW1lID0ge1xuICBCQVNFOiAncG9pbnRzLXRyYW5zZmVyLWxhbmRpbmctYm9keS1maWx0ZXJzLXdyYXAnLFxuICBNQUlOOiAnb2MtY29udGFpbmVyJyxcbiAgTk9fU0NST0xMOiAnbm8tc2Nyb2xsJyxcbiAgRklMVEVSOiAncG9pbnRzLXRyYW5zZmVyLWNoZWNrYm94LXdyYXAnLFxuICBGSUxURVJfTElTVDogJ3BvaW50cy10cmFuc2Zlci1sYW5kaW5nLWZpbHRlcnMtbGlzdCcsXG4gIEZJTFRFUl9MSVNUX0lURU06ICdwb2ludHMtdHJhbnNmZXItbGFuZGluZy1pdGVtJyxcbiAgQ0hFQ0tCT1g6ICdwb2ludHMtdHJhbnNmZXItY2hlY2tib3gnLFxuICBNT0RBTF9DTEFTUzogJ21vZGFsIG1vZGFsLW92ZXJsYXkgbW9kYWwtcG9pbnRzLXRyYW5zZmVyJyxcbiAgTU9EQUxfSUQ6ICdtb2RhbC1wb2ludHMtdHJhbnNmZXInLFxuICBNT0RBTF9IRUFERVI6ICdtb2RhbC1oZWFkZXItdGl0bGUnLFxuICBNT0JJTEVfVElUTEU6ICdwb2ludHMtdHJhbnNmZXItbGFuZGluZy1tb2JpbGUtY29udGVudCcsXG4gIE1PREFMX0xBVU5DSDogJ21vZGFsLXBvaW50cy10cmFuc2Zlci1sYXVuY2gnLFxuICBNT0RBTF9PUFRJT05TX1dSQVA6ICdmaWx0ZXItYnRuLXdyYXAgbGV2ZWwtb25lLWJ1dHRvbnMgZ3JpZC1jb250YWluZXInLFxuICBNT0RBTF9CVVRUT05fV1JBUDogJ2J0bi13cmFwcGVyIGdyaWQtMTAwIG1vYmlsZS1ncmlkLTEwMCcsXG4gIE1PREFMX0JVVFRPTl9BQ0NFUFQ6ICdwb2ludHMtdHJhbnNmZXItbGFuZGluZy1hY2NlcHQnLFxuICBNT0RBTF9CVVRUT05fQ0xFQVI6ICdwb2ludHMtdHJhbnNmZXItbGFuZGluZy1jbGVhcicsXG4gIFJFV0FSRFM6ICdwb2ludHMtdHJhbnNmZXItbGFuZGluZy1ib2R5LXBvaW50cy1yZXdhcmQnLFxuICBDTE9TRV9CVE46ICdtb2RhbC1jbG9zZS1idXR0b24nLFxuICBPRkZTQ1JFRU46ICdzY3JlZW4tcmVhZGVyLW9mZnNjcmVlbicsXG4gIEFDVElWRTogJ2lzLWFjdGl2ZScsXG4gIEhJRERFTjonaXMtaGlkZGVuJyxcbn07XG5cblBvaW50c1RyYW5zZmVyRmlsdGVycy5BUklBID0ge1xuICBNT0RBTF9MQUJFTDogJ21vZGFsLXBvaW50cy10cmFuc2Zlci10aXRsZScsXG4gIE1PREFMX0RFU0NSSUJFOidtb2RhbC1wb2ludHMtdHJhbnNmZXItZGVzY3JpcHRpb24nLFxufTtcblxuUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLkV2ZW50cyA9IHtcbiAgUkVOREVSRUQ6ICdmaWx0ZXJUYWJzOjpyZW5kZXJlZCcsXG59O1xuXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMuS2V5cyA9IHtcbiAgRU5URVI6IDEzLFxuICBTUEFDRTogMzIsXG4gIExFRlQ6IDM3LFxuICBSSUdIVDogMzksXG59O1xuXG5mdW5jdGlvbiBfY3JlYXRlUG9pbnRzVHJhbnNmZXJGaWx0ZXJzKCkge1xuICBfdG9BcnJheSgkKCcuJyArIFBvaW50c1RyYW5zZmVyRmlsdGVycy5DbGFzc05hbWUuQkFTRSkpLmZvckVhY2goZnVuY3Rpb24oZWwpIHtcbiAgICByZXR1cm4gbmV3IFBvaW50c1RyYW5zZmVyRmlsdGVycyhlbCk7XG4gIH0pO1xufVxuXG5Qb2ludHNUcmFuc2ZlckZpbHRlcnMuaW5pdGlhbGl6ZUFsbCA9IGZ1bmN0aW9uKCkge1xuICBfY3JlYXRlUG9pbnRzVHJhbnNmZXJGaWx0ZXJzKCk7XG59O1xuXG5cbmNpdGlTaGFyZS5wb2ludHNUcmFuc2ZlckZpbHRlcnMgPSAoZnVuY3Rpb24oKXtcblxuICBQb2ludHNUcmFuc2ZlckZpbHRlcnMuaW5pdGlhbGl6ZUFsbCgpO1xuXG4gIHJldHVybiB7XG4gICAgaW5pdEFsbDogUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLmluaXRpYWxpemVBbGwsXG4gICAgRXZlbnRzOiBQb2ludHNUcmFuc2ZlckZpbHRlcnMuRXZlbnRzLFxuICAgIENsYXNzTmFtZTogUG9pbnRzVHJhbnNmZXJGaWx0ZXJzLkNsYXNzTmFtZVxuICB9O1xuXG59KSgpO1xuIiwiLyoqXG4gKiBKU0hpbnQ6XG4gKiBUbyBhbGxvdyBicmFja2V0IG5vdGF0aW9uLFxuICogRm9yIGV4YW1wbGUsIHRlc3RbXCJwbGFjZWhvbGRlclwiXSB2cyB0ZXN0LnBsYWNlaG9sZGVyXG4gKi9cblxuLypqc2hpbnQgc3ViOnRydWUqL1xuXG5jaXRpU2hhcmUudHJhbnNmZXIgPSAoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgYWxsb3dhYmxlS2V5czogWzQ4LDQ5LDUwLDUxLDUyLDUzLDU0LDU1LDU2LDU3LDgsOSwwXSwgLy8gbnVtYmVycyAwLTksIGRlbCwgYW5kIHRhYlxuICAgICAgICBwb2ludHNUcmFuc2ZlckluY3JlbWVudDogMTAwMCxcbiAgICAgICAgcG9pbnRzVHJhbnNmZXJNaW46IDEwMDAsXG4gICAgICAgIHRoYW5reW91UG9pbnRzVG9UcmFuc2ZlcjogMTAwMCxcbiAgICAgICAgYnJhbmRQb2ludHNUb0dhaW46IDAsXG4gICAgICAgIHRoYW5reW91UG9pbnRzOiAwLFxuICAgICAgICBwb2ludFRyYW5zZmVyUmF0ZTogMS41LFxuICAgICAgICBnckNvdW50cnlBcnJheTogWydhdXN0cmFsaWEnLCAnYmFocmFpbicsICdob25nIGtvbmcnLCAncGhpbGlwcGluZXMnLCAndGhhaWxhbmQnLCAnc2luZ2Fwb3JlJywgJ21leGljbycsICd1YWUnLCAnbWFsYXlzaWEnXSxcbiAgICAgICAgJHRlcm1zQ29uZGl0aW9uc0NoZWNrYm94RXJyb3I6ICQoJy5wb2ludHMtdHJhbnNmZXItZGV0YWlsLXRlcm1zLWFuZC1jb25kaXRpb25zLWNoZWNrYm94LWVycm9yLW1lc3NhZ2UnKSxcbiAgICAgICAgJHNob3dNb3JlOiAkKCcjcG9pbnRzLXRyYW5zZmVyLWRldGFpbC1zaG93bW9yZScpLFxuICAgICAgICAkaGVyb0NvcHk6ICQoJyNwcm9tb3Rpb24taGVyby1jb3B5JyksXG4gICAgICAgICRwb2ludHNUb1RyYW5zZmVyOiAkKCcjcG9pbnRzLXRvLXRyYW5zZmVyJyksXG4gICAgICAgICRicmFuZFBvaW50czogJCgnI2JyYW5kLXBvaW50cycpLFxuICAgICAgICAkYnJhbmRQb2ludHNNZXNzYWdlOiAkKCcjYnJhbmQtcG9pbnRzLW1lc3NhZ2UnKSxcbiAgICAgICAgJHBvaW50c1RyYW5zZmVyRGV0YWlsQ29udGFpbmVyOiAkKCcucG9pbnRzLXRyYW5zZmVyLWRldGFpbC1jb250YWluZXInKSxcbiAgICAgICAgJGZvcm06ICQoJyNwb2ludHMtdHJhbnNmZXItZm9ybScpLFxuICAgICAgICAkdGVybXNBbmRDb25kaXRpb25zQ2hlY2tib3g6ICQoJyN0ZXJtcy1hbmQtY29uZGl0aW9ucy1jaGVja2JveCcpLFxuICAgICAgICAkdHJhbnNmZXJDb250aW51ZUJ1dHRvbjogJCgnI3BvaW50cy10cmFuc2Zlci1kZXRhaWwtZm9ybS1jb250aW51ZS1idXR0b24nKSxcbiAgICAgICAgJHBvaW50c1RyYW5zZmVyTWVzc2FnZTogJCgnI3BvaW50cy10by10cmFuc2Zlci1tZXNzYWdlJyksXG4gICAgICAgICRwb2ludHNUcmFuc2ZlckVycm9yOiAkKCcjcG9pbnRzLXRvLXRyYW5zZmVyLWVycm9yJyksXG4gICAgICAgICRlcnJvck1lc3NhZ2U6ICQoJy5wb2ludHMtdHJhbnNmZXItZGV0YWlsLXBhZ2UtZXJyb3ItbWVzc2FnZScpLFxuICAgICAgICAkcG9pbnRzVHJhbnNmZXJEZXRhaWxDb250ZW50OiAkKCcucG9pbnRzLXRyYW5zZmVyLWRldGFpbC1jb250YWluZXItY29udGVudCcpLFxuICAgICAgICAkcG9pbnRzVHJhbnNmZXJEZXRhaWxFcnJvck92ZXJsYXk6ICQoJy5wb2ludHMtdHJhbnNmZXItZGV0YWlsLWZ1bGwtcGFnZS1lcnJvci1vdmVybGF5JyksXG4gICAgICAgICRwb2ludHNUcmFuc2ZlckRldGFpbEZ1bGxQYWdlRXJyb3I6ICQoJy5wb2ludHMtdHJhbnNmZXItZGV0YWlsLWZ1bGwtcGFnZS1lcnJvcicpLFxuICAgICAgICBmb3JtRGF0YToge1xuICAgICAgICAgICAgbWVtYmVyTmFtZTogJycsXG4gICAgICAgICAgICBtZW1iZXJOdW1iZXI6ICcnLFxuICAgICAgICAgICAgbWVtYmVyUmVtZW1iZXJOdW1iZXI6IGZhbHNlLFxuICAgICAgICAgICAgbWVtYmVyUGFzc3dvcmQ6ICcnLFxuICAgICAgICAgICAgbWVtYmVyUG9pbnRzVG9UcmFuc2ZlcjogMFxuICAgICAgICB9LFxuICAgICAgICBtaW5IZXJvQ29weUxlbmd0aDogMTY0LFxuICAgICAgICB0cnVuY2F0ZWRDb3B5OiAnJyxcbiAgICAgICAgc2V0U2VlTW9yZTogZmFsc2VcbiAgICB9O1xuXG4gICAgLypcbiAgICAqIFRvZ2dsZSB0aGUgZnVsbCBwYWdlIGVycm9yIHN0YXRlLlxuICAgICovXG4gICAgZnVuY3Rpb24gdG9nZ2xlRnVsbFBhZ2VFcnJvcigpIHtcblxuICAgICAgICB2YXIgZGF0YUVycm9yID0gY29uZmlnLiRwb2ludHNUcmFuc2ZlckRldGFpbENvbnRlbnQuZGF0YSgnZnVsbC1wYWdlLWVycm9yJyk7XG4gICAgICAgIHZhciBoYXNFcnJvciA9IGZhbHNlO1xuXG4gICAgICAgIGlmICh0eXBlb2YgZGF0YUVycm9yICE9PSAndW5kZWZpbmVkJyAmJiBkYXRhRXJyb3IubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGhhc0Vycm9yID0gSlNPTi5wYXJzZShkYXRhRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2goZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdDb3VsZG5cXCd0IHBhcnNlIGBkYXRhLWZ1bGwtcGFnZS1lcnJvcmAgYXMgYSBib29sZWFuLCBmYWxsYmFjayB0byBjb21wYXJpbmcgd2l0aCB0aGUgc3RyaW5nIGRpcmVjdGx5LicpO1xuICAgICAgICAgICAgICAgIGhhc0Vycm9yID0gZGF0YUVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYoaGFzRXJyb3IgfHwgaGFzRXJyb3IgPT09ICd0cnVlJykge1xuXG4gICAgICAgICAgICBjb25maWcuJHBvaW50c1RyYW5zZmVyRGV0YWlsRXJyb3JPdmVybGF5LmFkZENsYXNzKCdzaG93Jyk7XG4gICAgICAgICAgICBjb25maWcuJHBvaW50c1RyYW5zZmVyRGV0YWlsRnVsbFBhZ2VFcnJvci5hZGRDbGFzcygnZXJyb3InKTtcblxuICAgICAgICAgICAgY29uZmlnLiRwb2ludHNUcmFuc2ZlckRldGFpbENvbnRlbnQuYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuXG4gICAgICAgICAgICAvLyBuZWVkZWQgYmVjYXVzZSBzb21lIHNsaWRlciBlbGVtZW50cyBhcmUgY3JlYXRlZCBkeW5hbWljYWxseSBhZnRlciB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZFxuICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLiRmb3JtLmZpbmQoJyonKS5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gICAgICAgICAgICAgICAgY29uZmlnLiRmb3JtLmZpbmQoJyonKS5hdHRyKCdhcmlhLWRpc2FibGVkJywgJ3RydWUnKTtcbiAgICAgICAgICAgICAgICBjb25maWcuJGZvcm0uZmluZCgnKicpLmF0dHIoJ3RhYmluZGV4JywgJy0xJyk7XG4gICAgICAgICAgICB9LCAxMDApO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRvZ2dsZSBBY2NvcmRpb24gOiBUZXJtcyBhbmQgQ29uZGl0aW9uc1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRvZ2dsZUFjY29yZGlvbigpIHtcbiAgICAgICAgdmFyICR0b2dnbGVBY2NvcmRpb25FbCA9ICQoJyNleHBhbmQtdGVybXMtYW5kLWNvbmRpdGlvbnMnKSxcbiAgICAgICAgICAgICR0ZXJtc0xhYmVsID0gJCgnI3Rlcm1zLWFuZC1jb25kaXRpb25zLWFjY29yZGlhbi1sYWJlbCcpO1xuXG4gICAgICAgICR0b2dnbGVBY2NvcmRpb25FbC5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICRwYXJlbnQgPSAkdGhpcy5wYXJlbnQoKSxcbiAgICAgICAgICAgICAgICAkZXJyb3JNZXNzYWdlID0gJHBhcmVudC5uZXh0KCk7XG5cbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBpZiAoJGVycm9yTWVzc2FnZS5oYXNDbGFzcygnZXJyb3InKSkge1xuICAgICAgICAgICAgICAgICRlcnJvck1lc3NhZ2UucmVtb3ZlQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICRwYXJlbnQudG9nZ2xlQ2xhc3MoJ29wZW4nKTtcblxuICAgICAgICAgICAgaWYgKCRwYXJlbnQuaGFzQ2xhc3MoJ29wZW4nKSkge1xuICAgICAgICAgICAgICAgICR0aGlzLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAkKCcjdGVybXMtYW5kLWNvbmRpdGlvbnMnKS5hdHRyKCdhcmlhLWhpZGRlbicsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAkKCcjdGVybXMtYW5kLWNvbmRpdGlvbnMgW3RhYmluZGV4XScpLmVhY2goZnVuY3Rpb24oaW5kZXgsIGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICQoZWwpLmF0dHIoJ3RhYmluZGV4JywgJzAnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAkKCcucG9pbnRzLXRyYW5zZmVyLWRldGFpbC1mb3JtLWNvbnRpbnVlLWNvbnRhaW5lcicpLnJlbW92ZUNsYXNzKCdzaG93LXRvb2x0aXAnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHRoaXMuYXR0cignYXJpYS1leHBhbmRlZCcsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAkKCcjdGVybXMtYW5kLWNvbmRpdGlvbnMnKS5hdHRyKCdhcmlhLWhpZGRlbicsIHRydWUpO1xuICAgICAgICAgICAgICAgICQoJyN0ZXJtcy1hbmQtY29uZGl0aW9ucyBbdGFiaW5kZXhdJykuZWFjaChmdW5jdGlvbihpbmRleCwgZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgJChlbCkuYXR0cigndGFiaW5kZXgnLCAnLTEnKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChjb25maWcuJHRlcm1zQW5kQ29uZGl0aW9uc0NoZWNrYm94WzBdLmNoZWNrZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJy5wb2ludHMtdHJhbnNmZXItZGV0YWlsLWZvcm0tY29udGludWUtY29udGFpbmVyJykuYWRkQ2xhc3MoJ3Nob3ctdG9vbHRpcCcpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChjb25maWcuJHRlcm1zQW5kQ29uZGl0aW9uc0NoZWNrYm94Lmhhc0NsYXNzKCdlcnJvcicpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kdGVybXNBbmRDb25kaXRpb25zQ2hlY2tib3gucmVtb3ZlQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kdGVybXNDb25kaXRpb25zQ2hlY2tib3hFcnJvci5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoJHBhcmVudC5oYXNDbGFzcygnZXJyb3InKSkge1xuICAgICAgICAgICAgICAgICAgICAkZXJyb3JNZXNzYWdlLmFkZENsYXNzKCdlcnJvcicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgICAkdGVybXNMYWJlbC5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICR0b2dnbGVBY2NvcmRpb25FbC50cmlnZ2VyKCdjbGljaycpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdXNlciBpbmZvcm1hdGlvbiBmb3IgdGhlIHNwZWNpZmllZCBzdGVwXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHN0ZXAgOiBQb2ludHMgVHJhbnNmZXIgc3RlcCAodHJhbnNmZXIsIHJldmlldyBvciBjb25maXJtYXRpb24pXG4gICAgICpcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRTdGVwRGF0YShzdGVwKSB7XG5cbiAgICAgICAgdmFyIGNvdW50cnlMb3dlcmNhc2UgPSBjaXRpQ29uZmlnLmNvdW50cnkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgdmFyIGpzb25EYXRhVXJsID0gY2l0aUNvbmZpZy5lbmRQb2ludEhvc3QgKyBjaXRpQ29uZmlnLnBvaW50c1RyYW5zZmVyRGV0YWlsRW5kUG9pbnRQYXRoICsgc3RlcCArICctc3RlcCc7XG4gICAgICAgIHZhciBpc0NvdW50cnlHUiA9IGNvbmZpZy5nckNvdW50cnlBcnJheS5pbmRleE9mKGNvdW50cnlMb3dlcmNhc2UpID49IDA7XG5cbiAgICAgICAgaWYoaXNDb3VudHJ5R1IpIHtcbiAgICAgICAgICAgIGpzb25EYXRhVXJsID0ganNvbkRhdGFVcmwgKyAnLWdyJztcbiAgICAgICAgfVxuXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IGpzb25EYXRhVXJsICsgJy5qc29uJyxcbiAgICAgICAgICAgIHR5cGU6ICdnZXQnLFxuICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgICAgICB9KVxuICAgICAgICAuZG9uZShmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBsb2FkIGRhdGEgaW50byBjb3JyZXNwb25kaW5nIGVsZW1lbnRzXG4gICAgICAgICAgICBzd2l0Y2ggKHN0ZXApIHtcbiAgICAgICAgICAgICAgICBjYXNlICdjb25maXJtYXRpb24nOlxuICAgICAgICAgICAgICAgICAgICBzZXRDb25maXJtYXRpb25EYXRhKGRhdGEsIGlzQ291bnRyeUdSKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAncmV2aWV3JzpcbiAgICAgICAgICAgICAgICAgICAgc2V0UmV2aWV3RGF0YShkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgc2V0VHJhbnNmZXJEYXRhKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgIC8vIFRPRE86IHNlcnZlciBlcnJvciBpbiByZXRyaWV2aW5nIHVzZXIgaW5mbz9cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcjogJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRha2UgcHJvdmlkZWQgZGF0YSBhbmQgc2V0IGl0IHRvIHRoZSB0cmFuc2ZlciBwYWdlXG4gICAgICpcbiAgICAgKlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNldFRyYW5zZmVyRGF0YShkYXRhKSB7XG5cbiAgICAgICAgdmFyIG5hbWVJbnB1dCA9ICQoJyNuYW1lJyk7XG5cbiAgICAgICAgaWYgKCQoJy5jdXN0b20tcG9pbnRzJykubGVuZ3RoICYmIGRhdGEucG9pbnRzKSB7XG4gICAgICAgICAgICBjb25maWcucG9pbnRzVHJhbnNmZXJJbmNyZW1lbnQgPSBwYXJzZUludChkYXRhLnBvaW50cy5pbmNyZW1lbnQsIDEwKTtcbiAgICAgICAgICAgIGNvbmZpZy5wb2ludFRyYW5zZmVyUmF0ZSA9IHBhcnNlSW50KGRhdGEucG9pbnRzLnRyYW5zZmVyUmF0ZSwgMTApO1xuICAgICAgICAgICAgY29uZmlnLnBvaW50c1RyYW5zZmVyTWluID0gcGFyc2VJbnQoZGF0YS5wb2ludHMubWluLCAxMCk7XG4gICAgICAgICAgICBjb25maWcudGhhbmt5b3VQb2ludHNUb1RyYW5zZmVyID0gY29uZmlnLnBvaW50c1RyYW5zZmVyTWluO1xuICAgICAgICB9XG5cbiAgICAgICAgbmFtZUlucHV0LnZhbChkYXRhLnVzZXIubmFtZSk7XG4gICAgICAgIG5hbWVJbnB1dC5hZGRDbGFzcyhkYXRhLmNsYXNzIHx8IFwiXCIpO1xuXG4gICAgICAgICQoJyNwb2ludHMtbGVmdC1hZnRlci10cmFuc2ZlcicpLnZhbChkYXRhLnVzZXIudGhhbmt5b3VQb2ludHMgLSBjb25maWcudGhhbmt5b3VQb2ludHNUb1RyYW5zZmVyKTtcblxuICAgICAgICBjb25maWcudGhhbmt5b3VQb2ludHMgPSBkYXRhLnVzZXIudGhhbmt5b3VQb2ludHM7XG4gICAgICAgIGNvbmZpZy5icmFuZFBvaW50c1RvR2FpbiA9IHBhcnNlSW50KGNvbmZpZy50aGFua3lvdVBvaW50c1RvVHJhbnNmZXIsIDEwKSAqIGNvbmZpZy5wb2ludFRyYW5zZmVyUmF0ZTtcblxuICAgICAgICBjb25maWcuJHBvaW50c1RyYW5zZmVyTWVzc2FnZS5maW5kKCdzcGFuJykudGV4dChjaXRpU2hhcmUudXRpbC5jb252ZXJ0VG9Db21tYUZvcm1hdChjb25maWcucG9pbnRzVHJhbnNmZXJJbmNyZW1lbnQpKTtcbiAgICAgICAgY29uZmlnLiRicmFuZFBvaW50c01lc3NhZ2UuZmluZCgnc3BhbicpLnRleHQoY2l0aVNoYXJlLnV0aWwuY29udmVydFRvQ29tbWFGb3JtYXQoY29uZmlnLnBvaW50c1RyYW5zZmVySW5jcmVtZW50ICogY29uZmlnLnBvaW50VHJhbnNmZXJSYXRlKSk7XG4gICAgICAgIGNvbmZpZy4kYnJhbmRQb2ludHMudmFsKGNpdGlTaGFyZS51dGlsLmNvbnZlcnRUb0NvbW1hRm9ybWF0KGNvbmZpZy5icmFuZFBvaW50c1RvR2FpbikpO1xuICAgICAgICBjaXRpU2hhcmUuc2xpZGVyLmluaXQoJ3BvaW50cy10cmFuc2Zlci1zbGlkZXInLCBjb25maWcucG9pbnRzVHJhbnNmZXJNaW4sIGNvbmZpZy50aGFua3lvdVBvaW50cywgY29uZmlnLnRoYW5reW91UG9pbnRzVG9UcmFuc2ZlciwgY29uZmlnLnBvaW50c1RyYW5zZmVySW5jcmVtZW50LCAncG9pbnRzLXRyYW5zZmVyLWRldGFpbC1zbGlkZXItbWluaW11bScsICdwb2ludHMtdHJhbnNmZXItZGV0YWlsLXNsaWRlci1tYXhpbXVtJywgJ3BvaW50cy10cmFuc2Zlci1mb3JtJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGFrZSBwcm92aWRlZCBkYXRhIGFuZCBzZXQgaXQgdG8gdGhlIHJldmlldyBwYWdlXG4gICAgICpcbiAgICAgKlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNldFJldmlld0RhdGEoZGF0YSkge1xuXG4gICAgICAgIGNvbmZpZy50aGFua3lvdVBvaW50cyA9IGRhdGEudXNlci50aGFua3lvdVBvaW50cztcbiAgICAgICAgY29uZmlnLnRoYW5reW91UG9pbnRzVG9UcmFuc2ZlciA9IGRhdGEudXNlci50aGFua3lvdVBvaW50c1RvVHJhbnNmZXI7XG5cbiAgICAgICAgY29uZmlnLiRwb2ludHNUb1RyYW5zZmVyLnZhbChjaXRpU2hhcmUudXRpbC5jb252ZXJ0VG9Db21tYUZvcm1hdChjb25maWcudGhhbmt5b3VQb2ludHNUb1RyYW5zZmVyKSk7XG5cbiAgICAgICAgaWYoY29uZmlnLiRwb2ludHNUb1RyYW5zZmVyLnZhbCgpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHZhciBwb2ludHNUb1RyYW5zZmVyVmFsID0gcGFyc2VJbnQoY29uZmlnLiRwb2ludHNUb1RyYW5zZmVyLnZhbCgpLnNwbGl0KCcsJykuam9pbignJykpO1xuICAgICAgICAgICAgdmFyIGJyYW5kUG9pbnRzRm9ybWF0dGVkID0gY2l0aVNoYXJlLnV0aWwuY29udmVydFRvQ29tbWFGb3JtYXQocG9pbnRzVG9UcmFuc2ZlclZhbCAqIGNvbmZpZy5wb2ludFRyYW5zZmVyUmF0ZSk7XG4gICAgICAgICAgICBjb25maWcuJGJyYW5kUG9pbnRzLnZhbChicmFuZFBvaW50c0Zvcm1hdHRlZCk7XG4gICAgICAgIH1cblxuICAgICAgICAkKCcjcG9pbnRzLWxlZnQtYWZ0ZXItdHJhbnNmZXInKS52YWwoY2l0aVNoYXJlLnV0aWwuY29udmVydFRvQ29tbWFGb3JtYXQoY29uZmlnLnRoYW5reW91UG9pbnRzIC0gY29uZmlnLnRoYW5reW91UG9pbnRzVG9UcmFuc2ZlcikpO1xuXG4gICAgICAgICQoJyNwb2ludHMtdHJhbnNmZXItbWVtYmVyLW5hbWUnKS50ZXh0KGRhdGEudXNlci5uYW1lKTtcbiAgICAgICAgJCgnI3BvaW50cy10cmFuc2Zlci1tZW1iZXItbnVtYmVyJykudGV4dChkYXRhLnVzZXIubWVtYmVyTnVtYmVyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUYWtlIHByb3ZpZGVkIGRhdGEgYW5kIHNldCBpdCB0byB0aGUgY29uZmlybWF0aW9uIHBhZ2VcbiAgICAgKlxuICAgICAqXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2V0Q29uZmlybWF0aW9uRGF0YShkYXRhLCBpc0NvdW50cnlHUikge1xuXG4gICAgICAgIHNldFJldmlld0RhdGEoZGF0YSk7XG5cbiAgICAgICAgJCgnI3BvaW50cy10cmFuc2Zlci1jb25maXJtYXRpb24tbnVtYmVyJykudGV4dChkYXRhLnVzZXIuY29uZmlybWF0aW9uTnVtYmVyKTtcblxuICAgICAgICAvKi0tLS0tLS0gc2V0dXAgcHJpbnQgcGFnZSAtLS0tLS0qL1xuICAgICAgICBpZihpc0NvdW50cnlHUikge1xuICAgICAgICAgICAgJCgnI3BvaW50cy10by10cmFuc2Zlci1wcmludCcpLnRleHQoJ1hYWCxYWFgnKTtcbiAgICAgICAgICAgICQoJyNicmFuZC1wb2ludHMtcHJpbnQnKS50ZXh0KCdYWFgsWFhYJyk7XG4gICAgICAgICAgICAkKCcjcG9pbnRzLWxlZnQtYWZ0ZXItdHJhbnNmZXItcHJpbnQnKS50ZXh0KCdYWFgsWFhYJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKCcjcG9pbnRzLXRvLXRyYW5zZmVyLXByaW50JykudGV4dChjaXRpU2hhcmUudXRpbC5jb252ZXJ0VG9Db21tYUZvcm1hdChjb25maWcudGhhbmt5b3VQb2ludHNUb1RyYW5zZmVyKSk7XG4gICAgICAgICAgICAkKCcjYnJhbmQtcG9pbnRzLXByaW50JykudGV4dCgwKTtcbiAgICAgICAgICAgICQoJyNwb2ludHMtbGVmdC1hZnRlci10cmFuc2Zlci1wcmludCcpLnRleHQoY2l0aVNoYXJlLnV0aWwuY29udmVydFRvQ29tbWFGb3JtYXQoY29uZmlnLnRoYW5reW91UG9pbnRzIC0gY29uZmlnLnRoYW5reW91UG9pbnRzVG9UcmFuc2ZlcikpO1xuICAgICAgICB9XG5cbiAgICAgICAgJCgnI3BvaW50cy10cmFuc2Zlci1jb25maXJtYXRpb24tbnVtYmVyLXByaW50JykudGV4dChkYXRhLnVzZXIucHJpbnQuY29uZmlybWF0aW9uTnVtYmVyIHx8IGRhdGEudXNlci5jb25maXJtYXRpb25OdW1iZXIpO1xuICAgICAgICAkKCcjcG9pbnRzLXRyYW5zZmVyLW1lbWJlci1uYW1lLXByaW50JykudGV4dChkYXRhLnVzZXIucHJpbnQubmFtZSB8fCBkYXRhLnVzZXIubmFtZSk7XG4gICAgICAgICQoJyNwb2ludHMtdHJhbnNmZXItbWVtYmVyLW51bWJlci1wcmludCcpLnRleHQoZGF0YS51c2VyLnByaW50Lm1lbWJlck51bWJlciB8fCBkYXRhLnVzZXIubWVtYmVyTnVtYmVyKTtcblxuICAgICAgICAkKCcjcG9pbnRzLXRyYW5zZmVyLXRoYW5reW91LWFjY291bnQtbmFtZS1wcmludCcpLnRleHQoZGF0YS51c2VyLnRoYW5rWW91Lm5hbWUpO1xuICAgICAgICAkKCcjcG9pbnRzLXRyYW5zZmVyLXRoYW5reW91LWFjY291bnQtbnVtYmVyLXByaW50JykudGV4dChkYXRhLnVzZXIudGhhbmtZb3UuYWNjb3VudE51bWJlcik7XG4gICAgfVxuXG4gICAgLyotLS0tLSB1c2UgdGVtcGxhdGUgY2xhc3NuYW1lIHRvIGdldCB0aGUgY3VycmVudCBQVERQIHN0ZXAgLS0tLS0qL1xuICAgIGZ1bmN0aW9uIGdldFBvaW50c1RyYW5zZmVyU3RlcCgpIHtcbiAgICAgICAgaWYgKGNvbmZpZy4kcG9pbnRzVHJhbnNmZXJEZXRhaWxDb250YWluZXIuaGFzQ2xhc3MoJ3BvaW50cy10cmFuc2Zlci1kZXRhaWwtdHJhbnNmZXInKSkge1xuICAgICAgICAgICAgcmV0dXJuICd0cmFuc2Zlcic7XG4gICAgICAgIH0gZWxzZSBpZiAoY29uZmlnLiRwb2ludHNUcmFuc2ZlckRldGFpbENvbnRhaW5lci5oYXNDbGFzcygncG9pbnRzLXRyYW5zZmVyLWRldGFpbC1yZXZpZXcnKSkge1xuICAgICAgICAgICAgcmV0dXJuICdyZXZpZXcnO1xuICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZy4kcG9pbnRzVHJhbnNmZXJEZXRhaWxDb250YWluZXIuaGFzQ2xhc3MoJ3BvaW50cy10cmFuc2Zlci1kZXRhaWwtY29uZmlybWF0aW9uJykpIHtcbiAgICAgICAgICAgIHJldHVybiAnY29uZmlybWF0aW9uJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qLS0tLS0gY2FsY3VsYXRlIHRoZSBicmFuZCBhbmQgdGhhbmt5b3UgcG9pbnRzIC0tLS0tKi9cbiAgICBmdW5jdGlvbiBjYWxjdWxhdGVQb2ludHNUcmFuc2ZlcmVkKGlzQnJhbmRGaWVsZCkge1xuICAgICAgICB2YXIgYnJhbmRQb2ludHNMaXZlID0gJCgnI2JyYW5kLXBvaW50cy1saXZlJyksXG4gICAgICAgICAgICBwb2ludHNMZWZ0QWZ0ZXJUcmFuc2ZlckxpdmUgPSAgJCgnI3BvaW50cy1sZWZ0LWFmdGVyLXRyYW5zZmVyLWxpdmUnKSxcbiAgICAgICAgICAgIHBvaW50c1RvVHJhbnNmZXJMaXZlID0gJCgnI3BvaW50cy10by10cmFuc2Zlci1saXZlJyksXG4gICAgICAgICAgICBjb252ZXJ0ZWRCcmFuZFBvaW50c1RvR2FpbiA9IDAsXG4gICAgICAgICAgICBjb252ZXJ0ZWRQb2ludHNMZWZ0ID0gMDtcblxuXG4gICAgICAgIGlmIChpc0JyYW5kRmllbGQpIHtcbiAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSB2YWx1ZXMgZnJvbSBicmFuZHBvaW50c1xuICAgICAgICAgICAgLy8gZG8gKm5vdCogdXNlIHBhcnNlSW50KCkgb24gdGhlIHBvaW50VHJhbnNmZXJSYXRlLi4uXG4gICAgICAgICAgICBjb25maWcudGhhbmt5b3VQb2ludHNUb1RyYW5zZmVyID0gTWF0aC5mbG9vcigoMSAvIGNvbmZpZy5wb2ludFRyYW5zZmVyUmF0ZSkgKiBwYXJzZUludChjb25maWcuYnJhbmRQb2ludHNUb0dhaW4sIDEwKSk7XG4gICAgICAgICAgICBjb25maWcuJHBvaW50c1RvVHJhbnNmZXIudmFsKGNpdGlTaGFyZS51dGlsLmNvbnZlcnRUb0NvbW1hRm9ybWF0KGNvbmZpZy50aGFua3lvdVBvaW50c1RvVHJhbnNmZXIpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbmZpZy5icmFuZFBvaW50c1RvR2FpbiA9IGNvbmZpZy5wb2ludFRyYW5zZmVyUmF0ZSAqIHBhcnNlSW50KGNvbmZpZy50aGFua3lvdVBvaW50c1RvVHJhbnNmZXIsIDEwKTtcbiAgICAgICAgICAgIGNvbnZlcnRlZEJyYW5kUG9pbnRzVG9HYWluID0gY2l0aVNoYXJlLnV0aWwuY29udmVydFRvQ29tbWFGb3JtYXQocGFyc2VJbnQoY29uZmlnLmJyYW5kUG9pbnRzVG9HYWluLCAxMCkpO1xuICAgICAgICAgICAgY29uZmlnLiRicmFuZFBvaW50cy52YWwoY29udmVydGVkQnJhbmRQb2ludHNUb0dhaW4pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29udmVydGVkQnJhbmRQb2ludHNUb0dhaW4gPSBjaXRpU2hhcmUudXRpbC5jb252ZXJ0VG9Db21tYUZvcm1hdChjb25maWcuYnJhbmRQb2ludHNUb0dhaW4pO1xuICAgICAgICBjb252ZXJ0ZWRQb2ludHNMZWZ0ID0gY2l0aVNoYXJlLnV0aWwuY29udmVydFRvQ29tbWFGb3JtYXQoY29uZmlnLnRoYW5reW91UG9pbnRzIC0gY29uZmlnLnRoYW5reW91UG9pbnRzVG9UcmFuc2Zlcik7XG5cbiAgICAgICAgcG9pbnRzVG9UcmFuc2ZlckxpdmUuaHRtbChwb2ludHNUb1RyYW5zZmVyTGl2ZS5kYXRhKCdsYWJlbCcpICsgJyAnICsgY29uZmlnLnRoYW5reW91UG9pbnRzVG9UcmFuc2Zlcik7XG4gICAgICAgIGJyYW5kUG9pbnRzTGl2ZS5odG1sKGJyYW5kUG9pbnRzTGl2ZS5kYXRhKCdsYWJlbCcpICsgJyAnICsgY29udmVydGVkQnJhbmRQb2ludHNUb0dhaW4pO1xuICAgICAgICBwb2ludHNMZWZ0QWZ0ZXJUcmFuc2ZlckxpdmUuaHRtbChwb2ludHNMZWZ0QWZ0ZXJUcmFuc2ZlckxpdmUuZGF0YSgnbGFiZWwnKSArICcgJyArIGNvbnZlcnRlZFBvaW50c0xlZnQpO1xuXG4gICAgICAgICQoJyNwb2ludHMtbGVmdC1hZnRlci10cmFuc2ZlcicpLnZhbChjb252ZXJ0ZWRQb2ludHNMZWZ0KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0b2dnbGVFcnJNc2coJGVsLCAkZWxFcnIsIHNob3dFcnIpIHtcbiAgICAgICAgaWYgKHNob3dFcnIpIHtcbiAgICAgICAgICAgICRlbC5hZGRDbGFzcygnZXJyb3InKTtcbiAgICAgICAgICAgICRlbEVyci5hZGRDbGFzcygnZXJyb3InKTtcbiAgICAgICAgICAgICRlbEVyci5hdHRyKCdhcmlhLWhpZGRlbicsIGZhbHNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRlbC5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAgICAgICAgICRlbEVyci5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAgICAgICAgICRlbEVyci5hdHRyKCdhcmlhLWhpZGRlbicsIHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2hlY2tGb3JtSW5wdXRzKCkge1xuXG4gICAgICAgIHZhciBlbWFpbCA9ICQoJyNicmFuZC1tZW1iZXItZW1haWwnKTtcbiAgICAgICAgdmFyIGVtYWlsRXJyb3IgPSAkKCcuYnJhbmQtbWVtYmVyLWVtYWlsLWVycm9yJyk7XG4gICAgICAgIHZhciBudW1iZXIgPSAkKCcjYnJhbmQtbWVtYmVyLW51bWJlcicpO1xuICAgICAgICB2YXIgbnVtYmVyRXJyb3IgPSAkKCcuYnJhbmQtbWVtYmVyLW51bWJlci1lcnJvcicpO1xuICAgICAgICB2YXIgY29uZmlybU51bWJlciA9ICQoJyNjb25maXJtLWJyYW5kLW1lbWJlci1udW1iZXInKTtcbiAgICAgICAgdmFyIGNvbmZpcm1OdW1iZXJFcnJvciA9ICQoJy5jb25maXJtLWJyYW5kLW1lbWJlci1udW1iZXItZXJyb3InKTtcbiAgICAgICAgdmFyIHBhc3N3b3JkID0gJCgnI2JyYW5kLW1lbWJlci1wYXNzd29yZCcpO1xuICAgICAgICB2YXIgcGFzc3dvcmRFcnJvciA9ICQoJy5icmFuZC1tZW1iZXItcGFzc3dvcmQtZXJyb3InKTtcbiAgICAgICAgdmFyIHJlbWVtYmVyTnVtYmVyID0gJCgnI3JlbWVtYmVyLWJyYW5kLW1lbWJlci1udW1iZXInKTtcbiAgICAgICAgdmFyIHJlbWVtYmVyTnVtYmVyRXJyb3IgPSAkKCcucmVtZW1iZXItYnJhbmQtbWVtYmVyLW51bWJlci1lcnJvcicpO1xuICAgICAgICB2YXIgbmJMb3lhbHR5UHJvZ3JhbSA9IHJlbWVtYmVyTnVtYmVyLmRhdGEoJ25iLWxveWFsdHktcHJvZ3JhbScpO1xuICAgICAgICB2YXIgbWF4TG95YWx0eVByb2dyYW0gPSByZW1lbWJlck51bWJlci5kYXRhKCdtYXgtbG95YWx0eS1wcm9ncmFtJyk7ICAgICAgICBcblxuICAgICAgICBpZihlbWFpbC5sZW5ndGggJiYgZW1haWwudmFsKCkudHJpbSgpLmxlbmd0aCA9PT0gMCB8fCAhY2l0aVNoYXJlLmZvcm1WYWxpZGF0aW9uLnZhbGlkYXRlSW5wdXQoZW1haWwudmFsKCksJ2VtYWlsJykpIHtcbiAgICAgICAgICAgIHRvZ2dsZUVyck1zZyhlbWFpbCwgZW1haWxFcnJvciwgdHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0b2dnbGVFcnJNc2coZW1haWwsIGVtYWlsRXJyb3IsIGZhbHNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChudW1iZXIubGVuZ3RoICYmIG51bWJlci52YWwoKS50cmltKCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0b2dnbGVFcnJNc2cobnVtYmVyLCBudW1iZXJFcnJvciwgdHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0b2dnbGVFcnJNc2cobnVtYmVyLCBudW1iZXJFcnJvciwgZmFsc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbmZpcm1OdW1iZXIubGVuZ3RoICYmIGNvbmZpcm1OdW1iZXIudmFsKCkudHJpbSgpICE9PSBudW1iZXIudmFsKCkudHJpbSgpIHx8IGNvbmZpcm1OdW1iZXIudmFsKCkudHJpbSgpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdG9nZ2xlRXJyTXNnKGNvbmZpcm1OdW1iZXIsIGNvbmZpcm1OdW1iZXJFcnJvciwgdHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0b2dnbGVFcnJNc2coY29uZmlybU51bWJlciwgY29uZmlybU51bWJlckVycm9yLCBmYWxzZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocGFzc3dvcmQubGVuZ3RoICYmIHBhc3N3b3JkLnZhbCgpLnRyaW0oKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRvZ2dsZUVyck1zZyhwYXNzd29yZCwgcGFzc3dvcmRFcnJvciwgdHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0b2dnbGVFcnJNc2cocGFzc3dvcmQsIHBhc3N3b3JkRXJyb3IsIGZhbHNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKHJlbWVtYmVyTnVtYmVyLmxlbmd0aCAmJiByZW1lbWJlck51bWJlci5pcygnOmNoZWNrZWQnKSAmJiBuYkxveWFsdHlQcm9ncmFtID49IG1heExveWFsdHlQcm9ncmFtKSB7XG4gICAgICAgICAgICB0b2dnbGVFcnJNc2cocmVtZW1iZXJOdW1iZXIsIHJlbWVtYmVyTnVtYmVyRXJyb3IsIHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdG9nZ2xlRXJyTXNnKHJlbWVtYmVyTnVtYmVyLCByZW1lbWJlck51bWJlckVycm9yLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBiaW5kRm9ybUNvbnRpbnVlQnV0dG9uKCkge1xuICAgICAgICBjb25maWcuJHRyYW5zZmVyQ29udGludWVCdXR0b24ub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgJGFjY29yZGlvbkNvbnRhaW5lciA9ICQoJy5wb2ludHMtdHJhbnNmZXItZGV0YWlsLXRlcm1zLWFuZC1jb25kaXRpb25zLWFjY29yZGlhbi1jb250YWluZXInKSxcbiAgICAgICAgICAgICAgICBudW1iZXJPZkVycm9ycyA9ICQoJy5wb2ludHMtdHJhbnNmZXItZGV0YWlsLWZvcm0tZXJyb3IuZXJyb3InKS5sZW5ndGg7XG5cbiAgICAgICAgICAgIGlmICghJGFjY29yZGlvbkNvbnRhaW5lci5oYXNDbGFzcygnb3BlbicpICYmICEkKCcjdGVybXMtYW5kLWNvbmRpdGlvbnMtY2hlY2tib3gnKS5pcygnOmNoZWNrZWQnKSkge1xuICAgICAgICAgICAgICAgICRhY2NvcmRpb25Db250YWluZXIuYWRkQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgJCgnI3Rlcm1zLWFuZC1jb25kaXRpb25zLWNoZWNrYm94JykuYWRkQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgJCgnLnBvaW50cy10cmFuc2Zlci1kZXRhaWwtdGVybXMtYW5kLWNvbmRpdGlvbnMtZXJyb3ItbWVzc2FnZScpLmFkZENsYXNzKCdlcnJvcicpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICghJCgnI3Rlcm1zLWFuZC1jb25kaXRpb25zLWNoZWNrYm94JykuaXMoJzpjaGVja2VkJykpIHtcbiAgICAgICAgICAgICAgICAkYWNjb3JkaW9uQ29udGFpbmVyLmFkZENsYXNzKCdlcnJvcicpO1xuICAgICAgICAgICAgICAgICQoJyN0ZXJtcy1hbmQtY29uZGl0aW9ucy1jaGVja2JveCcpLmFkZENsYXNzKCdlcnJvcicpO1xuICAgICAgICAgICAgICAgIGNvbmZpZy4kdGVybXNDb25kaXRpb25zQ2hlY2tib3hFcnJvci5hZGRDbGFzcygnZXJyb3InKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNoZWNrRm9ybUlucHV0cygpO1xuICAgICAgICAgICAgbnVtYmVyT2ZFcnJvcnMgPSAkKCcucG9pbnRzLXRyYW5zZmVyLWRldGFpbC1mb3JtLWVycm9yLmVycm9yJykubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKG51bWJlck9mRXJyb3JzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcG9zdFVzZXJJbnB1dCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKCcjbnVtYmVyLW9mLWVycm9ycycpLnRleHQobnVtYmVyT2ZFcnJvcnMpO1xuXG4gICAgICAgICAgICAgICAgaWYgKG51bWJlck9mRXJyb3JzID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJyNwbHVyYWwtZXJyb3JzJykudGV4dCgnJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChudW1iZXJPZkVycm9ycyA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3BsdXJhbC1lcnJvcnMnKS50ZXh0KCdzJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uZmlnLiRlcnJvck1lc3NhZ2UuYWRkQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgY29uZmlnLiRlcnJvck1lc3NhZ2UuYXR0cigndGFiaW5kZXgnLCAnLTEnKTtcbiAgICAgICAgICAgICAgICBjb25maWcuJGVycm9yTWVzc2FnZS5hdHRyKCdhcmlhLWxpdmUnLCdhc3NlcnRpdmUnKTtcbiAgICAgICAgICAgICAgICBjb25maWcuJGVycm9yTWVzc2FnZS5hdHRyKCdhcmlhLWhpZGRlbicsJ2ZhbHNlJyk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgJCgnaHRtbCxib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogY29uZmlnLiRlcnJvck1lc3NhZ2Uub2Zmc2V0KCkudG9wIC0gNTBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBjb25maWcuJGVycm9yTWVzc2FnZS5mb2N1cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwb3N0VXNlcklucHV0KCkge1xuICAgICAgICBjb25maWcuJGVycm9yTWVzc2FnZS5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAgICAgY29uZmlnLiRlcnJvck1lc3NhZ2UuYXR0cigndGFiaW5kZXgnLCAnLTEnKTtcblxuICAgICAgICBjb25maWcuZm9ybURhdGEubWVtYmVyTmFtZSA9ICQoJyNuYW1lJykudmFsKCk7XG4gICAgICAgIGNvbmZpZy5mb3JtRGF0YS5tZW1iZXJOdW1iZXIgPSAkKCcjYnJhbmQtbWVtYmVyLW51bWJlcicpLnZhbCgpO1xuICAgICAgICBjb25maWcuZm9ybURhdGEubWVtYmVyUmVtZW1iZXJOdW1iZXIgPSAkKCcjcmVtZW1iZXItYnJhbmQtbWVtYmVyLW51bWJlcicpLnZhbCgpO1xuICAgICAgICBjb25maWcuZm9ybURhdGEubWVtYmVyUG9pbnRzVG9UcmFuc2ZlciA9IGNvbmZpZy50aGFua3lvdVBvaW50c1RvVHJhbnNmZXI7XG4gICAgICAgIGNvbmZpZy5mb3JtRGF0YS5tZW1iZXJQYXNzd29yZCA9ICQoJyNicmFuZC1tZW1iZXItcGFzc3dvcmQnKS52YWwoKTtcblxuICAgICAgICAvLyBUT0RPOiB1c2UgUE9TVCB0eXBlIGFuZCBjb3JyZWN0IHRoZSB1cmxcbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHVybDogY2l0aUNvbmZpZy5lbmRQb2ludEhvc3QgKyBjaXRpQ29uZmlnLnBvaW50c1RyYW5zZmVyRGV0YWlsRW5kUG9pbnRQYXRoICsgJ3Jldmlldy1zdGVwLmpzb24nLFxuICAgICAgICAgICAgdHlwZTogJ2dldCcsXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgIH0pXG4gICAgICAgIC5kb25lKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luICsgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnNwbGl0KCcvJykuc2xpY2UoMCwtMSkuam9pbignLycpICsgJy9wb2ludHMtdHJhbnNmZXItZGV0YWlsLXR5LXJldmlldy5odG1sJztcbiAgICAgICAgfSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcjogJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJpbmRUcmFuc2l0aW9uQnV0dG9ucygpIHtcbiAgICAgICAgJCgnI3BvaW50cy10cmFuc2Zlci1kZXRhaWwtYmFjaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbiArIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpLnNsaWNlKDAsLTEpLmpvaW4oJy8nKSArICcvcG9pbnRzLXRyYW5zZmVyLWRldGFpbC10eS5odG1sJztcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnI3BvaW50cy10cmFuc2Zlci1kZXRhaWwtY2FuY2VsLWJ1dHRvbicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGNpdGlTaGFyZS5BY2Nlc3NpYmxlTW9kYWwoeyBtb2RhbDogJCgnI21vZGFsLXBvaW50c3RyYW5zZmVyLXJldmlldy1jYW5jZWwnKSB9KS5zaG93KCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJyNwb2ludHMtdHJhbnNmZXItZGV0YWlsLWNvbmZpcm0nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbiArIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpLnNsaWNlKDAsLTEpLmpvaW4oJy8nKSArICcvcG9pbnRzLXRyYW5zZmVyLWRldGFpbC10eS1jb25maXJtYXRpb24uaHRtbCc7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJpbmRUZXJtc0NvbmRpdGlvbnNDaGVja2JveCgpIHtcbiAgICAgICAgJCgnI3Rlcm1zLWFuZC1jb25kaXRpb25zLWNoZWNrYm94Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnZXJyb3InKSkge1xuICAgICAgICAgICAgICAgIGNvbmZpZy4kdGVybXNDb25kaXRpb25zQ2hlY2tib3hFcnJvci5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdlcnJvcicpO1xuICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgnLmVycm9yJykucmVtb3ZlQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICgkKHRoaXMpLmlzKCc6Y2hlY2tlZCcpKSB7XG4gICAgICAgICAgICAgICAgJCgnLnBvaW50cy10cmFuc2Zlci1kZXRhaWwtZm9ybS1jb250aW51ZS1jb250YWluZXInKS5yZW1vdmVDbGFzcygnc2hvdy10b29sdGlwJyk7XG4gICAgICAgICAgICAgICAgJCgnI2NvbnRpbnVlLWJ1dHRvbi10b29sdGlwJykuYXR0cignYXJpYS1oaWRkZW4nLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAkKCcjY29udGludWUtYnV0dG9uLXRvb2x0aXAnKS5hdHRyKCdyb2xlJywgJycpO1xuICAgICAgICAgICAgICAgIGNvbmZpZy4kdHJhbnNmZXJDb250aW51ZUJ1dHRvbi5hdHRyKCdhcmlhLWRlc2NyaWJlZGJ5JywgJycpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKCcucG9pbnRzLXRyYW5zZmVyLWRldGFpbC1mb3JtLWNvbnRpbnVlLWNvbnRhaW5lcicpLmFkZENsYXNzKCdzaG93LXRvb2x0aXAnKTtcbiAgICAgICAgICAgICAgICAkKCcjY29udGludWUtYnV0dG9uLXRvb2x0aXAnKS5hdHRyKCdhcmlhLWhpZGRlbicsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAkKCcjY29udGludWUtYnV0dG9uLXRvb2x0aXAnKS5hdHRyKCdyb2xlJywgJ3Rvb2x0aXAnKTtcbiAgICAgICAgICAgICAgICBjb25maWcuJHRyYW5zZmVyQ29udGludWVCdXR0b24uYXR0cignYXJpYS1kZXNjcmliZWRieScsICdjb250aW51ZS1idXR0b24tdG9vbHRpcCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBiaW5kQnJhbmRQb2ludHNJbnB1dCgpIHtcbiAgICAgICAgY29uZmlnLiRicmFuZFBvaW50cy5vbignZm9jdXNvdXQga2V5dXAnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICAgICAgJHRoaXNWYWwgPSAkdGhpcy52YWwoKS5zcGxpdCgnLCcpLmpvaW4oJycpLFxuICAgICAgICAgICAgICAgIGlucHV0VmFsID0gJycsXG4gICAgICAgICAgICAgICAgaW5wdXRSZW1haW5kZXI7XG5cbiAgICAgICAgICAgIGlmIChlLndoaWNoICE9PSAxMyAmJiBlLndoaWNoICE9PSAwICYmIGUud2hpY2ggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFpc05hTigkdGhpc1ZhbCkpIHtcbiAgICAgICAgICAgICAgICAvLyBVc2UgbWluaW11bSB2YWx1ZSB3aGVuIHVzZXIgZW50ZXJzIHZhbHVlIGxlc3MgdGhhbiB0aGUgbWluaW11bVxuICAgICAgICAgICAgICAgIGlmIChwYXJzZUludCgkdGhpc1ZhbCwgMTApIDwgKHBhcnNlSW50KGNvbmZpZy5wb2ludHNUcmFuc2Zlck1pbiwgMTApICogY29uZmlnLnBvaW50VHJhbnNmZXJSYXRlKSB8fCAkdGhpc1ZhbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmJyYW5kUG9pbnRzVG9HYWluID0gY29uZmlnLnBvaW50VHJhbnNmZXJSYXRlICogcGFyc2VJbnQoY29uZmlnLnBvaW50c1RyYW5zZmVyTWluLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0VmFsID0gcGFyc2VJbnQoY29uZmlnLmJyYW5kUG9pbnRzVG9HYWluLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLnZhbChjaXRpU2hhcmUudXRpbC5jb252ZXJ0VG9Db21tYUZvcm1hdChpbnB1dFZhbCkpO1xuICAgICAgICAgICAgICAgICAgICBjb25maWcuJGJyYW5kUG9pbnRzTWVzc2FnZS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kYnJhbmRQb2ludHNNZXNzYWdlLmF0dHIoJ2FyaWEtaGlkZGVuJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gJCgnI2JyYW5kLXBvaW50cy1tZXNzYWdlJykuZGF0YSgnbWVzc2FnZS11cCcpO1xuICAgICAgICAgICAgICAgICAgICAkKCcjYnJhbmQtcG9pbnRzLW1lc3NhZ2UnKS5odG1sKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAkKCcjYnJhbmQtcG9pbnRzLW1lc3NhZ2Ugc3BhbicpLnRleHQoY2l0aVNoYXJlLnV0aWwuY29udmVydFRvQ29tbWFGb3JtYXQoY29uZmlnLnBvaW50c1RyYW5zZmVySW5jcmVtZW50ICogY29uZmlnLnBvaW50VHJhbnNmZXJSYXRlKSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kcG9pbnRzVHJhbnNmZXJNZXNzYWdlLmh0bWwoJycpO1xuICAgICAgICAgICAgICAgIC8vIFVzZSBtYXhpbXVtIHZhbHVlIHdoZW4gdXNlciBlbnRlcnMgdmFsdWUgZ3JlYXRlciB0aGFuIHRoZSBtYXhpbXVtXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJzZUludCgkdGhpc1ZhbCwgMTApID4gKGNvbmZpZy5wb2ludFRyYW5zZmVyUmF0ZSAqIGNvbmZpZy50aGFua3lvdVBvaW50cykpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmJyYW5kUG9pbnRzVG9HYWluID0gY29uZmlnLnBvaW50VHJhbnNmZXJSYXRlICogcGFyc2VJbnQoY29uZmlnLnRoYW5reW91UG9pbnRzLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0VmFsID0gcGFyc2VJbnQoY29uZmlnLmJyYW5kUG9pbnRzVG9HYWluLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLnZhbChjaXRpU2hhcmUudXRpbC5jb252ZXJ0VG9Db21tYUZvcm1hdChpbnB1dFZhbCkpO1xuICAgICAgICAgICAgICAgICAgICBjb25maWcuJGJyYW5kUG9pbnRzTWVzc2FnZS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kYnJhbmRQb2ludHNNZXNzYWdlLmF0dHIoJ2FyaWEtaGlkZGVuJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gJCgnI2JyYW5kLXBvaW50cy1tZXNzYWdlJykuZGF0YSgnbWVzc2FnZS1kb3duJyk7XG4gICAgICAgICAgICAgICAgICAgICQoJyNicmFuZC1wb2ludHMtbWVzc2FnZScpLmh0bWwoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICQoJyNicmFuZC1wb2ludHMtbWVzc2FnZSBzcGFuJykudGV4dChjaXRpU2hhcmUudXRpbC5jb252ZXJ0VG9Db21tYUZvcm1hdChjb25maWcucG9pbnRzVHJhbnNmZXJJbmNyZW1lbnQgKiBjb25maWcucG9pbnRUcmFuc2ZlclJhdGUpKTtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLiRwb2ludHNUcmFuc2Zlck1lc3NhZ2UuaHRtbCgnJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXRSZW1haW5kZXIgPSAkdGhpc1ZhbCAlIHBhcnNlSW50KGNvbmZpZy5wb2ludHNUcmFuc2ZlckluY3JlbWVudCAqIGNvbmZpZy5wb2ludFRyYW5zZmVyUmF0ZSwgMTApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXRSZW1haW5kZXIgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kYnJhbmRQb2ludHNNZXNzYWdlLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kYnJhbmRQb2ludHNNZXNzYWdlLmF0dHIoJ2FyaWEtaGlkZGVuJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuYnJhbmRQb2ludHNUb0dhaW4gPSAkdGhpc1ZhbDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kYnJhbmRQb2ludHNNZXNzYWdlLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kYnJhbmRQb2ludHNNZXNzYWdlLmF0dHIoJ2FyaWEtaGlkZGVuJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmJyYW5kUG9pbnRzVG9HYWluID0gJHRoaXNWYWwgLSBpbnB1dFJlbWFpbmRlcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vYXJlYSB3aGVyZSBpdCBuZWVkcyB0byBcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSAkKCcjYnJhbmQtcG9pbnRzLW1lc3NhZ2UnKS5kYXRhKCdtZXNzYWdlLWRvd24nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNicmFuZC1wb2ludHMtbWVzc2FnZScpLmh0bWwoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjYnJhbmQtcG9pbnRzLW1lc3NhZ2Ugc3BhbicpLnRleHQoY2l0aVNoYXJlLnV0aWwuY29udmVydFRvQ29tbWFGb3JtYXQoY29uZmlnLnBvaW50c1RyYW5zZmVySW5jcmVtZW50ICogY29uZmlnLnBvaW50VHJhbnNmZXJSYXRlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuJHBvaW50c1RyYW5zZmVyTWVzc2FnZS5odG1sKCcnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpbnB1dFZhbCA9IHBhcnNlSW50KGNvbmZpZy5icmFuZFBvaW50c1RvR2FpbiwgMTApO1xuICAgICAgICAgICAgICAgICAgICAkdGhpcy52YWwoY2l0aVNoYXJlLnV0aWwuY29udmVydFRvQ29tbWFGb3JtYXQoaW5wdXRWYWwpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjYWxjdWxhdGVQb2ludHNUcmFuc2ZlcmVkKHRydWUpO1xuICAgICAgICAgICAgICAgICQoJyNwb2ludHMtdHJhbnNmZXItZGV0YWlsLXNsaWRlcicpLnRyaWdnZXIoJ3NsaWRlcklucHV0Q2hhbmdlJywgW2NvbmZpZy50aGFua3lvdVBvaW50c1RvVHJhbnNmZXIsICQoJyNwb2ludHMtdHJhbnNmZXItc2xpZGVyX2hhbmRsZScpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNldElucHV0Q29uc3RyYWludHMoY29uZmlnLiRicmFuZFBvaW50cyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYmluZFNsaWRlcklucHV0KCkge1xuICAgICAgICBjb25maWcuJHBvaW50c1RvVHJhbnNmZXIub24oJ2ZvY3Vzb3V0IGtleXVwJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAgICAgICR0aGlzVmFsID0gJHRoaXMudmFsKCkuc3BsaXQoJywnKS5qb2luKCcnKSxcbiAgICAgICAgICAgICAgICBpbnB1dFJlbWFpbmRlcjtcblxuICAgICAgICAgICAgaWYgKGUud2hpY2ggIT09IDEzICYmIGUud2hpY2ggIT09IDAgJiYgZS53aGljaCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWlzTmFOKCR0aGlzVmFsKSkge1xuICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChjb25maWcudGhhbmt5b3VQb2ludHMuc3BsaXQoJywnKS5qb2luKCcnKSwgMTApID49ICR0aGlzVmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0UmVtYWluZGVyID0gJHRoaXNWYWwgJSBjb25maWcucG9pbnRzVHJhbnNmZXJJbmNyZW1lbnQ7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0UmVtYWluZGVyID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuJHBvaW50c1RyYW5zZmVyTWVzc2FnZS5odG1sKCcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kcG9pbnRzVHJhbnNmZXJNZXNzYWdlLmF0dHIoJ2FyaWEtaGlkZGVuJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWcudGhhbmt5b3VQb2ludHNUb1RyYW5zZmVyID0gJHRoaXNWYWw7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NvbmZpZy4kcG9pbnRzVHJhbnNmZXJNZXNzYWdlLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kcG9pbnRzVHJhbnNmZXJNZXNzYWdlLmF0dHIoJ2FyaWEtaGlkZGVuJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLnRoYW5reW91UG9pbnRzVG9UcmFuc2ZlciA9ICR0aGlzVmFsIC0gaW5wdXRSZW1haW5kZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gJCgnI3BvaW50cy10by10cmFuc2Zlci1tZXNzYWdlJykuZGF0YSgnbWVzc2FnZS1kb3duJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjcG9pbnRzLXRvLXRyYW5zZmVyLW1lc3NhZ2UnKS5odG1sKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3BvaW50cy10by10cmFuc2Zlci1tZXNzYWdlIHNwYW46bnRoLWNoaWxkKDEpJykudGV4dChjaXRpU2hhcmUudXRpbC5jb252ZXJ0VG9Db21tYUZvcm1hdChjb25maWcucG9pbnRzVHJhbnNmZXJJbmNyZW1lbnQpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNwb2ludHMtdG8tdHJhbnNmZXItbWVzc2FnZSBzcGFuOm50aC1jaGlsZCgyKScpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kYnJhbmRQb2ludHNNZXNzYWdlLmh0bWwoJycpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgJHRoaXMudmFsKGNvbmZpZy50aGFua3lvdVBvaW50c1RvVHJhbnNmZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLnZhbChjb25maWcudGhhbmt5b3VQb2ludHMpO1xuICAgICAgICAgICAgICAgICAgICBjb25maWcudGhhbmt5b3VQb2ludHNUb1RyYW5zZmVyID0gY29uZmlnLnRoYW5reW91UG9pbnRzO1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gJCgnI3BvaW50cy10by10cmFuc2Zlci1tZXNzYWdlJykuZGF0YSgnbWVzc2FnZS1kb3duJyk7XG4gICAgICAgICAgICAgICAgICAgICQoJyNwb2ludHMtdG8tdHJhbnNmZXItbWVzc2FnZScpLmh0bWwoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICQoJyNwb2ludHMtdG8tdHJhbnNmZXItbWVzc2FnZSBzcGFuJykudGV4dChjaXRpU2hhcmUudXRpbC5jb252ZXJ0VG9Db21tYUZvcm1hdChjb25maWcucG9pbnRzVHJhbnNmZXJJbmNyZW1lbnQpKTtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLiRicmFuZFBvaW50c01lc3NhZ2UuaHRtbCgnJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzVmFsIDwgY29uZmlnLnBvaW50c1RyYW5zZmVyTWluKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kcG9pbnRzVHJhbnNmZXJNZXNzYWdlLmF0dHIoJ2FyaWEtaGlkZGVuJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBjb25maWcudGhhbmt5b3VQb2ludHNUb1RyYW5zZmVyID0gY29uZmlnLnBvaW50c1RyYW5zZmVyTWluO1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gJCgnI3BvaW50cy10by10cmFuc2Zlci1tZXNzYWdlJykuZGF0YSgnbWVzc2FnZS11cCcpO1xuICAgICAgICAgICAgICAgICAgICAkKCcjcG9pbnRzLXRvLXRyYW5zZmVyLW1lc3NhZ2UnKS5odG1sKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAkKCcjcG9pbnRzLXRvLXRyYW5zZmVyLW1lc3NhZ2Ugc3BhbicpLnRleHQoY2l0aVNoYXJlLnV0aWwuY29udmVydFRvQ29tbWFGb3JtYXQoY29uZmlnLnBvaW50c1RyYW5zZmVySW5jcmVtZW50KSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kYnJhbmRQb2ludHNNZXNzYWdlLmh0bWwoJycpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNhbGN1bGF0ZVBvaW50c1RyYW5zZmVyZWQoKTtcbiAgICAgICAgICAgICAgICAkKCcjcG9pbnRzLXRyYW5zZmVyLWRldGFpbC1zbGlkZXInKS50cmlnZ2VyKCdzbGlkZXJJbnB1dENoYW5nZScsIFtjb25maWcudGhhbmt5b3VQb2ludHNUb1RyYW5zZmVyLCAkKCcjcG9pbnRzLXRyYW5zZmVyLXNsaWRlcl9oYW5kbGUnKV0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkdGhpcy5hZGRDbGFzcygnbm90LWEtbnVtYmVyLWVycm9yIGVycm9yJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNldElucHV0Q29uc3RyYWludHMoY29uZmlnLiRwb2ludHNUb1RyYW5zZmVyKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXRJbnB1dENvbnN0cmFpbnRzKCRlbCkge1xuICAgICAgICAkZWwub24oJ2tleXByZXNzJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGNvbmZpZy5hbGxvd2FibGVLZXlzLmluZGV4T2YoZS53aGljaCkgPT09IC0xIHx8ICQodGhpcykudmFsKCkubGVuZ3RoID4gNDkpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KS5vbigna2V5dXAgY2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgIHZhbCA9ICR0aGlzLnZhbCgpO1xuXG4gICAgICAgICAgICB2YWwgPSB2YWwuc3BsaXQoJywnKS5qb2luKCcnKTtcbiAgICAgICAgICAgICR0aGlzLnZhbChjaXRpU2hhcmUudXRpbC5jb252ZXJ0VG9Db21tYUZvcm1hdCh2YWwpKTtcbiAgICAgICAgfSkub24oJ3Bhc3RlJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBiaW5kU2VlTW9yZUJyYW5kcygpIHtcbiAgICAgICAgJCgnI3NlZS1tb3JlLWJyYW5kcy1saW5rJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAkYnJhbmRzQ29udGFpbmVyID0gJHRoaXMubmV4dCgpO1xuXG4gICAgICAgICAgICBpZiAoJGJyYW5kc0NvbnRhaW5lci5oYXNDbGFzcygnb3BlbicpKSB7XG4gICAgICAgICAgICAgICAgJHRoaXMuZmluZCgnc3BhbicpLmh0bWwoJycpO1xuICAgICAgICAgICAgICAgICR0aGlzLmZpbmQoJ3NwYW4nKS50ZXh0KCcrJyk7XG4gICAgICAgICAgICAgICAgJGJyYW5kc0NvbnRhaW5lci5yZW1vdmVDbGFzcygnb3BlbicpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCdzcGFuJykudGV4dCgnJyk7XG4gICAgICAgICAgICAgICAgJHRoaXMuZmluZCgnc3BhbicpLmh0bWwoJyZtZGFzaDsnKTtcbiAgICAgICAgICAgICAgICAkYnJhbmRzQ29udGFpbmVyLmFkZENsYXNzKCdvcGVuJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYmluZEhlcm9TZWVNb3JlKCkge1xuICAgICAgICB2YXIgdGFibGV0V2lkdGggPSA3NjgsXG4gICAgICAgICAgICBpc01vYmlsZVdpZHRoID0gZmFsc2U7XG5cbiAgICAgICAgJCh3aW5kb3cpLm9uKCdyZXNpemUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNpdGlTaGFyZS51dGlsLnRocm90dGxlKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciB3aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoIHx8ICQod2luZG93KS53aWR0aCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvd1dpZHRoIDwgdGFibGV0V2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNNb2JpbGVXaWR0aCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaXNNb2JpbGVXaWR0aCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChpc01vYmlsZVdpZHRoICYmICFjb25maWcuc2V0U2VlTW9yZSkge1xuICAgICAgICAgICAgICAgICAgICB0cnVuY2F0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBjb25maWcuJHNob3dNb3JlLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLnNldFNlZU1vcmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzTW9iaWxlV2lkdGggJiYgY29uZmlnLnNldFNlZU1vcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLiRzaG93TW9yZS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy5zZXRTZWVNb3JlID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb25maWcuJHNob3dNb3JlLmhhc0NsYXNzKCdvcGVuJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVuVHJ1bmNhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kc2hvd01vcmUucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy4kc2hvd01vcmUuaHRtbChjb25maWcuJHNob3dNb3JlLmRhdGEoJ21vcmUnKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYoaXNNb2JpbGVXaWR0aCl7XG4gICAgICAgICAgICAgICAgICAgICQoJy5wb2ludHMtdHJhbnNmZXItZGV0YWlsLWZvcm0tY29udGludWUnKS5yZW1vdmVBdHRyKCdhcmlhLWRlc2NyaWJlZGJ5Jyk7XG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICQoJy5wb2ludHMtdHJhbnNmZXItZGV0YWlsLWZvcm0tY29udGludWUnKS5hdHRyKCdhcmlhLWRlc2NyaWJlZGJ5JywnY29udGludWUtYnV0dG9uLXRvb2x0aXAnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9KCksIDUwMCk7XG4gICAgICAgIH0pLnRyaWdnZXIoJ3Jlc2l6ZScpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJpbmRFbWFpbEVycm9yKCl7XG5cbiAgICAgICAgdmFyIGVtYWlsID0gJCgnI2JyYW5kLW1lbWJlci1lbWFpbCcpO1xuICAgICAgICB2YXIgZW1haWxFcnJvciA9ICQoJy5icmFuZC1tZW1iZXItZW1haWwtZXJyb3InKTtcbiAgICAgICAgXG4gICAgICAgICQoZW1haWwpLm9uKCdibHVyJyxmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYoZW1haWwubGVuZ3RoICYmIGVtYWlsLnZhbCgpLnRyaW0oKS5sZW5ndGggPT09IDAgfHwgIWNpdGlTaGFyZS5mb3JtVmFsaWRhdGlvbi52YWxpZGF0ZUlucHV0KGVtYWlsLnZhbCgpLCdlbWFpbCcpKSB7XG4gICAgICAgICAgICAgICAgdG9nZ2xlRXJyTXNnKGVtYWlsLCBlbWFpbEVycm9yLCB0cnVlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdG9nZ2xlRXJyTXNnKGVtYWlsLCBlbWFpbEVycm9yLCBmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJpbmRTaG93TW9yZUJ1dHRvbigpIHtcbiAgICAgICAgdmFyIG1vcmVDb3B5ID0gY29uZmlnLiRzaG93TW9yZS5kYXRhKCdtb3JlJyksXG4gICAgICAgICAgICBsZXNzQ29weSA9IGNvbmZpZy4kc2hvd01vcmUuZGF0YSgnbGVzcycpO1xuXG4gICAgICAgIGNvbmZpZy4kc2hvd01vcmUub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcblxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGlmICgkdGhpcy5oYXNDbGFzcygnb3BlbicpKSB7XG4gICAgICAgICAgICAgICAgJHRoaXMucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgICAgICAgICAkdGhpcy5odG1sKG1vcmVDb3B5KTtcbiAgICAgICAgICAgICAgICB0cnVuY2F0ZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkdGhpcy5hZGRDbGFzcygnb3BlbicpO1xuICAgICAgICAgICAgICAgICR0aGlzLmh0bWwobGVzc0NvcHkpO1xuICAgICAgICAgICAgICAgIHVuVHJ1bmNhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdHJ1bmNhdGUoKSB7XG4gICAgICAgIGlmIChjb25maWcubWluSGVyb0NvcHlMZW5ndGggIT09IG51bGwgJiYgY29uZmlnLiRoZXJvQ29weS5odG1sKCkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29uZmlnLnRydW5jYXRlZENvcHkgPSBjb25maWcuJGhlcm9Db3B5Lmh0bWwoKS5zdWJzdHJpbmcoY29uZmlnLm1pbkhlcm9Db3B5TGVuZ3RoKTtcbiAgICAgICAgICAgIGNvbmZpZy4kaGVyb0NvcHkuaHRtbChjb25maWcuJGhlcm9Db3B5Lmh0bWwoKS5zdWJzdHJpbmcoMCwgY29uZmlnLm1pbkhlcm9Db3B5TGVuZ3RoKSArICcuLi4nKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVuVHJ1bmNhdGUoKSB7XG4gICAgICAgIGlmIChjb25maWcuJGhlcm9Db3B5Lmxlbmd0aCkge1xuICAgICAgICAgICAgY29uZmlnLiRoZXJvQ29weS5odG1sKGNvbmZpZy4kaGVyb0NvcHkuaHRtbCgpLnNsaWNlKDAsLTMpICsgY29uZmlnLnRydW5jYXRlZENvcHkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYmluZFNob3dNb3JlQnV0dG9uKCk7XG5cbiAgICBmdW5jdGlvbiBfaW5pdCgpIHtcbiAgICAgICAgdmFyIHBvaW50c1RyYW5zZmVyU3RlcCA9IGdldFBvaW50c1RyYW5zZmVyU3RlcCgpO1xuXG4gICAgICAgIGlmIChwb2ludHNUcmFuc2ZlclN0ZXAgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgZ2V0U3RlcERhdGEocG9pbnRzVHJhbnNmZXJTdGVwKTtcblxuICAgICAgICAgICAgdG9nZ2xlQWNjb3JkaW9uKCk7XG5cbiAgICAgICAgICAgIGJpbmRUcmFuc2l0aW9uQnV0dG9ucygpO1xuXG4gICAgICAgICAgICBjb25maWcuJGZvcm0ub24oJ3NsaWRlclZhbHVlJywgZnVuY3Rpb24oZSwgcGFyYW0pIHtcbiAgICAgICAgICAgICAgICBjb25maWcuJHBvaW50c1RvVHJhbnNmZXIudmFsKHBhcmFtKS50cmlnZ2VyKCdjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICBjb25maWcudGhhbmt5b3VQb2ludHNUb1RyYW5zZmVyID0gcGFyYW07XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYmluZEZvcm1Db250aW51ZUJ1dHRvbigpO1xuXG4gICAgICAgICAgICBiaW5kVGVybXNDb25kaXRpb25zQ2hlY2tib3goKTtcblxuICAgICAgICAgICAgY29uZmlnLiRwb2ludHNUb1RyYW5zZmVyLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLnRoYW5reW91UG9pbnRzVG9UcmFuc2ZlciA9IHBhcnNlSW50KGUudGFyZ2V0LnZhbHVlLnNwbGl0KCcsJykuam9pbignJyksIDEwKTtcbiAgICAgICAgICAgICAgICBjYWxjdWxhdGVQb2ludHNUcmFuc2ZlcmVkKCk7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBiaW5kU2xpZGVySW5wdXQoKTtcbiAgICAgICAgICAgIGJpbmRCcmFuZFBvaW50c0lucHV0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBiaW5kU2VlTW9yZUJyYW5kcygpO1xuICAgICAgICBiaW5kSGVyb1NlZU1vcmUoKTtcbiAgICAgICAgdG9nZ2xlRnVsbFBhZ2VFcnJvcigpO1xuICAgICAgICBiaW5kRW1haWxFcnJvcigpO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRoZXJlIGlzIGEgbWluaW11bSBwb2ludHMgZXJyb3IgZm9yIHRoaXMgdXNlci5cbiAgICAgICAgLy8gSWYgc28sIHByZXZlbnQgdGFiYmluZyBhbmQgZGlzcGxheSBvdmVybGF5IHdpdGggdGhlIG1lc3NhZ2VcbiAgICAgICAgaWYgKCQoJy5wb2ludHMtdHJhbnNmZXItZGV0YWlsLW1pbmltdW0tcG9pbnRzLWVycm9yJykuaGFzQ2xhc3MoJ3Nob3ctbWluaW11bS1wb2ludHMtZXJyb3InKSkge1xuICAgICAgICAgICAgY29uZmlnLiRwb2ludHNUcmFuc2ZlckRldGFpbENvbnRlbnQuYXR0cigndGFiaW5kZXgnLCAwKTtcbiAgICAgICAgICAgICQoJyNtaW5pbXVtLXBvaW50cy1lcnJvci1vdmVybGF5Jykuc2hvdygpO1xuICAgICAgICAgICAgJCgnLnBvaW50cy10cmFuc2Zlci1kZXRhaWwtbWluaW11bS1wb2ludHMtZXJyb3InKS5zaG93KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBjb25maWc6IGNvbmZpZyxcbiAgICAgICAgaW5pdDogX2luaXRcbiAgICB9O1xufSkoKTtcblxuIiwiY2l0aVNoYXJlLnBvbHlmaWxscyA9IChmdW5jdGlvbigpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIGZ1bmN0aW9uIGNzczNDb2x1bW5zKCl7XG5cbiAgICBcdC8vIGNvbHVtbml6ZSB0aGUgYWxsIGJyYW5kcyB2YXJpYXRpb24gb2YgdGhlIGNhdGVnb3J5IGxhbmRpbmcgcGFnZVxuICAgIFx0JCgnLmNhdGVnb3J5LWJyYW5kLXdyYXBwZXInKS5hZGRDbGFzcygnZG9udHNwbGl0Jyk7XG4gICAgICAgIFxuICAgICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPCA0ODApIHtcbiAgICAgICAgICAgICQoJy5jYXRlZ29yeS1icmFuZHMtd3JhcHBlcicpLmNvbHVtbml6ZSh7XG4gICAgICAgICAgICAgICAgd2lkdGg6ICQoJy5vYy1jb250ZW50Jykud2lkdGgoKSAvIDEsIFxuICAgICAgICAgICAgICAgIGJ1aWxkT25jZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0YXJnZXQ6ICQoJy5uby1jc3MtY29sdW1ucy13cmFwcGVyJylcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKCQod2luZG93KS53aWR0aCgpIDwgNzU1KSB7XG4gICAgICAgICAgICAkKCcuY2F0ZWdvcnktYnJhbmRzLXdyYXBwZXInKS5jb2x1bW5pemUoe1xuICAgICAgICAgICAgICAgIHdpZHRoOiAkKCcub2MtY29udGVudCcpLndpZHRoKCkgLyAyLCBcbiAgICAgICAgICAgICAgICBidWlsZE9uY2U6IHRydWUsXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiAkKCcubm8tY3NzLWNvbHVtbnMtd3JhcHBlcicpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICgkKHdpbmRvdykud2lkdGgoKSA8IDk2MCkge1xuICAgICAgICAgICAgJCgnLmNhdGVnb3J5LWJyYW5kcy13cmFwcGVyJykuY29sdW1uaXplKHtcbiAgICAgICAgICAgICAgICB3aWR0aDogJCgnLm9jLWNvbnRlbnQnKS53aWR0aCgpIC8gMywgXG4gICAgICAgICAgICAgICAgYnVpbGRPbmNlOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRhcmdldDogJCgnLm5vLWNzcy1jb2x1bW5zLXdyYXBwZXInKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKCcuY2F0ZWdvcnktYnJhbmRzLXdyYXBwZXInKS5jb2x1bW5pemUoe1xuICAgICAgICAgICAgICAgIHdpZHRoOiAkKCcub2MtY29udGVudCcpLndpZHRoKCkgLyA0LCBcbiAgICAgICAgICAgICAgICBidWlsZE9uY2U6IHRydWUsXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiAkKCcubm8tY3NzLWNvbHVtbnMtd3JhcHBlcicpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcblxuICAgIH1cblxuXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIGlmICghTW9kZXJuaXpyLmNzc2NvbHVtbnMpIHtcbiAgICAgICAgaWYodHlwZW9mICQudGhyb3R0bGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAkKHdpbmRvdykucmVzaXplKCQudGhyb3R0bGUoNTAwLCBjc3MzQ29sdW1ucykpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGluaXQoKTtcbiAgICByZXR1cm4ge307XG59KSgpO1xuIiwiLypcbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gaW5pdGlhbGl6ZSBhbmQgaGFuZGxlIGV2ZXJ5dGhpbmcgcmVsYXRlZFxuICogdG8gdGhlIE15IFByb2ZpbGUgcGFnZVxuICpcbiAqIERlcGVuZHMgb25cbiAqICAtIEhhdmluZyBhIERJViB3aXRoIGEgY2xhc3Mgb2YgYG15LXByb2ZpbGVgXG4gKiAgLSBqUXVlcnlcbiAqICAtIGNpdGlTaGFyZS5BY2Nlc3NpYmxlTW9kYWxcbiAqXG4gKi9cbmNpdGlTaGFyZS5wcm9maWxlID0gKGZ1bmN0aW9uKCkge1xuXG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBjb25maWcgPSB7XG4gICAgJGVkaXRMaW5rczogJCgnLnByb2ZpbGUtZWRpdC1saW5rJyksXG4gICAgJGNhbmNlbExpbmtzOiAkKCcubXktcHJvZmlsZS1jYW5jZWwtbGluaycpLFxuICAgIGNvbnRhY3RJbmZvcm1hdGlvbkxpc3RzOiBbXSxcbiAgICBhamF4RGVsZXRlU2VsZWN0b3I6ICcuYWpheC1kZWxldGUnLFxuXG4gICAgZm9ybUdyb3VwRXJyb3JTZWxlY3RvcjogJy5mb3JtLWdyb3VwLWVycm9yJyxcblxuICAgIGVkaXRMaW5rU2VsZWN0b3I6ICcucHJvZmlsZS1lZGl0LWxpbmsnLFxuXG4gICAgbW9kdWxlU2VsZWN0b3I6ICcubW9kdWxlJyxcbiAgICBzdGF0aWNDb250YWluZXJTZWxlY3RvcjogJy5tb2R1bGUtc3RhdGljJyxcbiAgICBlZGl0YWJsZUNvbnRhaW5lclNlbGVjdG9yOiAnLm1vZHVsZS1lZGl0YWJsZScsXG4gICAgbW9kdWxlTWVzc2FnZXNTZWxlY3RvcjogJy5teS1wcm9maWxlLW1lc3NhZ2VzJyxcbiAgICBjYW5jZWxFZGl0c01vZGFsU2VsZWN0b3I6ICcjbW9kYWwtY29uZmlybS1jYW5jZWwnLFxuXG4gICAgJGFjY291bnRTZWxlY3Rpb25Gb3JtOiAkKCcjbXktcHJvZmlsZS1hY2NvdW50LXNlbGVjdGlvbi1mb3JtJyksXG4gICAgYWNjb3VudFNlbGVjdGlvbk1vZGFsU2VsZWN0b3I6ICcjbW9kYWwtYWNjb3VudC1zZWxlY3Rpb24tY29uZmlybScsXG4gICAgXG4gICAgJGNvbnRhY3RJbmZvcm1hdGlvbkZvcm06ICQoJyNteS1wcm9maWxlLWNvbnRhY3QtaW5mb3JtYXRpb24tZm9ybScpLFxuICAgICRjb250YWN0SW5mb3JtYXRpb25FbWFpbElucHV0OiAkKCcjZU1haWwsICNlTWFpbC1jb25maXJtJyksXG4gICAgJGNvbnRhY3RJbmZvcm1hdGlvblBob25lc0lucHV0OiAkKCcjaG9tZVBob25lLCAjYnVzaW5lc3NQaG9uZSwgI21vYmlsZVBob25lJyksXG5cbiAgICAkc2VjdXJpdHlJbmZvcm1hdGlvbkZvcm06ICQoJyNteS1wcm9maWxlLXNlY3VyaXR5LWluZm9ybWF0aW9uLWZvcm0nKSxcbiAgICAkZW1haWxTZXR0aW5nc0Zvcm06ICQoJyNteS1wcm9maWxlLWVtYWlsLXNldHRpbmdzLWZvcm0nKSxcbiAgICAkbGVnYWxOb3RpY2VzRm9ybTogJCgnI215LXByb2ZpbGUtbGVnYWwtbm90aWNlcy1mb3JtJyksXG5cbiAgICAkc2VjdXJpdHlJbmZvcm1hdGlvbk1hc2tlZElucHV0OiAkKCcjYW5zd2VyLCAjYW5zd2VyLWNvbmZpcm0nKSxcbiAgICAkc2VjdXJpdHlJbmZvcm1hdGlvblVzZXJuYW1lOiAkKCcjdXNlck5hbWUnKSxcblxuICAgICRsb3lhbHR5UHJvZ3JhbXNGb3JtOiAkKCcjbXktcHJvZmlsZS1sb3lhbHR5LXByb2dyYW1zLWZvcm0nKSxcbiAgICAkbG95YWx0eVByb2dyYW1zRG9uZUJ1dHRvbjogJCgnLm15LXByb2ZpbGUtbG95YWx0eS1wcm9ncmFtcyAubXktcHJvZmlsZS1zYXZlLWxpbmsnKSxcbiAgICAkbG95YWx0eVByb2dyYW1zUmVtb3ZlQnV0dG9uOiAkKCcubXktcHJvZmlsZS1sb3lhbHR5LXByb2dyYW1zIC5teS1wcm9maWxlLWxveWFsdHktcHJvZ3JhbXMtcmVtb3ZlLWxpbmsnKSxcbiAgICAkbG95YWx0eVByb2dyYW1zTnVtYmVySW5wdXQ6ICQoJyNsb3lhbHR5LXByb2dyYW1zLW51bWJlcicpLFxuXG4gICAgcmFkaW9CdXR0b25Hcm91cFNlbGVjdG9yOiAnLm15LXByb2ZpbGUtcmFkaW8tYnV0dG9uLWdyb3VwJ1xuICB9O1xuXG5cblxuICAvKlxuICAgKiBUdXJuIE9uIGVkaXRhYmxlIG1vZGUgb24gYSBzZWN0aW9uXG4gICAqL1xuICB2YXIgZWRpdFNlY3Rpb24gPSBmdW5jdGlvbiBlZGl0U2VjdGlvbigpIHtcblxuICAgIHZhciAkY2xpY2tlZExpbmsgPSAkKHRoaXMpO1xuICAgIHZhciAkbW9kdWxlID0gJGNsaWNrZWRMaW5rLnBhcmVudHMoY29uZmlnLm1vZHVsZVNlbGVjdG9yKTtcblxuICAgIC8vIFJlaW5zZXJ0IGRhdGEgZm9yIGNvbnRhY3QgaW5mb3JtYXRpb24uXG4gICAgaWYoJG1vZHVsZS5oYXNDbGFzcygnbXktcHJvZmlsZS1jb250YWN0LWluZm9ybWF0aW9uJykpIHtcbiAgICAgIHZhciAkaW5wdXRzID0gJG1vZHVsZS5maW5kKCdpbnB1dCcpO1xuICAgICAgdmFyICRzZWxlY3RzID0gJG1vZHVsZS5maW5kKCdzZWxlY3QnKTtcblxuICAgICAgJGlucHV0cy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAkKHRoaXMpLnZhbCgkKHRoaXMpLmF0dHIoJ3ZhbHVlJykpO1xuICAgICAgfSk7XG5cbiAgICAgICRzZWxlY3RzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxlY3RlZCA9ICQodGhpcykuZGF0YSgndmFsdWUnKTtcbiAgICAgICAgJCh0aGlzKS52YWwoc2VsZWN0ZWQpO1xuICAgICAgICAkKHRoaXMpLnNlbGVjdG1lbnUoJ3JlZnJlc2gnKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIF90b2dnbGVTZWN0aW9uKCRtb2R1bGUsIHRydWUpO1xuICB9O1xuXG5cblxuICAvKlxuICAgKiBTdWJtaXQgYWNjb3VudCBzZWxlY3Rpb24gZm9ybVxuICAgKi9cbiAgdmFyIG9uU3VibWl0QWNjb3VudFNlbGVjdGlvbiA9IGZ1bmN0aW9uIG9uU3VibWl0QWNjb3VudFNlbGVjdGlvbigpIHtcblxuICAgIHZhciAkZXJyb3IgPSAkKHRoaXMpLnBhcmVudHMoJy5tb2R1bGUnKS5maW5kKGNvbmZpZy5mb3JtR3JvdXBFcnJvclNlbGVjdG9yKTtcbiAgICB2YXIgc2VsZWN0aW9uID0gJCh0aGlzKS5zZXJpYWxpemVBcnJheSgpO1xuXG4gICAgaWYoc2VsZWN0aW9uLmxlbmd0aCA9PT0gMCB8fCBzZWxlY3Rpb25bMF0udmFsdWUgPT09ICcnKSB7XG4gICAgICAkZXJyb3IuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAkZXJyb3IudGV4dCgkZXJyb3IuZGF0YSgndGV4dCcpKTtcbiAgICB9XG4gICAgZWxzZSB7XG5cbiAgICAgIHZhciByZWRpcmVjdCA9IHNlbGVjdGlvblswXS52YWx1ZTtcblxuICAgICAgJGVycm9yLmNzcygnZGlzcGxheScsICdub25lJyk7XG4gICAgICAkZXJyb3IudGV4dCgnJyk7XG5cbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcmVkaXJlY3Q7XG4gICAgfVxuICB9O1xuXG4gIC8qXG4gICAqIFN1Ym1pdCBDb250YWN0IEluZm9ybWF0aW9uIGZvcm1cbiAgICovXG4gIHZhciBvblN1Ym1pdENvbnRhY3RJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uIG9uU3VibWl0Q29udGFjdEluZm9ybWF0aW9uKGUpIHtcblxuICAgIHZhciAkZm9ybSA9ICQodGhpcyk7XG4gICAgdmFyIGZvcm1FbGVtZW50cyA9IF9nZXRDb250ZXh0Rm9ybUVsZW1lbnRzKCRmb3JtKTtcbiAgICB2YXIgZm9ybURhdGEgPSBfcGFyc2VJbnB1dHMoZm9ybUVsZW1lbnRzLiRhbGxJbnB1dHMpO1xuICAgIFxuICAgIC8vIGhpZGUgcHJldmlvdXMgZXJyb3JzXG4gICAgX2hpZGVFcnJvcnMoZm9ybUVsZW1lbnRzKTtcblxuICAgIHZhciBpbnZhbGlkRGF0YSA9IF92YWxpZGF0ZUZvcm1EYXRhKGZvcm1EYXRhKTtcblxuICAgIHZhciBlbWFpbCA9IGZvcm1EYXRhLmVNYWlsO1xuICAgIHZhciBjb25maXJtRW1haWwgPSBmb3JtRGF0YVsnZU1haWwtY29uZmlybSddO1xuXG4gICAgaW52YWxpZERhdGEgPSBfdmFsaWRhdGVGaWVsZHNBcmVUaGVTYW1lKGVtYWlsLCBjb25maXJtRW1haWwsIGludmFsaWREYXRhKTtcblxuICAgIGlmKGludmFsaWREYXRhLm51bWJlck9mRXJyb3JzID4gMCkge1xuICAgICAgX3Nob3dFcnJvcnMoZm9ybUVsZW1lbnRzLiRnbG9iYWxNZXNzYWdlLCBpbnZhbGlkRGF0YSk7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gaWYgZXZlcnl0aGluZyBpcyB2YWxpZCBzdWJtaXQgdGhlIGZvcm1cbiAgICAkKHRoaXMpLnRyaWdnZXIoJ2Zvcm06cG9zdCcsIFtfYWpheERvbmUuYmluZCh0aGlzLCBmb3JtRWxlbWVudHMpXSk7XG4gIH07XG5cbiAgLypcbiAgICogU3VibWl0IFNlY3VyaXR5IEluZm9ybWF0aW9uIGZvcm1cbiAgICovXG4gIHZhciBvblN1Ym1pdFNlY3VyaXR5SW5mb3JtYXRpb24gPSBmdW5jdGlvbiBvblN1Ym1pdFNlY3VyaXR5SW5mb3JtYXRpb24oKSB7XG5cbiAgICB2YXIgZm9ybUVsZW1lbnRzID0gX2dldENvbnRleHRGb3JtRWxlbWVudHMoJCh0aGlzKSk7XG4gICAgdmFyIGZvcm1EYXRhID0gX3BhcnNlSW5wdXRzKGZvcm1FbGVtZW50cy4kYWxsSW5wdXRzKTtcblxuICAgIC8vIGhpZGUgcHJldmlvdXMgZXJyb3JzXG4gICAgX2hpZGVFcnJvcnMoZm9ybUVsZW1lbnRzKTtcblxuICAgIHZhciBpbnZhbGlkRGF0YSA9IF92YWxpZGF0ZUZvcm1EYXRhKGZvcm1EYXRhKTtcblxuICAgIHZhciBwYXNzd29yZCA9IGZvcm1EYXRhLnBhc3N3b3JkO1xuICAgIHZhciByZXR5cGVQYXNzd29yZCA9IGZvcm1EYXRhWydwYXNzd29yZC1jb25maXJtJ107XG4gICAgdmFyIGFuc3dlciA9IGZvcm1EYXRhLmFuc3dlcjtcbiAgICB2YXIgcmV0eXBlQW5zd2VyID0gZm9ybURhdGFbJ2Fuc3dlci1jb25maXJtJ107XG5cbiAgICBpbnZhbGlkRGF0YSA9IF92YWxpZGF0ZUZpZWxkc0FyZVRoZVNhbWUocGFzc3dvcmQsIHJldHlwZVBhc3N3b3JkLCBpbnZhbGlkRGF0YSk7XG4gICAgaW52YWxpZERhdGEgPSBfdmFsaWRhdGVGaWVsZHNBcmVUaGVTYW1lKGFuc3dlciwgcmV0eXBlQW5zd2VyLCBpbnZhbGlkRGF0YSk7XG5cbiAgICBpZihpbnZhbGlkRGF0YS5udW1iZXJPZkVycm9ycyA+IDApIHtcbiAgICAgIF9zaG93RXJyb3JzKGZvcm1FbGVtZW50cy4kZ2xvYmFsTWVzc2FnZSwgaW52YWxpZERhdGEpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIGlmIGV2ZXJ5dGhpbmcgaXMgdmFsaWQgc3VibWl0IHRoZSBmb3JtXG4gICAgJCh0aGlzKS50cmlnZ2VyKCdmb3JtOnBvc3QnLCBbX2FqYXhEb25lLmJpbmQodGhpcywgZm9ybUVsZW1lbnRzKV0pO1xuICB9O1xuXG4gIC8qXG4gICAqIFN1Ym1pdCBTZWN1cml0eSBJbmZvcm1hdGlvbiBmb3JtXG4gICAqL1xuICB2YXIgb25TdWJtaXRSYWRpb0J1dHRvbkZvcm0gPSBmdW5jdGlvbiBvblN1Ym1pdFJhZGlvQnV0dG9uRm9ybSgpIHtcblxuICAgIHZhciBmb3JtRWxlbWVudHMgPSBfZ2V0Q29udGV4dEZvcm1FbGVtZW50cygkKHRoaXMpKTtcbiAgICB2YXIgZm9ybURhdGEgPSAkKHRoaXMpLnNlcmlhbGl6ZUFycmF5KCk7XG5cbiAgICBpZihmb3JtRGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKCdtdXN0IHNlbGVjdCBhIHJhZGlvIGJ1dHRvbicpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIGlmIGV2ZXJ5dGhpbmcgaXMgdmFsaWQgc3VibWl0IHRoZSBmb3JtXG4gICAgJCh0aGlzKS50cmlnZ2VyKCdmb3JtOnBvc3QnLCBbX2FqYXhEb25lLmJpbmQodGhpcywgZm9ybUVsZW1lbnRzKV0pO1xuICB9O1xuXG4gIC8qXG4gICAqIFN1Ym1pdCBMb3lhbHR5IFByb2dyYW1zIGZvcm1cbiAgICovXG4gIHZhciBvblN1Ym1pdExveWFsdHlQcm9ncmFtc0Zvcm0gPSBmdW5jdGlvbiBvblN1Ym1pdExveWFsdHlQcm9ncmFtc0Zvcm0oKSB7XG5cbiAgICB2YXIgZm9ybUVsZW1lbnRzID0gX2dldENvbnRleHRGb3JtRWxlbWVudHMoJCh0aGlzKSk7XG4gICAgdmFyIGZvcm1EYXRhID0gX3BhcnNlSW5wdXRzKGZvcm1FbGVtZW50cy4kYWxsSW5wdXRzKTtcblxuICAgIC8vIGhpZGUgcHJldmlvdXMgZXJyb3JzXG4gICAgX2hpZGVFcnJvcnMoZm9ybUVsZW1lbnRzKTtcblxuICAgIHZhciBpbnZhbGlkRGF0YSA9IF92YWxpZGF0ZUZvcm1EYXRhKGZvcm1EYXRhKTtcblxuICAgIGlmKGludmFsaWREYXRhLm51bWJlck9mRXJyb3JzID4gMCkge1xuICAgICAgX3Nob3dFcnJvcnMoZm9ybUVsZW1lbnRzLiRnbG9iYWxNZXNzYWdlLCBpbnZhbGlkRGF0YSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgJCh0aGlzKS50cmlnZ2VyKCdmb3JtOnBvc3QnLCBbX2FqYXhEb25lLmJpbmQodGhpcywgZm9ybUVsZW1lbnRzKV0pO1xuXG4gICAgLy8gZW1wdHkgdGhlIGZvcm1cbiAgICAkKHRoaXMpWzBdLnJlc2V0KCk7XG4gICAgJCh0aGlzKS5maW5kKCdzZWxlY3QnKVswXS5zZWxlY3RlZEluZGV4ID0gMDtcbiAgICAkKHRoaXMpLmZpbmQoJ3NlbGVjdCcpLnNlbGVjdG1lbnUoJ3JlZnJlc2gnKTtcbiAgICAkKHRoaXMpLmZpbmQoJ2lucHV0JykuYXR0cignZGF0YS12YWwnLCAnJyk7XG4gICAgXG4gICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAkKCcuYWpheC1kZWxldGUnKS5vbignY2xpY2snLCBvblJlbW92ZUxveWFsdHlQcm9ncmFtKTtcbiAgICB9LCAxMDApO1xuICB9O1xuXG4gIC8qXG4gICAqIE9uIHJlbW92ZSBsb3lhbHR5IHByb2dyYW1zXG4gICAqL1xuICB2YXIgb25SZW1vdmVMb3lhbHR5UHJvZ3JhbSA9IGZ1bmN0aW9uIG9uUmVtb3ZlTG95YWx0eVByb2dyYW0oZSkge1xuXG4gICAgLy8gcHJldmVudCBmcm9tIHdlaXJkIHJlZGlyZWN0aW9uIHRvIGFqYXggaHRtbFxuICAgIGlmKGUgJiYgZS5wcmV2ZW50RGVmYXVsdCkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cblxuICAgIHZhciAkZm9ybSA9ICQodGhpcykucGFyZW50cygnZm9ybScpO1xuICAgIHZhciBmb3JtRWxlbWVudHMgPSBfZ2V0Q29udGV4dEZvcm1FbGVtZW50cygkZm9ybSk7XG4gICAgX2hpZGVFcnJvcnMoZm9ybUVsZW1lbnRzKTtcblxuICAgICQodGhpcykudHJpZ2dlcignZm9ybTpkZWxldGUnLCBbX2FqYXhEb25lLmJpbmQodGhpcywgZm9ybUVsZW1lbnRzKV0pO1xuICB9O1xuXG4gIC8qXG4gICAqIE9uIGNsaWNrIGZvciB0aGUgc2F2ZSBDVEEgaW4gbG95YWx0eSBwcm9ncmFtc1xuICAgKi9cbiAgdmFyIG9uRG9uZUxveWFsdHlQcm9ncmFtID0gZnVuY3Rpb24gb25Eb25lTG95YWx0eVByb2dyYW0oKSB7XG5cbiAgICB2YXIgJG1vZHVsZSA9ICQodGhpcykucGFyZW50cygnLm1vZHVsZScpO1xuXG4gICAgX3RvZ2dsZVNlY3Rpb24oJG1vZHVsZSwgZmFsc2UpO1xuICAgIF9zaG93R2xvYmFsTWVzc2FnZSgkbW9kdWxlLmZpbmQoY29uZmlnLm1vZHVsZU1lc3NhZ2VzU2VsZWN0b3IpLCAnW0NvbmZpcm1hdGlvbiBNZXNzYWdlIEdvZXMgSGVyZV0nLCAnY29uZmlybWF0aW9uJyk7XG4gIH07XG5cbiAgLypcbiAgICogR2xvYmFsIG9uIGdldCBzdWNjZXNzIGV2ZW50LlxuICAgKi9cbiAgdmFyIG9uR2V0U3VjY2VzcyA9IGZ1bmN0aW9uIG9uR2V0U3VjY2VzcygpIHtcblxuICAgIC8vIExveWFsdHkgUHJvZ3JhbXNcbiAgICB2YXIgJGxveWFsdHlNb2R1bGUgPSAkKCcubXktcHJvZmlsZS1sb3lhbHR5LXByb2dyYW1zJyk7XG5cbiAgICBpZigkbG95YWx0eU1vZHVsZS5sZW5ndGggPiAwKSB7XG4gICAgICB2YXIgJGVkaXRMaW5rID0gJGxveWFsdHlNb2R1bGUuZmluZCgnLnByb2ZpbGUtZWRpdC1saW5rJyk7XG4gICAgICB2YXIgJGxveWFsdHlQcm9ncmFtc1Jvd3MgPSAkbG95YWx0eU1vZHVsZS5maW5kKCcubXktcHJvZmlsZS1sb3lhbHR5LXByb2dyYW1zLXN0YXRpYy10Ym9keSB0cicpO1xuXG4gICAgICBpZigkbG95YWx0eVByb2dyYW1zUm93cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICRlZGl0TGluay50ZXh0KCRsb3lhbHR5TW9kdWxlLmRhdGEoJ2VkaXQnKSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgJGVkaXRMaW5rLnRleHQoJGxveWFsdHlNb2R1bGUuZGF0YSgnYWRkJykpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvKlxuICAgKiBDYW5jZWwgdGhlIGVkaXRzLCB3YXJuIHVzZXIgaWYgYW55IG1vZGlmaWNhdGlvbnMuXG4gICAqL1xuICB2YXIgY2FuY2VsRWRpdHMgPSBmdW5jdGlvbiBjYW5jZWxFZGl0cyhlKSB7XG5cbiAgICB2YXIgJGNsaWNrZWRMaW5rID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgIHZhciAkbW9kdWxlID0gJGNsaWNrZWRMaW5rLnBhcmVudHMoY29uZmlnLm1vZHVsZVNlbGVjdG9yKTtcbiAgICB2YXIgJGZvcm0gPSAkbW9kdWxlLmZpbmQoJ2Zvcm0nKTtcbiAgICB2YXIgdmFsdWVzID0gJGZvcm0uc2VyaWFsaXplQXJyYXkoKTtcbiAgICB2YXIgZm9ybUlzTW9kaWZpZWQgPSBmYWxzZTtcbiAgICBcbiAgICAvLyBDaGVjayBpZiB0aGUgZm9ybSB3YXMgbW9kaWZpZWQuXG4gICAgJC5lYWNoKHZhbHVlcywgZnVuY3Rpb24oaSwgb2JqZWN0KSB7XG4gICAgICBpZihvYmplY3QudmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgICBmb3JtSXNNb2RpZmllZCA9IHRydWU7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgICQoJy5tb2R1bGUnKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAkKHRoaXMpLmF0dHIoJ2FyaWEtaGlkZGVuJywndHJ1ZScpO1xuICAgIH0pO1xuXG4gICAgJG1vZHVsZS5hdHRyKCdhcmlhLWhpZGRlbicsJ2ZhbHNlJyk7XG4gICAgXG4gICAgX3RvZ2dsZVNlY3Rpb24oJG1vZHVsZSwgZmFsc2UpO1xuICB9O1xuXG4gIHZhciBhY2Nlc3NpYmxlUmFkaW9CdXR0b25zID0gZnVuY3Rpb24gYWNjZXNzaWJsZVJhZGlvQnV0dG9ucygpIHtcblxuICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgdmFyICRpbnB1dHMgPSAkdGhpcy5wYXJlbnRzKGNvbmZpZy5yYWRpb0J1dHRvbkdyb3VwU2VsZWN0b3IpLmZpbmQoJ2lucHV0Jyk7XG5cbiAgICAkaW5wdXRzLmF0dHIoJ2FyaWEtY2hlY2tlZCcsICdmYWxzZScpO1xuICAgICR0aGlzLmF0dHIoJ2FyaWEtY2hlY2tlZCcsICd0cnVlJyk7XG4gIH07XG5cblxuICAvKlxuICAgKiBVdGlsIGZ1bmN0aW9uIHRvIHRvZ2dsZSBPbiBvciBPZmYgYSBzZWN0aW9uLlxuICAgKi9cbiAgdmFyIF90b2dnbGVTZWN0aW9uID0gZnVuY3Rpb24gX3RvZ2dsZVNlY3Rpb24oJG1vZHVsZSwgaXNFZGl0YWJsZSkge1xuXG4gICAgdmFyICRlZGl0TGluayA9ICRtb2R1bGUuZmluZChjb25maWcuZWRpdExpbmtTZWxlY3Rvcik7XG4gICAgdmFyICRzdGF0aWNDb250YWluZXIgPSAkbW9kdWxlLmZpbmQoY29uZmlnLnN0YXRpY0NvbnRhaW5lclNlbGVjdG9yKTtcbiAgICB2YXIgJGVkaXRhYmxlQ29udGFpbmVyID0gJG1vZHVsZS5maW5kKGNvbmZpZy5lZGl0YWJsZUNvbnRhaW5lclNlbGVjdG9yKTtcbiAgICB2YXIgJGVycm9ycyA9ICRtb2R1bGUuZmluZChjb25maWcuZm9ybUdyb3VwRXJyb3JTZWxlY3Rvcik7XG4gICAgdmFyICRnbG9iYWxNZXNzYWdlID0gJG1vZHVsZS5maW5kKGNvbmZpZy5tb2R1bGVNZXNzYWdlc1NlbGVjdG9yKTtcbiAgICB2YXIgJG5vdGVzID0gJG1vZHVsZS5maW5kKCcubXktcHJvZmlsZS1mb3JtLW5vdGVzLXJlcXVpcmVkJyk7XG4gICAgdmFyICRmaXJzdElucHV0ID0gJG1vZHVsZS5maW5kKCdwJykuZXEoMCk7XG5cbiAgICBpZihpc0VkaXRhYmxlKSB7XG4gICAgICAkZWRpdGFibGVDb250YWluZXIuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAkZWRpdGFibGVDb250YWluZXIuYXR0cignYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcbiAgICAgICRzdGF0aWNDb250YWluZXIuZXEoMCkuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICRzdGF0aWNDb250YWluZXIuZXEoMCkuYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuICAgICAgJGVkaXRMaW5rLmNzcygnZGlzcGxheScsICdub25lJyk7XG5cbiAgICAgIGlmKCRub3Rlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICRub3Rlcy5hdHRyKCd0YWJpbmRleCcsICctMScpO1xuICAgICAgICAkbm90ZXMuZm9jdXMoKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAkZmlyc3RJbnB1dC5hdHRyKCd0YWJpbmRleCcsICctMScpO1xuICAgICAgICAkZmlyc3RJbnB1dC5mb2N1cygpO1xuICAgICAgfVxuXG4gICAgICBfaGlkZUdsb2JhbE1lc3NhZ2UoJGdsb2JhbE1lc3NhZ2UpO1xuICAgIH1cbiAgICBlbHNlIHtcblxuICAgICAgLy8gUmVzZXRzIGlucHV0IGlmIGFueSB2YWx1ZSB3b3VsZCd2ZSBiZWVuIGVudGVyZWQuXG4gICAgICAkbW9kdWxlLmZpbmQoJ2Zvcm0nKS50cmlnZ2VyKCdyZXNldCcpO1xuICAgICAgJG1vZHVsZS5maW5kKCc6aW5wdXQnKS5ub3QoJzpidXR0b24sIDpzdWJtaXQsIDpyZXNldCwgOmhpZGRlbiwgOmNoZWNrYm94LCA6cmFkaW8nKS52YWwoJycpLnJlbW92ZUNsYXNzKCdlcnJvcicpO1xuICAgICAgJG1vZHVsZS5maW5kKCdzZWxlY3QnKS52YWwoJycpLnJlbW92ZUNsYXNzKCdlcnJvcicpLnNlbGVjdG1lbnUoJ3JlZnJlc2gnKTsgLy8gcmVzZXRzIHNlbGVjdCBpbnB1dCBhbmQgcmVmcmVzaCBqcXVlcnkgdWkgc2VsZWN0XG4gICAgICAkbW9kdWxlLmZpbmQoJzpjaGVja2JveCwgOnJhZGlvJykucHJvcCgnY2hlY2tlZCcsIGZhbHNlKS5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAgICRtb2R1bGUuZmluZCgnLm15LXByb2ZpbGUtcmFkaW8tYnV0dG9uLWdyb3VwIC5teS1wcm9maWxlLWZvcm0tcmFkaW8nKS5lcSgwKS5wcm9wKCdjaGVja2VkJywgdHJ1ZSk7IC8vIHNlbGVjdCBmaXJzdCByYWRpbyBidXR0b24gb2YgYSBncm91cFxuICAgICAgJG1vZHVsZS5maW5kKCcubXktcHJvZmlsZS1tZXNzYWdlcycpLnJlbW92ZUNsYXNzKCdlcnJvciBjb25maXJtYXRpb24nKTtcblxuICAgICAgJG5vdGVzLnJlbW92ZUF0dHIoJ3RhYmluZGV4Jyk7XG5cbiAgICAgICRzdGF0aWNDb250YWluZXIuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAkc3RhdGljQ29udGFpbmVyLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJyk7XG5cbiAgICAgICRlZGl0TGluay5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICRlZGl0YWJsZUNvbnRhaW5lci5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgJGVkaXRhYmxlQ29udGFpbmVyLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcblxuICAgICAgJGVycm9ycy5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAkbW9kdWxlLmZpbmQoJ2gyJykuYXR0cigndGFiaW5kZXgnLCctMScpO1xuICAgICAgICAkbW9kdWxlLmZpbmQoJ2gyJykuZm9jdXMoKTtcbiAgICAgICAgJCgnLm1vZHVsZScpLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAkKHRoaXMpLmF0dHIoJ2FyaWEtaGlkZGVuJywnZmFsc2UnKTtcbiAgICAgICAgfSk7XG4gICAgICB9LCAxKTtcbiAgICAgIFxuICAgICAgX2hpZGVHbG9iYWxNZXNzYWdlKCRnbG9iYWxNZXNzYWdlKTtcbiAgICB9XG5cbiAgICAkKHdpbmRvdykudHJpZ2dlcigncmVzaXplJyk7XG4gIH07XG5cbiAgLypcbiAgICogR2V0IG5lY2Vzc2FyeSBET00gZWxlbWVudHMgZm9yIHNhdmluZyBhIGZvcm1cbiAgICovXG4gIHZhciBfZ2V0Q29udGV4dEZvcm1FbGVtZW50cyA9IGZ1bmN0aW9uIF9nZXRDb250ZXh0Rm9ybUVsZW1lbnRzKCRmb3JtKSB7XG5cbiAgICB2YXIgJG1vZHVsZSA9ICRmb3JtLnBhcmVudHMoY29uZmlnLm1vZHVsZVNlbGVjdG9yKTtcbiAgICB2YXIgJGlucHV0cyA9ICRmb3JtLmZpbmQoJzppbnB1dCcpLm5vdCgnOmJ1dHRvbiwgOnN1Ym1pdCwgOmhpZGRlbiwgOnJlc2V0LCA6Y2hlY2tib3gsIDpyYWRpbycpO1xuICAgIHZhciAkc2VsZWN0cyA9ICRmb3JtLmZpbmQoJ3NlbGVjdCcpO1xuICAgIHZhciAkYWxsSW5wdXRzID0gJGlucHV0cy5hZGQoJHNlbGVjdHMpO1xuXG4gICAgLy8gdG9kbzogUmVmYWN0b3IgcmV0dXJuIGFsbElucHV0cyB0byBpbnB1dHMgb25seS5cbiAgICByZXR1cm4ge1xuICAgICAgJG1vZHVsZTogJG1vZHVsZSxcbiAgICAgICRlcnJvcnM6ICRmb3JtLmZpbmQoY29uZmlnLmZvcm1Hcm91cEVycm9yU2VsZWN0b3IpLFxuICAgICAgJGdsb2JhbE1lc3NhZ2U6ICRtb2R1bGUuZmluZChjb25maWcubW9kdWxlTWVzc2FnZXNTZWxlY3RvciksXG4gICAgICAkYWxsSW5wdXRzOiAkYWxsSW5wdXRzXG4gICAgfTtcbiAgfTtcbiAgXG4gIC8qXG4gICAqIFV0aWwgZnVuY3Rpb24gdG8gcGFyc2UgYSBmb3JtIGEgcmV0dXJuIGEgSlNPTiByZXByZXNlbnRhdGlvbiBvZiB0aGUgaW5wdXRzXG4gICAqL1xuICB2YXIgX3BhcnNlSW5wdXRzID0gZnVuY3Rpb24gX3BhcnNlSW5wdXRzKCRpbnB1dHMpIHtcblxuICAgIHZhciBmb3JtRGF0YSA9IHt9O1xuXG4gICAgJC5lYWNoKCRpbnB1dHMsIGZ1bmN0aW9uKGksIG9iamVjdCkge1xuXG4gICAgICB2YXIgJG9iamVjdCA9ICQob2JqZWN0KTtcbiAgICAgIHZhciBuYW1lID0gJG9iamVjdC5hdHRyKCduYW1lJyk7XG5cbiAgICAgIGZvcm1EYXRhW25hbWVdID0ge307XG4gICAgICBmb3JtRGF0YVtuYW1lXS5uYW1lID0gbmFtZTtcbiAgICAgIGZvcm1EYXRhW25hbWVdLnR5cGUgPSAkb2JqZWN0LmF0dHIoJ3R5cGUnKSB8fCAkb2JqZWN0LmRhdGEoJ3R5cGUnKSB8fCAnc2VsZWN0JztcbiAgICAgIGZvcm1EYXRhW25hbWVdLmRhdGFUeXBlID0gJG9iamVjdC5kYXRhKCd0eXBlJykgfHwgJ3RleHQnO1xuICAgICAgZm9ybURhdGFbbmFtZV0udmFsdWUgPSAkb2JqZWN0LmF0dHIoJ2RhdGEtdmFsJykgfHwgJG9iamVjdC52YWwoKTtcbiAgICAgIGZvcm1EYXRhW25hbWVdLnJlcXVpcmVkID0gJG9iamVjdC5wcm9wKCdyZXF1aXJlZCcpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGZvcm1EYXRhO1xuICB9O1xuXG4gIC8qXG4gICAqIFV0aWwgZnVuY3Rpb24gdG8gY2hlY2sgaWYgZmllbGRzIGlzIHZhbGlkXG4gICAqIFJldHVybjogYW4gYXJyYXkgb2YgaW52YWxpZCBmaWVsZCBuYW1lLlxuICAgKi9cbiAgdmFyIF92YWxpZGF0ZUZvcm1EYXRhID0gZnVuY3Rpb24gX3ZhbGlkYXRlRm9ybURhdGEoZm9ybURhdGEpIHtcblxuICAgIHZhciBpbnZhbGlkRGF0YSA9IHtcbiAgICAgIG51bWJlck9mRXJyb3JzOiAwLFxuICAgICAgaW5wdXRzOiBbXVxuICAgIH07XG5cbiAgICAkLmVhY2goZm9ybURhdGEsIGZ1bmN0aW9uKGksIGRhdGEpIHtcblxuICAgICAgdmFyIGRhdGFUeXBlID0gZGF0YS5kYXRhVHlwZTtcblxuICAgICAgaWYoZGF0YS5yZXF1aXJlZCAmJiBkYXRhLnZhbHVlID09PSAnJykge1xuICAgICAgICBpbnZhbGlkRGF0YS5udW1iZXJPZkVycm9ycyArPSAxO1xuICAgICAgICBpbnZhbGlkRGF0YS5pbnB1dHMucHVzaCh7XG4gICAgICAgICAgXCJuYW1lXCI6IGRhdGEubmFtZSxcbiAgICAgICAgICBcImVycm9yVHlwZVwiOiBcInJlcXVpcmVkXCJcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZihkYXRhVHlwZSA9PT0gJ2VtYWlsJykge1xuICAgICAgICAvLyByZWdleCBlbWFpbCB2YWxpZGF0aW9uXG4gICAgICAgIHZhciBlbWFpbFJlZ2V4ID0gL15bYS16QS1aMC05Ll8lKy1dK0BbYS16QS1aMC05Li1dK1xcLlthLXpBLVpdezIsfSQvZztcblxuICAgICAgICBpZighZW1haWxSZWdleC50ZXN0KGRhdGEudmFsdWUpKSB7XG4gICAgICAgICAgaW52YWxpZERhdGEubnVtYmVyT2ZFcnJvcnMgKz0gMTtcbiAgICAgICAgICBpbnZhbGlkRGF0YS5pbnB1dHMucHVzaCh7XG4gICAgICAgICAgICBcIm5hbWVcIjogZGF0YS5uYW1lLFxuICAgICAgICAgICAgXCJlcnJvclR5cGVcIjogXCJpbnZhbGlkXCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBzaW1wbHkgY2hlY2tzIGlmIHN0cmluZ3MgY29udGFpbnMgb25seSBudW1iZXJzLCBwYXJlbnRoZXNpcyBvciBwbHVzIHNpZ25cbiAgICAgIGlmKGRhdGFUeXBlID09PSAncGhvbmUnKSB7XG4gICAgICAgIHZhciBwaG9uZVJlZ2V4ID0gL15bMC05LStcXHMoKV0qJC87XG4gICAgICAgIGlmKCFwaG9uZVJlZ2V4LnRlc3QoZGF0YS52YWx1ZSkpIHtcbiAgICAgICAgICBpbnZhbGlkRGF0YS5udW1iZXJPZkVycm9ycyArPSAxO1xuICAgICAgICAgIGludmFsaWREYXRhLmlucHV0cy5wdXNoKHtcbiAgICAgICAgICAgIFwibmFtZVwiOiBkYXRhLm5hbWUsXG4gICAgICAgICAgICBcImVycm9yVHlwZVwiOiBcImludmFsaWRcIlxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmKGRhdGFUeXBlID09PSAnemlwJykge1xuICAgICAgICB2YXIgemlwUmVnZXggPS9eW2EtejAtOVxcLVxcIF0rJC9pO1xuICAgICAgICBpZighemlwUmVnZXgudGVzdChkYXRhLnZhbHVlKSkge1xuICAgICAgICAgIGludmFsaWREYXRhLm51bWJlck9mRXJyb3JzICs9IDE7XG4gICAgICAgICAgaW52YWxpZERhdGEuaW5wdXRzLnB1c2goe1xuICAgICAgICAgICAgXCJuYW1lXCI6IGRhdGEubmFtZSxcbiAgICAgICAgICAgIFwiZXJyb3JUeXBlXCI6IFwiaW52YWxpZFwiXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBpbnZhbGlkRGF0YTtcbiAgfTtcblxuICAvKlxuICAgKiBVdGlsIGZ1bmN0aW9uIHRvIGNoZWNrIHR3byBmaWVsZHMgYXJlIHRoZSBzYW1lXG4gICAqIFJldHVybjogdGhlIGluaXRpYWwgbW9kaWZpZWQgYXJyYXkgb2YgaW52YWxpZCB2YWx1ZXNcbiAgICovXG4gIHZhciBfdmFsaWRhdGVGaWVsZHNBcmVUaGVTYW1lID0gZnVuY3Rpb24gX3ZhbGlkYXRlRmllbGRzQXJlVGhlU2FtZShmaWVsZDEsIGZpZWxkMiwgaW52YWxpZERhdGEpIHtcblxuICAgIGlmKGZpZWxkMS52YWx1ZSAhPT0gJycgfHwgZmllbGQyLnZhbHVlICE9PSAnJykge1xuXG4gICAgICBpZihmaWVsZDEudmFsdWUgIT09IGZpZWxkMi52YWx1ZSkge1xuXG4gICAgICAgIHZhciBpbmRleHMgPSBbXTtcblxuICAgICAgICAvLyBSZW1vdmUgcHJldmlvdXMgZXJyb3Igd2l0aCB0aGUgc2FtZSBuYW1lXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW52YWxpZERhdGEuaW5wdXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYgKGludmFsaWREYXRhLmlucHV0c1tpXS5uYW1lID09PSBmaWVsZDEubmFtZSB8fCBpbnZhbGlkRGF0YS5pbnB1dHNbaV0ubmFtZSA9PT0gZmllbGQyLm5hbWUpIHtcbiAgICAgICAgICAgIGluZGV4cy5wdXNoKGkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAodmFyIGogPSBpbmRleHMubGVuZ3RoIC0gMTsgaiA+PSAwOyBqLS0pIHtcbiAgICAgICAgICBpbnZhbGlkRGF0YS5pbnB1dHMuc3BsaWNlKGluZGV4c1tqXSwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGp1c3QgdGhlIG51bWJlciBvZiBlcnJvcnMgYmFzZWQgb24gdGhlIHJlbW92ZWQgZXJyb3JzLlxuICAgICAgICBpbnZhbGlkRGF0YS5udW1iZXJPZkVycm9ycyA9IGludmFsaWREYXRhLm51bWJlck9mRXJyb3JzIC0gaW5kZXhzLmxlbmd0aDtcblxuICAgICAgICAvLyBBZGQgdGhlIG5ldyBlcnJvci5cbiAgICAgICAgaW52YWxpZERhdGEuaW5wdXRzLnB1c2goe1xuICAgICAgICAgIFwibmFtZVwiOiBmaWVsZDEubmFtZSxcbiAgICAgICAgICBcImVycm9yVHlwZVwiOiBcIm5vdC1tYXRjaGluZ1wiXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGludmFsaWREYXRhLmlucHV0cy5wdXNoKHtcbiAgICAgICAgICBcIm5hbWVcIjogZmllbGQyLm5hbWUsXG4gICAgICAgICAgXCJlcnJvclR5cGVcIjogXCJub3QtbWF0Y2hpbmdcIlxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBOb3QgbWF0Y2hpbmcgb25seSBjb3VudCBhcyBvbmUgZXJyb3JzLlxuICAgICAgICBpbnZhbGlkRGF0YS5udW1iZXJPZkVycm9ycyArPSAxO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBUaGlzIGlzIGxlZnQgY29tbWVudCBvdXQgaW4gY2FzZSBNaWNoYWVsIGRlY2lkZSB0aGF0IGlmIDIgZmllbGQgYXJlIHRoZSBzYW1lXG4gICAgICAvLyBidXQgYm90aCBhcmUgaW52YWxpZCBjb3VudHMgb25seSBoYXMgMSBlcnJvci5cbiAgICAgIGVsc2Uge1xuXG4gICAgICAgIHZhciBzYW1lQnV0SW52YWxpZCA9IFtdO1xuXG4gICAgICAgIGZvciAodmFyIGwgPSAwOyBsIDwgaW52YWxpZERhdGEuaW5wdXRzLmxlbmd0aDsgbCsrKSB7XG4gICAgICAgICAgaWYgKGludmFsaWREYXRhLmlucHV0c1tsXS5uYW1lID09PSBmaWVsZDEubmFtZSB8fCBpbnZhbGlkRGF0YS5pbnB1dHNbbF0ubmFtZSA9PT0gZmllbGQyLm5hbWUpIHtcbiAgICAgICAgICAgIHNhbWVCdXRJbnZhbGlkLnB1c2goaW52YWxpZERhdGEuaW5wdXRzW2xdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZihzYW1lQnV0SW52YWxpZC5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICBpbnZhbGlkRGF0YS5udW1iZXJPZkVycm9ycyAtPSAxO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGludmFsaWREYXRhO1xuICB9O1xuXG4gIC8qXG4gICAqIFV0aWwgZnVuY3Rpb24gdG8gc2hvdyBjb25maXJtYXRpb24gbWVzc2FnZSBvZiBhIG1vZHVsZVxuICAgKi9cbiAgdmFyIF9zaG93R2xvYmFsTWVzc2FnZSA9IGZ1bmN0aW9uIF9zaG93R2xvYmFsTWVzc2FnZSgkZ2xvYmFsTWVzc2FnZSwgbWVzc2FnZSwgc3RhdGVDbGFzcykge1xuICAgICRnbG9iYWxNZXNzYWdlLmNzcygnZGlzcGxheScsICdibG9jaycpO1xuICAgICRnbG9iYWxNZXNzYWdlLnRleHQobWVzc2FnZSk7XG4gICAgJGdsb2JhbE1lc3NhZ2UuYXR0cigndGFiaW5kZXgnLCAnLTEnKTtcbiAgICAkZ2xvYmFsTWVzc2FnZS5mb2N1cygpO1xuICAgICRnbG9iYWxNZXNzYWdlLmFkZENsYXNzKHN0YXRlQ2xhc3MpO1xuICB9O1xuXG4gIC8qXG4gICAqIFV0aWwgZnVuY3Rpb24gdG8gc2hvdyBlcnJvcnMgb2YgYSBmb3JtL21vZHVsZVxuICAgKi9cbiAgdmFyIF9zaG93RXJyb3JzID0gZnVuY3Rpb24gX3Nob3dFcnJvcnMoJGdsb2JhbE1lc3NhZ2UsIGludmFsaWREYXRhKSB7XG5cbiAgICAkZ2xvYmFsTWVzc2FnZS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAkZ2xvYmFsTWVzc2FnZS5hZGRDbGFzcygnZXJyb3InKTtcbiAgICBcbiAgICB2YXIgdGV4dCA9ICQucGFyc2VIVE1MKCRnbG9iYWxNZXNzYWdlLmF0dHIoJ2RhdGEtZXJyb3InKSk7XG4gICAgdGV4dFsxXS5pbm5lclRleHQgPSBpbnZhbGlkRGF0YS5udW1iZXJPZkVycm9ycztcbiAgICAkZ2xvYmFsTWVzc2FnZS5hcHBlbmQodGV4dCk7XG4gICAgXG4gICAgJGdsb2JhbE1lc3NhZ2UuYXR0cigndGFiaW5kZXgnLCAnLTEnKTtcbiAgICAkZ2xvYmFsTWVzc2FnZS5mb2N1cygpO1xuXG4gICAgJC5lYWNoKGludmFsaWREYXRhLmlucHV0cywgZnVuY3Rpb24oaSwgaW5wdXQpIHtcbiAgICAgIHZhciAkZXJyb3IgPSAkKCcjJyArIGlucHV0Lm5hbWUgKyAnLWVycm9yJyk7XG4gICAgICB2YXIgJGZpZWxkID0gJCgnIycgKyBpbnB1dC5uYW1lKTtcbiAgICAgIHZhciAkZm9ybUdyb3VwcyA9ICRlcnJvci5wYXJlbnRzKCcubXktcHJvZmlsZS1mb3JtLXNlY3Rpb24nKS5maW5kKCcuZm9ybS1ncm91cCcpO1xuICAgICAgdmFyIGVycm9yUm93TnVtYmVyID0gJGVycm9yLnBhcmVudHMoJy5mb3JtLWdyb3VwJykuaW5kZXgoKTtcblxuICAgICAgaWYoJCh3aW5kb3cpLndpZHRoKCkgPiA3NjcpIHtcbiAgICAgICAgJGZvcm1Hcm91cHMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgc3R5bGVBdHRyID0gJCh0aGlzKS5hdHRyKCdzdHlsZScpO1xuICAgICAgICAgIHZhciBmb3JtR3JvdXBSb3dOdW1iZXIgPSAkKHRoaXMpLmluZGV4KCk7XG4gICAgICAgICAgaWYoZXJyb3JSb3dOdW1iZXIgPT09IGZvcm1Hcm91cFJvd051bWJlcikge1xuICAgICAgICAgICAgaWYoIXN0eWxlQXR0ciB8fCBzdHlsZUF0dHIuaW5kZXhPZignaGVpZ2h0JykgPT09IC0xKSB7XG4gICAgICAgICAgICAgICQodGhpcykuY3NzKCdoZWlnaHQnLCAkZXJyb3Iub3V0ZXJIZWlnaHQodHJ1ZSkgKyAkKHRoaXMpLm91dGVySGVpZ2h0KCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgICRlcnJvci50ZXh0KCRmaWVsZC5kYXRhKGlucHV0LmVycm9yVHlwZSkpO1xuICAgICAgJGZpZWxkLmFkZENsYXNzKCdlcnJvcicpO1xuICAgICAgJGVycm9yLmNzcygnZGlzcGxheScsICdibG9jaycpO1xuICAgIH0pO1xuICB9O1xuXG4gIC8qXG4gICAqIFV0aWwgZnVuY3Rpb24gdG8gaGlkZSBlcnJvcnNcbiAgICovXG4gIHZhciBfaGlkZUVycm9ycyA9IGZ1bmN0aW9uIF9oaWRlRXJyb3JzKGZvcm1FbGVtZW50cykge1xuICAgIGZvcm1FbGVtZW50cy4kZXJyb3JzLmNzcygnZGlzcGxheScsICdub25lJyk7XG4gICAgZm9ybUVsZW1lbnRzLiRhbGxJbnB1dHMucmVtb3ZlQ2xhc3MoJ2Vycm9yJyk7XG4gICAgZm9ybUVsZW1lbnRzLiRtb2R1bGUuZmluZCgnLmZvcm0tZ3JvdXAnKS5yZW1vdmVBdHRyKCdzdHlsZScpO1xuICAgIF9oaWRlR2xvYmFsTWVzc2FnZShmb3JtRWxlbWVudHMuJGdsb2JhbE1lc3NhZ2UpO1xuICB9O1xuXG4gIC8qXG4gICAqIFV0aWwgZnVuY3Rpb24gdG8gaGlkZSBtb2R1bGUgbWVzc2FnZXNcbiAgICovXG4gIHZhciBfaGlkZUdsb2JhbE1lc3NhZ2UgPSBmdW5jdGlvbiBfaGlkZUdsb2JhbE1lc3NhZ2UoJG1lc3NhZ2UpIHtcbiAgICAkbWVzc2FnZS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICRtZXNzYWdlLnRleHQoJycpO1xuICAgICRtZXNzYWdlLnJlbW92ZUNsYXNzKCdjb25maXJtYXRpb24nKTtcbiAgICAkbWVzc2FnZS5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAkbWVzc2FnZS5yZW1vdmVBdHRyKCd0YWJpbmRleCcpO1xuICB9O1xuXG4gIC8qXG4gICAqIEhhbmRsZSB3aGVuIHRoZSBhamF4IGlzIGRvbmVcbiAgICovXG4gIHZhciBfYWpheERvbmUgPSBmdW5jdGlvbiBfYWpheERvbmUoZm9ybUVsZW1lbnRzLCBzdGF0dXMsIGpzb25SZXMsIGlzRHluYW1pYykge1xuXG4gICAgaWYoc3RhdHVzID09PSAnc3VjY2VzcycpIHtcbiAgICAgIGlmKCFpc0R5bmFtaWMpIHtcbiAgICAgICAgX3RvZ2dsZVNlY3Rpb24oZm9ybUVsZW1lbnRzLiRtb2R1bGUsIGZhbHNlKTtcbiAgICAgIH1cblxuICAgICAgX3Nob3dHbG9iYWxNZXNzYWdlKGZvcm1FbGVtZW50cy4kZ2xvYmFsTWVzc2FnZSwganNvblJlcy5zdWNjZXNzLCAnY29uZmlybWF0aW9uJyk7XG5cbiAgICAgIHZhciAkYWpheERlbGV0ZSA9ICQoY29uZmlnLmFqYXhEZWxldGVTZWxlY3Rvcik7XG4gICAgICAkYWpheERlbGV0ZS5vbignY2xpY2snLCBvblJlbW92ZUxveWFsdHlQcm9ncmFtKTtcblxuICAgICAgaW5pdExpc3RzKCk7XG4gICAgICAkKHdpbmRvdykudHJpZ2dlcigncmVzaXplJyk7XG4gICAgfVxuXG4gICAgaWYgKHN0YXR1cyA9PT0gJ2Vycm9yJykge1xuICAgICAgX2hpZGVHbG9iYWxNZXNzYWdlKGZvcm1FbGVtZW50cy4kZ2xvYmFsTWVzc2FnZSk7XG4gICAgICBfc2hvd0dsb2JhbE1lc3NhZ2UoZm9ybUVsZW1lbnRzLiRnbG9iYWxNZXNzYWdlLCBqc29uUmVzLmVycm9yLCAnZXJyb3InKTtcbiAgICB9XG4gIH07XG5cbiAgLypcbiAgICogVW5tYXNrIHRoZSBkYXRhLlxuICAgKi9cbiAgdmFyIF91bm1hc2tEYXRhID0gIGZ1bmN0aW9uIF91bm1hc2tEYXRhKCkge1xuXG4gICAgdmFyICRpbnB1dCA9ICQodGhpcyk7XG5cbiAgICB2YXIgdW5tYXNrVmFsdWUgPSAkaW5wdXQuYXR0cignZGF0YS12YWwnKSB8fCAnJztcblxuICAgIGlmKCRpbnB1dC5hdHRyKCdkYXRhLXZhbCcpKSB7XG4gICAgICB1bm1hc2tWYWx1ZSA9IHVubWFza1ZhbHVlLnJlcGxhY2UoL1tcXFtcXF1dKy9nLCAnJyk7XG4gICAgfVxuXG4gICAgdW5tYXNrVmFsdWUgPSB1bm1hc2tWYWx1ZS50cmltKCk7XG4gICAgJGlucHV0LnZhbCh1bm1hc2tWYWx1ZSk7XG4gIH07XG5cbiAgLypcbiAgICogTWFzayB0aGUgdXNlcm5hbWUgaW5wdXQgaW4gc2VjdXJpdHkgaW5mb3JtYXRpb24uXG4gICAqIFJlc3VsdCBzaG91bGQgYmVcbiAgICogIC0gMTIzNFxuICAgKiAgLSAxMio0NVxuICAgKiAgLSAxMioqKioqODlcbiAgICovXG4gIHZhciBfbWFza1VzZXJuYW1lID0gZnVuY3Rpb24gX21hc2tVc2VybmFtZSgpIHtcblxuICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpO1xuICAgIHZhciBlbnRlcmVkVmFsdWUgPSAkaW5wdXQudmFsKCkudHJpbSgpO1xuICAgIHZhciBtYXNrZWRWYWx1ZSA9ICcnO1xuICAgIHZhciBudW1iZXJPZlN0YXJzID0gMDtcblxuICAgICRpbnB1dC5hdHRyKCdkYXRhLXZhbCcsIGVudGVyZWRWYWx1ZSk7XG5cbiAgICAvLyBEb24ndCBtYXNrIGlmIGxlc3MgdGhhbiA1IGNoYXIuXG4gICAgaWYoZW50ZXJlZFZhbHVlLmxlbmd0aCA8PSAyKSB7XG4gICAgICBtYXNrZWRWYWx1ZSA9IGVudGVyZWRWYWx1ZTtcbiAgICB9XG4gICAgZWxzZSBpZihlbnRlcmVkVmFsdWUubGVuZ3RoID4gMiAmJiBlbnRlcmVkVmFsdWUubGVuZ3RoIDwgNSkge1xuICAgICAgbnVtYmVyT2ZTdGFycyA9IGVudGVyZWRWYWx1ZS5sZW5ndGggLSAyO1xuICAgICAgbWFza2VkVmFsdWUgPSBlbnRlcmVkVmFsdWUuc3Vic3RyKDAsIDIpICsgbmV3IEFycmF5KG51bWJlck9mU3RhcnMgKyAxKS5qb2luKCcqJyk7XG4gICAgfVxuICAgIC8vIE1hc2sgdGhlIG1pZGRsZSBjaGFyIGlmIHN0cmluZyBpcyA1IGNoYXIgbG9uZy5cbiAgICBlbHNlIGlmKGVudGVyZWRWYWx1ZS5sZW5ndGggPT09IDUpIHtcbiAgICAgIG1hc2tlZFZhbHVlID0gZW50ZXJlZFZhbHVlLnN1YnN0cigwLCAyKSArICcqJyArIGVudGVyZWRWYWx1ZS5zdWJzdHIoMywgZW50ZXJlZFZhbHVlLmxlbmd0aCk7XG4gICAgfVxuICAgIC8vIEtlZXAgdGhlIGZpcnN0IGFuZCB0aGUgbGFzdCAyIGNoYXIgYW5kIGFkZCBhcHByb3ByaWF0ZSBhbW91bnQgb2Ygc3RhcnMuXG4gICAgZWxzZSB7XG4gICAgICBudW1iZXJPZlN0YXJzID0gZW50ZXJlZFZhbHVlLmxlbmd0aCAtIDQ7XG4gICAgICB2YXIgYmVnaW5uaW5nID0gZW50ZXJlZFZhbHVlLnN1YnN0cigwLCAyKTtcbiAgICAgIHZhciBlbmRpbmcgPSBlbnRlcmVkVmFsdWUuc3Vic3RyKGVudGVyZWRWYWx1ZS5sZW5ndGggLSAyLCBlbnRlcmVkVmFsdWUubGVuZ3RoKTtcbiAgICAgIHZhciBzdGFycyA9IG5ldyBBcnJheShudW1iZXJPZlN0YXJzICsgMSkuam9pbignKicpO1xuICAgICAgbWFza2VkVmFsdWUgPSBiZWdpbm5pbmcgKyBzdGFycyArIGVuZGluZztcbiAgICB9XG5cbiAgICAkaW5wdXQudmFsKG1hc2tlZFZhbHVlKTtcbiAgfTtcblxuICAvKlxuICAgKiBNYXNrIHRoZSBlbWFpbCBpbnB1dCBpbiBjb250YWN0IGluZm9ybWF0aW9uLlxuICAgKiBSZXN1bHQgc2hvdWxkIGJlXG4gICAqICAtIGFAY2l0aS5jb21cbiAgICogIC0gYSpAY2l0aS5jb21cbiAgICogIC0gYSoqQCBjaXRpLmNvbVxuICAgKiAgLSBhKiozQGNpdGkuY29tXG4gICAqICAtIGEqKioqKjNAY2l0aS5jb21cbiAgICovXG4gIHZhciBfbWFza0VtYWlsID0gZnVuY3Rpb24gX21hc2tFbWFpbCgpIHtcblxuICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpO1xuICAgIHZhciBtYXNrZWRWYWx1ZSA9ICcnO1xuICAgIHZhciBlbnRlcmVkVmFsdWUgPSB7XG4gICAgICBjb21wbGV0ZTogJGlucHV0LnZhbCgpLnRyaW0oKSxcbiAgICAgIGxvY2FsOiAnJyxcbiAgICAgIGRvbWFpbjogJydcbiAgICB9O1xuXG4gICAgJGlucHV0LmF0dHIoJ2RhdGEtdmFsJywgZW50ZXJlZFZhbHVlLmNvbXBsZXRlKTtcblxuICAgIHZhciBhdENoYXIgPSBlbnRlcmVkVmFsdWUuY29tcGxldGUuaW5kZXhPZignQCcpO1xuICAgIGVudGVyZWRWYWx1ZS5sb2NhbCA9IGVudGVyZWRWYWx1ZS5jb21wbGV0ZS5zdWJzdHIoJzAnLCBhdENoYXIpO1xuICAgIGVudGVyZWRWYWx1ZS5kb21haW4gPSBlbnRlcmVkVmFsdWUuY29tcGxldGUuc3Vic3RyKGF0Q2hhciwgZW50ZXJlZFZhbHVlLmNvbXBsZXRlLmxlbmd0aCk7XG5cblxuICAgIHZhciBmaXJzdENoYXIgPSBlbnRlcmVkVmFsdWUubG9jYWwuc3Vic3RyKDAsIDEpO1xuICAgIHZhciBsYXN0Q2hhciA9IGVudGVyZWRWYWx1ZS5sb2NhbC5zdWJzdHIoYXRDaGFyIC0gMSwgYXRDaGFyKTtcbiAgICB2YXIgc3RhcnMgPSBudWxsO1xuXG4gICAgLy8gRG9uJ3QgbWFzayBmb3IgMSBjaGFyXG4gICAgaWYgKGVudGVyZWRWYWx1ZS5sb2NhbC5sZW5ndGggPD0gMSkge1xuICAgICAgbWFza2VkVmFsdWUgPSBlbnRlcmVkVmFsdWUuY29tcGxldGU7XG4gICAgfVxuICAgIC8vIEZvciAyIGFuZCAzIGNoYXIsIGxlYXZlIHRoZSBmaXJzdCBjaGFyIHVubWFza1xuICAgIGVsc2UgaWYgKGVudGVyZWRWYWx1ZS5sb2NhbC5sZW5ndGggPD0gMykge1xuICAgICAgc3RhcnMgPSBuZXcgQXJyYXkoZW50ZXJlZFZhbHVlLmxvY2FsLmxlbmd0aCkuam9pbignKicpO1xuICAgICAgbWFza2VkVmFsdWUgPSBmaXJzdENoYXIgKyBzdGFycyArIGVudGVyZWRWYWx1ZS5kb21haW47XG4gICAgfVxuICAgIC8vIExlYXZlIGZpcnN0IGFuZCBsYXN0IGxvY2FsIGNoYXIgdW5tYXNrLCBtYXNrIHRoZSByZXN0IG9mIHRoZSBsb2NhbCBwYXJ0LlxuICAgIGVsc2UgaWYgKGVudGVyZWRWYWx1ZS5sb2NhbC5sZW5ndGggPj0gNCkge1xuICAgICAgc3RhcnMgPSBuZXcgQXJyYXkoZW50ZXJlZFZhbHVlLmxvY2FsLmxlbmd0aCAtIDEpLmpvaW4oJyonKTtcbiAgICAgIG1hc2tlZFZhbHVlID0gZmlyc3RDaGFyICsgc3RhcnMgKyBsYXN0Q2hhciArIGVudGVyZWRWYWx1ZS5kb21haW47XG4gICAgfVxuXG4gICAgJGlucHV0LnZhbChtYXNrZWRWYWx1ZSk7XG4gIH07XG5cbiAgLypcbiAgICogTWFzayB0aGUgcGhvbmUgbnVtYmVyIGluIGNvbnRhY3QgaW5mb3JtYXRpb25cbiAgICogUmVzdWx0IHNob3VsZCBiZVxuICAgKiAtICoqKi0qKiotMTExMVxuICAgKiAtICgqKiopICoqKiAtIDExMTFcbiAgICogLSAqKioxMTExXG4gICAqIC0gKioqKioqMTExMVxuICAgKiAtIDExMTFcbiAgICogLSAqMTExMVxuICAgKi9cbiAgdmFyIF9tYXNrUGhvbmVOdW1iZXIgPSBmdW5jdGlvbiBfbWFza1Bob25lTnVtYmVyKCkge1xuXG4gICAgdmFyICRpbnB1dCA9ICQodGhpcyk7XG4gICAgdmFyIHJlcGxhY2VSZWdleCA9IC8oWzAtOWEtekEtWl0pL2c7XG4gICAgdmFyIGVudGVyZWRWYWx1ZSA9IHtcbiAgICAgIGNvbXBsZXRlOiAkaW5wdXQudmFsKCkudHJpbSgpLFxuICAgICAgYmVnaW5uaW5nOiAnJyxcbiAgICAgIGVuZGluZzogJydcbiAgICB9O1xuXG4gICAgdmFyIG1hc2tlZFZhbHVlID0gZW50ZXJlZFZhbHVlLmNvbXBsZXRlO1xuICAgICRpbnB1dC5hdHRyKCdkYXRhLXZhbCcsIGVudGVyZWRWYWx1ZS5jb21wbGV0ZSk7XG5cbiAgICBpZihlbnRlcmVkVmFsdWUuY29tcGxldGUubGVuZ3RoID4gNCkge1xuICAgICAgZW50ZXJlZFZhbHVlLmJlZ2lubmluZyA9IGVudGVyZWRWYWx1ZS5jb21wbGV0ZS5zdWJzdHIoMCwgZW50ZXJlZFZhbHVlLmNvbXBsZXRlLmxlbmd0aCAtIDQpO1xuICAgICAgZW50ZXJlZFZhbHVlLmVuZGluZyA9IGVudGVyZWRWYWx1ZS5jb21wbGV0ZS5zdWJzdHIoZW50ZXJlZFZhbHVlLmNvbXBsZXRlLmxlbmd0aCAtIDQsIGVudGVyZWRWYWx1ZS5jb21wbGV0ZS5sZW5ndGgpO1xuICAgICAgbWFza2VkVmFsdWUgPSBlbnRlcmVkVmFsdWUuYmVnaW5uaW5nLnJlcGxhY2UocmVwbGFjZVJlZ2V4LCAnKicpICsgZW50ZXJlZFZhbHVlLmVuZGluZztcbiAgICB9XG5cbiAgICAkaW5wdXQudmFsKG1hc2tlZFZhbHVlKTtcbiAgfTtcblxuICAvKlxuICAgKiBNYXNrIHRoZSBsb3lhbHR5IHByb2dyYW0gbnVtYmVyXG4gICAqIFJlc3VsdCBzaG91bGQgYmVcbiAgICogLSAqKioqKioqKioqQUJDRFxuICAgKiAtICoqKkFCQ0RcbiAgICogLSBBQkNEXG4gICAqL1xuICB2YXIgX21hc2tMb3lhbHR5UHJvZ3JhbU51bWJlciA9IGZ1bmN0aW9uIF9tYXNrTG95YWx0eVByb2dyYW1OdW1iZXIoKSB7XG5cbiAgICB2YXIgJGlucHV0ID0gJCh0aGlzKTtcbiAgICB2YXIgZW50ZXJlZFZhbHVlID0ge1xuICAgICAgY29tcGxldGU6ICRpbnB1dC52YWwoKSxcbiAgICAgIGJlZ2lubmluZzogJycsXG4gICAgICBlbmRpbmc6ICcnXG4gICAgfTtcblxuICAgICRpbnB1dC5hdHRyKCdkYXRhLXZhbCcsIGVudGVyZWRWYWx1ZS5jb21wbGV0ZSk7XG5cbiAgICBpZihlbnRlcmVkVmFsdWUuY29tcGxldGUubGVuZ3RoID4gNCkge1xuICAgICAgZW50ZXJlZFZhbHVlLmJlZ2lubmluZyA9IGVudGVyZWRWYWx1ZS5jb21wbGV0ZS5zdWJzdHIoMCwgZW50ZXJlZFZhbHVlLmNvbXBsZXRlLmxlbmd0aCAtIDQpO1xuICAgICAgZW50ZXJlZFZhbHVlLmVuZGluZyA9IGVudGVyZWRWYWx1ZS5jb21wbGV0ZS5zdWJzdHIoZW50ZXJlZFZhbHVlLmNvbXBsZXRlLmxlbmd0aCAtIDQsIGVudGVyZWRWYWx1ZS5jb21wbGV0ZS5sZW5ndGgpO1xuICAgICAgJGlucHV0LnZhbChuZXcgQXJyYXkoZW50ZXJlZFZhbHVlLmJlZ2lubmluZy5sZW5ndGggKyAxKS5qb2luKCcqJykgKyBlbnRlcmVkVmFsdWUuZW5kaW5nKTtcbiAgICB9XG4gIH07XG5cbiAgLypcbiAgICogSW5pdCB0aGUgYWNjZXNzaWJsZSBsaXN0XG4gICAqL1xuICB2YXIgaW5pdExpc3RzID0gZnVuY3Rpb24gaW5pdExpc3RzKCkge1xuXG4gICAgJCgnLnByb2ZpbGUtY29udGFjdC1pbmZvcm1hdGlvbi1saXN0JykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgIHZhciBsaXN0ID0gY2l0aVNoYXJlLmFjY2Vzc2libGVNdWx0aUNvbHVtbkxpc3QodGhpcywgMyk7XG4gICAgICBsaXN0LmluaXQoKTtcbiAgICAgIGNvbmZpZy5jb250YWN0SW5mb3JtYXRpb25MaXN0cy5wdXNoKGxpc3QpO1xuICAgIH0pO1xuXG4gICAgY2l0aVNoYXJlLmFjY2Vzc2libGVNdWx0aUNvbHVtbkxpc3QoJy5wcm9maWxlLXNlY3VyaXR5LWluZm9ybWF0aW9uLWxpc3QnLCAzKS5pbml0KCk7XG4gIH07XG5cbiAgLypcbiAgICogQWRkIGZ1bmN0aW9uYWxpdHkgdG8gdGhlIHNlbGVjdCBzbyB0aGV5IG9wZW4gd2hlbiBwcmVzc2luZyBlbnRlclxuICAgKi9cbiAgdmFyIG9uRW50ZXJTZWxlY3QgPSBmdW5jdGlvbiBvbkVudGVyU2VsZWN0KGUpIHtcblxuICAgIGlmKGUud2hpY2ggPT09IDEzKSB7XG5cbiAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgICB2YXIgc2VsZWN0ID0gJHRoaXMucHJldignc2VsZWN0Jyk7XG5cbiAgICAgIGlmKCQodGhpcykuYXR0cignYXJpYS1leHBhbmRlZCcpID09PSAnZmFsc2UnKSB7XG5cbiAgICAgICAgc2VsZWN0LnNlbGVjdG1lbnUoJ29wZW4nKTtcblxuICAgICAgICAvLyBVbmJpbmQgZXZlbnQgYW5kIHJlYmluZCBvbiBjbG9zZS5cbiAgICAgICAgLy8gVGhpcyBpcyBkb25lIGJlY2F1c2UgdGhlIGJlaGF2aW9yIG9uIHRoZSBlbnRlciBrZXkgd2hlbiB0aGUgZHJvcGRvd25cbiAgICAgICAgLy8gaXMgb3BlbiBpcyBhbHJlYWR5IHRha2VuIGNhcmUgYnkgdGhlIHBsdWdpbi5cbiAgICAgICAgJHRoaXMub2ZmKCdrZXlkb3duLmVudGVyJyk7XG4gICAgICAgIHNlbGVjdC5vbignc2VsZWN0bWVudWNsb3NlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJHRoaXMub24oJ2tleWRvd24uZW50ZXInLCBvbkVudGVyU2VsZWN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIC8qXG4gICAqIEluaXQgdGhlIGNpdGlTaGFyZS5wcm9maWxlIGNvZGUuXG4gICAqIEJhc2ljYWxseSBiaW5kIGFsbCBuZWNlc3NhcnkgZXZlbnRzLlxuICAgKi9cbiAgdmFyIGluaXQgPSBmdW5jdGlvbiBpbml0ICgpIHtcblxuICAgIC8vIFRvZ2dsaW5nIHNlY3Rpb24gZnVuY3Rpb25hbGl0eVxuICAgIGNvbmZpZy4kZWRpdExpbmtzLmNsaWNrKGVkaXRTZWN0aW9uKTtcbiAgICBjb25maWcuJGNhbmNlbExpbmtzLmNsaWNrKGNhbmNlbEVkaXRzKTtcblxuICAgIC8vIFN1Ym1pdCBldmVudHNcbiAgICBjb25maWcuJGFjY291bnRTZWxlY3Rpb25Gb3JtLm9uKCdzdWJtaXQnLCBvblN1Ym1pdEFjY291bnRTZWxlY3Rpb24pO1xuICAgIGNvbmZpZy4kY29udGFjdEluZm9ybWF0aW9uRm9ybS5vbignc3VibWl0Jywgb25TdWJtaXRDb250YWN0SW5mb3JtYXRpb24pO1xuICAgIGNvbmZpZy4kc2VjdXJpdHlJbmZvcm1hdGlvbkZvcm0ub24oJ3N1Ym1pdCcsIG9uU3VibWl0U2VjdXJpdHlJbmZvcm1hdGlvbik7XG4gICAgY29uZmlnLiRlbWFpbFNldHRpbmdzRm9ybS5vbignc3VibWl0Jywgb25TdWJtaXRSYWRpb0J1dHRvbkZvcm0pO1xuICAgIGNvbmZpZy4kbGVnYWxOb3RpY2VzRm9ybS5vbignc3VibWl0Jywgb25TdWJtaXRSYWRpb0J1dHRvbkZvcm0pO1xuICAgIGNvbmZpZy4kbG95YWx0eVByb2dyYW1zRm9ybS5vbignc3VibWl0Jywgb25TdWJtaXRMb3lhbHR5UHJvZ3JhbXNGb3JtKTtcbiAgICBjb25maWcuJGxveWFsdHlQcm9ncmFtc0RvbmVCdXR0b24ub24oJ2NsaWNrJywgb25Eb25lTG95YWx0eVByb2dyYW0pO1xuXG4gICAgLy8gcHJldmVudCBmb3JtIHN1Ym1pc3Npb24gb24gZW50ZXJcbiAgICAkKCcubXktcHJvZmlsZSBmb3JtJykub24oJ2tleXByZXNzJywgZnVuY3Rpb24oZSkge1xuICAgICAgcmV0dXJuIGUud2hpY2ggIT09IDEzO1xuICAgIH0pO1xuXG4gICAgLy8gYWxsb3cgZm9ybSBzdWJtaXNzaW9uIG9uIHN1Ym1pdCBidXR0b24gZW50ZXJcbiAgICAkKCcubXktcHJvZmlsZSBmb3JtIGlucHV0W3R5cGU9c3VibWl0XScpLm9uKCdrZXlwcmVzcycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGlmKGUud2hpY2ggPT09IDEzKSB7XG4gICAgICAgICQodGhpcykucGFyZW50cygnZm9ybScpLnRyaWdnZXIoJ3N1Ym1pdCcpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgJChjb25maWcuYWpheERlbGV0ZVNlbGVjdG9yKS5vbignY2xpY2snLCBvblJlbW92ZUxveWFsdHlQcm9ncmFtKTtcblxuICAgIC8vIFNlY3VyaXR5IGFuc3dlciBzaG93L2hpZGUgdGV4dCBmdW5jdGlvbmFsaXR5XG4gICAgY29uZmlnLiRzZWN1cml0eUluZm9ybWF0aW9uTWFza2VkSW5wdXQuZm9jdXMoZnVuY3Rpb24oKSB7XG4gICAgICAkKHRoaXMpLmF0dHIoJ3R5cGUnLCAndGV4dCcpO1xuICAgIH0pO1xuXG4gICAgY29uZmlnLiRzZWN1cml0eUluZm9ybWF0aW9uTWFza2VkSW5wdXQuYmx1cihmdW5jdGlvbigpIHtcbiAgICAgICQodGhpcykuYXR0cigndHlwZScsICdwYXNzd29yZCcpO1xuICAgIH0pO1xuXG4gICAgY29uZmlnLiRzZWN1cml0eUluZm9ybWF0aW9uVXNlcm5hbWUuZm9jdXMoX3VubWFza0RhdGEpO1xuICAgIGNvbmZpZy4kc2VjdXJpdHlJbmZvcm1hdGlvblVzZXJuYW1lLmJsdXIoX21hc2tVc2VybmFtZSk7XG5cbiAgICBjb25maWcuJGNvbnRhY3RJbmZvcm1hdGlvbkVtYWlsSW5wdXQuZm9jdXMoX3VubWFza0RhdGEpO1xuICAgIGNvbmZpZy4kY29udGFjdEluZm9ybWF0aW9uRW1haWxJbnB1dC5ibHVyKF9tYXNrRW1haWwpO1xuXG4gICAgY29uZmlnLiRjb250YWN0SW5mb3JtYXRpb25QaG9uZXNJbnB1dC5mb2N1cyhfdW5tYXNrRGF0YSk7XG4gICAgY29uZmlnLiRjb250YWN0SW5mb3JtYXRpb25QaG9uZXNJbnB1dC5ibHVyKF9tYXNrUGhvbmVOdW1iZXIpO1xuXG4gICAgY29uZmlnLiRsb3lhbHR5UHJvZ3JhbXNOdW1iZXJJbnB1dC5mb2N1cyhfdW5tYXNrRGF0YSk7XG4gICAgY29uZmlnLiRsb3lhbHR5UHJvZ3JhbXNOdW1iZXJJbnB1dC5ibHVyKF9tYXNrTG95YWx0eVByb2dyYW1OdW1iZXIpO1xuXG4gICAgLy8gQWNjZXNzaWJsZSByYWRpbyBidXR0b25zXG4gICAgJChjb25maWcucmFkaW9CdXR0b25Hcm91cFNlbGVjdG9yICsgJyBpbnB1dCcpLm9uKCdjbGljaycsIGFjY2Vzc2libGVSYWRpb0J1dHRvbnMpO1xuXG4gICAgLy8gQWRkIG9wZW4gb24gZW50ZXIgZm9yIHNlbGVjdCBtZW51XG4gICAgJCgnLmRyb3Bkb3duJykuZmluZCgnLnVpLXNlbGVjdG1lbnUtYnV0dG9uJykub24oJ2tleWRvd24uZW50ZXInLCBvbkVudGVyU2VsZWN0KTtcbiAgICAkKCcuZHJvcGRvd24gc2VsZWN0Jykuc2VsZWN0bWVudSgncmVmcmVzaCcpO1xuXG4gICAgLy8gT24gYWpheCBnZXQgc3VjY2Vzcy5cbiAgICAkKGRvY3VtZW50KS5vbignZ2V0LnN1Y2Nlc3MnLCBvbkdldFN1Y2Nlc3MpO1xuXG4gICAgLy8gQWNjZXNzaWJsZSBsaXN0cy5cbiAgICBpbml0TGlzdHMoKTtcbiAgfTtcblxuICBpZigkKCcubXktcHJvZmlsZScpLmxlbmd0aCA+IDApIHtcbiAgICBpbml0KCk7XG4gIH1cblxufSkoKTtcbiIsIi8qanNoaW50IGRlYnVnOnRydWUgKi9cblxuY2l0aVNoYXJlLnF1aWNrVmlldyA9IChmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvKipcbiAgICpcbiAgICovXG4gIGZ1bmN0aW9uIG9wZW5EcmF3ZXIoKSB7XG5cbiAgICAvLyBzaGlmdCBmb2N1cyB0byBxdWlja3ZpZXcgYW5kIGxvY2sgdGhlIGtleWJvYXJkIHVzZXIgaW5cbiAgICAkKFwiLmpzLXByb2R1Y3QtZGV0YWlsLW1vZHVsZVwiKS5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgY2l0aVNoYXJlLnV0aWwudHJhcFRhYktleSgkKCcuanMtcHJvZHVjdC1kZXRhaWwtbW9kdWxlJyksIGV2ZW50KTtcbiAgICAgIGNpdGlTaGFyZS51dGlsLnRyYXBFc2NhcGVLZXkoJCgnLmpzLXByb2R1Y3QtZGV0YWlsLW1vZHVsZScpLCBldmVudCk7XG4gICAgfSk7XG5cbiAgICAkKCcuanMtcHJvZHVjdC1saXN0LXBsYWNlaG9sZGVyJykub24oXCJjbGlja1wiLCBcIi5xdWlja3ZpZXctbGFiZWxcIiwgZnVuY3Rpb24gKCkge1xuXG4gICAgICAvLyBJdGVtcyBwZXIgcm93XG4gICAgICB2YXIgcHJvZHVjdElkID0gJCh0aGlzKS5jbG9zZXN0KCcucHJvZHVjdC1saXN0LWl0ZW0nKS5kYXRhKCdwcm9kdWN0LWlkJyk7XG5cblxuICAgICAgLy8gQ2xlYW4gdXAgYW55IGFjdGl2ZSBkcmF3ZXJcbiAgICAgIC8vIFRPRE86IFNob3cgd2hlbiBhamF4IGlzIGRvbmUgOlxuICAgICAgJCgnLnByb2R1Y3QtZGV0YWlsLnF1aWNrLXZpZXcnKS5yZW1vdmVDbGFzcygnaXMtYWN0aXZlJyk7XG4gICAgICBjbG9zZURyYXdlcigkKHRoaXMpKTtcblxuICAgICAgLy8gQWRkIFwiYWN0aXZlXCIgY2xhc3MgdG8gcGFyZW50IGRpdlxuICAgICAgJCh0aGlzKS5wYXJlbnQoKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcblxuXG4gICAgICAvLyBUT0RPOiBJbnNlcnQgYWpheCBoZXJlXG4gICAgICAkKCcuanMtcHJvZHVjdC1kZXRhaWwtbW9kdWxlJykuZW1wdHkoKTtcbiAgICAgIGNpdGlTaGFyZS5nZXRQcm9kdWN0RGV0YWlsSXRlbSgkKCcuanMtcHJvZHVjdC1kZXRhaWwtbW9kdWxlJyksICcjanMtcHJvZHVjdC1kZXRhaWwtdGVtcGxhdGUnLCB3aW5kb3cuanNvbiwgcHJvZHVjdElkLCBpbml0UXVpY2t2aWV3TW9kYWwuYmluZCgkKHRoaXMpKSk7XG5cbiAgICAgIGxvY2tRdWlja1ZpZXdUb1BsYWNlaG9sZGVyKCk7XG5cblxuICAgIH0pO1xuXG4gIH1cblxuICBmdW5jdGlvbiBpbml0UXVpY2t2aWV3TW9kYWwoKSB7XG4gICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgIC8vIGZvcmNpbmcganNoaW50IHRvIHZhbGlkYXRlIHVzZSBvZiAndGhpcycga2V5d29yZCB3aXRoaW4gdGhpcyBmdW5jdGlvblxuICAgIC8vIGJlY2F1c2Ugd2UgbmVlZCB0byBtYWludGFpbiBzY29wZSBhcyB3ZSdyZSBwYXNzaW5nIHRoaXMgYXMgYSBjYWxsYmFja1xuICAgIC8vIHRvIGNpdGlTaGFyZS5nZXRQcm9kdWN0RGV0YWlsSXRlbVxuXG4gICAgLy8gSXRlbXMgcGVyIHJvd1xuICAgIHZhciAkcXVpY2tWaWV3QnV0dG9uID0gJCh0aGlzKSxcbiAgICAgIHBlclJvdyA9IDMsXG4gICAgICBjdXJyZW50Q29udGFpbmVySW5kZXggPSAkcXVpY2tWaWV3QnV0dG9uLmNsb3Nlc3QoJy5wcm9kdWN0LWxpc3QtaXRlbScpLmluZGV4KCcucHJvZHVjdC1saXN0LWl0ZW0nKSArIDEsXG4gICAgICBjdXJyZW50Um93RW5kSW5kZXggPSBmaW5kTmV4dFJvd0JyZWFrKGN1cnJlbnRDb250YWluZXJJbmRleCwgcGVyUm93KSAtIDE7XG5cbiAgICAvLyBDaGVjayBmb3IgZmlsdGVyIGhlaWdodFxuICAgIHZhciBmaWx0ZXJIZWlnaHQgPSAkKFwiLmZpbHRlci1zdGlja3ktd3JhcHBlclwiKS5vdXRlckhlaWdodCgpO1xuXG4gICAgY2l0aVNoYXJlLmNyZWF0ZVpvb20oKTtcbiAgICBjaXRpU2hhcmUuY3JlYXRlVGFicygpO1xuICAgIGNpdGlTaGFyZS5jcmVhdGVUb29sdGlwcygpO1xuICAgIGNpdGlTaGFyZS5jcmVhdGVCdXR0b25TZXRzKCk7XG4gICAgY2l0aVNoYXJlLnNlbGVjdE1lbnVGb3JFbGVtZW50KCk7XG4gICAgY2l0aVNoYXJlLm51bWVyaWNTdGVwcGVyU2V0dXAoKTtcblxuICAgICQoJy5qcy1wcm9kdWN0LWRldGFpbC1tb2R1bGUtcGxhY2Vob2xkZXInKVxuICAgICAgLnNob3coKVxuICAgICAgLmluc2VydEFmdGVyKCQoXCIucXVpY2t2aWV3LWVuYWJsZVwiKS5lcShjdXJyZW50Um93RW5kSW5kZXgpLmNsb3Nlc3QoJy5wcm9kdWN0LWxpc3QtaXRlbScpKVxuICAgICAgLmFuaW1hdGUoe2hlaWdodDogNDUwfSwgNTAwKTtcblxuICAgICQoJy5wcm9kdWN0LWRldGFpbC5xdWljay12aWV3JykuYWRkQ2xhc3MoJ2lzLWFjdGl2ZScpO1xuXG4gICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe1xuICAgICAgc2Nyb2xsVG9wOiAkKCcuanMtcHJvZHVjdC1kZXRhaWwtbW9kdWxlLXBsYWNlaG9sZGVyJykub2Zmc2V0KCkudG9wIC0gZmlsdGVySGVpZ2h0ICsgTnVtYmVyKCQoJy5qcy1wcm9kdWN0LWRldGFpbC1tb2R1bGUtcGxhY2Vob2xkZXInKS5jc3MoJ21hcmdpbi10b3AnKS5yZXBsYWNlKCdweCcsICcnKSlcbiAgICB9LCAxMDAwLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICQoXCIuanMtcHJvZHVjdC1kZXRhaWwtbW9kdWxlLXBsYWNlaG9sZGVyXCIpLmhlaWdodCgkKCcuanMtcHJvZHVjdC1kZXRhaWwtbW9kdWxlJykuaGVpZ2h0KCkpO1xuXG4gICAgICAkKCcuanMtcHJvZHVjdC1kZXRhaWwtbW9kdWxlJykuY3NzKHtcbiAgICAgICAgdG9wOiAkKFwiLmpzLXByb2R1Y3QtZGV0YWlsLW1vZHVsZS1wbGFjZWhvbGRlclwiKS5vZmZzZXQoKS50b3AgLSBmaWx0ZXJIZWlnaHQgKyBOdW1iZXIoJCgnLmpzLXByb2R1Y3QtZGV0YWlsLW1vZHVsZS1wbGFjZWhvbGRlcicpLmNzcygnbWFyZ2luLXRvcCcpLnJlcGxhY2UoJ3B4JywgJycpKVxuICAgICAgfSk7XG5cbiAgICAgICQoJy5qcy1wcm9kdWN0LWRldGFpbC1tb2R1bGUgLmpzLXByb2R1Y3QtdGl0bGUnKS5mb2N1cygpO1xuXG4gICAgICAkKCcjb2MtY29udGFpbmVyLCAubGl2ZS1jaGF0LXdyYXBwZXInKS5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG5cbiAgICAgICQoJy5qcy1wcm9kdWN0LWRldGFpbC1tb2R1bGUnKS5vbihcImNsaWNrXCIsIFwiLm1vZGFsLWNsb3NlLWJ1dHRvblwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNsb3NlRHJhd2VyKCRxdWlja1ZpZXdCdXR0b24pO1xuICAgICAgfSk7XG5cbiAgICAgICQod2luZG93KS50cmlnZ2VyKCdzY3JvbGwnKTtcblxuICAgIH0pO1xuXG4gICAgJCgnI29jLWNvbnRhaW5lcicpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIGlmIHRoZSBxdWlja3ZpZXcgY29udGFpbmVyIGlzIG5vdCBlbXB0eSwgY2xvc2UgdGhlIGRyYXdlciB3aGVuIGNsaWNraW5nIG9uICNvYy1jb250YWluZXJcbiAgICAgIGlmICgkKCcuanMtcHJvZHVjdC1kZXRhaWwtbW9kdWxlOnZpc2libGUnKVswXS5oYXNDaGlsZE5vZGVzKCkpIHtcbiAgICAgICAgY2xvc2VEcmF3ZXIoJHF1aWNrVmlld0J1dHRvbik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAkKHdpbmRvdykub24oJ3Njcm9sbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxvY2tRdWlja1ZpZXdUb1BsYWNlaG9sZGVyKCk7XG4gICAgfSk7XG5cbiAgICBjaXRpU2hhcmUudG9vbHRpcC5yZWZyZXNoKCk7XG4gIH1cblxuXG4gIC8vIHZpc3VhbGx5IGF0dGFjaCBxdWlja3ZpZXcgY29udGFpbmVyIHRvIHF1aWNrdmlldyBwbGFjZWhvbGRlclxuICBmdW5jdGlvbiBsb2NrUXVpY2tWaWV3VG9QbGFjZWhvbGRlcigpIHtcbiAgICAkKCcuanMtcHJvZHVjdC1kZXRhaWwtbW9kdWxlJykuY3NzKHtcbiAgICAgIHRvcDogJChcIi5qcy1wcm9kdWN0LWRldGFpbC1tb2R1bGUtcGxhY2Vob2xkZXJcIikub2Zmc2V0KCkudG9wIC0gJChkb2N1bWVudCkuc2Nyb2xsVG9wKCksXG4gICAgICBsZWZ0OiAkKFwiLmpzLXByb2R1Y3QtZGV0YWlsLW1vZHVsZS1wbGFjZWhvbGRlclwiKS5vZmZzZXQoKS5sZWZ0XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVwb3NpdGlvbiBxdWlja3ZpZXcgcGFuZWwgb24gd2luZG93cyByZXNpemVcbiAgICovXG4gIGZ1bmN0aW9uIHBvc2l0aW9uUXVpY2tWaWV3V2luZG93UmVzaXplKCkge1xuICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24gKCkge1xuICAgICAgbG9ja1F1aWNrVmlld1RvUGxhY2Vob2xkZXIoKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbG9zZSBkcmF3ZXJcbiAgICovXG4gIGZ1bmN0aW9uIGNsb3NlRHJhd2VyKCRxdWlja1ZpZXdCdXR0b24pIHtcbiAgICAkKCcucHJvZHVjdC1kZXRhaWwucXVpY2stdmlldycpLnJlbW92ZUNsYXNzKCdpcy1hY3RpdmUnKTtcbiAgICAkKCcuanMtcHJvZHVjdC1kZXRhaWwtbW9kdWxlJykuZW1wdHkoKTtcbiAgICAkKCcuanMtcHJvZHVjdC1kZXRhaWwtbW9kdWxlLXBsYWNlaG9sZGVyJykuaGlkZSgpO1xuICAgICQoJyNvYy1jb250YWluZXIsIC5saXZlLWNoYXQtd3JhcHBlcicpLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJyk7XG4gICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCRxdWlja1ZpZXdCdXR0b24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAkcXVpY2tWaWV3QnV0dG9uLmZvY3VzKCk7XG4gICAgICB9XG4gICAgfSwgNTAwKTtcbiAgfVxuXG5cbiAgLyoqXG4gICAqIENsb3NlIGRyYXdlciBvbiB3aW5kb3cgcmVzaXplXG4gICAqL1xuICBmdW5jdGlvbiBjbG9zZURyYXdlcldpbmRvd1Jlc2l6ZSgpIHtcbiAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB3aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoIHx8ICQod2luZG93KS53aWR0aCgpO1xuICAgICAgaWYgKHdpbmRvd1dpZHRoIDwgOTYwKSB7XG4gICAgICAgIGNsb3NlRHJhd2VyKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogVHJpZ2dlciBjbGljayBldmVudCBrZXkgZW50ZXJcbiAgICovXG4gIGZ1bmN0aW9uIGFkZEtleWJvYXJkRW50ZXJLZXkoKSB7XG4gICAgJChkb2N1bWVudCkub24oXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS5rZXlDb2RlID09PSAxMykge1xuICAgICAgICAkKHRoaXMpLmNsaWNrKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCB0aGUgbmV4dCBjbG9zZXN0IHJvdyBicmVhayBmb3IgaW5qZWN0aW5nIHRoZSBxdWlja3ZpZXcgdGVtcGxhdGVcbiAgICogQHBhcmFtIGN1cnJlbnRDb250YWluZXJJbmRleFxuICAgKiBAcGFyYW0gaXRlbXNQZXJSb3dcbiAgICogQHJldHVybnMge251bWJlcn0gSW5kZXggbnVtYmVyIG9mIHRoZSBuZXh0IHJvdyBicmVha1xuICAgKi9cbiAgZnVuY3Rpb24gZmluZE5leHRSb3dCcmVhayhjdXJyZW50Q29udGFpbmVySW5kZXgsIGl0ZW1zUGVyUm93KSB7XG5cbiAgICB2YXIgbmV4dFJvd0JyZWFrSW5kZXg7XG5cbiAgICAvL0ZpcnN0IHJvd1xuICAgIGlmIChjdXJyZW50Q29udGFpbmVySW5kZXggPD0gaXRlbXNQZXJSb3cpIHtcbiAgICAgIC8vIG5lZWQgdG8gY2hlY2sgdG8gc2VlIGlmIHdlIGV2ZW4gaGF2ZSBpdGVtc1BlclJvdyBudW1iZXIgb2YgcHJvZHVjdHNcbiAgICAgIGlmICgkKCcucHJvZHVjdC1saXN0LWl0ZW0nKS5sZW5ndGggPiBpdGVtc1BlclJvdykge1xuICAgICAgICBuZXh0Um93QnJlYWtJbmRleCA9IGl0ZW1zUGVyUm93O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV4dFJvd0JyZWFrSW5kZXggPSAkKCcucHJvZHVjdC1saXN0LWl0ZW0nKS5sZW5ndGg7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaWYgKGN1cnJlbnRDb250YWluZXJJbmRleCAlIGl0ZW1zUGVyUm93ID09PSAwKSB7XG4gICAgICAgIG5leHRSb3dCcmVha0luZGV4ID0gY3VycmVudENvbnRhaW5lckluZGV4O1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIG5leHRSb3dCcmVha0luZGV4ID0gKGl0ZW1zUGVyUm93IC0gY3VycmVudENvbnRhaW5lckluZGV4ICUgaXRlbXNQZXJSb3cpICsgY3VycmVudENvbnRhaW5lckluZGV4O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbmV4dFJvd0JyZWFrSW5kZXg7XG4gIH1cblxuICBpZiAoJCgnLmpzLXByb2R1Y3QtZGV0YWlsLW1vZHVsZScpLmxlbmd0aCA+IDApIHtcbiAgICAvLyBUT0RPOiBSZS13cml0ZSB0aGlzIHNvIHRoYXQgaXQgaGFwcGVucyBhdXRvbWFnaWNhbGx5LlxuICAgIFsnYnV0dG9uc2V0LWNvbXBvbmVudCcsICdzdWJtaXQtYnV0dG9uLWNvbXBvbmVudCcsICd0b29sdGlwLWNvbXBvbmVudCcsICdkcm9wZG93bi1jb21wb25lbnQnLCAnbnVtZXJpYy1zdGVwcGVyLWNvbXBvbmVudCddLmZvckVhY2goZnVuY3Rpb24gKHRlbXBsYXRlKSB7XG4gICAgICBjaXRpU2hhcmUudXRpbC5nZXRIYW5kbGViYXJQYXJ0aWFscyh0ZW1wbGF0ZSk7XG4gICAgfSk7XG5cbiAgICBvcGVuRHJhd2VyKCk7XG4gICAgY2xvc2VEcmF3ZXJXaW5kb3dSZXNpemUoKTtcbiAgICBhZGRLZXlib2FyZEVudGVyS2V5KCk7XG4gICAgcG9zaXRpb25RdWlja1ZpZXdXaW5kb3dSZXNpemUoKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgYWRkS2V5Ym9hcmRFbnRlcktleTogYWRkS2V5Ym9hcmRFbnRlcktleSxcbiAgICBjbG9zZURyYXdlcldpbmRvd1Jlc2l6ZTogY2xvc2VEcmF3ZXJXaW5kb3dSZXNpemUsXG4gICAgbG9ja1F1aWNrVmlld1RvUGxhY2Vob2xkZXI6IGxvY2tRdWlja1ZpZXdUb1BsYWNlaG9sZGVyLFxuICAgIG9wZW5EcmF3ZXI6IG9wZW5EcmF3ZXIsXG4gICAgcG9zaXRpb25RdWlja1ZpZXdXaW5kb3dSZXNpemU6IHBvc2l0aW9uUXVpY2tWaWV3V2luZG93UmVzaXplXG4gIH07XG59KSgpO1xuIiwiY2l0aVNoYXJlLnJlaW5zdGF0ZUN1cnJlbmN5ID0gKGZ1bmN0aW9uICgpIHtcblxuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgY29uZmlnID0ge1xuICAgICRjb250YWluZXI6ICQoXCIucmVpbnN0YXRlLXBvaW50cy1jb250YWluZXJcIiksXG4gIH07XG5cbiAgdmFyIHNldHVwQ2hlY2tib3hlcyA9IGZ1bmN0aW9uIHNldHVwQ2hlY2tib3hlcygpIHtcbiAgICBjb25maWcuJGNvbnRhaW5lci5vbihcImtleXByZXNzXCIsIFwiaW5wdXRbdHlwZT1jaGVja2JveF1cIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICQodGhpcykucHJvcChcImNoZWNrZWRcIiwgISQodGhpcykucHJvcChcImNoZWNrZWRcIikpO1xuICAgICAgICAkKHRoaXMpLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25maWcuJGNvbnRhaW5lci5vbihcImNoYW5nZVwiLCBcImlucHV0W3R5cGU9Y2hlY2tib3hdXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciAkb3B0aW9ucyA9IGNvbmZpZy4kY29udGFpbmVyLmZpbmQoXCJpbnB1dFt0eXBlPWNoZWNrYm94XVwiKSxcbiAgICAgICAgZW5hYmxlU3VibWl0ID0gZmFsc2U7XG5cbiAgICAgICRvcHRpb25zLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoJCh0aGlzKS5pcygnOmNoZWNrZWQnKSkge1xuICAgICAgICAgIGVuYWJsZVN1Ym1pdCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZW5hYmxlU3VibWl0KSB7XG4gICAgICAgIGNvbmZpZy4kY29udGFpbmVyLmZpbmQoXCJpbnB1dFt0eXBlPXN1Ym1pdF1cIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uZmlnLiRjb250YWluZXIuZmluZChcImlucHV0W3R5cGU9c3VibWl0XVwiKS5nZXQoMCkuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHZhciBpbml0ID0gZnVuY3Rpb24gaW5pdCgpIHtcbiAgICBzZXR1cENoZWNrYm94ZXMoKTtcbiAgICBjb25maWcuJGNvbnRhaW5lci5vbihcImNsaWNrXCIsIFwiaW5wdXRbdHlwZT1zdWJtaXRdXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbmZpZy4kY29udGFpbmVyLmZpbmQoXCJmb3JtXCIpLnRyaWdnZXIoXCJmb3JtOnJlaW5zdGF0ZVwiKTtcbiAgICB9KTtcbiAgfTtcblxuICBpZiAoJCgnLm15LXByb2ZpbGUnKSkge1xuICAgIGluaXQoKTtcbiAgfVxuXG59KSgpOyIsImNpdGlTaGFyZS5zZWFyY2ggPSAoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHRlbXBsYXRlUGFydGlhbHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGRhdGFQcm9wZXJ0eTogJ3RyYXZlbFJlc3VsdHMnLFxuICAgICAgICAgICAgdGVtcGxhdGU6ICd0cmF2ZWwtcmVzdWx0cy1oZWFkZXInXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGRhdGFQcm9wZXJ0eTogJ3N1Z2dlc3Rpb25UZXJtcycsXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJ3NlYXJjaC1zdWdnZXN0aW9ucydcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgZGF0YVByb3BlcnR5OiAnc2hvcFdpdGhQb2ludHMnLFxuICAgICAgICAgICAgdGVtcGxhdGU6ICdzaG9wLXdpdGgtcG9pbnRzLXJlc3VsdCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgZGF0YVByb3BlcnR5OiAndGFicycsXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJ2ZpbHRlci10YWJzJ1xuICAgICAgICB9XG4gICAgXTtcblxuICAgIHZhciB0ZW1wbGF0ZXMgPSBbXTtcblxuICAgIHRlbXBsYXRlUGFydGlhbHMuZm9yRWFjaChmdW5jdGlvbihwYXJ0aWFsRGF0YSkge1xuICAgICAgICB0ZW1wbGF0ZXMucHVzaChwYXJ0aWFsRGF0YS50ZW1wbGF0ZSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBzaG93U2VhcmNoUmVzdWx0cygpe1xuXG4gICAgXHQkLmFqYXgoe1xuICAgIFx0XHR1cmw6IHdpbmRvdy5jaXRpQ29uZmlnLmVuZFBvaW50SG9zdCArIHdpbmRvdy5jaXRpQ29uZmlnLnNlYXJjaFJlc3VsdHNFbmRQb2ludFBhdGggKyB3aW5kb3cuc2VhcmNoRW5kcG9pbnQsXG4gICAgXHRcdHR5cGU6ICdHRVQnLFxuICAgIFx0XHRkYXRhVHlwZTogJ2pzb24nXG4gICAgXHR9KVxuICAgIFx0LmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgdmFyICRjb250ZW50V3JhcHBlciA9ICQoJy5qcy1zZWFyY2gtcGFnZS1oZWFkZXItY29udGVudC13cmFwcGVyJyk7XG5cbiAgICAgICAgICAgIHRlbXBsYXRlUGFydGlhbHMuZm9yRWFjaChmdW5jdGlvbihwYXJ0aWFsKXtcbiAgICAgICAgICAgICAgICBpZihkYXRhLmhhc093blByb3BlcnR5KHBhcnRpYWwuZGF0YVByb3BlcnR5KSkge1xuICAgICAgICAgICAgICAgICAgICAkY29udGVudFdyYXBwZXIuYXBwZW5kKGNpdGlTaGFyZS51dGlsLnJlbmRlclRlbXBsYXRlKHdpbmRvdy5IYW5kbGViYXJzLnBhcnRpYWxzW3BhcnRpYWwudGVtcGxhdGVdLCBkYXRhKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYocGFydGlhbC5kYXRhUHJvcGVydHkgPT09ICd0YWJzJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9uZWVkZWQgZm9yIHZhcmlhbnQgd2hlcmUgdHJhdmVsIHJlc3VsdHMgKyB0YWJzIGFyZSBkaXNwbGF5ZWQgdG9nZXRoZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50V3JhcHBlci5hZGRDbGFzcygnanMtc2VhcmNoLXBhZ2UtaGVhZGVyLWNvbnRlbnQtd3JhcHBlci0taGFzLXRhYnMnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQod2luZG93KS50cmlnZ2VyKGNpdGlTaGFyZS5maWx0ZXJUYWJzLkV2ZW50cy5SRU5ERVJFRCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgIFx0fSlcbiAgICBcdC5mYWlsKGZ1bmN0aW9uKCkge1xuICAgIFx0XHRjb25zb2xlLmxvZyhcImVycm9yXCIpO1xuICAgIFx0fSlcbiAgICBcdC5hbHdheXMoZnVuY3Rpb24oKSB7XG4gICAgXHRcdGNvbnNvbGUubG9nKFwiY29tcGxldGVcIik7XG4gICAgXHR9KTtcblxuICAgIH1cblxuXG4gICAgLy8gVE9ETzogUmUtd3JpdGUgdGhpcyBzbyB0aGF0IGl0IGhhcHBlbnMgYXV0b21hZ2ljYWxseS5cbiAgICBmdW5jdGlvbiBkZWZpbmVTZWFyY2hQYXJ0aWFscygpe1xuXHRcdHRlbXBsYXRlcy5mb3JFYWNoKGZ1bmN0aW9uKHRlbXBsYXRlKXtcblx0ICAgICAgICBjaXRpU2hhcmUudXRpbC5nZXRIYW5kbGViYXJQYXJ0aWFscyh0ZW1wbGF0ZSk7XG5cdCAgICB9KTtcbiAgICB9XG5cblxuXHRpZigkKCcuanMtc2VhcmNoLXBhZ2UtaGVhZGVyLWNvbnRlbnQtd3JhcHBlcicpLmxlbmd0aCA+IDApe1xuICAgICAgICBkZWZpbmVTZWFyY2hQYXJ0aWFscygpO1xuXHRcdHNob3dTZWFyY2hSZXN1bHRzKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZGVmaW5lU2VhcmNoUGFydGlhbHM6IGRlZmluZVNlYXJjaFBhcnRpYWxzXG4gICAgfTtcbn0pKCk7XG4iLCIvKipcbiAqIEBmaWxlb3ZlcnZpZXcgTGluZSBjbGFtcGVyIGl0ZW0gZm9yIENpdGlCYW5rLlxuICogQGF1dGhvciBOYXRoYW4gQnVjaGFyXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIENsYW1wLmpzIDAuNy4wXG4gKlxuICogQ29weXJpZ2h0IDIwMTEtMjAxMywgSm9zZXBoIFNjaG1pdHQgaHR0cDovL2pvZS5zaFxuICogUmVsZWFzZWQgdW5kZXIgdGhlIFdURlBMIGxpY2Vuc2VcbiAqIGh0dHA6Ly9zYW0uem95Lm9yZy93dGZwbC9cbiAqL1xuZnVuY3Rpb24gJGNsYW1wKGVsZW1lbnQsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgdmFyIHdpbiA9IHdpbmRvdyxcbiAgICBvcHQgPSB7XG4gICAgICBjbGFtcDogb3B0aW9ucy5jbGFtcCB8fCAyLFxuICAgICAgdXNlTmF0aXZlQ2xhbXA6IHR5cGVvZihvcHRpb25zLnVzZU5hdGl2ZUNsYW1wKSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnVzZU5hdGl2ZUNsYW1wIDogdHJ1ZSxcbiAgICAgIHNwbGl0T25DaGFyczogb3B0aW9ucy5zcGxpdE9uQ2hhcnMgfHwgWycuJywgJy0nLCAn4oCTJywgJ+KAlCcsICcgJ10sIC8vU3BsaXQgb24gc2VudGVuY2VzIChwZXJpb2RzKSwgaHlwZW5zLCBlbi1kYXNoZXMsIGVtLWRhc2hlcywgYW5kIHdvcmRzIChzcGFjZXMpLlxuICAgICAgYW5pbWF0ZTogb3B0aW9ucy5hbmltYXRlIHx8IGZhbHNlLFxuICAgICAgdHJ1bmNhdGlvbkNoYXI6IG9wdGlvbnMudHJ1bmNhdGlvbkNoYXIgfHwgJyYjODIzMDsnLFxuICAgICAgdHJ1bmNhdGlvbkhUTUw6IG9wdGlvbnMudHJ1bmNhdGlvbkhUTUxcbiAgICB9LFxuXG4gICAgc3R5ID0gZWxlbWVudC5zdHlsZSxcbiAgICBvcmlnaW5hbFRleHQgPSBlbGVtZW50LmlubmVySFRNTCxcblxuICAgIHN1cHBvcnRzTmF0aXZlQ2xhbXAgPSB0eXBlb2YoZWxlbWVudC5zdHlsZS53ZWJraXRMaW5lQ2xhbXApICE9PSAndW5kZWZpbmVkJyxcbiAgICBjbGFtcFZhbHVlID0gb3B0LmNsYW1wLFxuICAgIGlzQ1NTVmFsdWUgPSBjbGFtcFZhbHVlLmluZGV4T2YgJiYgKGNsYW1wVmFsdWUuaW5kZXhPZigncHgnKSA+IC0xIHx8IGNsYW1wVmFsdWUuaW5kZXhPZignZW0nKSA+IC0xKSxcbiAgICB0cnVuY2F0aW9uSFRNTENvbnRhaW5lcjtcblxuICBpZiAob3B0LnRydW5jYXRpb25IVE1MKSB7XG4gICAgdHJ1bmNhdGlvbkhUTUxDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgdHJ1bmNhdGlvbkhUTUxDb250YWluZXIuaW5uZXJIVE1MID0gb3B0LnRydW5jYXRpb25IVE1MO1xuICB9XG5cblxuICAvLyBVVElMSVRZIEZVTkNUSU9OUyBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgY3VycmVudCBzdHlsZSBmb3IgYW4gZWxlbWVudC5cbiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbSBUaGUgZWxlbWVudCB0byBjb21wdXRlLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvcCBUaGUgc3R5bGUgcHJvcGVydHkuXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAqL1xuICBmdW5jdGlvbiBjb21wdXRlU3R5bGUoZWxlbSwgcHJvcCkge1xuICAgIGlmICghd2luLmdldENvbXB1dGVkU3R5bGUpIHtcbiAgICAgIHdpbi5nZXRDb21wdXRlZFN0eWxlID0gZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgdGhpcy5lbCA9IGVsO1xuICAgICAgICB0aGlzLmdldFByb3BlcnR5VmFsdWUgPSBmdW5jdGlvbihwcm9wKSB7XG4gICAgICAgICAgdmFyIHJlID0gLyhcXC0oW2Etel0pezF9KS9nO1xuICAgICAgICAgIGlmIChwcm9wID09PSAnZmxvYXQnKSB7XG4gICAgICAgICAgICBwcm9wID0gJ3N0eWxlRmxvYXQnO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocmUudGVzdChwcm9wKSkge1xuICAgICAgICAgICAgcHJvcCA9IHByb3AucmVwbGFjZShyZSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHJldHVybiBhcmd1bWVudHNbMl0udG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZWwuY3VycmVudFN0eWxlICYmIGVsLmN1cnJlbnRTdHlsZVtwcm9wXSA/IGVsLmN1cnJlbnRTdHlsZVtwcm9wXSA6IG51bGw7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gd2luLmdldENvbXB1dGVkU3R5bGUoZWxlbSwgbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShwcm9wKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBtYXhpbXVtIG51bWJlciBvZiBsaW5lcyBvZiB0ZXh0IHRoYXQgc2hvdWxkIGJlIHJlbmRlcmVkIGJhc2VkXG4gICAqIG9uIHRoZSBjdXJyZW50IGhlaWdodCBvZiB0aGUgZWxlbWVudCBhbmQgdGhlIGxpbmUtaGVpZ2h0IG9mIHRoZSB0ZXh0LlxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0TWF4TGluZXMoaGVpZ2h0KSB7XG4gICAgdmFyIGF2YWlsSGVpZ2h0ID0gaGVpZ2h0IHx8IGVsZW1lbnQuY2xpZW50SGVpZ2h0LFxuICAgICAgbGluZUhlaWdodCA9IGdldExpbmVIZWlnaHQoZWxlbWVudCk7XG5cbiAgICByZXR1cm4gTWF0aC5tYXgoTWF0aC5mbG9vcihhdmFpbEhlaWdodCAvIGxpbmVIZWlnaHQpLCAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBtYXhpbXVtIGhlaWdodCBhIGdpdmVuIGVsZW1lbnQgc2hvdWxkIGhhdmUgYmFzZWQgb24gdGhlIGxpbmUtXG4gICAqIGhlaWdodCBvZiB0aGUgdGV4dCBhbmQgdGhlIGdpdmVuIGNsYW1wIHZhbHVlLlxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0TWF4SGVpZ2h0KGNsbXApIHtcbiAgICB2YXIgbGluZUhlaWdodCA9IGdldExpbmVIZWlnaHQoZWxlbWVudCk7XG4gICAgcmV0dXJuIGxpbmVIZWlnaHQgKiBjbG1wO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGxpbmUtaGVpZ2h0IG9mIGFuIGVsZW1lbnQgYXMgYW4gaW50ZWdlci5cbiAgICovXG4gIGZ1bmN0aW9uIGdldExpbmVIZWlnaHQoZWxlbSkge1xuICAgIHZhciBsaCA9IGNvbXB1dGVTdHlsZShlbGVtLCAnbGluZS1oZWlnaHQnKTtcbiAgICBpZiAobGggPT09ICdub3JtYWwnKSB7XG4gICAgICAvLyBOb3JtYWwgbGluZSBoZWlnaHRzIHZhcnkgZnJvbSBicm93c2VyIHRvIGJyb3dzZXIuIFRoZSBzcGVjIHJlY29tbWVuZHNcbiAgICAgIC8vIGEgdmFsdWUgYmV0d2VlbiAxLjAgYW5kIDEuMiBvZiB0aGUgZm9udCBzaXplLiBVc2luZyAxLjEgdG8gc3BsaXQgdGhlIGRpZmYuXG4gICAgICBsaCA9IHBhcnNlSW50KGNvbXB1dGVTdHlsZShlbGVtLCAnZm9udC1zaXplJykpICogMS4yO1xuICAgIH1cbiAgICByZXR1cm4gcGFyc2VJbnQobGgpO1xuICB9XG5cblxuICAvLyBNRUFUIEFORCBQT1RBVE9FUyAoTU1NTSwgUE9UQVRPRVMuLi4pIF9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXG4gIHZhciBzcGxpdE9uQ2hhcnMgPSBvcHQuc3BsaXRPbkNoYXJzLnNsaWNlKDApLFxuICAgIHNwbGl0Q2hhciA9IHNwbGl0T25DaGFyc1swXSxcbiAgICBjaHVua3MsXG4gICAgbGFzdENodW5rO1xuXG4gIC8qKlxuICAgKiBHZXRzIGFuIGVsZW1lbnQncyBsYXN0IGNoaWxkLiBUaGF0IG1heSBiZSBhbm90aGVyIG5vZGUgb3IgYSBub2RlJ3MgY29udGVudHMuXG4gICAqL1xuICBmdW5jdGlvbiBnZXRMYXN0Q2hpbGQoZWxlbSkge1xuICAgIC8vQ3VycmVudCBlbGVtZW50IGhhcyBjaGlsZHJlbiwgbmVlZCB0byBnbyBkZWVwZXIgYW5kIGdldCBsYXN0IGNoaWxkIGFzIGEgdGV4dCBub2RlXG4gICAgaWYgKGVsZW0ubGFzdENoaWxkLmNoaWxkcmVuICYmIGVsZW0ubGFzdENoaWxkLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiBnZXRMYXN0Q2hpbGQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZWxlbS5jaGlsZHJlbikucG9wKCkpO1xuICAgIH1cbiAgICAvL1RoaXMgaXMgdGhlIGFic29sdXRlIGxhc3QgY2hpbGQsIGEgdGV4dCBub2RlLCBidXQgc29tZXRoaW5nJ3Mgd3Jvbmcgd2l0aCBpdC4gUmVtb3ZlIGl0IGFuZCBrZWVwIHRyeWluZ1xuICAgIGVsc2UgaWYgKCFlbGVtLmxhc3RDaGlsZCB8fCAhZWxlbS5sYXN0Q2hpbGQubm9kZVZhbHVlIHx8IGVsZW0ubGFzdENoaWxkLm5vZGVWYWx1ZSA9PT0gJycgfHwgZWxlbS5sYXN0Q2hpbGQubm9kZVZhbHVlID09PSBvcHQudHJ1bmNhdGlvbkNoYXIpIHtcbiAgICAgIGVsZW0ubGFzdENoaWxkLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxlbS5sYXN0Q2hpbGQpO1xuICAgICAgcmV0dXJuIGdldExhc3RDaGlsZChlbGVtZW50KTtcbiAgICB9XG4gICAgLy9UaGlzIGlzIHRoZSBsYXN0IGNoaWxkIHdlIHdhbnQsIHJldHVybiBpdFxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIGVsZW0ubGFzdENoaWxkO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmVzIG9uZSBjaGFyYWN0ZXIgYXQgYSB0aW1lIGZyb20gdGhlIHRleHQgdW50aWwgaXRzIHdpZHRoIG9yXG4gICAqIGhlaWdodCBpcyBiZW5lYXRoIHRoZSBwYXNzZWQtaW4gbWF4IHBhcmFtLlxuICAgKi9cbiAgZnVuY3Rpb24gdHJ1bmNhdGUodGFyZ2V0LCBtYXhIZWlnaHQpIHtcbiAgICBpZiAoIW1heEhlaWdodCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc2V0cyBnbG9iYWwgdmFyaWFibGVzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICAgc3BsaXRPbkNoYXJzID0gb3B0LnNwbGl0T25DaGFycy5zbGljZSgwKTtcbiAgICAgIHNwbGl0Q2hhciA9IHNwbGl0T25DaGFyc1swXTtcbiAgICAgIGNodW5rcyA9IG51bGw7XG4gICAgICBsYXN0Q2h1bmsgPSBudWxsO1xuICAgIH1cblxuICAgIHZhciBub2RlVmFsdWUgPSB0YXJnZXQubm9kZVZhbHVlLnJlcGxhY2Uob3B0LnRydW5jYXRpb25DaGFyLCAnJyk7XG5cbiAgICAvL0dyYWIgdGhlIG5leHQgY2h1bmtzXG4gICAgaWYgKCFjaHVua3MpIHtcbiAgICAgIC8vSWYgdGhlcmUgYXJlIG1vcmUgY2hhcmFjdGVycyB0byB0cnksIGdyYWIgdGhlIG5leHQgb25lXG4gICAgICBpZiAoc3BsaXRPbkNoYXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgc3BsaXRDaGFyID0gc3BsaXRPbkNoYXJzLnNoaWZ0KCk7XG4gICAgICB9XG4gICAgICAvL05vIGNoYXJhY3RlcnMgdG8gY2h1bmsgYnkuIEdvIGNoYXJhY3Rlci1ieS1jaGFyYWN0ZXJcbiAgICAgIGVsc2Uge1xuICAgICAgICBzcGxpdENoYXIgPSAnJztcbiAgICAgIH1cblxuICAgICAgY2h1bmtzID0gbm9kZVZhbHVlLnNwbGl0KHNwbGl0Q2hhcik7XG4gICAgfVxuXG4gICAgLy9JZiB0aGVyZSBhcmUgY2h1bmtzIGxlZnQgdG8gcmVtb3ZlLCByZW1vdmUgdGhlIGxhc3Qgb25lIGFuZCBzZWUgaWZcbiAgICAvLyB0aGUgbm9kZVZhbHVlIGZpdHMuXG4gICAgaWYgKGNodW5rcy5sZW5ndGggPiAxKSB7XG4gICAgICBsYXN0Q2h1bmsgPSBjaHVua3MucG9wKCk7XG4gICAgICBhcHBseUVsbGlwc2lzKHRhcmdldCwgY2h1bmtzLmpvaW4oc3BsaXRDaGFyKSk7XG4gICAgfVxuICAgIC8vTm8gbW9yZSBjaHVua3MgY2FuIGJlIHJlbW92ZWQgdXNpbmcgdGhpcyBjaGFyYWN0ZXJcbiAgICBlbHNlIHtcbiAgICAgIGNodW5rcyA9IG51bGw7XG4gICAgfVxuXG4gICAgLy9JbnNlcnQgdGhlIGN1c3RvbSBIVE1MIGJlZm9yZSB0aGUgdHJ1bmNhdGlvbiBjaGFyYWN0ZXJcbiAgICBpZiAodHJ1bmNhdGlvbkhUTUxDb250YWluZXIpIHtcbiAgICAgICAgdGFyZ2V0Lm5vZGVWYWx1ZSA9IHRhcmdldC5ub2RlVmFsdWUucmVwbGFjZShvcHQudHJ1bmNhdGlvbkNoYXIsICcnKTtcbiAgICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSB0YXJnZXQubm9kZVZhbHVlICsgb3B0LnRydW5jYXRpb25DaGFyICsgJyAnICsgdHJ1bmNhdGlvbkhUTUxDb250YWluZXIuaW5uZXJIVE1MIDtcbiAgICB9XG5cbiAgICAvL1NlYXJjaCBwcm9kdWNlZCB2YWxpZCBjaHVua3NcbiAgICBpZiAoY2h1bmtzKSB7XG4gICAgICAvL0l0IGZpdHNcbiAgICAgIGlmIChlbGVtZW50LmNsaWVudEhlaWdodCA8PSBtYXhIZWlnaHQpIHtcbiAgICAgICAgLy9UaGVyZSdzIHN0aWxsIG1vcmUgY2hhcmFjdGVycyB0byB0cnkgc3BsaXR0aW5nIG9uLCBub3QgcXVpdGUgZG9uZSB5ZXRcbiAgICAgICAgaWYgKHNwbGl0T25DaGFycy5sZW5ndGggPj0gMCAmJiBzcGxpdENoYXIgIT09ICcnKSB7XG4gICAgICAgICAgYXBwbHlFbGxpcHNpcyh0YXJnZXQsIGNodW5rcy5qb2luKHNwbGl0Q2hhcikgKyBzcGxpdENoYXIgKyBsYXN0Q2h1bmspO1xuICAgICAgICAgIGNodW5rcyA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgLy9GaW5pc2hlZCFcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGVsZW1lbnQuaW5uZXJIVE1MO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIC8vTm8gdmFsaWQgY2h1bmtzIHByb2R1Y2VkXG4gICAgZWxzZSB7XG4gICAgICAvL05vIHZhbGlkIGNodW5rcyBldmVuIHdoZW4gc3BsaXR0aW5nIGJ5IGxldHRlciwgdGltZSB0byBtb3ZlXG4gICAgICAvL29uIHRvIHRoZSBuZXh0IG5vZGVcbiAgICAgIGlmIChzcGxpdENoYXIgPT09ICcnKSB7XG4gICAgICAgIGFwcGx5RWxsaXBzaXModGFyZ2V0LCAnJyk7XG4gICAgICAgIHRhcmdldCA9IGdldExhc3RDaGlsZChlbGVtZW50KTtcblxuICAgICAgICByZXNldCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vSWYgeW91IGdldCBoZXJlIGl0IG1lYW5zIHN0aWxsIHRvbyBiaWcsIGxldCdzIGtlZXAgdHJ1bmNhdGluZ1xuICAgIGlmIChvcHQuYW5pbWF0ZSkge1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgdHJ1bmNhdGUodGFyZ2V0LCBtYXhIZWlnaHQpO1xuICAgICAgfSwgb3B0LmFuaW1hdGUgPT09IHRydWUgPyAxMCA6IG9wdC5hbmltYXRlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRydW5jYXRlKHRhcmdldCwgbWF4SGVpZ2h0KTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBhcHBseUVsbGlwc2lzKGVsZW0sIHN0cikge1xuICAgIGVsZW0ubm9kZVZhbHVlID0gc3RyICsgb3B0LnRydW5jYXRpb25DaGFyO1xuICB9XG5cblxuICAvLyBDT05TVFJVQ1RPUiBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXG5cbiAgaWYgKGNsYW1wVmFsdWUgPT09ICdhdXRvJykge1xuICAgIGNsYW1wVmFsdWUgPSBnZXRNYXhMaW5lcygpO1xuICB9IGVsc2UgaWYgKGlzQ1NTVmFsdWUpIHtcbiAgICBjbGFtcFZhbHVlID0gZ2V0TWF4TGluZXMocGFyc2VJbnQoY2xhbXBWYWx1ZSkpO1xuICB9XG5cbiAgdmFyIGNsYW1wZWRUZXh0O1xuICBpZiAoc3VwcG9ydHNOYXRpdmVDbGFtcCAmJiBvcHQudXNlTmF0aXZlQ2xhbXApIHtcbiAgICBzdHkub3ZlcmZsb3cgPSAnaGlkZGVuJztcbiAgICBzdHkudGV4dE92ZXJmbG93ID0gJ2VsbGlwc2lzJztcbiAgICBzdHkud2Via2l0Qm94T3JpZW50ID0gJ3ZlcnRpY2FsJztcbiAgICBzdHkuZGlzcGxheSA9ICctd2Via2l0LWJveCc7XG4gICAgc3R5LndlYmtpdExpbmVDbGFtcCA9IGNsYW1wVmFsdWU7XG5cbiAgICBpZiAoaXNDU1NWYWx1ZSkge1xuICAgICAgc3R5LmhlaWdodCA9IG9wdC5jbGFtcCArICdweCc7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHZhciBoZWlnaHQgPSBnZXRNYXhIZWlnaHQoY2xhbXBWYWx1ZSk7XG4gICAgaWYgKGhlaWdodCA8IGVsZW1lbnQuY2xpZW50SGVpZ2h0KSB7XG4gICAgICBjbGFtcGVkVGV4dCA9IHRydW5jYXRlKGdldExhc3RDaGlsZChlbGVtZW50KSwgaGVpZ2h0KTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgICdvcmlnaW5hbCc6IG9yaWdpbmFsVGV4dCxcbiAgICAnY2xhbXBlZCc6IGNsYW1wZWRUZXh0XG4gIH07XG59XG5cbi8qKlxuICogU2VlTW9yZUl0ZW1cbiAqL1xudmFyIFNlZU1vcmVJdGVtID0gZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMpIHtcblxuICAvKipcbiAgICogVGhlIGJhc2UgZWxlbWVudCBmb3IgdGhpcyBpdGVtLlxuICAgKlxuICAgKiBAdHlwZSB7SFRNTEVsZW1lbnR9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICB0aGlzLl9lbGVtZW50ID0gZWxlbWVudDtcblxuICAvKipcbiAgICogVGhlIGNsYW1wIG9wdGlvbnMuXG4gICAqXG4gICAqIEB0eXBlIHtPYmplY3R9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICB0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcblxuICAvKipcbiAgICogVGhlIGNsYW1wIE9iamVjdC5cbiAgICpcbiAgICogQHR5cGUge09iamVjdH1cbiAgICogQGRlZmF1bHQgbnVsbFxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdGhpcy5fY2xhbXAgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgc2VlIG1vcmUgYnV0dG9uLlxuICAgKlxuICAgKiBAdHlwZSB7SFRNTEVsZW1lbnR9XG4gICAqIEBkZWZhdWx0IG51bGxcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHRoaXMuX3NlZU1vcmVCdXR0b24gPSBudWxsO1xuICBcbiAgLyoqXG4gICAqIFRoZSBzZWUgbGVzcyBidXR0b24uXG4gICAqXG4gICAqIEB0eXBlIHtIVE1MRWxlbWVudH1cbiAgICogQGRlZmF1bHQgbnVsbFxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdGhpcy5fc2VlTGVzc0J1dHRvbiA9IG51bGw7XG5cbiAgLyoqXG4gICAqIENhbGxlZCB3aGVuIFwic2VlIG1vcmVcIiBpcyBwcmVzc2VkIGFuZCBkZWxlZ2F0ZXMgdG8gdGhlIGFwcHJvcHJpYXRlIG1ldGhvZFxuICAgKiB3aXRoIHRoZSBwcm9wZXIgbGV4aWNhbCBzY29wZS5cbiAgICpcbiAgICogQHR5cGUge09iamVjdH1cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHRoaXMuX29uU2VlTW9yZUNsaWNrID0gdGhpcy5faGFuZGxlU2VlTW9yZUNsaWNrLmJpbmQodGhpcyk7XG4gIFxuICAvKipcbiAgICogQ2FsbGVkIHdoZW4gXCJzZWUgbGVzc1wiIGlzIHByZXNzZWQgYW5kIGRlbGVnYXRlcyB0byB0aGUgYXBwcm9wcmlhdGUgbWV0aG9kXG4gICAqIHdpdGggdGhlIHByb3BlciBsZXhpY2FsIHNjb3BlLlxuICAgKlxuICAgKiBAdHlwZSB7T2JqZWN0fVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdGhpcy5fb25TZWVMZXNzQ2xpY2sgPSB0aGlzLl9oYW5kbGVTZWVMZXNzQ2xpY2suYmluZCh0aGlzKTtcblxuICB0aGlzLl9pbml0KCk7XG59O1xuXG4vKipcbiAqIEluaXRpYWxpemVzIHRoZSBTZWVNb3JlSXRlbSBpbnN0YW5jZS5cbiAqXG4gKiBAcHJpdmF0ZVxuICovXG5TZWVNb3JlSXRlbS5wcm90b3R5cGUuX2luaXQgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuX3N0cmlwVGFncygpO1xuICB0aGlzLl9jbGFtcEl0ZW0oKTtcbn07XG5cbi8qKlxuICogU3RyaXAgdGFncyBmcm9tIHRoZSBjb250ZW50LiAkY2xhbXAgd2lsbCBub3Qgd29yayBhcyBpbnRlbmRlZCBpZiB0aGVyZSdzIG1vcmVcbiAqIHRoYW4gb25lIGNoaWxkIHBlciB0YXJnZXQgbm9kZS5cbiAqXG4gKiBAcHJpdmF0ZVxuICovXG5TZWVNb3JlSXRlbS5wcm90b3R5cGUuX3N0cmlwVGFncyA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5fZWxlbWVudC50ZXh0Q29udGVudCA9IHRoaXMuX2VsZW1lbnQuaW5uZXJIVE1MLnJlcGxhY2UoLyg8KFtePl0rKT4pL2lnLCAnJyk7XG59O1xuXG4vKipcbiAqIFJlLWNsYW1wcyB0aGUgU2VlTW9yZUl0ZW0gaW5zdGFuY2UuIFRoaXMgaXMgZGVzdHJ1Y3RpdmUuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuU2VlTW9yZUl0ZW0ucHJvdG90eXBlLl91cGRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuX2NsYW1wSXRlbSgpO1xufTtcblxuLyoqXG4gKiBDbGFtcHMgdGhlIFNlZU1vcmVJdGVtIGluc3RhbmNlLlxuICpcbiAqIEBwcml2YXRlXG4gKi9cblNlZU1vcmVJdGVtLnByb3RvdHlwZS5fY2xhbXBJdGVtID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLl9yZXNldFNlZU1vcmVCdXR0b24oKTtcblxuICB0aGlzLl9jbGFtcCA9ICRjbGFtcCh0aGlzLl9lbGVtZW50LCB7XG4gICAgY2xhbXA6IHRoaXMuX29wdGlvbnMubnVtTGluZXMsXG4gICAgdXNlTmF0aXZlQ2xhbXA6IGZhbHNlLFxuICAgIHNwbGl0T25DaGFyczogWycuJywgJy0nLCAn4oCTJywgJ+KAlCcsICcgJ10sXG4gICAgdHJ1bmNhdGlvbkNoYXI6ICcmIzgyMzA7JyxcbiAgICB0cnVuY2F0aW9uSFRNTDogU2VlTW9yZUl0ZW0uVHJ1bmNhdGlvbkhUTUwsXG4gICAgYW5pbWF0ZTogZmFsc2VcbiAgfSk7XG5cbiAgdGhpcy5fcmVnaXN0ZXJTZWVNb3JlQnV0dG9uKCk7XG59O1xuXG4vKipcbiAqIENhY2hlcyBhIHJlZmVyZW5jZSB0byB0aGUgc2VlIG1vcmUgYnV0dG9uIHBvaW50ZXIgYW5kIGFkZHMgYSBjbGljayBldmVudFxuICogbGlzdGVuZXIuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuU2VlTW9yZUl0ZW0ucHJvdG90eXBlLl9yZWdpc3RlclNlZU1vcmVCdXR0b24gPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuX3NlZU1vcmVCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoU2VlTW9yZUl0ZW0uU2VsZWN0b3JzLkJVVFRPTl9NT1JFKTtcblxuICBpZiAodGhpcy5fc2VlTW9yZUJ1dHRvbikge1xuICAgIHRoaXMuX3NlZU1vcmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9vblNlZU1vcmVDbGljayk7XG4gIH1cbn07XG5cblNlZU1vcmVJdGVtLnByb3RvdHlwZS5fcmVnaXN0ZXJTZWVMZXNzQnV0dG9uID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLl9zZWVMZXNzQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFNlZU1vcmVJdGVtLlNlbGVjdG9ycy5CVVRUT05fTEVTUyk7XG5cbiAgaWYgKHRoaXMuX3NlZUxlc3NCdXR0b24pIHtcbiAgICB0aGlzLl9zZWVMZXNzQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5fb25TZWVMZXNzQ2xpY2spO1xuICB9XG59O1xuXG4vKipcbiAqIENhbGxlZCB3aGVuIHRoZSBcInNlZSBtb3JlXCIgYnV0dG9uIGlzIHByZXNzZWQuXG4gKlxuICogQHBhcmFtIHtFdmVudH0gZXZ0XG4gKiBAcHJpdmF0ZVxuICovXG5TZWVNb3JlSXRlbS5wcm90b3R5cGUuX2hhbmRsZVNlZU1vcmVDbGljayA9IGZ1bmN0aW9uIChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgdGhpcy5fZWxlbWVudC5pbm5lckhUTUwgPSB0aGlzLl9jbGFtcC5vcmlnaW5hbCArICcgJyArIFNlZU1vcmVJdGVtLlJldmVyc2VUcnVuY2F0aW9uSFRNTDtcbiAgdGhpcy5fcmVzZXRTZWVNb3JlQnV0dG9uKCk7XG4gIHRoaXMuX3JlZ2lzdGVyU2VlTGVzc0J1dHRvbigpO1xufTtcblxuLyoqXG4gKiBDYWxsZWQgd2hlbiB0aGUgXCJzZWUgbGVzc1wiIGJ1dHRvbiBpcyBwcmVzc2VkLlxuICpcbiAqIEBwYXJhbSB7RXZlbnR9IGV2dFxuICogQHByaXZhdGVcbiAqL1xuU2VlTW9yZUl0ZW0ucHJvdG90eXBlLl9oYW5kbGVTZWVMZXNzQ2xpY2sgPSBmdW5jdGlvbiAoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIHRoaXMuX2VsZW1lbnQuaW5uZXJIVE1MID0gdGhpcy5fY2xhbXAuY2xhbXBlZDtcbiAgdGhpcy5fcmVzZXRTZWVMZXNzQnV0dG9uKCk7XG4gIHRoaXMuX3JlZ2lzdGVyU2VlTW9yZUJ1dHRvbigpO1xufTtcblxuLyoqXG4gKiBSZXNldHMgdGhlIFwic2VlIG1vcmVcIiBidXR0b24gYnkgcmVtb3ZpbmcgdGhlIGV2ZW50IGxpc3RlbmVyIGFuZCBzZXR0aW5nIHRoZVxuICogaW50ZXJuYWwgcG9pbnRlciB0byBudWxsLiBUaGlzIGFzc3VtZXMgdGhhdCB0aGUgXCJzZWUgbW9yZVwiIGJ1dHRvbiBoYXMgYmVlblxuICogZGVzdHJveWVkIGFmdGVyIGJlaW5nIGNsaWNrZWQuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuU2VlTW9yZUl0ZW0ucHJvdG90eXBlLl9yZXNldFNlZU1vcmVCdXR0b24gPSBmdW5jdGlvbiAoKSB7XG4gIGlmICh0aGlzLl9zZWVNb3JlQnV0dG9uICE9PSBudWxsKSB7XG4gICAgdGhpcy5fc2VlTW9yZUJ1dHRvbi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX29uU2VlTW9yZUNsaWNrKTtcbiAgICB0aGlzLl9zZWVNb3JlQnV0dG9uID0gbnVsbDtcbiAgfVxufTtcblxuLyoqXG4gKiBSZXNldHMgdGhlIFwic2VlIGxlc3NcIiBidXR0b24gYnkgcmVtb3ZpbmcgdGhlIGV2ZW50IGxpc3RlbmVyIGFuZCBzZXR0aW5nIHRoZVxuICogaW50ZXJuYWwgcG9pbnRlciB0byBudWxsLiBUaGlzIGFzc3VtZXMgdGhhdCB0aGUgXCJzZWUgbGVzc1wiIGJ1dHRvbiBoYXMgYmVlblxuICogZGVzdHJveWVkIGFmdGVyIGJlaW5nIGNsaWNrZWQuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuU2VlTW9yZUl0ZW0ucHJvdG90eXBlLl9yZXNldFNlZUxlc3NCdXR0b24gPSBmdW5jdGlvbiAoKSB7XG4gIGlmICh0aGlzLl9zZWVMZXNzQnV0dG9uICE9PSBudWxsKSB7XG4gICAgdGhpcy5fc2VlTGVzc0J1dHRvbi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX29uU2VlTGVzc0NsaWNrKTtcbiAgICB0aGlzLl9zZWVMZXNzQnV0dG9uID0gbnVsbDtcbiAgfVxufTtcblxuXG4vKipcbiAqIFRoZSBzZWUgbW9yZSBidXR0b24gSFRNTC5cbiAqXG4gKiBAcmVhZG9ubHlcbiAqL1xuU2VlTW9yZUl0ZW0uVHJ1bmNhdGlvbkhUTUwgPVxuICAnPGEgY2xhc3M9XCJzZWUtbW9yZS1idXR0b25cIiBocmVmPVwiI1wiIHN0eWxlPVwiZm9udDogaW5oZXJpdDtcIiB0aXRsZT1cIlNlZSBNb3JlXCI+U2hvdyBNb3JlICs8L2E+JztcblxuU2VlTW9yZUl0ZW0uUmV2ZXJzZVRydW5jYXRpb25IVE1MID1cbiAgJzxhIGNsYXNzPVwic2VlLWxlc3MtYnV0dG9uXCIgaHJlZj1cIiNcIiBzdHlsZT1cImZvbnQ6IGluaGVyaXQ7XCIgdGl0bGU9XCJTZWUgTGVzc1wiPlNob3cgTGVzcyAtPC9hPic7XG5cbi8qKlxuICogUmVsYXRlZCBTZWxlY3RvcnMgZm9yIFNlZU1vcmVJdGVtLlxuICpcbiAqIEBlbnVtIHtzdHJpbmd9XG4gKiBAcmVhZG9ubHlcbiAqL1xuU2VlTW9yZUl0ZW0uU2VsZWN0b3JzID0ge1xuICBCVVRUT05fTU9SRSA6ICcuc2VlLW1vcmUtYnV0dG9uJyxcbiAgQlVUVE9OX0xFU1MgOiAnLnNlZS1sZXNzLWJ1dHRvbidcbn07XG5cbmNpdGlTaGFyZS5jbGFtcEl0ZW0gPSBTZWVNb3JlSXRlbTtcbiIsIi8qKlxuICogQGZpbGVvdmVydmlldyBcIlNlZSBNb3JlXCIgZm9yIENpdGlCYW5rLlxuICogQGF1dGhvciBOYXRoYW4gQnVjaGFyIDxuYXRoYW5Ab2RvcG9kLmNvbT5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbnZhciBTZWVNb3JlID0ge1xuXG4gIC8qKlxuICAgKiBBbGwgYWRkZWQgXCJzZWUgbW9yZVwiIGl0ZW1zLlxuICAgKlxuICAgKiBAdHlwZSB7U2VlTW9yZUl0ZW1bXX1cbiAgICogQHByaXZhdGVcbiAgICovXG4gIF9pdGVtczogW10sXG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgYWxsIGFkZGVkIFNlZU1vcmUgaXRlbXMuXG4gICAqXG4gICAqIEBhY2Nlc3MgcHVibGljXG4gICAqL1xuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICBpdGVtLl91cGRhdGUoKTtcbiAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICogUmVnaXN0ZXJzIHRoZSBnaXZlbiBlbGVtZW50cyB3aXRoIG91ciBpbnN0YW5jZS5cbiAgICpcbiAgICogQHBhcmFtIHtIVE1MRWxlbWVudFtdfSBlbGVtZW50c1xuICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xuICAgKiBAcmV0dXJucyB7U2VlTW9yZUlyZW1bXX1cbiAgICogQGFjY2VzcyBwdWJsaWNcbiAgICovXG4gIGFkZDogZnVuY3Rpb24gKGVsZW1lbnRzLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIGVsZW1lbnRzLm1hcChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgdmFyIGl0ZW0gPSBuZXcgY2l0aVNoYXJlLmNsYW1wSXRlbShlbGVtZW50LCBvcHRpb25zKTtcblxuICAgICAgdGhpcy5faXRlbXMucHVzaChpdGVtKTtcblxuICAgICAgcmV0dXJuIGl0ZW07XG4gICAgfS5iaW5kKHRoaXMpKTtcbiAgfSxcblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgYWxsIGNsYW1wZWQgZWxlbWVudHMgd2l0aGluIHRoZSBnaXZlbiBjb250ZXh0IChvciB0aGUgZG9jdW1lbnRcbiAgICogYm9keSBpZiBubyBjb250ZXh0IGlzIHNwZWNpZmllZCkuXG4gICAqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAgICogQHBhcmFtIHtPYmplY3R9IFtjb250ZXh0PWRvY3VtZW50LmJvZHldXG4gICAqIEByZXR1cm5zIHtTZWVNb3JlSXJlbVtdfVxuICAgKiBAYWNjZXNzIHB1YmxpY1xuICAgKi9cbiAgaW5pdGlhbGl6ZUFsbDogZnVuY3Rpb24gKG9wdGlvbnMsIGNvbnRleHQpIHtcbiAgICB2YXIgY3R4ID0gY29udGV4dCB8fCBkb2N1bWVudC5ib2R5O1xuICAgIHZhciBvcHRzID0gJC5leHRlbmQoe30sIFNlZU1vcmUuRGVmYXVsdHMsIG9wdGlvbnMgfHwge30pO1xuICAgIHZhciBlbGVtZW50cyA9IGN0eC5xdWVyeVNlbGVjdG9yQWxsKFNlZU1vcmUuU2VsZWN0b3JzLkJBU0UpO1xuXG4gICAgcmV0dXJuIFNlZU1vcmUuYWRkKFNlZU1vcmUudG9BcnJheShlbGVtZW50cyksIG9wdHMpO1xuICB9XG59O1xuXG4vKipcbiAqIFN0YXRpYyBoZWxwZXIgdGhhdCB3aWxsIGNvbnZlcnQgYSBOb2RlTGlzdCBpbnRvIGEgcHJvcGVyIEFycmF5LlxuICpcbiAqIEBwYXJhbSB7Tm9kZUxpc3R9IG5vZGVMaXN0XG4gKiBAcmV0dXJucyB7SFRNTEVsZW1lbnRbXX1cbiAqIEBzdGF0aWNcbiAqL1xuU2VlTW9yZS50b0FycmF5ID0gZnVuY3Rpb24gKG5vZGVMaXN0KSB7XG4gIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChub2RlTGlzdCk7XG59O1xuXG4vKipcbiAqIFJlbGF0ZWQgY2xhc3MgbmFtZXMgZm9yIFNlZU1vcmUuXG4gKlxuICogQGVudW0ge3N0cmluZ31cbiAqIEByZWFkb25seVxuICovXG5TZWVNb3JlLkNsYXNzTmFtZXMgPSB7XG4gIEJBU0U6ICdzZWUtbW9yZSdcbn07XG5cbi8qKlxuICogUmVsYXRlZCBTZWxlY3RvcnMgZm9yIFNlZU1vcmUuXG4gKlxuICogQGVudW0ge3N0cmluZ31cbiAqIEByZWFkb25seVxuICovXG5TZWVNb3JlLlNlbGVjdG9ycyA9IHtcbiAgQkFTRTogJy5zZWUtbW9yZSdcbn07XG5cbi8qKlxuICogQGVudW0ge21peGVkfSBEZWZhdWx0c1xuICogQHJlYWRvbmx5XG4gKi9cblNlZU1vcmUuRGVmYXVsdHMgPSB7XG4gIG51bUxpbmVzOiA1XG59O1xuXG4vKipcbiAqIENpdGlCYW5rIFNlZU1vcmUgcHVibGljIEFQSS5cbiAqXG4gKiBAZW51bSB7T2JqZWN0fVxuICogQHJlYWRvbmx5XG4gKi9cbmNpdGlTaGFyZS5zZWVNb3JlID0ge1xuICBpbml0QWxsOiBTZWVNb3JlLmluaXRpYWxpemVBbGwsXG4gIHVwZGF0ZTogU2VlTW9yZS51cGRhdGVcbn07XG5cbmNpdGlTaGFyZS5zZWVNb3JlLmluaXRBbGwoKTtcbiIsImNpdGlTaGFyZS5zaG93TW9yZSA9IChmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBmdW5jdGlvbiBjaGVja1N0YXJ0U3RyaW5nKHN0cmluZywgc3RyaW5nVG9GaW5kKSB7XG4gICAgcmV0dXJuIHN0cmluZy5pbmRleE9mKHN0cmluZ1RvRmluZCwgMCkgPT09IDA7XG4gIH1cblxuICBmdW5jdGlvbiBjaGVja0VuZFN0cmluZyhzdHJpbmcsIHNlYXJjaFN0cmluZykge1xuICAgIHZhciBzdWJqZWN0U3RyaW5nID0gc3RyaW5nLFxuICAgICAgcG9zaXRpb24gPSBzdWJqZWN0U3RyaW5nLmxlbmd0aDtcbiAgICBwb3NpdGlvbiAtPSBzZWFyY2hTdHJpbmcubGVuZ3RoO1xuICAgIHZhciBsYXN0SW5kZXggPSBzdWJqZWN0U3RyaW5nLmxhc3RJbmRleE9mKHNlYXJjaFN0cmluZywgcG9zaXRpb24pO1xuICAgIHJldHVybiBsYXN0SW5kZXggIT09IC0xICYmIGxhc3RJbmRleCA9PT0gcG9zaXRpb247XG4gIH1cblxuICB2YXIgY29uZmlnID0ge1xuICAgICRzaG93TW9yZUNvbXBvbmVudDogJCgnLnNob3ctbW9yZS1jb21wb25lbnQnKSxcbiAgICBtaW5Db3B5TGVuZ3RoOiAxNjBcbiAgfTtcblxuICBmdW5jdGlvbiBfaW5pdFNob3dNb3JlKCkge1xuICAgICQuZWFjaChjb25maWcuJHNob3dNb3JlQ29tcG9uZW50LCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgICB0ZXh0U2VsZWN0b3IgPSAkdGhpcy5zaWJsaW5ncyhcIi5tZXNzYWdlLW1vcmVcIik7XG4gICAgICAkdGhpcy5kYXRhKFwibW9yZVwiLCB0cnVuY2F0ZSh0ZXh0U2VsZWN0b3IpKTtcbiAgICAgICR0aGlzLmRhdGEoXCJsZXNzXCIsIHRleHRTZWxlY3Rvci5odG1sKCkpO1xuXG5cbiAgICAgIGlmICh0ZXh0U2VsZWN0b3IuaHRtbCgpLnJlcGxhY2UoLzwhLS1bXFxzXFxTXSo/LS0+L2csIFwiXCIpLnRyaW0oKS5sZW5ndGggPiBjb25maWcubWluQ29weUxlbmd0aCkge1xuICAgICAgICAkdGhpcy5zaG93KCk7XG4gICAgICAgICR0aGlzLmFkZENsYXNzKFwib3BlblwiKTtcbiAgICAgICAgZGV0ZWN0VHJ1bmMoJHRoaXMsIHRleHRTZWxlY3Rvcik7XG4gICAgICAgICR0aGlzLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgZGV0ZWN0VHJ1bmMoJHRoaXMsIHRleHRTZWxlY3Rvcik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZGV0ZWN0VHJ1bmMobGluaywgc2VsZWN0b3IpIHtcbiAgICBpZiAobGluay5oYXNDbGFzcygnb3BlbicpKSB7XG4gICAgICBsaW5rLnJlbW92ZUNsYXNzKCdvcGVuJyk7XG4gICAgICBzZWxlY3Rvci5odG1sKGxpbmsuZGF0YShcIm1vcmVcIikpO1xuICAgICAgbGluay5odG1sKGxpbmsuZGF0YShcIm1vcmUtYWN0aW9uXCIpKTtcbiAgICAgIGxpbmsuYXR0cihcImFyaWEtZXhwYW5kZWRcIiwgXCJmYWxzZVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGluay5hZGRDbGFzcygnb3BlbicpO1xuICAgICAgc2VsZWN0b3IuaHRtbChsaW5rLmRhdGEoXCJsZXNzXCIpKTtcbiAgICAgIGxpbmsuaHRtbChsaW5rLmRhdGEoXCJsZXNzLWFjdGlvblwiKSk7XG4gICAgICBsaW5rLmF0dHIoXCJhcmlhLWV4cGFuZGVkXCIsIFwidHJ1ZVwiKTtcbiAgICB9XG4gICAgY2hlY2tDb2x1bW5IZWlnaHQoc2VsZWN0b3IucGFyZW50cyhcInVsXCIpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoZWNrQ29sdW1uSGVpZ2h0KGxpc3QpIHtcbiAgICB2YXIgaGVpZ2h0VG9VcGRhdGUgPSAwO1xuICAgICQuZWFjaChsaXN0LmZpbmQoXCIubXktYWNjb3VudC1hY2Nlc3NpYmxlLWxpc3QtY29sdW1uMVwiKSwgZnVuY3Rpb24gKCkge1xuICAgICAgaGVpZ2h0VG9VcGRhdGUgKz0gJCh0aGlzKS5vdXRlckhlaWdodCh0cnVlKTtcbiAgICB9KTtcbiAgICBsaXN0LmNzcyhcImhlaWdodFwiLCBoZWlnaHRUb1VwZGF0ZSk7XG4gICAgbGlzdC5maW5kKFwiLnJlc2V0MVwiKS5jc3MoXCJtYXJnaW4tdG9wXCIsIGhlaWdodFRvVXBkYXRlICogLTEpO1xuICB9XG5cbiAgZnVuY3Rpb24gX3Jlc2V0SGVpZ2h0cygpIHtcbiAgICAkLmVhY2goY29uZmlnLiRzaG93TW9yZUNvbXBvbmVudCwgZnVuY3Rpb24gKCkge1xuICAgICAgY2hlY2tDb2x1bW5IZWlnaHQoJCh0aGlzKS5wYXJlbnRzKFwidWxcIikpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gdHJ1bmNhdGUoc2VsZWN0b3IpIHtcbiAgICB2YXIgdHJ1bmNhdGVkVGV4dCA9IHNlbGVjdG9yLmh0bWwoKSxcbiAgICAgIHRydW5jYXRlZFRleHRUcmltbWVkID0gdHJ1bmNhdGVkVGV4dC5yZXBsYWNlKC88IS0tW1xcc1xcU10qPy0tPi9nLCBcIlwiKS50cmltKCk7XG5cbiAgICB0cnVuY2F0ZWRUZXh0ID0gdHJ1bmNhdGVkVGV4dFRyaW1tZWQuc3Vic3RyaW5nKDAsIGNvbmZpZy5taW5Db3B5TGVuZ3RoKSArICcuLi4nO1xuICAgIGlmIChjaGVja1N0YXJ0U3RyaW5nKHNlbGVjdG9yLmh0bWwoKS50cmltKCksIFwiPCEtLSBEYXRhIFN0YXJ0IC0tPlwiKSkge1xuICAgICAgdHJ1bmNhdGVkVGV4dCA9IFwiPCEtLSBEYXRhIFN0YXJ0IC0tPlwiICsgdHJ1bmNhdGVkVGV4dDtcbiAgICB9XG4gICAgaWYgKHRydW5jYXRlZFRleHRUcmltbWVkLnNsaWNlKC0xKSA9PT0gXCJdXCIpIHtcbiAgICAgIHRydW5jYXRlZFRleHQgKz0gXCJdXCI7XG4gICAgfVxuICAgIGlmIChjaGVja0VuZFN0cmluZyhzZWxlY3Rvci5odG1sKCkudHJpbSgpLCBcIjwhLS0tIERhdGEgRW5kIC0tLS0+XCIpKSB7XG4gICAgICB0cnVuY2F0ZWRUZXh0ID0gdHJ1bmNhdGVkVGV4dCArIFwiPCEtLS0gRGF0YSBFbmQgLS0tLT5cIjtcbiAgICB9XG4gICAgcmV0dXJuIHRydW5jYXRlZFRleHQ7XG4gIH1cblxuICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICBfaW5pdFNob3dNb3JlKCk7XG4gIH0sIDMwMCk7XG5cbiAgcmV0dXJuIHtcbiAgICByZXNldEhlaWdodHM6IF9yZXNldEhlaWdodHNcbiAgfTtcblxufSkoKTtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIFRhYnMgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gIC8qKlxuICAgKiBCYXNlIGVsZW1lbnRcbiAgICogQHR5cGUge0VsZW1lbnR9XG4gICAqL1xuICB0aGlzLl9lbGVtZW50ID0gZWxlbWVudDtcblxuICAvKipcbiAgICogQmFzZSBlbGVtZW50XG4gICAqIEB0eXBlIHtqUXVlcnl9XG4gICAqL1xuICB0aGlzLiRlbCA9ICQoZWxlbWVudCk7XG5cbiAgLyoqXG4gICAqIEZpbHRlciB0YWJzXG4gICAqIEB0eXBlIHtqUXVlcnl9XG4gICAqL1xuICB0aGlzLl8kdGFicyA9ICQoJy4nICsgVGFicy5DbGFzc05hbWUuVEFCUyk7XG5cbiAgLyoqXG4gICAqIEZpbHRlciB0YWJzXG4gICAqIEB0eXBlIHtBcnJheX1cbiAgICovXG4gIHRoaXMuX3RhYnMgPSBUYWJzLnRvQXJyYXkodGhpcy5fJHRhYnMpO1xuXG4gIC8qKlxuICAgKiBUYWIgcGFuZXNcbiAgICogQHR5cGUge0FycmF5fVxuICAgKi9cbiAgdGhpcy5fcGFuZXMgPSB0aGlzLl90YWJzLm1hcChmdW5jdGlvbih0YWIpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRhYnMtcGFuZVtkYXRhLWZvcj1cIicrIHRhYi5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKSArJ1wiXScpO1xuICB9KTtcblxuICB0aGlzLl9jbGlja0xpc3RlbmVyID0gdGhpcy5faGFuZGxlQ2xpY2tFdmVudC5iaW5kKHRoaXMpO1xuICB0aGlzLl9rZXlkb3duTGlzdGVuZXIgPSB0aGlzLl9oYW5kbGVLZXlQcmVzcy5iaW5kKHRoaXMpO1xuICB0aGlzLl9hY3RpdmVUYWIgPSBudWxsO1xuICB0aGlzLnRhYklkID0gJyc7XG5cbiAgdGhpcy5faW5pdCgpO1xufTtcblxuVGFicy50b0FycmF5ID0gZnVuY3Rpb24oYXJyYXlMaWtlKSB7XG4gIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnJheUxpa2UpO1xufTtcblxuLyoqXG4gKiBJbml0aWFsaXplcyB0aGUgVGFicyBjb21wb25lbnRcbiAqL1xuVGFicy5wcm90b3R5cGUuX2luaXQgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5fcHJvY2Vzc1RhYnMoKTtcbiAgdGhpcy5fYmluZEV2ZW50cygpO1xuXG4gIC8vaGFyZC1jb2RlZCBmaXJzdCB2YWx1ZVxuICB0aGlzLnNldEFjdGl2ZVRhYih0aGlzLl8kdGFicy5lcSgwKVswXSk7XG59O1xuXG5UYWJzLnByb3RvdHlwZS5zZXRBY3RpdmVUYWIgPSBmdW5jdGlvbih0YWIpIHtcbiAgdGhpcy5fJHRhYnMucmVtb3ZlQ2xhc3MoVGFicy5DbGFzc05hbWUuQUNUSVZFX1RBQik7XG4gIHRoaXMuXyR0YWJzLmF0dHIoJ2FyaWEtc2VsZWN0ZWQnLCAnZmFsc2UnKTtcbiAgdGhpcy5fYWN0aXZlVGFiID0gdGFiO1xuICAkKHRoaXMuX2FjdGl2ZVRhYikuYWRkQ2xhc3MoVGFicy5DbGFzc05hbWUuQUNUSVZFX1RBQik7XG4gICQodGhpcy5fYWN0aXZlVGFiKS5hdHRyKCdhcmlhLXNlbGVjdGVkJywgJ3RydWUnKTtcbiAgdGhpcy50YWJJZCA9IHRoaXMuX2FjdGl2ZVRhYi5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTtcbiAgdGhpcy5fc2hvd1BhbmUoKTtcbn07XG5cbi8qKlxuICogQWRkcyBhcmlhIHN0YXRlcyBmb3Igc2NyZWVuIHJlYWRlcnNcbiAqL1xuVGFicy5wcm90b3R5cGUuX3Byb2Nlc3NUYWJzID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuJGVsLmF0dHIoJ3JvbGUnLCAndGFibGlzdCcpO1xuXG4gIHRoaXMuXyR0YWJzLmF0dHIoe1xuICAgIHJvbGU6ICd0YWInLFxuICAgIHRhYkluZGV4OiAwXG4gIH0pO1xuXG4gIHRoaXMuX3BhbmVzLmZvckVhY2goZnVuY3Rpb24oZWwpIHtcbiAgICBlbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgdHJ1ZSk7XG4gIH0pO1xufTtcblxuLyoqXG4gKiBCaW5kcyB3aW5kb3csIGNsaWNrLCBhbmQga2V5cHJlc3MgZXZlbnRzIHRvIHRhYnNcbiAqL1xuXG5UYWJzLnByb3RvdHlwZS5fYmluZEV2ZW50cyA9IGZ1bmN0aW9uKCkge1xuICAkKHdpbmRvdykub24oJ3Jlc2l6ZS50YWJzIG9yaWVudGF0aW9uY2hhbmdlLnRhYnMnLCB0aGlzLl9yZXNpemVMaXN0ZW5lcik7XG4gIHRoaXMuXyR0YWJzLm9uKCdjbGljay50YWJzJywgdGhpcy5fY2xpY2tMaXN0ZW5lcik7XG4gIHRoaXMuXyR0YWJzLm9uKCdrZXlkb3duLnRhYnMnLCB0aGlzLl9rZXlkb3duTGlzdGVuZXIpO1xufTtcblxuLyoqXG4gKiBSZWdpc3RlcnMgdGhlIGFjdGl2ZSB0YWJcbiAqIEBwYXJhbSB7RXZlbnR9IGpRdWVyeSBFdmVudFxuICovXG5UYWJzLnByb3RvdHlwZS5faGFuZGxlQ2xpY2tFdmVudCA9IGZ1bmN0aW9uKGUpIHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGlmICh0aGlzLl9hY3RpdmVUYWIgIT09IGUuY3VycmVudFRhcmdldCkge1xuICAgIHRoaXMuc2V0QWN0aXZlVGFiKGUuY3VycmVudFRhcmdldCk7XG4gIH1cbn07XG5cbi8qKlxuICogUmVnaXN0ZXJzIHRoZSBhY3RpdmUgdGFiIG9uIGBFTlRFUmAga2V5cHJlc3NcbiAqIGFuZCBtb3ZlIGJldHdlZW4gdGFicyBvbiBgTEVGVGAgb3IgYFJJR0hUYCBrZXlwcmVzc1xuICogQHBhcmFtIHtFdmVudH0galF1ZXJ5IEV2ZW50XG4gKi9cblRhYnMucHJvdG90eXBlLl9oYW5kbGVLZXlQcmVzcyA9IGZ1bmN0aW9uKGUpIHtcblxuICB2YXIgZm9jdXNlZFRhYiA9IHRoaXMuX2NsYW1wKHRoaXMuX2dldEZvY3VzZWRUYWJJbmRleCgpKTtcblxuICBzd2l0Y2goZS53aGljaCkge1xuICAgIGNhc2UgVGFicy5LZXlzLkVOVEVSOlxuICAgICAgdGhpcy5faGFuZGxlQ2xpY2tFdmVudChlKTtcbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSBUYWJzLktleXMuTEVGVDpcbiAgICAgIGZvY3VzZWRUYWItLTtcbiAgICAgIHRoaXMuX2ZvY3VzVGFiKGZvY3VzZWRUYWIpO1xuICAgICAgYnJlYWs7XG5cbiAgICBjYXNlIFRhYnMuS2V5cy5SSUdIVDpcbiAgICAgIGZvY3VzZWRUYWIrKztcbiAgICAgIHRoaXMuX2ZvY3VzVGFiKGZvY3VzZWRUYWIpO1xuICAgICAgYnJlYWs7XG4gIH1cbn07XG5cbi8qKlxuICogRm9jdXMgb24gYSB0YWIuXG4gKiBAcGFyYW0ge251bWJlcn0gaW5kZXggVGFiIGluZGV4IHRvIGZvY3VzIG9uLlxuICovXG5UYWJzLnByb3RvdHlwZS5fZm9jdXNUYWIgPSBmdW5jdGlvbihpbmRleCkge1xuICB0aGlzLl8kdGFicy5lcShpbmRleCkuZm9jdXMoKTtcbn07XG5cbi8qKlxuICogQ2xhbXAgYSB2YWx1ZSBiZXR3ZWVuIHZhbGlkIGluZGV4ZXMgb2YgdGhlIHRhYnMuXG4gKiBAcGFyYW0ge251bWJlcn0gaW5kZXggSW5kZXggdG8gY2xhbXAuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IENsYW1wZWQgaW5kZXguXG4gKi9cblRhYnMucHJvdG90eXBlLl9jbGFtcCA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gIHJldHVybiBNYXRoLm1pbihNYXRoLm1heChpbmRleCwgMCksIHRoaXMuX3RhYnMubGVuZ3RoIC0gMSk7XG59O1xuXG4vKipcbiAqIEZpbmQgdGhlIGluZGV4IG9mIHRoZSBjdXJyZW50bHkgZm9jdXNlZCB0YWIuXG4gKiBAcmV0dXJuIHtudW1iZXJ9XG4gKi9cblRhYnMucHJvdG90eXBlLl9nZXRGb2N1c2VkVGFiSW5kZXggPSBmdW5jdGlvbigpIHtcbiAgdmFyICRmb2N1c2VkVGFiID0gJChkb2N1bWVudC5hY3RpdmVFbGVtZW50KS5jbG9zZXN0KCcuJyArIFRhYnMuQ2xhc3NOYW1lLlRBQlMpO1xuICByZXR1cm4gdGhpcy5fJHRhYnMuaW5kZXgoJGZvY3VzZWRUYWIpO1xufTtcblxuVGFicy5wcm90b3R5cGUuX3Nob3dQYW5lID0gZnVuY3Rpb24oKSB7XG4gIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgdmFyIGFjdGl2ZVBhbmUgPSB0aGlzLl9wYW5lcy5maWx0ZXIoZnVuY3Rpb24ocGFuZSkge1xuICAgIHJldHVybiBwYW5lLmdldEF0dHJpYnV0ZSgnZGF0YS1mb3InKSA9PT0gX3RoaXMudGFiSWQ7XG4gIH0pWzBdO1xuXG4gIHZhciBpbmFjdGl2ZVBhbmVzID0gdGhpcy5fcGFuZXMuZmlsdGVyKGZ1bmN0aW9uKHBhbmUpIHtcbiAgICByZXR1cm4gcGFuZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtZm9yJykgIT09IF90aGlzLnRhYklkO1xuICB9KTtcblxuICB0aGlzLl9oaWRlUGFuZXMoaW5hY3RpdmVQYW5lcyk7XG5cbiAgJChhY3RpdmVQYW5lKS5hZGRDbGFzcyhUYWJzLkNsYXNzTmFtZS5BQ1RJVkVfUEFORSk7XG4gICQoYWN0aXZlUGFuZSkucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xuICBhY3RpdmVQYW5lLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCBmYWxzZSk7XG59O1xuXG5UYWJzLnByb3RvdHlwZS5faGlkZVBhbmVzID0gZnVuY3Rpb24ocGFuZXMpIHtcbiAgcGFuZXMuZm9yRWFjaChmdW5jdGlvbihlbCkge1xuICAgIGVsLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCB0cnVlKTtcbiAgICAkKGVsKS5hZGRDbGFzcygnaGlkZGVuJyk7XG4gICAgJChlbCkucmVtb3ZlQ2xhc3MoVGFicy5DbGFzc05hbWUuQUNUSVZFX1BBTkUpO1xuICB9KTtcbn07XG5cblRhYnMuS2V5cyA9IHtcbiAgRU5URVI6IDEzLFxuICBMRUZUOiAzNyxcbiAgUklHSFQ6IDM5LFxufTtcblxuXG5UYWJzLkNsYXNzTmFtZSA9IHtcbiAgQkFTRTogJ3RhYnMnLFxuICBUQUJTOiAndGFicy10YWInLFxuICBBQ1RJVkVfVEFCOiAndGFicy10YWItaXMtYWN0aXZlJyxcbiAgQUNUSVZFX1BBTkU6ICd0YWJzLXBhbmUtaXMtYWN0aXZlJ1xufTtcblxuVGFicy5pbml0aWFsaXplQWxsID0gZnVuY3Rpb24oKSB7XG4gIFRhYnMudG9BcnJheSgkKCcudGFicy5mYXEtdGFicycpKS5mb3JFYWNoKGZ1bmN0aW9uKGVsKSB7XG4gICAgcmV0dXJuIG5ldyBUYWJzKGVsKTtcbiAgfSk7XG59O1xuXG5UYWJzLmluaXQgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gIHJldHVybiBuZXcgVGFicyhlbGVtZW50KTtcbn07XG5cbmNpdGlTaGFyZS50YWJzID0gKGZ1bmN0aW9uKCl7XG5cbiAgcmV0dXJuIHtcbiAgICBpbml0OiBUYWJzLmluaXQsXG4gICAgaW5pdEFsbDogVGFicy5pbml0aWFsaXplQWxsLFxuICAgIEV2ZW50czogVGFicy5FdmVudHMsXG4gICAgQ2xhc3NOYW1lOiBUYWJzLkNsYXNzTmFtZVxuICB9O1xuXG59KSgpO1xuIiwidmFyIHNpdGVUYWdzID0gW1xuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1hY2NvcmRpb24tdG9nZ2xlXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWFkZC10by1jYXJ0XCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWJyZWFkY3J1bWItaXRlbVwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1icmVhZGNydW1iLWxpbmtcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtYnV0dG9uc2V0XCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWNhcnQtYmlsbGluZy1hZGRyZXNzLWVkaXRcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtY2FydC1jaGVja291dC1oZWFkZXItY2FuY2VsXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWNhcnQtY2hlY2tvdXQtZ2lmdC1jYXJkcy1zaGlwcGluZy1mYXFcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtY2FydC1jaGVja291dC1naWZ0LWNhcmRzLWluLXN0b3JlLXBpY2t1cC1mYXFcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtY2FydC1jaGVja291dC1zaGlwcGluZy1hZGRyZXNzLWVkaXRcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtY2FydC1jaGVja291dC1zaGlwcGluZy1hZGRyZXNzLXR5cGUtY2hhbmdlXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWNhcnQtY2hlY2tvdXQtY2hhbmdlLXJlY2lwaWVudFwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1jYXJ0LWNoZWNrb3V0LWNoYW5nZS1yZWNpcGllbnQtZWRpdC1tZXNzYWdlXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWNhcnQtY2hlY2tvdXQtY2hhbmdlLXJlY2lwaWVudC1jYW5jZWxcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtY2FydC1jaGVja291dC1jaGFuZ2UtcmVjaXBpZW50LWFwcGx5XCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWNhcnQtY2hlY2tvdXQtaXRlbS1hZGRcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtY2FydC1jaGVja291dC1pdGVtLXJlbW92ZVwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1jYXJ0LWNoZWNrb3V0LXN1bW1hcnktY29udGludWVcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtY2FydC1jaGVja291dC1zdW1tYXJ5LWNhbmNlbFwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1jYXJ0LWNvbmZpcm1hdGlvbi1vcmRlci1oaXN0b3J5XCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWNhcnQtY29uZmlybWF0aW9uLWNvbnRpbnVlLXNob3BwaW5nXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWNhcnQtY29uZmlybWF0aW9uLXByaW50XCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWNhcnQtY29uZmlybWF0aW9uLWdpZnQtY2FyZHMtc2hpcHBpbmctZmFxXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWNhcnQtY29uZmlybWF0aW9uLWluLXN0b3JlLXBpY2t1cC1mYXFcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtY2FydC1yZXZpZXctZ2lmdC1jYXJkcy1zaGlwcGluZy1mYXFcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtY2FydC1yZXZpZXctZ2lmdC1jYXJkcy1pbi1zdG9yZS1waWNrdXAtZmFxXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWNhcnQtcmV2aWV3LWhlYWRlci1jYW5jZWxcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtY2FydC1yZXZpZXctaGVhZGVyLXJldHVyblwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1jYXJ0LXJldmlldy1zdW1tYXJ5LXN1Ym1pdFwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1jYXJ0LXJldmlldy1zdW1tYXJ5LWNhbmNlbFwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1jYXRlZ29yeS1jdGFcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtY2F0ZWdvcnktaW5kZXgtbGlua1wiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1jYXRlZ29yeS1pdGVtXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWRlbGl2ZXJ5LXRlcm1zXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWRyb3Bkb3duLW1lbnVcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtZHJvcGRvd24tb3B0aW9uXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWFjY291bnQtZHJvcGRvd24tbWVudVwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1hY2NvdW50LWRyb3Bkb3duLW9wdGlvblwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1mb290ZXItZmFjZWJvb2tcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtZm9vdGVyLWxpbmtcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtZm9vdGVyLXNpdGVtYXBcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtZm9vdGVyLXR3aXR0ZXJcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtZm9vdGVyLXlvdXR1YmVcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtZmlsdGVyLWRvbmVcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtZmlsdGVyLXJlc2V0XCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWZpbHRlci10YWJcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtaGVhZGVyLWNhcnRcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtaGVhZGVyLWNoZWNrLWJhbGFuY2VcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtaGVhZGVyLWNpdGlcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtaGVhZGVyLWxvZ2luXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWhlYWRlci1sb2dvdXRcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtaGVhZGVyLW1lcmNoYW5kaXNlXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWhlYWRlci1zZWFyY2gtYnV0dG9uXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLWhlYWRlci1zZWFyY2gtZmllbGRcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtaGVhZGVyLXRyYXZlbFwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1pbnB1dC1maWVsZFwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1saXZlLWNoYXQtYnRuXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLW1vZGFsLWFkZC10by1jYXJ0LWxhdW5jaFwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1tb2RhbC1hZGQtdG8tY2FydC1jbG9zZVwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1tb2RhbC1hZGQtdG8tY2FydC1jb250aW51ZS1zaG9wcGluZ1wiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1tb2RhbC1hZGQtdG8tY2FydC1nby10by1jYXJ0XCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLW1vZGFsLXNlc3Npb24tZW5kZWQtbGF1bmNoXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLW1vZGFsLXNlc3Npb24tZW5kZWQtY2xvc2VcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtbW9kYWwtc2Vzc2lvbi10aW1lb3V0LWxhdW5jaFwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1tb2RhbC1zZXNzaW9uLXRpbWVvdXQtY2xvc2VcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtbW9kYWwtc2Vzc2lvbi10aW1lb3V0LW5vXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLW1vZGFsLXNlc3Npb24tdGltZW91dC15ZXNcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtbW9kYWwtc2Vzc2lvbi12aXNpdG9yLWxhdW5jaFwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1tb2RhbC12aXNpdG9yLWNsb3NlXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLW1vZGFsLXZpc2l0b3ItY29udGludWVcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtbW9kYWwtdmlzaXRvci1zaWduLW9uXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLW51bWVyaWMtc3RlcHBlci1pbmNyZWFzZVwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1udW1lcmljLXN0ZXBwZXItaW5wdXRcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtcGFnaW5hdGlvbi1uZXh0XCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLXBhZ2luYXRpb24tcHJldmlvdXNcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtcGFnaW5hdGlvbi1wYWdlXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLXBscC1kZXRhaWxcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtcHJvZHVjdC1kZXRhaWwtdGl0bGVcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtcHJvbW8tY3RhXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLXF1aWNrdmlldy1jbG9zZVwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1xdWlja3ZpZXctZGV0YWlsc1wiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1xdWlja3ZpZXctb3BlblwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1zZWFyY2gtc3VnZ2VzdGlvblwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1zbGlkZXItaXRlbVwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1zbGlkZXItbmV4dFwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1zbGlkZXItcHJldmlvdXNcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtc2xpZGVyLXBhZ2luYXRpb25cIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtc3RpY2t5LWZpbHRlclwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS1zd3AtZGV0YWlsc1wiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS10YWJcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiY2xhc3NcIjogXCIub21uaXR1cmUtdGFiLXByb2R1Y3QtaW5mb1wiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS10YWItcHJvZHVjdC1kZWxpdmVyeVwiLFxuICAgICAgICBcIm9wdHNcIiA6IFwiXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJjbGFzc1wiOiBcIi5vbW5pdHVyZS10b29sdGlwXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLXRyYXZlbC1yZXN1bHRzXCIsXG4gICAgICAgIFwib3B0c1wiIDogXCJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBcImNsYXNzXCI6IFwiLm9tbml0dXJlLXRyYXZlbC1yZXN1bHRzLWJvb2tcIixcbiAgICAgICAgXCJvcHRzXCIgOiBcIlwiXG4gICAgfVxuXTtcblxuZnVuY3Rpb24gZmlyZVRhZ3MoKXtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgc2l0ZVRhZ3MuZm9yRWFjaChmdW5jdGlvbihlbGVtKSB7XG4gICAgICAgICQoZWxlbS5jbGFzcykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwibGV0J3MgZmlyZSBhIHRhZyBoZXJlXCIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuZmlyZVRhZ3MoKTtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIFRlcm1zU2VjdGlvbiA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgdGhpcy4kZWwgPSAkKGVsZW1lbnQpO1xuXG4gIHRoaXMudHJpZ2dlciA9IHRoaXMuJGVsLmZpbmQoJy5qcy10ZXJtcy10cmlnZ2VyJyk7XG4gIHRoaXMuX2Ryb3Bkb3duID0gdGhpcy5lbGVtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ29tbml0dXJlLWRyb3Bkb3duLW1lbnUnKVswXTtcblxuICB0aGlzLl9idXR0b24gPSAkKCcudWktc2VsZWN0bWVudS1idXR0b24nKTtcblxuICB0aGlzLnRhYnNTZWN0aW9uID0gbnVsbDtcbiAgdGhpcy5fdHJpZ2dlckNsaWNrID0gdGhpcy5faGFuZGxlVHJpZ2dlckNsaWNrLmJpbmQodGhpcyk7XG5cbiAgdGhpcy5faW5pdCgpO1xuXG4gIHRoaXMuX2luaXRpYWxpemVkID0gZmFsc2U7XG5cbiAgdGhpcy5fZGV0ZXJtaW5lQWN0aXZlVGFicygpO1xufTtcblxuVGVybXNTZWN0aW9uLnByb3RvdHlwZS5faW5pdCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgdGFicyA9IHRoaXMuJGVsLmZpbmQoJy5mYXEtdGFicycpWzBdO1xuICB0aGlzLnRhYnNTZWN0aW9uID0gY2l0aVNoYXJlLnRhYnMuaW5pdCh0YWJzKTtcblxuICB0aGlzLnRyaWdnZXIub24oJ2NsaWNrJywgdGhpcy5fdHJpZ2dlckNsaWNrKTtcbiAgdGhpcy5fYnV0dG9uLm9uKCdjbGljaycsIHRoaXMuX2hhbmRsZURyb3Bkb3duQ2xpY2suYmluZCh0aGlzKSk7XG5cbiAgdGhpcy5fc2V0Rmlyc3RBY2NvcmRpb25zT3BlbigpO1xuICB0aGlzLl9zZXRTZWxlY3RVSVdpZHRoKCk7XG4gIHRoaXMuX3NldElubmVyVGFiSW5kZXgoKTtcbn07XG5cblRlcm1zU2VjdGlvbi5wcm90b3R5cGUuX2hhbmRsZURyb3Bkb3duQ2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcblxuICB0aGlzLl9oaWRlRmlyc3RPcHRpb24oKTtcbiAgdGhpcy5faW5pdGlhbGl6ZWQgPSB0cnVlO1xufTtcblxuVGVybXNTZWN0aW9uLnByb3RvdHlwZS5faGFuZGxlVHJpZ2dlckNsaWNrID0gZnVuY3Rpb24oZSkge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIHRoaXMuX2RldGVybWluZUFjdGl2ZVRhYnMoKTtcbiAgdGhpcy5faGlkZUZpcnN0T3B0aW9uKCk7XG4gIHRoaXMuX2luaXRpYWxpemVkID0gdHJ1ZTtcbn07XG5cblRlcm1zU2VjdGlvbi5wcm90b3R5cGUuX2hpZGVGaXJzdE9wdGlvbiA9IGZ1bmN0aW9uKCkge1xuICBpZiAodGhpcy5faW5pdGlhbGl6ZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIGRyb3Bkb3duID0gJCgnLnVpLXNlbGVjdG1lbnUtbWVudScpO1xuICB2YXIgZHJvcGRvd25FbGVtZW50cyA9IGRyb3Bkb3duLmZpbmQoJy51aS1tZW51LWl0ZW0nKTtcbiAgdmFyIGN1cnJlbnREcm9wZG93bkVsZW1lbnQgPSBkcm9wZG93bkVsZW1lbnRzLmVxKDApO1xuICBcbiAgZHJvcGRvd25FbGVtZW50cy5yZW1vdmVDbGFzcygnaXMtaGlkZGVuJyk7XG4gIGN1cnJlbnREcm9wZG93bkVsZW1lbnQuYWRkQ2xhc3MoJ2lzLWhpZGRlbicpO1xufTtcblxuVGVybXNTZWN0aW9uLnByb3RvdHlwZS5fZGV0ZXJtaW5lQWN0aXZlVGFicyA9IGZ1bmN0aW9uKCkge1xuICB2YXIgdGFicztcbiAgdmFyIGluZGV4O1xuXG4gIHZhciBkcm9wZG93biA9ICQoJy51aS1zZWxlY3RtZW51LW1lbnUnKTtcblxuICBpZih0aGlzLl9kcm9wZG93bikge1xuICAgIGluZGV4ID0gdGhpcy5fZHJvcGRvd24uc2VsZWN0ZWRJbmRleDtcbiAgICB2YXIgb3B0aW9uU2VsZWN0ZWQgPSB0aGlzLl9kcm9wZG93bi5nZXRFbGVtZW50c0J5VGFnTmFtZSgnb3B0aW9uJylbaW5kZXhdO1xuICAgIHRhYnMgPSBvcHRpb25TZWxlY3RlZC5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGFicycpLnJlcGxhY2UoL1xccy9nLCAnJykuc3BsaXQoJywnKTtcbiAgfSBlbHNlIHtcbiAgICBpbmRleCA9IDA7XG4gICAgdGFicyA9IHRoaXMudGFic1NlY3Rpb24uXyR0YWJzLnRvQXJyYXkoKS5tYXAoZnVuY3Rpb24oZWwpIHtcbiAgICAgIHJldHVybiBlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTtcbiAgICB9KTtcbiAgfVxuXG4gIGlmIChkcm9wZG93bikge1xuICAgIHZhciBkcm9wZG93bkVsZW1lbnRzID0gZHJvcGRvd24uZmluZCgnLnVpLW1lbnUtaXRlbScpO1xuICAgIHZhciBjdXJyZW50RHJvcGRvd25FbGVtZW50ID0gZHJvcGRvd25FbGVtZW50cy5lcShpbmRleCk7XG4gICAgXG4gICAgZHJvcGRvd25FbGVtZW50cy5yZW1vdmVDbGFzcygnaXMtaGlkZGVuJyk7XG4gICAgY3VycmVudERyb3Bkb3duRWxlbWVudC5hZGRDbGFzcygnaXMtaGlkZGVuJyk7XG4gIH1cblxuICB0aGlzLl9zaG93VGFicyh0YWJzKTtcbn07XG5cblRlcm1zU2VjdGlvbi5wcm90b3R5cGUuX3NldFNlbGVjdFVJV2lkdGggPSBmdW5jdGlvbigpIHtcbiAgdmFyICRzZWxlY3RVSSA9ICQoJy51aS1zZWxlY3RtZW51LW1lbnUnKTtcbiAgJHNlbGVjdFVJLmFkZENsYXNzKCd0ZXJtcy1hbmQtY29uZGl0aW9ucy1zZWxlY3QtZHJvcGRvd24nKTtcbn07XG5cblRlcm1zU2VjdGlvbi5wcm90b3R5cGUuX3Nob3dUYWJzID0gZnVuY3Rpb24odGFicykge1xuICB0aGlzLnRhYnNTZWN0aW9uLl8kdGFicy5hZGRDbGFzcygndGFicy10YWItaXMtaGlkZGVuJyk7XG4gIHRoaXMudGFic1NlY3Rpb24uXyR0YWJzLnJlbW92ZUNsYXNzKCd0YWJzLXRhYi1pcy12aXNpYmxlJyk7XG4gIHRoaXMudGFic1NlY3Rpb24uXyR0YWJzLmF0dHIoJ2FyaWEtaGlkZGVuJywgdHJ1ZSk7XG5cbiAgdmFyIF90aGlzID0gdGhpcztcbiAgdmFyICRlbDtcblxuICB2YXIgYWN0aXZlVGFicyA9IHRhYnMubWFwKGZ1bmN0aW9uKGlkKSB7XG4gICAgcmV0dXJuIF90aGlzLiRlbC5maW5kKCcudGFicy10YWJbZGF0YS1pZD1cIicraWQrJ1wiXScpWzBdO1xuICB9KTtcblxuICB0aGlzLnRhYnNTZWN0aW9uLnNldEFjdGl2ZVRhYihhY3RpdmVUYWJzWzBdKTtcblxuICB0aGlzLl9zZXRUYWJXaWR0aHMoYWN0aXZlVGFicy5sZW5ndGgpO1xuXG4gIGFjdGl2ZVRhYnMuZm9yRWFjaChmdW5jdGlvbihlbCkge1xuICAgICRlbCA9ICQoZWwpO1xuICAgICRlbC5yZW1vdmVDbGFzcygndGFicy10YWItaXMtaGlkZGVuJyk7XG4gICAgJGVsLmFkZENsYXNzKCd0YWJzLXRhYi1pcy12aXNpYmxlJyk7XG4gICAgJGVsLmF0dHIoJ2FyaWEtaGlkZGVuJywgZmFsc2UpO1xuICB9KTtcbn07XG5cblRlcm1zU2VjdGlvbi5wcm90b3R5cGUuX3NldFRhYldpZHRocyA9IGZ1bmN0aW9uKG51bWJlck9mVGFicykge1xuICAkKHRoaXMudGFic1NlY3Rpb24uX2VsZW1lbnQpLmF0dHIoJ2RhdGEtdGFicy1jb3VudCcsIG51bWJlck9mVGFicyk7XG59O1xuXG5UZXJtc1NlY3Rpb24ucHJvdG90eXBlLl9zZXRJbm5lclRhYkluZGV4ID0gZnVuY3Rpb24oKSB7XG4gIHZhciBpbm5lckxpc3RzID0gdGhpcy4kZWwuZmluZCgnLnRlcm1zLWFuZC1jb25kaXRpb25zLWFjY29yZGlvbi1jb250ZW50Jyk7XG5cbiAgaW5uZXJMaXN0cy5lYWNoKGZ1bmN0aW9uKGksIGVsKSB7XG4gICAgdmFyICRlbCA9ICQoZWwpO1xuICAgIHZhciBpdGVtID0gJGVsLmZpbmQoJy50ZXJtcy1hbmQtY29uZGl0aW9ucy1hY2NvcmRpb24tY29udGVudC1pdGVtJykuZXEoMCk7XG4gICAgaXRlbS5hdHRyKCd0YWJpbmRleCcsIDApO1xuICB9KTtcbn07XG5cblRlcm1zU2VjdGlvbi5wcm90b3R5cGUuX3NldEZpcnN0QWNjb3JkaW9uc09wZW4gPSBmdW5jdGlvbigpIHtcbiAgdmFyICR0YWJQYW5lcyA9IHRoaXMuJGVsLmZpbmQoJy50YWJzLXBhbmUnKTtcbiAgJHRhYlBhbmVzLmVhY2goJC5wcm94eShmdW5jdGlvbihpbmRleCwgZWwpIHtcbiAgICB2YXIgYWNjb3JkaW9uQ29udGVudCA9ICQoZWwpLmZpbmQoJy50ZXJtcy1hbmQtY29uZGl0aW9ucy1hY2NvcmRpb24gLnRlcm1zLWFuZC1jb25kaXRpb25zLWFjY29yZGlvbi1jb250ZW50LXdyYXAnKVswXTtcbiAgICBpZihhY2NvcmRpb25Db250ZW50KSB7XG4gICAgICB0aGlzLl9vcGVuQWNjb3JkaW9uTWVudShhY2NvcmRpb25Db250ZW50KTtcbiAgICB9XG4gIH0sIHRoaXMpKTtcbn07XG5cblRlcm1zU2VjdGlvbi5wcm90b3R5cGUuX29wZW5BY2NvcmRpb25NZW51ID0gZnVuY3Rpb24ocGFyZW50RWxlbWVudCkge1xuICB2YXIgZmlyc3RFbGVtZW50SGVhZGVyID0gcGFyZW50RWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkaW9uLXRvZ2dsZS1oZWFkZXInKTtcbiAgdmFyIGZpcnN0RWxlbWVudENvbnRlbnQgPSBwYXJlbnRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRpb25TdWJNZW51Jyk7XG5cbiAgZmlyc3RFbGVtZW50SGVhZGVyLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICd0cnVlJyk7XG4gIGZpcnN0RWxlbWVudENvbnRlbnQuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ3RydWUnKTtcblxuICBmaXJzdEVsZW1lbnRIZWFkZXIuY2xhc3NMaXN0LmFkZCgnZXhwYW5kZWQnKTtcbiAgZmlyc3RFbGVtZW50Q29udGVudC5jbGFzc0xpc3QuYWRkKCdleHBhbmRlZCcpO1xuXG4gIGZpcnN0RWxlbWVudEhlYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdpcy1oaWRkZW4nKTtcbiAgZmlyc3RFbGVtZW50Q29udGVudC5jbGFzc0xpc3QucmVtb3ZlKCdpcy1oaWRkZW4nKTtcbn07XG5cblRlcm1zU2VjdGlvbi5pbml0ID0gZnVuY3Rpb24oKSB7XG4gIHZhciB0ZXJtc0VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGVybXMtYW5kLWNvbmRpdGlvbnMtc2VjdGlvbicpO1xuXG4gIGlmICh0ZXJtc0VsZW1lbnQpIHtcbiAgICByZXR1cm4gbmV3IFRlcm1zU2VjdGlvbih0ZXJtc0VsZW1lbnQpO1xuICB9XG59O1xuXG5jaXRpU2hhcmUudGVybXNTZWN0aW9uID0gKGZ1bmN0aW9uKCkge1xuICBUZXJtc1NlY3Rpb24uaW5pdCgpO1xufSkoKTtcbiIsImNpdGlTaGFyZS50YWJzID0gKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIC8qKlxuICAgICAqIFRvZ2dsZSBUYWJzXG4gICAgICogRm9yIGV4YW1wbGUsIGNpdGlTaGFyZS5wcm9kdWN0RGV0YWlscy50b2dnbGVUYWJzKFwianMtdG9nZ2xlLWRldGFpbHNcIiwgXCJ0YWJcIiwgXCJqcy1wcm9kdWN0LWRldGFpbHNcIik7XG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9nZ2xlVGFicyhsaW5rQ2xhc3MsIHR5cGUsIHNob3dDbGFzcyl7XG5cbiAgICAgICAgdmFyICR0b2dnbGVUYWJFbHMgPSAkKGxpbmtDbGFzcyk7XG5cbiAgICAgICAgJHRvZ2dsZVRhYkVscy5vbihcImNsaWNrIGtleXByZXNzXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlLndoaWNoID09PSAxMyB8fCBlLnR5cGUgPT09ICdjbGljaycpIHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGRhdGFBdHRyID0gJCh0aGlzKS5kYXRhKHR5cGUpO1xuXG4gICAgICAgICAgICAgICAgdmFyICRzaG93RGV0YWlsc0VsID0gJChzaG93Q2xhc3MgKyBcIltkYXRhLVwiICsgdHlwZSArIFwiPVwiICsgZGF0YUF0dHIgKyBcIl1cIik7XG4gICAgICAgICAgICAgICAgdmFyICRoaWRlRGV0YWlsc0VsID0gJChzaG93Q2xhc3MgKyBcIltkYXRhLVwiICsgdHlwZSArIFwiIT1cIiArIGRhdGFBdHRyICsgXCJdXCIpO1xuICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgdGFiaW5kZXhcbiAgICAgICAgICAgICAgICAkKCBsaW5rQ2xhc3MgKyBcIltkYXRhLXRhYj0nXCIgKyBkYXRhQXR0ciArIFwiJ11cIikuYXR0cihcInRhYmluZGV4XCIsIDApLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgJCggbGlua0NsYXNzICsgXCJbZGF0YS10YWIhPSdcIiArIGRhdGFBdHRyICsgXCInXVwiKS5hdHRyKFwidGFiaW5kZXhcIiwgLTEpO1xuXG4gICAgICAgICAgICAgICAgLy9JZiBzZWxmIGlzIGNsaWNrZWQsIGRvIG5vdCB0b2dnbGVcbiAgICAgICAgICAgICAgICB2YXIgaXNUb2dnbGVkID0gJHNob3dEZXRhaWxzRWwuaGFzQ2xhc3MoXCJpcy1oaWRkZW5cIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoIGlzVG9nZ2xlZCApIHtcbiAgICAgICAgICAgICAgICAgICAgJHRvZ2dsZVRhYkVscy50b2dnbGVDbGFzcyhcInByb2R1Y3QtYWN0aXZlXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICQoIGxpbmtDbGFzcyArIFwiW2RhdGEtXCIgKyBcInRhYlwiICsgXCI9XCIgKyBkYXRhQXR0ciArIFwiXVwiICkuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICQoIGxpbmtDbGFzcyArIFwiW2RhdGEtXCIgKyBcInRhYlwiICsgXCIhPVwiICsgZGF0YUF0dHIgKyBcIl1cIiApLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsIGZhbHNlKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBUb2dnbGUgZGV0YWlsc1xuICAgICAgICAgICAgICAgICAgICAkaGlkZURldGFpbHNFbC50b2dnbGVDbGFzcyhcImlzLWhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgJHNob3dEZXRhaWxzRWwudG9nZ2xlQ2xhc3MoXCJpcy1oaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICB0b2dnbGVUYWJzOiB0b2dnbGVUYWJzXG4gICAgfTtcbn0pKCk7XG4iLCIvKipcbiAqIEpTSGludDpcbiAqIFRvIGFsbG93IGJyYWNrZXQgbm90YXRpb24sXG4gKiBGb3IgZXhhbXBsZSwgdGVzdFtcInBsYWNlaG9sZGVyXCJdIHZzIHRlc3QucGxhY2Vob2xkZXJcbiAqL1xuXG4vKmpzaGludCBzdWI6dHJ1ZSovXG5cbmNpdGlTaGFyZS50b29sdGlwUmVtb3ZlID0gKGZ1bmN0aW9uKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIFxuICAgIHZhciBjdXJyZW50bHlPcGVuZWRSZW1vdmVUb29sdGlwO1xuXG4gICAgZnVuY3Rpb24gX3JlbW92ZUl0ZW0oYXJndW1lbnQpIHtcbiAgICAgICAgLy8gYSBmdW5jdGlvbiB0byByZW1vdmUgYW4gaXRlbSBmcm9tIHRoZSBjYXJ0XG4gICAgICAgIGNvbnNvbGUubG9nKCdpbiBfcmVtb3ZlSXRlbScsIGFyZ3VtZW50KTtcbiAgICAgICAgX2Nsb3NlVG9vbHRpcCgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9vcGVuVG9vbHRpcCgkcmVtb3ZlQnV0dG9uKXtcbiAgICAgICAgJHJlbW92ZUJ1dHRvbi5maW5kKCcudG9vbHRpcC1yZW1vdmUtd3JhcHBlcicpLmFkZENsYXNzKCdpcy1hY3RpdmUnKTtcbiAgICAgICAgY3VycmVudGx5T3BlbmVkUmVtb3ZlVG9vbHRpcCA9IG5ldyBjaXRpU2hhcmUuQWNjZXNzaWJsZU1vZGFsKHtcbiAgICAgICAgICBtb2RhbDogJHJlbW92ZUJ1dHRvbi5maW5kKFwiLnRvb2x0aXAtcmVtb3ZlLWRpYWxvZy13cmFwcGVyOmZpcnN0XCIpLFxuICAgICAgICAgIHByZXZpb3VzRWxlbWVudDogJHJlbW92ZUJ1dHRvbixcbiAgICAgICAgICBjbG9zZUJ1dHRvbjogJHJlbW92ZUJ1dHRvbi5maW5kKFwiLnRvb2x0aXAtcmVtb3ZlLWJ1dHRvbi1jYW5jZWxcIiksXG4gICAgICAgICAgbW9kYWxUeXBlOiAnc2ltcGxlJ1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfY2xvc2VUb29sdGlwKCl7XG4gICAgICAgICQoJy50b29sdGlwLXJlbW92ZS13cmFwcGVyJykucmVtb3ZlQ2xhc3MoJ2lzLWFjdGl2ZScpO1xuICAgICAgICBjdXJyZW50bHlPcGVuZWRSZW1vdmVUb29sdGlwID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9pbml0KCkge1xuICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmNoZWNrb3V0LWl0ZW0tcmVtb3ZlJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBfY2xvc2VUb29sdGlwKCQoJy50b29sdGlwLXJlbW92ZS13cmFwcGVyJykpO1xuXG4gICAgICAgICAgICBpZiAoISQodGhpcykuZmluZCgnLnRvb2x0aXAtcmVtb3ZlLXdyYXBwZXInKS5oYXNDbGFzcygnaXMtYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgICBfb3BlblRvb2x0aXAoJCh0aGlzKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIF9jbG9zZVRvb2x0aXAoJCh0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcub2MtY29udGVudCcsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICBpZiggZXZlbnQudGFyZ2V0LnRhZ05hbWUgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgICAgICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCcudG9vbHRpcC1yZW1vdmUtd3JhcHBlcicpLmxlbmd0aCA9PT0gMCAmJlxuICAgICAgICAgICAgICAgICEkKGV2ZW50LnRhcmdldCkuaXMoJy5jaGVja291dC1pdGVtLXJlbW92ZScpKSB7XG4gICAgICAgICAgICAgICAgICAgIF9jbG9zZVRvb2x0aXAoKTtcbiAgICAgICAgICAgIH0gICAgICAgIFxuICAgICAgICB9KTtcblxuXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcudG9vbHRpcC1yZW1vdmUtYnV0dG9uLWNvbmZpcm0nLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBfcmVtb3ZlSXRlbSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2sga2V5cHJlc3MnLCAnLnRvb2x0aXAtcmVtb3ZlLWJ1dHRvbi1jYW5jZWwnLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgIGlmIChldmVudC53aGljaCA9PT0gMTMgfHwgZXZlbnQudHlwZSA9PT0gJ2NsaWNrJykge1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBfY2xvc2VUb29sdGlwKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgX2luaXQoKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBcbiAgICB9O1xufSkoKTtcblxuIiwiLyoqXG4gKiBKU0hpbnQ6XG4gKiBUbyBhbGxvdyBicmFja2V0IG5vdGF0aW9uLFxuICogRm9yIGV4YW1wbGUsIHRlc3RbXCJwbGFjZWhvbGRlclwiXSB2cyB0ZXN0LnBsYWNlaG9sZGVyXG4gKi9cblxuLypqc2hpbnQgc3ViOnRydWUqL1xuXG5jaXRpU2hhcmUudG9vbHRpcCA9IChmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBFWElURVJfQ0xBU1MgPSAndG9vbHRpcC1leGl0ZXInLFxuICAgIFRBUkdFVF9DTEFTUyA9ICd0b29sdGlwLXRhcmdldCcsXG4gICAgVEFSR0VUX1NFTEVDVE9SID0gJy4nICsgVEFSR0VUX0NMQVNTLFxuICAgIEVYSVRFUl9TRUxFQ1RPUiA9ICcuJyArIEVYSVRFUl9DTEFTUyxcbiAgICBUT1BfQUxJR05FRF9DTEFTUyA9ICd0b29sdGlwLXRvcC1wb3NpdGlvbicsXG4gICAgVE9PTFRJUF9UT1BfQ0xBU1MgPSAndG9wLWFsaWduZWQnO1xuXG4gIHZhciAkd3JhcHBlciA9IG51bGwsXG4gICAgJGJveCA9IG51bGwsXG4gICAgJGNvbnRlbnQgPSBudWxsLFxuICAgICRhcnJvdyA9IG51bGwsXG4gICAgJGN1cnJlbnRCYXNlID0gbnVsbCxcbiAgICBjdXJyZW50Q29udGVudCA9IG51bGwsXG4gICAgaXNPcGVuID0gZmFsc2UsXG4gICAgZXhpdGVyQmVmb3JlID0gbnVsbCxcbiAgICBleGl0ZXJBZnRlciA9IG51bGwsXG4gICAgaW5pdGlhbEFycm93TWFyZ2luID0gMCxcbiAgICBpbml0aWFsaXplZCA9IGZhbHNlO1xuXG4gIGZ1bmN0aW9uIF9yZWZyZXNoQXR0cnMoJGJhc2UpIHtcbiAgICB2YXIgbGFiZWwgPSAkYmFzZS5hdHRyKCdhcmlhLWxhYmVsJyk7XG4gICAgdmFyIGNvbnRlbnQgPSAkYmFzZS5hdHRyKCdkYXRhLXRvb2x0aXAtY29udGVudCcpO1xuICAgIHZhciB0b1Nob3cgPSBjb250ZW50ID8gY29udGVudCA6IGxhYmVsO1xuXG4gICAgJGJhc2UuYXR0cignZGF0YS10b29sdGlwLWNvbnRlbnQnLCB0b1Nob3cpO1xuICAgICRiYXNlLmF0dHIoJ2FyaWEtbGFiZWwnLCBsYWJlbC5yZXBsYWNlKC88YnIgP1xcLz4vZywgJycpKTtcbiAgICAkYmFzZS5hdHRyKCd0YWJpbmRleCcsICcwJyk7XG4gIH1cblxuICAvL0NhbGwgdGhpcyBpZiBkeW5hbWljIGNvbnRlbnQgb2NjdXJzIHNvIHRoZSB0aXBzIGNhbiBiZSBwb3NpdGlvbmVkXG4gIGZ1bmN0aW9uIHJlZnJlc2goKSB7XG5cbiAgICBpZiAoaXNPcGVuKSB7XG4gICAgICBoaWRlKCk7XG4gICAgfVxuXG4gICAgJChUQVJHRVRfU0VMRUNUT1IpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcblxuICAgICAgX3JlZnJlc2hBdHRycygkdGhpcyk7XG5cbiAgICAgIC8vVGhpcyBtYXkgbmVlZCB0byBiZSBtb2RpZmllZCBhcyB1c2UtY2FzZXMgYXJpc2UuXG4gICAgICBpZiAoJHRoaXMuY3NzKCd2ZXJ0aWNhbC1hbGlnbicpICE9PSAndG9wJykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgJHBhcmVudCA9ICR0aGlzLnBhcmVudCgpO1xuICAgICAgdmFyICRwcmV2ID0gJHRoaXMucHJldigpO1xuICAgICAgdmFyICRndWlkZSA9IG51bGw7XG4gICAgICB2YXIgdHJhbnNsYXRlWSA9IDA7XG5cbiAgICAgIGlmICgkcHJldi5sZW5ndGggPiAwKSB7XG4gICAgICAgICRndWlkZSA9ICRwcmV2O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGd1aWRlID0gJHBhcmVudDtcbiAgICAgIH1cblxuICAgICAgdmFyIGd1aWRlSGVpZ2h0ID0gJGd1aWRlLmhlaWdodCgpO1xuICAgICAgdmFyIHRpcEhlaWdodCA9ICR0aGlzLmhlaWdodCgpO1xuICAgICAgaWYgKHRpcEhlaWdodCA+IGd1aWRlSGVpZ2h0KSB7XG4gICAgICAgIHRyYW5zbGF0ZVkgPSAoKHRpcEhlaWdodCAtIGd1aWRlSGVpZ2h0KSAvIDIpICogLTE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0cmFuc2xhdGVZID0gKGd1aWRlSGVpZ2h0IC8gMikgLSAodGlwSGVpZ2h0IC8gMik7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBzaG93KGNvbnRlbnQsICRiYXNlKSB7XG5cbiAgICBpc09wZW4gPSB0cnVlO1xuXG4gICAgJGN1cnJlbnRCYXNlLmF0dHIoJ3RpdGxlJywgJycpO1xuICAgICRjdXJyZW50QmFzZS5hZGRDbGFzcygndG9vbHRpcC1hY3RpdmUnKTtcbiAgICBpZiAoJGJhc2UuaGFzQ2xhc3MoVE9QX0FMSUdORURfQ0xBU1MpKSB7XG4gICAgICAkd3JhcHBlci5hZGRDbGFzcyhUT09MVElQX1RPUF9DTEFTUyk7XG4gICAgfVxuICAgICR3cmFwcGVyLmNzcygnZGlzcGxheScsICdibG9jaycpO1xuICAgICRjb250ZW50Lmh0bWwoY29udGVudCk7XG5cbiAgICB2YXIgcG9zaXRpb24gPSBfZ2V0UG9zaXRpb25Gb3JCYXNlKCRiYXNlKTtcblxuICAgIGlmIChwb3NpdGlvbi5vZmZzZXQgIT09IDApIHtcbiAgICAgIHZhciBuZXdNYXJnaW4gPSBpbml0aWFsQXJyb3dNYXJnaW47XG5cbiAgICAgIGlmIChwb3NpdGlvbi5vZmZzZXQgPCAwKSB7XG4gICAgICAgIG5ld01hcmdpbiArPSBNYXRoLmFicyhwb3NpdGlvbi5vZmZzZXQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3TWFyZ2luIC09IHBvc2l0aW9uLm9mZnNldDtcbiAgICAgIH1cbiAgICAgICRhcnJvdy5jc3MoJ21hcmdpbi1sZWZ0JywgbmV3TWFyZ2luKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGFycm93LmNzcygnbWFyZ2luLWxlZnQnLCBpbml0aWFsQXJyb3dNYXJnaW4pO1xuICAgIH1cblxuICAgICR3cmFwcGVyLmNzcyh7XG4gICAgICBvcGFjaXR5OiAxLFxuICAgICAgdG9wOiBwb3NpdGlvbi50b3AsXG4gICAgICBsZWZ0OiBwb3NpdGlvbi5sZWZ0XG4gICAgfSk7XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIGhpZGUoKSB7XG5cbiAgICBpc09wZW4gPSBmYWxzZTtcblxuICAgICRjdXJyZW50QmFzZS5yZW1vdmVDbGFzcygndG9vbHRpcC1hY3RpdmUgJyk7XG4gICAgJGN1cnJlbnRCYXNlLmF0dHIoJ3RpdGxlJywgY3VycmVudENvbnRlbnQpO1xuICAgICRjb250ZW50Lmh0bWwoJycpO1xuICAgICR3cmFwcGVyLnJlbW92ZUNsYXNzKFRPT0xUSVBfVE9QX0NMQVNTKTtcbiAgICAkd3JhcHBlci5jc3Moe1xuICAgICAgZGlzcGxheTogJ25vbmUnLFxuICAgICAgb3BhY2l0eTogMCxcbiAgICAgIHRvcDogMCxcbiAgICAgIGxlZnQ6IC05OTk5XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2V0UG9zaXRpb25Gb3JCYXNlKCRiYXNlKSB7XG4gICAgdmFyICRiID0gJCgkYmFzZSksXG4gICAgICBiYXNlT2Zmc2V0ID0gJGIub2Zmc2V0KCksXG4gICAgICBiYXNlSGVpZ2h0ID0gJGIub3V0ZXJIZWlnaHQoKSxcbiAgICAgIGJhc2VXaWR0aCA9ICRiLm91dGVyV2lkdGgoKSxcbiAgICAgIHRpcEhlaWdodCA9ICR3cmFwcGVyLmhlaWdodCgpLFxuICAgICAgdGlwV2lkdGggPSAkd3JhcHBlci53aWR0aCgpLFxuICAgICAgd2luV2lkdGggPSAkKHdpbmRvdykud2lkdGgoKSxcbiAgICAgIGlzVG9wUG9zaXRpb25lZCA9ICRiYXNlLmhhc0NsYXNzKFRPUF9BTElHTkVEX0NMQVNTKTtcblxuXG4gICAgdmFyIHRvcCA9IGlzVG9wUG9zaXRpb25lZCA/IGJhc2VPZmZzZXQudG9wIC0gKHRpcEhlaWdodCArIDEwKSA6IGJhc2VPZmZzZXQudG9wICsgYmFzZUhlaWdodCxcbiAgICAgIGxlZnQgPSBiYXNlT2Zmc2V0LmxlZnQgLSAodGlwV2lkdGggLyAyKSArIChiYXNlV2lkdGggLyAyKSxcbiAgICAgIHJpZ2h0ID0gbGVmdCArIHRpcFdpZHRoLFxuICAgICAgbGVmdEJvdW5kcyA9IDI1LFxuICAgICAgcmlnaHRCb3VuZHMgPSB3aW5XaWR0aCAtIGxlZnRCb3VuZHMsXG4gICAgICBvZmZzZXQgPSAwO1xuXG4gICAgaWYgKGxlZnQgPCBsZWZ0Qm91bmRzKSB7XG4gICAgICBvZmZzZXQgPSBsZWZ0Qm91bmRzIC0gbGVmdDtcbiAgICAgIGxlZnQgPSBsZWZ0Qm91bmRzO1xuICAgIH0gZWxzZSBpZiAocmlnaHQgPiByaWdodEJvdW5kcykge1xuICAgICAgb2Zmc2V0ID0gKHJpZ2h0IC0gcmlnaHRCb3VuZHMpICogLTE7XG4gICAgICBsZWZ0ID0gcmlnaHRCb3VuZHMgLSB0aXBXaWR0aDtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG9wOiB0b3AsXG4gICAgICBsZWZ0OiBsZWZ0LFxuICAgICAgb2Zmc2V0OiBvZmZzZXRcbiAgICB9O1xuXG4gIH1cblxuICBmdW5jdGlvbiBfdW5zZXRFeGl0ZXJzKCkge1xuICAgIGlmIChleGl0ZXJCZWZvcmUpIHtcbiAgICAgIGV4aXRlckJlZm9yZS5hdHRyKCd0YWJpbmRleCcsIG51bGwpLnJlbW92ZUNsYXNzKEVYSVRFUl9DTEFTUyk7XG4gICAgfVxuICAgIGlmIChleGl0ZXJBZnRlcikge1xuICAgICAgZXhpdGVyQWZ0ZXIuYXR0cigndGFiaW5kZXgnLCBudWxsKTtcbiAgICB9XG4gICAgZXhpdGVyQmVmb3JlID0gbnVsbDtcbiAgICBleGl0ZXJBZnRlciA9IG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBfc2V0RXhpdGVycygpIHtcbiAgICBfdW5zZXRFeGl0ZXJzKCk7XG5cbiAgICB2YXIgbmV4dFNpYmxpbmcgPSAkY3VycmVudEJhc2UubmV4dCgpO1xuICAgIHZhciBwcmV2aW91c1NpYmxpbmcgPSAkY3VycmVudEJhc2UucHJldigpO1xuXG4gICAgaWYgKG5leHRTaWJsaW5nLmxlbmd0aCA+IDApIHtcbiAgICAgIGV4aXRlckFmdGVyID0gbmV4dFNpYmxpbmc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciB0cmllcyA9IDA7XG4gICAgICB2YXIgJHRoaXNQYXJlbnQgPSAkY3VycmVudEJhc2UucGFyZW50KCk7XG4gICAgICBleGl0ZXJBZnRlciA9IG51bGw7XG5cbiAgICAgIGRvIHtcbiAgICAgICAgdmFyICRwYXJlbnRTaWJsaW5nID0gJHRoaXNQYXJlbnQubmV4dCgpO1xuXG4gICAgICAgIGlmICgkcGFyZW50U2libGluZy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdmFyIGlzSGlkZGVuID0gJHBhcmVudFNpYmxpbmcuYXR0cignYXJpYS1oaWRkZW4nKSB8fCAnZmFsc2UnO1xuICAgICAgICAgIGlmKGlzSGlkZGVuID09PSAnZmFsc2UnKSB7XG5cbiAgICAgICAgICAgIHZhciB0YWcgPSAkcGFyZW50U2libGluZ1swXS50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICBpZiAodGFnICE9PSAnZGl2Jykge1xuICAgICAgICAgICAgICBleGl0ZXJBZnRlciA9ICRwYXJlbnRTaWJsaW5nO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdmFyICRmaXJzdENoaWxkID0gJHBhcmVudFNpYmxpbmcuZmluZCgnYSwgdGQsIHRoLCBpbnB1dCwgc3BhbiwgcCwgaDEsIGgyLCBoMywgaDQsIGg1LCBoNiwgYnV0dG9uLCBsYWJlbCcpLmZpcnN0KCk7XG4gICAgICAgICAgICAgIHZhciAkcGFyZW50U2libGluZ05leHQgPSAkcGFyZW50U2libGluZy5uZXh0KCk7XG4gICAgICAgICAgICAgIGlmICgkZmlyc3RDaGlsZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFleGl0ZXJBZnRlcikge1xuICAgICAgICAgICAgICAgICAgZXhpdGVyQWZ0ZXIgPSAkZmlyc3RDaGlsZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYoJHBhcmVudFNpYmxpbmdOZXh0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZighZXhpdGVyQWZ0ZXIpIHtcbiAgICAgICAgICAgICAgICAgIGV4aXRlckFmdGVyID0gJHBhcmVudFNpYmxpbmdOZXh0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRyaWVzICs9IDE7XG4gICAgICAgICR0aGlzUGFyZW50ID0gJHRoaXNQYXJlbnQucGFyZW50KCk7XG4gICAgICB9IHdoaWxlICh0cmllcyA8IDYgJiYgIWV4aXRlckFmdGVyKTtcbiAgICB9XG4gICAgaWYgKHByZXZpb3VzU2libGluZy5sZW5ndGggPiAwKSB7XG4gICAgICBleGl0ZXJCZWZvcmUgPSBwcmV2aW91c1NpYmxpbmc7XG4gICAgfSBlbHNlIHtcbiAgICAgIGV4aXRlckJlZm9yZSA9ICRjdXJyZW50QmFzZS5wYXJlbnQoKTtcbiAgICB9XG5cbiAgICBleGl0ZXJCZWZvcmUuYXR0cigndGFiaW5kZXgnLCAnMCcpLmFkZENsYXNzKEVYSVRFUl9DTEFTUyk7XG4gICAgaWYgKGV4aXRlckFmdGVyKSB7XG4gICAgICBleGl0ZXJBZnRlci5hdHRyKCd0YWJpbmRleCcsICcwJykuYWRkQ2xhc3MoRVhJVEVSX0NMQVNTKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfb25MZWF2ZShlKSB7XG4gICAgX3Vuc2V0RXhpdGVycygpO1xuXG4gICAgdmFyICRyZWxhdGVkID0gZS5yZWxhdGVkVGFyZ2V0O1xuICAgIHZhciBpc0ZvY3VzZWQgPSBlLmN1cnJlbnRUYXJnZXQgPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG4gICAgaWYgKCRyZWxhdGVkICE9PSAkd3JhcHBlclswXSAmJiAhJC5jb250YWlucygkd3JhcHBlclswXSwgJHJlbGF0ZWQpICYmICFpc0ZvY3VzZWQpIHtcbiAgICAgIGhpZGUoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfb25FbnRlcihlKSB7XG4gICAgdmFyICR0YXJnID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuXG4gICAgaWYgKCR0YXJnLmlzKCdib2R5JykpIHtcbiAgICAgICR0YXJnID0gJChlLnRhcmdldCk7XG4gICAgfVxuXG4gICAgJGN1cnJlbnRCYXNlID0gJHRhcmc7XG4gICAgY3VycmVudENvbnRlbnQgPSAkY3VycmVudEJhc2UuYXR0cignZGF0YS10b29sdGlwLWNvbnRlbnQnKTtcblxuICAgIGlmIChjdXJyZW50Q29udGVudCAmJiBjdXJyZW50Q29udGVudCAhPT0gJycpIHtcbiAgICAgIHNob3coY3VycmVudENvbnRlbnQsICRjdXJyZW50QmFzZSk7XG4gICAgfVxuXG4gICAgaWYgKE1vZGVybml6ci50b3VjaCkge1xuICAgICAgX3NldEV4aXRlcnMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGUud2hpY2ggPT09IDApIHtcbiAgICAgICAgX3Vuc2V0RXhpdGVycygpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX3NldEV4aXRlcnMoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIF9vbkNsaWNrKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgdmFyIGVsZW1lbnQgPSAkKGUudGFyZ2V0KTtcbiAgICB2YXIgdGFnTmFtZSA9IGVsZW1lbnQucHJvcCgndGFnTmFtZScpO1xuXG4gICAgaWYgKGlzT3BlbiAmJiB0YWdOYW1lICE9PSAnSU5QVVQnKSB7XG4gICAgICBoaWRlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVsZW1lbnQuZm9jdXMoKTtcbiAgICAgIF9vbkVudGVyKGUpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9vbldyYXBwZXJMZWF2ZSgpIHtcbiAgICB2YXIgYWN0aXZlRWxlbWVudCA9ICQoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkucHJvcCgndGFnTmFtZScpO1xuICAgIGlmIChpc09wZW4gJiYgYWN0aXZlRWxlbWVudCAhPT0gJ0lOUFVUJykge1xuICAgICAgaGlkZSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9vblZpZXdwb3J0VXBkYXRlKCkge1xuICAgIHJlZnJlc2goKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9vbkV4aXRlckxlYXZlKGUpIHtcbiAgICBpZiAoISQoZS5yZWxhdGVkVGFyZ2V0KS5pcyhUQVJHRVRfU0VMRUNUT1IpKSB7XG4gICAgICBfdW5zZXRFeGl0ZXJzKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX2JpbmQoKSB7XG4gICAgdmFyICRib2R5ID0gJCgnYm9keScpO1xuXG4gICAgaWYgKE1vZGVybml6ci50b3VjaCkge1xuICAgICAgJGJvZHlbMF0uYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgJHRhcmcgPSAkKGUudGFyZ2V0KTtcbiAgICAgICAgdmFyIGlzVGlwID0gJHRhcmcuaXMoJy50b29sdGlwLXdyYXBwZXInKSB8fCAkdGFyZy5jbG9zZXN0KCcudG9vbHRpcC13cmFwcGVyJykubGVuZ3RoID4gMDtcbiAgICAgICAgaWYgKCR0YXJnLmlzKFRBUkdFVF9TRUxFQ1RPUikgfHwgKGlzT3BlbiAmJiAhaXNUaXApKSB7XG4gICAgICAgICAgX29uQ2xpY2soZSk7XG4gICAgICAgIH1cbiAgICAgIH0sIGZhbHNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGJvZHkub24oJ2NsaWNrJywgVEFSR0VUX1NFTEVDVE9SLCBfb25DbGljayk7XG4gICAgfVxuICAgICRib2R5Lm9uKCdtb3VzZW92ZXIgZm9jdXMnLCBUQVJHRVRfU0VMRUNUT1IsIF9vbkVudGVyKTtcbiAgICAkYm9keS5vbignbW91c2VvdXQgYmx1cicsIFRBUkdFVF9TRUxFQ1RPUiwgX29uTGVhdmUpO1xuICAgICR3cmFwcGVyLm9uKCdtb3VzZWxlYXZlJywgX29uV3JhcHBlckxlYXZlKTtcbiAgICAkYm9keS5vbignYmx1cicsIEVYSVRFUl9TRUxFQ1RPUiwgX29uRXhpdGVyTGVhdmUpO1xuXG4gICAgY2l0aVNoYXJlLm9uKCd2aWV3cG9ydDp1cGRhdGUnLCBfb25WaWV3cG9ydFVwZGF0ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfY3JlYXRlSG9sZGVyKCkge1xuICAgIGlmICgkd3JhcHBlcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgICRhcnJvdyA9ICQoJzxzcGFuIGNsYXNzPVwidG9vbHRpcC1hcnJvd1wiPjwvc3Bhbj4nKTtcbiAgICAkd3JhcHBlciA9ICQoJzxkaXYgcm9sZT1cInRvb2x0aXBcIiBjbGFzcz1cInRvb2x0aXAtd3JhcHBlclwiPjwvZGl2PicpO1xuICAgICRib3ggPSAkKCc8ZGl2IGNsYXNzPVwidWktdG9vbHRpcCB1aS13aWRnZXQgdWktY29ybmVyLWFsbCB1aS13aWRnZXQtY29udGVudCB0b29sdGlwLWJveFwiPjwvZGl2PicpO1xuICAgICRjb250ZW50ID0gJCgnPGRpdiBjbGFzcz1cInVpLXRvb2x0aXAtY29udGVudFwiPjwvZGl2PicpO1xuXG4gICAgJHdyYXBwZXIuY3NzKHtcbiAgICAgIGRpc3BsYXk6ICdub25lJyxcbiAgICAgIG9wYWNpdHk6IDBcbiAgICB9KTtcblxuICAgICR3cmFwcGVyLmFwcGVuZCgkYXJyb3cpO1xuICAgICR3cmFwcGVyLmFwcGVuZCgkYm94KTtcbiAgICAkYm94LmFwcGVuZCgkY29udGVudCk7XG4gICAgJCgnYm9keScpLmFwcGVuZCgkd3JhcHBlcik7XG5cbiAgICBpbml0aWFsQXJyb3dNYXJnaW4gPSBwYXJzZUludCgkYXJyb3cuY3NzKCdtYXJnaW4tbGVmdCcpLCAxMCk7XG4gIH1cblxuICBmdW5jdGlvbiBfaW5pdCgpIHtcbiAgICBpZiAoaW5pdGlhbGl6ZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpbml0aWFsaXplZCA9IHRydWU7XG5cbiAgICBfY3JlYXRlSG9sZGVyKCk7XG4gICAgcmVmcmVzaCgpO1xuICAgIF9iaW5kKCk7XG4gIH1cblxuICBfaW5pdCgpO1xuXG4gIHJldHVybiB7XG4gICAgcmVmcmVzaDogcmVmcmVzaCxcbiAgICBzaG93OiBzaG93LFxuICAgIGhpZGU6IGhpZGVcbiAgfTtcblxufSkoKTtcblxuIiwiLy9UaGlzIGlzIGdsb2JhbCB0byBrZWVwIHRyYWNrIG9mIGJyb3dzZXIgZGltZW5zaW9ucywgZXRjLiAgQWRkIGZ1bmN0aW9uYWxpdHkgaGVyZSBhcyBuZWVkZWQgKGkuZS4gc2Nyb2xsLCBoYXNoUGFyYW1zLCBldGMpXG4vL1xuY2l0aVNoYXJlLnZpZXdwb3J0ID0gKGZ1bmN0aW9uKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgdmFyIHdpbiA9IHtcbiAgICAgIHdpZHRoOjAsXG4gICAgICBoZWlnaHQ6MFxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBfZ2V0KCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgd2luOndpblxuICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfd2luKCkge1xuICAgICAgcmV0dXJuIHdpbjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfb25SZXNpemUoKSB7XG4gICAgICB2YXIgdyA9IHdpbmRvdy5pbm5lcldpZHRoIHx8ICQod2luZG93KS53aWR0aCgpO1xuICAgICAgdmFyIGggPSB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgJCh3aW5kb3cpLmhlaWdodCgpO1xuICAgICAgdmFyIHVwZGF0ZWQgPSB3aW4ud2lkdGggIT09IHcgfHwgd2luLmhlaWdodCAhPT0gaDtcblxuICAgICAgd2luLndpZHRoID0gdztcbiAgICAgIHdpbi5oZWlnaHQgPSBoO1xuXG4gICAgICBpZiAodXBkYXRlZCkge1xuICAgICAgICBjaXRpU2hhcmUudHJpZ2dlcigndmlld3BvcnQ6dXBkYXRlJywgd2luKTtcbiAgICAgIH1cblxuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9iaW5kKCkge1xuICAgICAgJCh3aW5kb3cpLm9uKCdyZXNpemUnLCBjaXRpU2hhcmUudXRpbC50aHJvdHRsZShfb25SZXNpemUsIDUwKSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2luaXQoKSB7XG4gICAgICBfYmluZCgpO1xuICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Jlc2l6ZScpO1xuICAgIH1cblxuICAgIF9pbml0KCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZ2V0Ol9nZXQsXG4gICAgICB3aW46X3dpblxuICAgIH07XG59KSgpO1xuXG4iXX0=
